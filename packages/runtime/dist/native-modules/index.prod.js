import{Protocol as e,Metadata as t,Registration as n,DI as r,firstDefined as s,mergeArrays as i,fromAnnotationOrDefinitionOrTypeOrDefault as o,isNumberOrBigInt as a,isStringOrDate as u,emptyArray as l,isArrayIndex as c,IPlatform as h,ILogger as d}from"../../../kernel/dist/native-modules/index.js";export{IPlatform}from"../../../kernel/dist/native-modules/index.js";export{Platform,Task,TaskAbortError,TaskQueue,TaskQueuePriority,TaskStatus}from"../../../platform/dist/native-modules/index.js";function f(...n){return function(r){const s=e.annotation.keyFor("aliases"),i=t.getOwn(s,r);void 0===i?t.define(s,n,r):i.push(...n)}}function p(e,t,r,s){for(let i=0,o=e.length;i<o;++i)n.aliasTo(r,t.keyFrom(e[i])).register(s)}const g=Object.freeze({});class v{constructor(e,t){if(void 0!==e)if(void 0!==t)this[e]=t;else for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this[t]=e[t])}static create(e,t){return new v(e,t)}static get(e,t,n,r){var s,i;if(null==e)throw new Error(`Scope is ${e}.`);let o=e.overrideContext,a=e;if(n>0){for(;n>0;)if(n--,a=a.parentScope,null==(null==a?void 0:a.overrideContext))return;return o=a.overrideContext,t in o?o:o.bindingContext}for(;!((null==a?void 0:a.isBoundary)||null==o||t in o||o.bindingContext&&t in o.bindingContext);)a=null!==(s=a.parentScope)&&void 0!==s?s:null,o=null!==(i=null==a?void 0:a.overrideContext)&&void 0!==i?i:null;return o?t in o?o:o.bindingContext:16&r?g:e.bindingContext||e.overrideContext}}class b{constructor(e,t,n,r){this.parentScope=e,this.bindingContext=t,this.overrideContext=n,this.isBoundary=r}static create(e,t,n){return new b(null,e,null==t?y.create(e):t,null!=n&&n)}static fromOverride(e){if(null==e)throw new Error(`OverrideContext is ${e}`);return new b(null,e.bindingContext,e,!1)}static fromParent(e,t){if(null==e)throw new Error(`ParentScope is ${e}`);return new b(e,t,y.create(t),!1)}}class y{constructor(e){this.bindingContext=e}static create(e){return new y(e)}}const m=r.createInterface("ISignaler",(e=>e.singleton(w)));class w{constructor(){this.signals=Object.create(null)}dispatchSignal(e,t){const n=this.signals[e];if(void 0!==n)for(const e of n.keys())e.handleChange(void 0,void 0,t)}addSignalListener(e,t){const n=this.signals,r=n[e];void 0===r?n[e]=new Set([t]):r.add(t)}removeSignalListener(e,t){const n=this.signals[e];n&&n.delete(t)}}var x;function C(e){return function(t){return S.define(e,t)}}!function(e){e[e.singleton=1]="singleton",e[e.interceptor=2]="interceptor"}(x||(x={}));class k{constructor(e,t,n,r,s){this.Type=e,this.name=t,this.aliases=n,this.key=r,this.strategy=s}static create(e,t){let n,r;"string"==typeof e?(n=e,r={name:n}):(n=e.name,r=e);const a=Object.getPrototypeOf(t)===T;return new k(t,s(S.getAnnotation(t,"name"),n),i(S.getAnnotation(t,"aliases"),r.aliases,t.aliases),S.keyFrom(n),o("strategy",r,t,(()=>a?2:1)))}register(e){const{Type:t,key:r,aliases:s,strategy:i}=this;switch(i){case 1:n.singleton(r,t).register(e);break;case 2:n.instance(r,new O(e,t)).register(e)}n.aliasTo(r,t).register(e),p(s,S,r,e)}}class O{constructor(e,t){this.container=e,this.Type=t,this.deps=r.getDependencies(t)}construct(e,t){const n=this.container,r=this.deps;switch(r.length){case 0:case 1:case 2:return new this.Type(e,t);case 3:return new this.Type(n.get(r[0]),e,t);case 4:return new this.Type(n.get(r[0]),n.get(r[1]),e,t);default:return new this.Type(...r.map((e=>n.get(e))),e,t)}}}class T{constructor(e,t){let n;for(this.binding=e,this.expr=t,this.interceptor=this;e.interceptor!==this;)n=e.interceptor,e.interceptor=this,e=n}get observerLocator(){return this.binding.observerLocator}get locator(){return this.binding.locator}get $scope(){return this.binding.$scope}get isBound(){return this.binding.isBound}get obs(){return this.binding.obs}get sourceExpression(){return this.binding.sourceExpression}updateTarget(e,t){this.binding.updateTarget(e,t)}updateSource(e,t){this.binding.updateSource(e,t)}callSource(e){return this.binding.callSource(e)}handleChange(e,t,n){this.binding.handleChange(e,t,n)}handleCollectionChange(e,t){this.binding.handleCollectionChange(e,t)}observeProperty(e,t){this.binding.observeProperty(e,t)}observeCollection(e){this.binding.observeCollection(e)}$bind(e,t){this.binding.$bind(e,t)}$unbind(e){this.binding.$unbind(e)}}const S={name:e.resource.keyFor("binding-behavior"),keyFrom:e=>`${S.name}:${e}`,isType:e=>"function"==typeof e&&t.hasOwn(S.name,e),define(n,r){const s=k.create(n,r);return t.define(S.name,s,s.Type),t.define(S.name,s,s),e.resource.appendTo(r,S.name),s.Type},getDefinition(e){const n=t.getOwn(S.name,e);if(void 0===n)throw new Error(`No definition found for type ${e.name}`);return n},annotate(n,r,s){t.define(e.annotation.keyFor(r),s,n)},getAnnotation:(n,r)=>t.getOwn(e.annotation.keyFor(r),n)};function $(e){return function(t){return E.define(e,t)}}class L{constructor(e,t,n,r){this.Type=e,this.name=t,this.aliases=n,this.key=r}static create(e,t){let n,r;return"string"==typeof e?(n=e,r={name:n}):(n=e.name,r=e),new L(t,s(E.getAnnotation(t,"name"),n),i(E.getAnnotation(t,"aliases"),r.aliases,t.aliases),E.keyFrom(n))}register(e){const{Type:t,key:r,aliases:s}=this;n.singleton(r,t).register(e),n.aliasTo(r,t).register(e),p(s,E,r,e)}}const E={name:e.resource.keyFor("value-converter"),keyFrom:e=>`${E.name}:${e}`,isType:e=>"function"==typeof e&&t.hasOwn(E.name,e),define(n,r){const s=L.create(n,r);return t.define(E.name,s,s.Type),t.define(E.name,s,s),e.resource.appendTo(r,E.name),s.Type},getDefinition(e){const n=t.getOwn(E.name,e);if(void 0===n)throw new Error(`No definition found for type ${e.name}`);return n},annotate(n,r,s){t.define(e.annotation.keyFor(r),s,n)},getAnnotation:(n,r)=>t.getOwn(e.annotation.keyFor(r),n)};var A;!function(e){e[e.Connects=32]="Connects",e[e.Observes=64]="Observes",e[e.CallsFunction=128]="CallsFunction",e[e.HasAncestor=256]="HasAncestor",e[e.IsPrimary=512]="IsPrimary",e[e.IsLeftHandSide=1024]="IsLeftHandSide",e[e.HasBind=2048]="HasBind",e[e.HasUnbind=4096]="HasUnbind",e[e.IsAssignable=8192]="IsAssignable",e[e.IsLiteral=16384]="IsLiteral",e[e.IsResource=32768]="IsResource",e[e.IsForDeclaration=65536]="IsForDeclaration",e[e.Type=31]="Type",e[e.AccessThis=1793]="AccessThis",e[e.AccessScope=10082]="AccessScope",e[e.ArrayLiteral=17955]="ArrayLiteral",e[e.ObjectLiteral=17956]="ObjectLiteral",e[e.PrimitiveLiteral=17925]="PrimitiveLiteral",e[e.Template=17958]="Template",e[e.Unary=39]="Unary",e[e.CallScope=1448]="CallScope",e[e.CallMember=1161]="CallMember",e[e.CallFunction=1162]="CallFunction",e[e.AccessMember=9323]="AccessMember",e[e.AccessKeyed=9324]="AccessKeyed",e[e.TaggedTemplate=1197]="TaggedTemplate",e[e.Binary=46]="Binary",e[e.Conditional=63]="Conditional",e[e.Assign=8208]="Assign",e[e.ValueConverter=36913]="ValueConverter",e[e.BindingBehavior=38962]="BindingBehavior",e[e.HtmlLiteral=51]="HtmlLiteral",e[e.ArrayBindingPattern=65556]="ArrayBindingPattern",e[e.ObjectBindingPattern=65557]="ObjectBindingPattern",e[e.BindingIdentifier=65558]="BindingIdentifier",e[e.ForOfStatement=6199]="ForOfStatement",e[e.Interpolation=24]="Interpolation"}(A||(A={}));class U{constructor(){this.text=""}static unparse(e){const t=new U;return e.accept(t),t.text}visitAccessMember(e){e.object.accept(this),this.text+=`.${e.name}`}visitAccessKeyed(e){e.object.accept(this),this.text+="[",e.key.accept(this),this.text+="]"}visitAccessThis(e){if(0===e.ancestor)return void(this.text+="$this");this.text+="$parent";let t=e.ancestor-1;for(;t--;)this.text+=".$parent"}visitAccessScope(e){let t=e.ancestor;for(;t--;)this.text+="$parent.";this.text+=e.name}visitArrayLiteral(e){const t=e.elements;this.text+="[";for(let e=0,n=t.length;e<n;++e)0!==e&&(this.text+=","),t[e].accept(this);this.text+="]"}visitObjectLiteral(e){const t=e.keys,n=e.values;this.text+="{";for(let e=0,r=t.length;e<r;++e)0!==e&&(this.text+=","),this.text+=`'${t[e]}':`,n[e].accept(this);this.text+="}"}visitPrimitiveLiteral(e){if(this.text+="(","string"==typeof e.value){const t=e.value.replace(/'/g,"\\'");this.text+=`'${t}'`}else this.text+=`${e.value}`;this.text+=")"}visitCallFunction(e){this.text+="(",e.func.accept(this),this.writeArgs(e.args),this.text+=")"}visitCallMember(e){this.text+="(",e.object.accept(this),this.text+=`.${e.name}`,this.writeArgs(e.args),this.text+=")"}visitCallScope(e){this.text+="(";let t=e.ancestor;for(;t--;)this.text+="$parent.";this.text+=e.name,this.writeArgs(e.args),this.text+=")"}visitTemplate(e){const{cooked:t,expressions:n}=e,r=n.length;this.text+="`",this.text+=t[0];for(let e=0;e<r;e++)n[e].accept(this),this.text+=t[e+1];this.text+="`"}visitTaggedTemplate(e){const{cooked:t,expressions:n}=e,r=n.length;e.func.accept(this),this.text+="`",this.text+=t[0];for(let e=0;e<r;e++)n[e].accept(this),this.text+=t[e+1];this.text+="`"}visitUnary(e){this.text+=`(${e.operation}`,e.operation.charCodeAt(0)>=97&&(this.text+=" "),e.expression.accept(this),this.text+=")"}visitBinary(e){this.text+="(",e.left.accept(this),105===e.operation.charCodeAt(0)?this.text+=` ${e.operation} `:this.text+=e.operation,e.right.accept(this),this.text+=")"}visitConditional(e){this.text+="(",e.condition.accept(this),this.text+="?",e.yes.accept(this),this.text+=":",e.no.accept(this),this.text+=")"}visitAssign(e){this.text+="(",e.target.accept(this),this.text+="=",e.value.accept(this),this.text+=")"}visitValueConverter(e){const t=e.args;e.expression.accept(this),this.text+=`|${e.name}`;for(let e=0,n=t.length;e<n;++e)this.text+=":",t[e].accept(this)}visitBindingBehavior(e){const t=e.args;e.expression.accept(this),this.text+=`&${e.name}`;for(let e=0,n=t.length;e<n;++e)this.text+=":",t[e].accept(this)}visitArrayBindingPattern(e){const t=e.elements;this.text+="[";for(let e=0,n=t.length;e<n;++e)0!==e&&(this.text+=","),t[e].accept(this);this.text+="]"}visitObjectBindingPattern(e){const t=e.keys,n=e.values;this.text+="{";for(let e=0,r=t.length;e<r;++e)0!==e&&(this.text+=","),this.text+=`'${t[e]}':`,n[e].accept(this);this.text+="}"}visitBindingIdentifier(e){this.text+=e.name}visitHtmlLiteral(e){throw new Error("visitHtmlLiteral")}visitForOfStatement(e){e.declaration.accept(this),this.text+=" of ",e.iterable.accept(this)}visitInterpolation(e){const{parts:t,expressions:n}=e,r=n.length;this.text+="${",this.text+=t[0];for(let e=0;e<r;e++)n[e].accept(this),this.text+=t[e+1];this.text+="}"}writeArgs(e){this.text+="(";for(let t=0,n=e.length;t<n;++t)0!==t&&(this.text+=","),e[t].accept(this);this.text+=")"}}class I{constructor(e){this.value=e}evaluate(e,t,n,r){return this.value}}class B{constructor(e,t,n){this.expression=e,this.name=t,this.args=n,this.behaviorKey=S.keyFrom(t)}get $kind(){return 38962}get hasBind(){return!0}get hasUnbind(){return!0}evaluate(e,t,n,r){return this.expression.evaluate(e,t,n,r)}assign(e,t,n,r){return this.expression.assign(e,t,n,r)}bind(e,t,n){this.expression.hasBind&&this.expression.bind(e,t,n);const r=n.locator.get(this.behaviorKey);if(null==r)throw new Error(`BindingBehavior named '${this.name}' could not be found. Did you forget to register it as a dependency?`);if(!(r instanceof O)){if(void 0!==n[this.behaviorKey])throw new Error(`BindingBehavior named '${this.name}' already applied.`);n[this.behaviorKey]=r,r.bind.call(r,e,t,n,...this.args.map((r=>r.evaluate(e,t,n.locator,null))))}}unbind(e,t,n){const r=this.behaviorKey,s=n;void 0!==s[r]&&("function"==typeof s[r].unbind&&s[r].unbind(e,t,n),s[r]=void 0),this.expression.hasUnbind&&this.expression.unbind(e,t,n)}accept(e){return e.visitBindingBehavior(this)}toString(){return U.unparse(this)}}class j{constructor(e,t,n){this.expression=e,this.name=t,this.args=n,this.converterKey=E.keyFrom(t)}get $kind(){return 36913}get hasBind(){return!1}get hasUnbind(){return!0}evaluate(e,t,n,r){const s=n.get(this.converterKey);if(null==s)throw new Error(`ValueConverter named '${this.name}' could not be found. Did you forget to register it as a dependency?`);if(null!==r&&"handleChange"in r){const e=s.signals;if(null!=e){const t=n.get(m);for(let n=0,s=e.length;n<s;++n)t.addSignalListener(e[n],r)}}return"toView"in s?s.toView(this.expression.evaluate(e,t,n,r),...this.args.map((s=>s.evaluate(e,t,n,r)))):this.expression.evaluate(e,t,n,r)}assign(e,t,n,r){const s=n.get(this.converterKey);if(null==s)throw new Error(`ValueConverter named '${this.name}' could not be found. Did you forget to register it as a dependency?`);return"fromView"in s&&(r=s.fromView(r,...this.args.map((r=>r.evaluate(e,t,n,null))))),this.expression.assign(e,t,n,r)}unbind(e,t,n){const r=n.locator.get(this.converterKey);if(void 0===r.signals)return;const s=n.locator.get(m);for(let e=0;e<r.signals.length;++e)s.removeSignalListener(r.signals[e],n)}accept(e){return e.visitValueConverter(this)}toString(){return U.unparse(this)}}class V{constructor(e,t){this.target=e,this.value=t}get $kind(){return 8208}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){return this.target.assign(e,t,n,this.value.evaluate(e,t,n,r))}assign(e,t,n,r){return this.value.assign(e,t,n,r),this.target.assign(e,t,n,r)}accept(e){return e.visitAssign(this)}toString(){return U.unparse(this)}}class P{constructor(e,t,n){this.condition=e,this.yes=t,this.no=n}get $kind(){return 63}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){return this.condition.evaluate(e,t,n,r)?this.yes.evaluate(e,t,n,r):this.no.evaluate(e,t,n,r)}assign(e,t,n,r){}accept(e){return e.visitConditional(this)}toString(){return U.unparse(this)}}class M{constructor(e=0){this.ancestor=e}get $kind(){return 1793}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){var s;let i=t.overrideContext,o=t,a=this.ancestor;for(;a--&&i;)o=o.parentScope,i=null!==(s=null==o?void 0:o.overrideContext)&&void 0!==s?s:null;return a<1&&i?i.bindingContext:void 0}assign(e,t,n,r){}accept(e){return e.visitAccessThis(this)}toString(){return U.unparse(this)}}M.$this=new M(0),M.$parent=new M(1);class _{constructor(e,t=0){this.name=e,this.ancestor=t}get $kind(){return 10082}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){const s=v.get(t,this.name,this.ancestor,e);null!==r&&r.observeProperty(s,this.name);const i=s[this.name];if(null==i&&"$host"===this.name)throw new Error("Unable to find $host context. Did you forget [au-slot] attribute?");return 1&e?i:null==i?"":i}assign(e,t,n,r){var s;if("$host"===this.name)throw new Error("Invalid assignment. $host is a reserved keyword.");const i=v.get(t,this.name,this.ancestor,e);if(i instanceof Object)return void 0!==(null===(s=i.$observers)||void 0===s?void 0:s[this.name])?(i.$observers[this.name].setValue(r,e),r):i[this.name]=r}accept(e){return e.visitAccessScope(this)}toString(){return U.unparse(this)}}class F{constructor(e,t){this.object=e,this.name=t}get $kind(){return 9323}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){const s=this.object.evaluate(e,t,n,(128&e)>0?null:r);return 1&e?null==s?s:(null!==r&&r.observeProperty(s,this.name),s[this.name]):(null!==r&&s instanceof Object&&r.observeProperty(s,this.name),s?s[this.name]:"")}assign(e,t,n,r){const s=this.object.evaluate(e,t,n,null);return s instanceof Object?void 0!==s.$observers&&void 0!==s.$observers[this.name]?s.$observers[this.name].setValue(r,e):s[this.name]=r:this.object.assign(e,t,n,{[this.name]:r}),r}accept(e){return e.visitAccessMember(this)}toString(){return U.unparse(this)}}class K{constructor(e,t){this.object=e,this.key=t}get $kind(){return 9324}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){const s=this.object.evaluate(e,t,n,(128&e)>0?null:r);if(s instanceof Object){const i=this.key.evaluate(e,t,n,(128&e)>0?null:r);return null!==r&&r.observeProperty(s,i),s[i]}}assign(e,t,n,r){return this.object.evaluate(e,t,n,null)[this.key.evaluate(e,t,n,null)]=r}accept(e){return e.visitAccessKeyed(this)}toString(){return U.unparse(this)}}class D{constructor(e,t,n=0){this.name=e,this.args=t,this.ancestor=n}get $kind(){return 1448}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){const s=this.args.map((s=>s.evaluate(e,t,n,r))),i=v.get(t,this.name,this.ancestor,e),o=se(e,i,this.name);if(o)return o.apply(i,s)}assign(e,t,n,r){}accept(e){return e.visitCallScope(this)}toString(){return U.unparse(this)}}class q{constructor(e,t,n){this.object=e,this.name=t,this.args=n}get $kind(){return 1161}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){const s=this.object.evaluate(e,t,n,(128&e)>0?null:r),i=this.args.map((s=>s.evaluate(e,t,n,r))),o=se(e,s,this.name);if(o)return o.apply(s,i)}assign(e,t,n,r){}accept(e){return e.visitCallMember(this)}toString(){return U.unparse(this)}}class N{constructor(e,t){this.func=e,this.args=t}get $kind(){return 1162}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){const s=this.func.evaluate(e,t,n,r);if("function"==typeof s)return s(...this.args.map((s=>s.evaluate(e,t,n,r))));if(8&e||null!=s)throw new Error("Expression is not a function.")}assign(e,t,n,r){}accept(e){return e.visitCallFunction(this)}toString(){return U.unparse(this)}}class R{constructor(e,t,n){this.operation=e,this.left=t,this.right=n}get $kind(){return 46}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){switch(this.operation){case"&&":return this.left.evaluate(e,t,n,r)&&this.right.evaluate(e,t,n,r);case"||":return this.left.evaluate(e,t,n,r)||this.right.evaluate(e,t,n,r);case"==":return this.left.evaluate(e,t,n,r)==this.right.evaluate(e,t,n,r);case"===":return this.left.evaluate(e,t,n,r)===this.right.evaluate(e,t,n,r);case"!=":return this.left.evaluate(e,t,n,r)!=this.right.evaluate(e,t,n,r);case"!==":return this.left.evaluate(e,t,n,r)!==this.right.evaluate(e,t,n,r);case"instanceof":{const s=this.right.evaluate(e,t,n,r);return"function"==typeof s&&this.left.evaluate(e,t,n,r)instanceof s}case"in":{const s=this.right.evaluate(e,t,n,r);return s instanceof Object&&this.left.evaluate(e,t,n,r)in s}case"+":{const s=this.left.evaluate(e,t,n,r),i=this.right.evaluate(e,t,n,r);if((1&e)>0)return s+i;if(!s||!i){if(a(s)||a(i))return(s||0)+(i||0);if(u(s)||u(i))return(s||"")+(i||"")}return s+i}case"-":return this.left.evaluate(e,t,n,r)-this.right.evaluate(e,t,n,r);case"*":return this.left.evaluate(e,t,n,r)*this.right.evaluate(e,t,n,r);case"/":return this.left.evaluate(e,t,n,r)/this.right.evaluate(e,t,n,r);case"%":return this.left.evaluate(e,t,n,r)%this.right.evaluate(e,t,n,r);case"<":return this.left.evaluate(e,t,n,r)<this.right.evaluate(e,t,n,r);case">":return this.left.evaluate(e,t,n,r)>this.right.evaluate(e,t,n,r);case"<=":return this.left.evaluate(e,t,n,r)<=this.right.evaluate(e,t,n,r);case">=":return this.left.evaluate(e,t,n,r)>=this.right.evaluate(e,t,n,r);default:throw new Error(`Unknown binary operator: '${this.operation}'`)}}assign(e,t,n,r){}accept(e){return e.visitBinary(this)}toString(){return U.unparse(this)}}class z{constructor(e,t){this.operation=e,this.expression=t}get $kind(){return 39}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){switch(this.operation){case"void":return void this.expression.evaluate(e,t,n,r);case"typeof":return typeof this.expression.evaluate(1|e,t,n,r);case"!":return!this.expression.evaluate(e,t,n,r);case"-":return-this.expression.evaluate(e,t,n,r);case"+":return+this.expression.evaluate(e,t,n,r);default:throw new Error(`Unknown unary operator: '${this.operation}'`)}}assign(e,t,n,r){}accept(e){return e.visitUnary(this)}toString(){return U.unparse(this)}}class H{constructor(e){this.value=e}get $kind(){return 17925}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){return this.value}assign(e,t,n,r){}accept(e){return e.visitPrimitiveLiteral(this)}toString(){return U.unparse(this)}}H.$undefined=new H(void 0),H.$null=new H(null),H.$true=new H(!0),H.$false=new H(!1),H.$empty=new H("");class Q{constructor(e){this.parts=e}get $kind(){return 51}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){let s="";for(let i=0;i<this.parts.length;++i){const o=this.parts[i].evaluate(e,t,n,r);null!=o&&(s+=o)}return s}assign(e,t,n,r,s){}accept(e){return e.visitHtmlLiteral(this)}toString(){return U.unparse(this)}}class W{constructor(e){this.elements=e}get $kind(){return 17955}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){return this.elements.map((s=>s.evaluate(e,t,n,r)))}assign(e,t,n,r){}accept(e){return e.visitArrayLiteral(this)}toString(){return U.unparse(this)}}W.$empty=new W(l);class G{constructor(e,t){this.keys=e,this.values=t}get $kind(){return 17956}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){const s={};for(let i=0;i<this.keys.length;++i)s[this.keys[i]]=this.values[i].evaluate(e,t,n,r);return s}assign(e,t,n,r){}accept(e){return e.visitObjectLiteral(this)}toString(){return U.unparse(this)}}G.$empty=new G(l,l);class Z{constructor(e,t=l){this.cooked=e,this.expressions=t}get $kind(){return 17958}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){let s=this.cooked[0];for(let i=0;i<this.expressions.length;++i)s+=String(this.expressions[i].evaluate(e,t,n,r)),s+=this.cooked[i+1];return s}assign(e,t,n,r){}accept(e){return e.visitTemplate(this)}toString(){return U.unparse(this)}}Z.$empty=new Z([""]);class J{constructor(e,t,n,r=l){this.cooked=e,this.func=n,this.expressions=r,e.raw=t}get $kind(){return 1197}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){const s=this.expressions.map((s=>s.evaluate(e,t,n,r))),i=this.func.evaluate(e,t,n,r);if("function"!=typeof i)throw new Error("Left-hand side of tagged template expression is not a function.");return i(this.cooked,...s)}assign(e,t,n,r){}accept(e){return e.visitTaggedTemplate(this)}toString(){return U.unparse(this)}}class X{constructor(e){this.elements=e}get $kind(){return 65556}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){}assign(e,t,n,r){}accept(e){return e.visitArrayBindingPattern(this)}toString(){return U.unparse(this)}}class Y{constructor(e,t){this.keys=e,this.values=t}get $kind(){return 65557}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){}assign(e,t,n,r){}accept(e){return e.visitObjectBindingPattern(this)}toString(){return U.unparse(this)}}class ee{constructor(e){this.name=e}get $kind(){return 65558}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){return this.name}accept(e){return e.visitBindingIdentifier(this)}toString(){return U.unparse(this)}}const te=Object.prototype.toString;class ne{constructor(e,t){this.declaration=e,this.iterable=t}get $kind(){return 6199}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){return this.iterable.evaluate(e,t,n,r)}assign(e,t,n,r){}count(e,t){switch(te.call(t)){case"[object Array]":return t.length;case"[object Map]":case"[object Set]":return t.size;case"[object Number]":return t;case"[object Null]":case"[object Undefined]":return 0;default:throw new Error(`Cannot count ${te.call(t)}`)}}iterate(e,t,n){switch(te.call(t)){case"[object Array]":return ie(t,n);case"[object Map]":return function(e,t){const n=Array(e.size);let r=-1;for(const t of e.entries())n[++r]=t;ie(n,t)}(t,n);case"[object Set]":return function(e,t){const n=Array(e.size);let r=-1;for(const t of e.keys())n[++r]=t;ie(n,t)}(t,n);case"[object Number]":return function(e,t){const n=Array(e);for(let t=0;t<e;++t)n[t]=t;ie(n,t)}(t,n);case"[object Null]":case"[object Undefined]":return;default:throw new Error(`Cannot iterate over ${te.call(t)}`)}}bind(e,t,n){this.iterable.hasBind&&this.iterable.bind(e,t,n)}unbind(e,t,n){this.iterable.hasUnbind&&this.iterable.unbind(e,t,n)}accept(e){return e.visitForOfStatement(this)}toString(){return U.unparse(this)}}class re{constructor(e,t=l){this.parts=e,this.expressions=t,this.isMulti=t.length>1,this.firstExpression=t[0]}get $kind(){return 24}get hasBind(){return!1}get hasUnbind(){return!1}evaluate(e,t,n,r){if(this.isMulti){let s=this.parts[0];for(let i=0;i<this.expressions.length;++i)s+=String(this.expressions[i].evaluate(e,t,n,r)),s+=this.parts[i+1];return s}return`${this.parts[0]}${this.firstExpression.evaluate(e,t,n,r)}${this.parts[1]}`}assign(e,t,n,r){}accept(e){return e.visitInterpolation(this)}toString(){return U.unparse(this)}}function se(e,t,n){const r=null==t?null:t[n];if("function"==typeof r)return r;if(!(8&e)&&null==r)return null;throw new Error(`Expected '${n}' to be a function`)}function ie(e,t){for(let n=0,r=e.length;n<r;++n)t(e,n,e[n])}const oe=Reflect.defineProperty;function ae(e,t,n){oe(e,t,{enumerable:!1,configurable:!0,writable:!0,value:n})}function ue(e,t,n,r=!1){!r&&Object.prototype.hasOwnProperty.call(e,t)||ae(e,t,n)}var le,ce,he,de,fe,pe;function ge(e,t){const{length:n}=e,r=Array(n);let s=0;for(;s<n;)r[s]=e[s],++s;return r.deletedItems=void 0!==t?t.slice(0):void 0!==e.deletedItems?e.deletedItems.slice(0):[],r.isIndexMap=!0,r}function ve(e=0){const t=Array(e);let n=0;for(;n<e;)t[n]=n++;return t.deletedItems=[],t.isIndexMap=!0,t}function be(e){const t=e.slice();return t.deletedItems=e.deletedItems.slice(),t.isIndexMap=!0,t}function ye(e){return e instanceof Array&&!0===e.isIndexMap}function me(e){return null==e?we:we(e)}function we(e){const t=e.prototype;oe(t,"subs",{get:Ce}),ue(t,"subscribe",ke),ue(t,"unsubscribe",Oe)}!function(e){e[e.oneTime=1]="oneTime",e[e.toView=2]="toView",e[e.fromView=4]="fromView",e[e.twoWay=6]="twoWay",e[e.default=8]="default"}(le||(le={})),function(e){e[e.none=0]="none",e[e.persistentBindingFlags=961]="persistentBindingFlags",e[e.allowParentScopeTraversal=64]="allowParentScopeTraversal",e[e.observeLeafPropertiesOnly=128]="observeLeafPropertiesOnly",e[e.targetObserverFlags=769]="targetObserverFlags",e[e.noFlush=256]="noFlush",e[e.persistentTargetObserverQueue=512]="persistentTargetObserverQueue",e[e.bindingStrategy=1]="bindingStrategy",e[e.isStrictBindingStrategy=1]="isStrictBindingStrategy",e[e.fromBind=2]="fromBind",e[e.fromUnbind=4]="fromUnbind",e[e.mustEvaluate=8]="mustEvaluate",e[e.isTraversingParentScope=16]="isTraversingParentScope",e[e.dispose=32]="dispose"}(ce||(ce={})),function(e){e[e.None=0]="None",e[e.Subscriber0=1]="Subscriber0",e[e.Subscriber1=2]="Subscriber1",e[e.Subscriber2=4]="Subscriber2",e[e.SubscribersRest=8]="SubscribersRest",e[e.Any=15]="Any"}(he||(he={})),function(e){e[e.none=0]="none",e[e.capturing=1]="capturing",e[e.bubbling=2]="bubbling"}(de||(de={})),function(e){e[e.indexed=8]="indexed",e[e.keyed=4]="keyed",e[e.array=9]="array",e[e.map=6]="map",e[e.set=7]="set"}(fe||(fe={})),function(e){e[e.None=0]="None",e[e.Observer=1]="Observer",e[e.Node=2]="Node",e[e.Layout=4]="Layout",e[e.Primtive=8]="Primtive",e[e.Array=18]="Array",e[e.Set=34]="Set",e[e.Map=66]="Map"}(pe||(pe={}));class xe{constructor(){this._sf=0,this.count=0}add(e){if(this.has(e))return!1;const t=this._sf;return 0==(1&t)?(this._s0=e,this._sf|=1):0==(2&t)?(this._s1=e,this._sf|=2):0==(4&t)?(this._s2=e,this._sf|=4):0==(8&t)?(this._sr=[e],this._sf|=8):this._sr.push(e),++this.count,!0}has(e){const t=this._sf;if((1&t)>0&&this._s0===e)return!0;if((2&t)>0&&this._s1===e)return!0;if((4&t)>0&&this._s2===e)return!0;if((8&t)>0){const t=this._sr,n=t.length;let r=0;for(;r<n;++r)if(t[r]===e)return!0}return!1}any(){return 0!==this._sf}remove(e){const t=this._sf;if((1&t)>0&&this._s0===e)return this._s0=void 0,this._sf=1^(1|this._sf),--this.count,!0;if((2&t)>0&&this._s1===e)return this._s1=void 0,this._sf=2^(2|this._sf),--this.count,!0;if((4&t)>0&&this._s2===e)return this._s2=void 0,this._sf=4^(4|this._sf),--this.count,!0;if((8&t)>0){const t=this._sr,n=t.length;let r=0;for(;r<n;++r)if(t[r]===e)return t.splice(r,1),1===n&&(this._sf=8^(8|this._sf)),--this.count,!0}return!1}notify(e,t,n){const r=this._s0,s=this._s1,i=this._s2;let o=this._sr;if(void 0!==o&&(o=o.slice()),void 0!==r&&r.handleChange(e,t,n),void 0!==s&&s.handleChange(e,t,n),void 0!==i&&i.handleChange(e,t,n),void 0!==o){const r=o.length;let s,i=0;for(;i<r;++i)s=o[i],void 0!==s&&s.handleChange(e,t,n)}}notifyCollection(e,t){const n=this._s0,r=this._s1,s=this._s2;let i=this._sr;if(void 0!==i&&(i=i.slice()),void 0!==n&&n.handleCollectionChange(e,t),void 0!==r&&r.handleCollectionChange(e,t),void 0!==s&&s.handleCollectionChange(e,t),void 0!==i){const n=i.length;let r,s=0;for(;s<n;++s)r=i[s],void 0!==r&&r.handleCollectionChange(e,t)}}}function Ce(){const e=new xe;return ae(this,"subs",e),e}function ke(e){return this.subs.add(e)}function Oe(e){return this.subs.remove(e)}function Te(e){return null==e?Se:Se(e)}function Se(e){oe(e.prototype,"queue",{get:Le})}class $e{constructor(){this.flushing=!1,this.items=new Set}get count(){return this.items.size}add(e){if(this.items.add(e),this.flushing)return;this.flushing=!0;const t=this.items;let n;try{for(n of t)t.delete(n),n.flush()}finally{this.flushing=!1}}clear(){this.items.clear(),this.flushing=!1}}function Le(){return $e.instance}$e.instance=new $e;class Ee{constructor(e){this.owner=e,this.f=0,this.type=18,this.value=this.oldvalue=(this.obj=e.collection).length}getValue(){return this.obj.length}setValue(e,t){const n=this.value;e!==n&&c(e)&&(0==(256&t)&&(this.obj.length=e),this.value=e,this.oldvalue=n,this.f=t,this.queue.add(this))}handleCollectionChange(e,t){const n=this.value;(this.value=this.obj.length)!==n&&(this.oldvalue=n,this.f=t,this.queue.add(this))}flush(){je=this.oldvalue,this.oldvalue=this.value,this.subs.notify(this.value,je,this.f)}}class Ae{constructor(e){this.owner=e,this.f=0,this.value=this.oldvalue=(this.obj=e.collection).size,this.type=this.obj instanceof Map?66:34}getValue(){return this.obj.size}setValue(){throw new Error('Map/Set "size" is a readonly property')}handleCollectionChange(e,t){const n=this.value;(this.value=this.obj.size)!==n&&(this.oldvalue=n,this.f=t,this.queue.add(this))}flush(){je=this.oldvalue,this.oldvalue=this.value,this.subs.notify(this.value,je,this.f)}}function Ue(e){const t=e.prototype;ue(t,"subscribe",Ie,!0),ue(t,"unsubscribe",Be,!0),Te(e),me(e)}function Ie(e){this.subs.add(e)&&1===this.subs.count&&this.owner.subscribe(this)}function Be(e){this.subs.remove(e)&&0===this.subs.count&&this.owner.subscribe(this)}let je;Ue(Ee),Ue(Ae);const Ve=new WeakMap;function Pe(e,t){return e===t?0:(e=null===e?"null":e.toString())<(t=null===t?"null":t.toString())?-1:1}function Me(e,t){return void 0===e?void 0===t?0:1:void 0===t?-1:0}function _e(e,t,n,r,s){let i,o,a,u,l,c,h;for(c=n+1;c<r;c++){for(i=e[c],o=t[c],h=c-1;h>=n&&(a=e[h],u=t[h],l=s(a,i),l>0);h--)e[h+1]=a,t[h+1]=u;e[h+1]=i,t[h+1]=o}}function Fe(e,t,n,r,s){let i,o,a,u,l,c,h,d,f,p,g,v,b,y,m,w,x,C,k,O=0,T=0;for(;;){if(r-n<=10)return void _e(e,t,n,r,s);O=n+(r-n>>1),i=e[n],u=t[n],o=e[r-1],l=t[r-1],a=e[O],c=t[O],h=s(i,o),h>0&&(p=i,g=u,i=o,u=l,o=p,l=g),d=s(i,a),d>=0?(p=i,g=u,i=a,u=c,a=o,c=l,o=p,l=g):(f=s(o,a),f>0&&(p=o,g=l,o=a,l=c,a=p,c=g)),e[n]=i,t[n]=u,e[r-1]=a,t[r-1]=c,v=o,b=l,y=n+1,m=r-1,e[O]=e[y],t[O]=t[y],e[y]=v,t[y]=b;e:for(T=y+1;T<m;T++)if(w=e[T],x=t[T],C=s(w,v),C<0)e[T]=e[y],t[T]=t[y],e[y]=w,t[y]=x,y++;else if(C>0){do{if(m--,m==T)break e;k=e[m],C=s(k,v)}while(C>0);e[T]=e[m],t[T]=t[m],e[m]=w,t[m]=x,C<0&&(w=e[T],x=t[T],e[T]=e[y],t[T]=t[y],e[y]=w,t[y]=x,y++)}r-m<y-n?(Fe(e,t,m,r,s),r=y):(Fe(e,t,n,y,s),n=m)}}const Ke=Array.prototype,De=Ke.push,qe=Ke.unshift,Ne=Ke.pop,Re=Ke.shift,ze=Ke.splice,He=Ke.reverse,Qe=Ke.sort,We={push:De,unshift:qe,pop:Ne,shift:Re,splice:ze,reverse:He,sort:Qe},Ge=["push","unshift","pop","shift","splice","reverse","sort"],Ze={push:function(...e){const t=Ve.get(this);if(void 0===t)return De.apply(this,e);const n=this.length,r=e.length;if(0===r)return n;this.length=t.indexMap.length=n+r;let s=n;for(;s<this.length;)this[s]=e[s-n],t.indexMap[s]=-2,s++;return t.notify(),this.length},unshift:function(...e){const t=Ve.get(this);if(void 0===t)return qe.apply(this,e);const n=e.length,r=new Array(n);let s=0;for(;s<n;)r[s++]=-2;qe.apply(t.indexMap,r);const i=qe.apply(this,e);return t.notify(),i},pop:function(){const e=Ve.get(this);if(void 0===e)return Ne.call(this);const t=e.indexMap,n=Ne.call(this),r=t.length-1;return t[r]>-1&&t.deletedItems.push(t[r]),Ne.call(t),e.notify(),n},shift:function(){const e=Ve.get(this);if(void 0===e)return Re.call(this);const t=e.indexMap,n=Re.call(this);return t[0]>-1&&t.deletedItems.push(t[0]),Re.call(t),e.notify(),n},splice:function(...e){const t=e[0],n=e[1],r=Ve.get(this);if(void 0===r)return ze.apply(this,e);const s=this.length,i=0|t,o=i<0?Math.max(s+i,0):Math.min(i,s),a=r.indexMap,u=e.length,l=0===u?0:1===u?s-o:n;if(l>0){let e=o;const t=e+l;for(;e<t;)a[e]>-1&&a.deletedItems.push(a[e]),e++}if(u>2){const e=u-2,r=new Array(e);let s=0;for(;s<e;)r[s++]=-2;ze.call(a,t,n,...r)}else ze.apply(a,e);const c=ze.apply(this,e);return r.notify(),c},reverse:function(){const e=Ve.get(this);if(void 0===e)return He.call(this),this;const t=this.length,n=t/2|0;let r=0;for(;r!==n;){const n=t-r-1,s=this[r],i=e.indexMap[r],o=e.indexMap[n];this[r]=this[n],e.indexMap[r]=o,this[n]=s,e.indexMap[n]=i,r++}return e.notify(),this},sort:function(e){const t=Ve.get(this);if(void 0===t)return Qe.call(this,e),this;const n=this.length;if(n<2)return this;Fe(this,t.indexMap,0,n,Me);let r=0;for(;r<n&&void 0!==this[r];)r++;return void 0!==e&&"function"==typeof e||(e=Pe),Fe(this,t.indexMap,0,r,e),t.notify(),this}};for(const e of Ge)oe(Ze[e],"observing",{value:!0,writable:!1,configurable:!1,enumerable:!1});let Je=!1;function Xe(){for(const e of Ge)!0!==Ke[e].observing&&ae(Ke,e,Ze[e])}function Ye(){for(const e of Ge)!0===Ke[e].observing&&ae(Ke,e,We[e])}class et{constructor(e){this.type=18,Je||(Je=!0,Xe()),this.indexObservers={},this.collection=e,this.indexMap=ve(e.length),this.lenObs=void 0,Ve.set(e,this)}notify(){const e=this.indexMap;this.indexMap=ve(this.collection.length),this.subs.notifyCollection(e,0)}getLengthObserver(){var e;return null!==(e=this.lenObs)&&void 0!==e?e:this.lenObs=new Ee(this)}getIndexObserver(e){var t,n;return null!==(t=(n=this.indexObservers)[e])&&void 0!==t?t:n[e]=new tt(this,e)}}class tt{constructor(e,t){this.owner=e,this.index=t,this.doNotCache=!0,this.value=this.getValue()}getValue(){return this.owner.collection[this.index]}setValue(e,t){if(e===this.getValue())return;const n=this.owner,r=this.index,s=n.indexMap;s[r]>-1&&s.deletedItems.push(s[r]),s[r]=-2,n.collection[r]=e,n.notify()}handleCollectionChange(e,t){const n=this.index;if(e[n]===n)return;const r=this.value,s=this.value=this.getValue();r!==s&&this.subs.notify(s,r,t)}subscribe(e){this.subs.add(e)&&1===this.subs.count&&this.owner.subscribe(this)}unsubscribe(e){this.subs.remove(e)&&0===this.subs.count&&this.owner.unsubscribe(this)}}function nt(e){let t=Ve.get(e);return void 0===t&&(t=new et(e)),t}function rt(e){let t=0,n=0;const r=e.length;for(let s=0;s<r;++s){for(;e.deletedItems[n]<=s-t;)++n,--t;-2===e[s]?++t:e[s]+=t}}function st(e,t){const n=e.slice(),r=t.length;let s=0,i=0;for(;s<r;)i=t[s],-2!==i&&(e[s]=n[i]),++s}me(et),me(tt);const it=new WeakMap,ot=Set.prototype,at=ot.add,ut=ot.clear,lt=ot.delete,ct={add:at,clear:ut,delete:lt},ht=["add","clear","delete"],dt={add:function(e){const t=it.get(this);if(void 0===t)return at.call(this,e),this;const n=this.size;at.call(this,e);return this.size===n||(t.indexMap[n]=-2,t.notify()),this},clear:function(){const e=it.get(this);if(void 0===e)return ut.call(this);if(this.size>0){const t=e.indexMap;let n=0;for(const e of this.keys())t[n]>-1&&t.deletedItems.push(t[n]),n++;ut.call(this),t.length=0,e.notify()}},delete:function(e){const t=it.get(this);if(void 0===t)return lt.call(this,e);if(0===this.size)return!1;let n=0;const r=t.indexMap;for(const s of this.keys()){if(s===e){r[n]>-1&&r.deletedItems.push(r[n]),r.splice(n,1);const s=lt.call(this,e);return!0===s&&t.notify(),s}n++}return!1}},ft={writable:!0,enumerable:!1,configurable:!0};for(const e of ht)oe(dt[e],"observing",{value:!0,writable:!1,configurable:!1,enumerable:!1});let pt=!1;function gt(){for(const e of ht)!0!==ot[e].observing&&oe(ot,e,{...ft,value:dt[e]})}function vt(){for(const e of ht)!0===ot[e].observing&&oe(ot,e,{...ft,value:ct[e]})}class bt{constructor(e){this.type=34,pt||(pt=!0,gt()),this.collection=e,this.indexMap=ve(e.size),this.lenObs=void 0,it.set(e,this)}notify(){const e=this.indexMap;this.indexMap=ve(this.collection.size),this.subs.notifyCollection(e,0)}getLengthObserver(){var e;return null!==(e=this.lenObs)&&void 0!==e?e:this.lenObs=new Ae(this)}}function yt(e){let t=it.get(e);return void 0===t&&(t=new bt(e)),t}me(bt);const mt=new WeakMap,wt=Map.prototype,xt=wt.set,Ct=wt.clear,kt=wt.delete,Ot={set:xt,clear:Ct,delete:kt},Tt=["set","clear","delete"],St={set:function(e,t){const n=mt.get(this);if(void 0===n)return xt.call(this,e,t),this;const r=this.get(e),s=this.size;xt.call(this,e,t);if(this.size===s){let t=0;for(const s of this.entries()){if(s[0]===e)return s[1]!==r&&(n.indexMap.deletedItems.push(n.indexMap[t]),n.indexMap[t]=-2,n.notify()),this;t++}return this}return n.indexMap[s]=-2,n.notify(),this},clear:function(){const e=mt.get(this);if(void 0===e)return Ct.call(this);if(this.size>0){const t=e.indexMap;let n=0;for(const e of this.keys())t[n]>-1&&t.deletedItems.push(t[n]),n++;Ct.call(this),t.length=0,e.notify()}},delete:function(e){const t=mt.get(this);if(void 0===t)return kt.call(this,e);if(0===this.size)return!1;let n=0;const r=t.indexMap;for(const s of this.keys()){if(s===e){r[n]>-1&&r.deletedItems.push(r[n]),r.splice(n,1);const s=kt.call(this,e);return!0===s&&t.notify(),s}++n}return!1}},$t={writable:!0,enumerable:!1,configurable:!0};for(const e of Tt)oe(St[e],"observing",{value:!0,writable:!1,configurable:!1,enumerable:!1});let Lt=!1;function Et(){for(const e of Tt)!0!==wt[e].observing&&oe(wt,e,{...$t,value:St[e]})}function At(){for(const e of Tt)!0===wt[e].observing&&oe(wt,e,{...$t,value:Ot[e]})}class Ut{constructor(e){this.type=66,Lt||(Lt=!0,Et()),this.collection=e,this.indexMap=ve(e.size),this.lenObs=void 0,mt.set(e,this)}notify(){const e=this.indexMap;this.indexMap=ve(this.collection.size),this.subs.notifyCollection(e,0)}getLengthObserver(){var e;return null!==(e=this.lenObs)&&void 0!==e?e:this.lenObs=new Ae(this)}}function It(e){let t=mt.get(e);return void 0===t&&(t=new Ut(e)),t}function Bt(e,t){const n=this.observerLocator.getObserver(e,t);this.obs.add(n)}function jt(){const e=new Ft(this);return ae(this,"obs",e),e}function Vt(e){let t;if(e instanceof Array)t=nt(e);else if(e instanceof Set)t=yt(e);else{if(!(e instanceof Map))throw new Error("Unrecognised collection type.");t=It(e)}this.obs.add(t)}function Pt(e){this.obs.add(e)}function Mt(){throw new Error('method "handleChange" not implemented')}function _t(){throw new Error('method "handleCollectionChange" not implemented')}me(Ut);class Ft{constructor(e){this.binding=e,this.version=0,this.count=0,this.slots=0}handleChange(e,t,n){return this.binding.interceptor.handleChange(e,t,n)}handleCollectionChange(e,t){this.binding.interceptor.handleCollectionChange(e,t)}add(e){const t=this.slots;let n=t;for(;n--&&this[`_o${n}`]!==e;);if(-1===n){for(n=0;void 0!==this[`_o${n}`];)n++;this[`_o${n}`]=e,e.subscribe(this),n===t&&(this.slots=n+1),++this.count}this[`_v${n}`]=this.version}clear(e){const t=this.slots;let n,r,s=0;if(!0===e){for(;s<t;++s)n=`_o${s}`,r=this[n],void 0!==r&&(this[n]=void 0,r.unsubscribe(this));this.count=this.slots=0}else for(;s<t;++s)this[`_v${s}`]!==this.version&&(n=`_o${s}`,r=this[n],void 0!==r&&(this[n]=void 0,r.unsubscribe(this),this.count--))}}function Kt(e){const t=e.prototype;return ue(t,"observeProperty",Bt,!0),ue(t,"observeCollection",Vt,!0),ue(t,"subscribeTo",Pt,!0),oe(t,"obs",{get:jt}),ue(t,"handleChange",Mt),ue(t,"handleCollectionChange",_t),e}function Dt(e){return null==e?Kt:Kt(e)}class qt{constructor(e,t,n,r){this.key=e,this.binding=t,this.observerLocator=n,this.locator=r,this.interceptor=this}$bind(){throw new Error("Method not implemented.")}$unbind(){throw new Error("Method not implemented.")}handleChange(e,t,n){this.binding[this.key](e,t,n)}}Kt(qt);const Nt=r.createInterface("IExpressionParser",(e=>e.singleton(Rt)));class Rt{constructor(){this.expressionLookup=Object.create(null),this.forOfLookup=Object.create(null),this.interpolationLookup=Object.create(null)}parse(e,t){switch(t){case 2048:{let n=this.interpolationLookup[e];return void 0===n&&(n=this.interpolationLookup[e]=this.$parse(e,t)),n}case 539:{let n=this.forOfLookup[e];return void 0===n&&(n=this.forOfLookup[e]=this.$parse(e,t)),n}default:{if(0===e.length&&55&t)return H.$empty;let n=this.expressionLookup[e];return void 0===n&&(n=this.expressionLookup[e]=this.$parse(e,t)),n}}}$parse(e,t){return sn.input=e,sn.length=e.length,sn.index=0,sn.currentChar=e.charCodeAt(0),an(sn,0,61,void 0===t?53:t)}}var zt,Ht,Qt,Wt;function Gt(e){switch(e){case 98:return 8;case 116:return 9;case 110:return 10;case 118:return 11;case 102:return 12;case 114:return 13;case 34:return 34;case 39:return 39;case 92:return 92;default:return e}}!function(e){e[e.Null=0]="Null",e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.LineFeed=10]="LineFeed",e[e.VerticalTab=11]="VerticalTab",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.Exclamation=33]="Exclamation",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dollar=36]="Dollar",e[e.Percent=37]="Percent",e[e.Ampersand=38]="Ampersand",e[e.SingleQuote=39]="SingleQuote",e[e.OpenParen=40]="OpenParen",e[e.CloseParen=41]="CloseParen",e[e.Asterisk=42]="Asterisk",e[e.Plus=43]="Plus",e[e.Comma=44]="Comma",e[e.Minus=45]="Minus",e[e.Dot=46]="Dot",e[e.Slash=47]="Slash",e[e.Semicolon=59]="Semicolon",e[e.Backtick=96]="Backtick",e[e.OpenBracket=91]="OpenBracket",e[e.Backslash=92]="Backslash",e[e.CloseBracket=93]="CloseBracket",e[e.Caret=94]="Caret",e[e.Underscore=95]="Underscore",e[e.OpenBrace=123]="OpenBrace",e[e.Bar=124]="Bar",e[e.CloseBrace=125]="CloseBrace",e[e.Colon=58]="Colon",e[e.LessThan=60]="LessThan",e[e.Equals=61]="Equals",e[e.GreaterThan=62]="GreaterThan",e[e.Question=63]="Question",e[e.Zero=48]="Zero",e[e.One=49]="One",e[e.Two=50]="Two",e[e.Three=51]="Three",e[e.Four=52]="Four",e[e.Five=53]="Five",e[e.Six=54]="Six",e[e.Seven=55]="Seven",e[e.Eight=56]="Eight",e[e.Nine=57]="Nine",e[e.UpperA=65]="UpperA",e[e.UpperB=66]="UpperB",e[e.UpperC=67]="UpperC",e[e.UpperD=68]="UpperD",e[e.UpperE=69]="UpperE",e[e.UpperF=70]="UpperF",e[e.UpperG=71]="UpperG",e[e.UpperH=72]="UpperH",e[e.UpperI=73]="UpperI",e[e.UpperJ=74]="UpperJ",e[e.UpperK=75]="UpperK",e[e.UpperL=76]="UpperL",e[e.UpperM=77]="UpperM",e[e.UpperN=78]="UpperN",e[e.UpperO=79]="UpperO",e[e.UpperP=80]="UpperP",e[e.UpperQ=81]="UpperQ",e[e.UpperR=82]="UpperR",e[e.UpperS=83]="UpperS",e[e.UpperT=84]="UpperT",e[e.UpperU=85]="UpperU",e[e.UpperV=86]="UpperV",e[e.UpperW=87]="UpperW",e[e.UpperX=88]="UpperX",e[e.UpperY=89]="UpperY",e[e.UpperZ=90]="UpperZ",e[e.LowerA=97]="LowerA",e[e.LowerB=98]="LowerB",e[e.LowerC=99]="LowerC",e[e.LowerD=100]="LowerD",e[e.LowerE=101]="LowerE",e[e.LowerF=102]="LowerF",e[e.LowerG=103]="LowerG",e[e.LowerH=104]="LowerH",e[e.LowerI=105]="LowerI",e[e.LowerJ=106]="LowerJ",e[e.LowerK=107]="LowerK",e[e.LowerL=108]="LowerL",e[e.LowerM=109]="LowerM",e[e.LowerN=110]="LowerN",e[e.LowerO=111]="LowerO",e[e.LowerP=112]="LowerP",e[e.LowerQ=113]="LowerQ",e[e.LowerR=114]="LowerR",e[e.LowerS=115]="LowerS",e[e.LowerT=116]="LowerT",e[e.LowerU=117]="LowerU",e[e.LowerV=118]="LowerV",e[e.LowerW=119]="LowerW",e[e.LowerX=120]="LowerX",e[e.LowerY=121]="LowerY",e[e.LowerZ=122]="LowerZ"}(zt||(zt={})),function(e){e[e.Reset=0]="Reset",e[e.Ancestor=511]="Ancestor",e[e.This=512]="This",e[e.Scope=1024]="Scope",e[e.Member=2048]="Member",e[e.Keyed=4096]="Keyed"}(Ht||(Ht={})),function(e){e[e.Variadic=61]="Variadic",e[e.Assign=62]="Assign",e[e.Conditional=63]="Conditional",e[e.LogicalOR=64]="LogicalOR",e[e.LogicalAND=128]="LogicalAND",e[e.Equality=192]="Equality",e[e.Relational=256]="Relational",e[e.Additive=320]="Additive",e[e.Multiplicative=384]="Multiplicative",e[e.Binary=448]="Binary",e[e.LeftHandSide=449]="LeftHandSide",e[e.Primary=450]="Primary",e[e.Unary=451]="Unary"}(Qt||(Qt={})),function(e){e[e.EOF=1572864]="EOF",e[e.ExpressionTerminal=1048576]="ExpressionTerminal",e[e.AccessScopeTerminal=524288]="AccessScopeTerminal",e[e.ClosingToken=262144]="ClosingToken",e[e.OpeningToken=131072]="OpeningToken",e[e.BinaryOp=65536]="BinaryOp",e[e.UnaryOp=32768]="UnaryOp",e[e.LeftHandSide=16384]="LeftHandSide",e[e.StringOrNumericLiteral=12288]="StringOrNumericLiteral",e[e.NumericLiteral=8192]="NumericLiteral",e[e.StringLiteral=4096]="StringLiteral",e[e.IdentifierName=3072]="IdentifierName",e[e.Keyword=2048]="Keyword",e[e.Identifier=1024]="Identifier",e[e.Contextual=512]="Contextual",e[e.Precedence=448]="Precedence",e[e.Type=63]="Type",e[e.FalseKeyword=2048]="FalseKeyword",e[e.TrueKeyword=2049]="TrueKeyword",e[e.NullKeyword=2050]="NullKeyword",e[e.UndefinedKeyword=2051]="UndefinedKeyword",e[e.ThisScope=3076]="ThisScope",e[e.ParentScope=3078]="ParentScope",e[e.OpenParen=671751]="OpenParen",e[e.OpenBrace=131080]="OpenBrace",e[e.Dot=16393]="Dot",e[e.CloseBrace=1835018]="CloseBrace",e[e.CloseParen=1835019]="CloseParen",e[e.Comma=1572876]="Comma",e[e.OpenBracket=671757]="OpenBracket",e[e.CloseBracket=1835022]="CloseBracket",e[e.Colon=1572879]="Colon",e[e.Question=1572880]="Question",e[e.Ampersand=1572883]="Ampersand",e[e.Bar=1572884]="Bar",e[e.BarBar=1638549]="BarBar",e[e.AmpersandAmpersand=1638614]="AmpersandAmpersand",e[e.EqualsEquals=1638679]="EqualsEquals",e[e.ExclamationEquals=1638680]="ExclamationEquals",e[e.EqualsEqualsEquals=1638681]="EqualsEqualsEquals",e[e.ExclamationEqualsEquals=1638682]="ExclamationEqualsEquals",e[e.LessThan=1638747]="LessThan",e[e.GreaterThan=1638748]="GreaterThan",e[e.LessThanEquals=1638749]="LessThanEquals",e[e.GreaterThanEquals=1638750]="GreaterThanEquals",e[e.InKeyword=1640799]="InKeyword",e[e.InstanceOfKeyword=1640800]="InstanceOfKeyword",e[e.Plus=623009]="Plus",e[e.Minus=623010]="Minus",e[e.TypeofKeyword=34851]="TypeofKeyword",e[e.VoidKeyword=34852]="VoidKeyword",e[e.Asterisk=1638885]="Asterisk",e[e.Percent=1638886]="Percent",e[e.Slash=1638887]="Slash",e[e.Equals=1048616]="Equals",e[e.Exclamation=32809]="Exclamation",e[e.TemplateTail=540714]="TemplateTail",e[e.TemplateContinuation=540715]="TemplateContinuation",e[e.OfKeyword=1051180]="OfKeyword"}(Wt||(Wt={}));const Zt=H.$false,Jt=H.$true,Xt=H.$null,Yt=H.$undefined,en=M.$this,tn=M.$parent;var nn;!function(e){e[e.None=0]="None",e[e.IgnoreAttr=4096]="IgnoreAttr",e[e.Interpolation=2048]="Interpolation",e[e.IsRef=5376]="IsRef",e[e.IsIterator=512]="IsIterator",e[e.IsCustom=256]="IsCustom",e[e.IsFunction=128]="IsFunction",e[e.IsEvent=64]="IsEvent",e[e.IsProperty=32]="IsProperty",e[e.IsCommand=16]="IsCommand",e[e.IsPropertyCommand=48]="IsPropertyCommand",e[e.IsEventCommand=80]="IsEventCommand",e[e.DelegationStrategyDelta=6]="DelegationStrategyDelta",e[e.Command=15]="Command",e[e.OneTimeCommand=49]="OneTimeCommand",e[e.ToViewCommand=50]="ToViewCommand",e[e.FromViewCommand=51]="FromViewCommand",e[e.TwoWayCommand=52]="TwoWayCommand",e[e.BindCommand=53]="BindCommand",e[e.TriggerCommand=4182]="TriggerCommand",e[e.CaptureCommand=4183]="CaptureCommand",e[e.DelegateCommand=4184]="DelegateCommand",e[e.CallCommand=153]="CallCommand",e[e.OptionsCommand=26]="OptionsCommand",e[e.ForCommand=539]="ForCommand",e[e.CustomCommand=284]="CustomCommand"}(nn||(nn={}));class rn{constructor(e){this.input=e,this.index=0,this.startIndex=0,this.lastIndex=0,this.currentToken=1572864,this.tokenValue="",this.assignable=!0,this.length=e.length,this.currentChar=e.charCodeAt(0)}get tokenRaw(){return this.input.slice(this.startIndex,this.index)}}const sn=new rn("");function on(e,t){return sn.input=e,sn.length=e.length,sn.index=0,sn.currentChar=e.charCodeAt(0),an(sn,0,61,void 0===t?53:t)}function an(e,t,n,r){if(284===r)return new I(e.input);if(0===e.index){if(2048&r)return function(e){const t=[],n=[],r=e.length;let s="";for(;e.index<r;){switch(e.currentChar){case 36:if(123===e.input.charCodeAt(e.index+1)){t.push(s),s="",e.index+=2,e.currentChar=e.input.charCodeAt(e.index),ln(e);const r=an(e,0,61,2048);n.push(r);continue}s+="$";break;case 92:s+=String.fromCharCode(Gt(cn(e)));break;default:s+=String.fromCharCode(e.currentChar)}cn(e)}if(n.length)return t.push(s),new re(t,n);return null}(e);if(ln(e),1048576&e.currentToken)throw new Error(`Invalid start of expression: '${e.input}'`)}let s;if(e.assignable=448>n,32768&e.currentToken){const n=vn[63&e.currentToken];ln(e),s=new z(n,an(e,t,449,r)),e.assignable=!1}else{e:switch(e.currentToken){case 3078:e.assignable=!1;do{if(ln(e),t++,!pn(e,16393)){if(524288&e.currentToken){const e=511&t;s=0===e?en:1===e?tn:new M(e),t=512;break e}throw new Error(`Invalid member expression: '${e.input}'`)}if(16393===e.currentToken)throw new Error(`Double dot and spread operators are not supported: '${e.input}'`);if(1572864===e.currentToken)throw new Error(`Expected identifier: '${e.input}'`)}while(3078===e.currentToken);case 1024:512&r?s=new ee(e.tokenValue):(s=new _(e.tokenValue,511&t),t=1024),e.assignable=!0,ln(e);break;case 3076:e.assignable=!1,ln(e),s=en,t=512;break;case 671751:ln(e),s=an(e,0,62,r),gn(e,1835019),t=0;break;case 671757:s=function(e,t,n){ln(e);const r=new Array;for(;1835022!==e.currentToken;)if(pn(e,1572876)){if(r.push(Yt),1835022===e.currentToken)break}else{if(r.push(an(e,t,62,-513&n)),!pn(e,1572876))break;if(1835022===e.currentToken)break}return gn(e,1835022),512&n?new X(r):(e.assignable=!1,new W(r))}(e,t,r),t=0;break;case 131080:s=function(e,t){const n=new Array,r=new Array;ln(e);for(;1835018!==e.currentToken;){if(n.push(e.tokenValue),12288&e.currentToken)ln(e),gn(e,1572879),r.push(an(e,0,62,-513&t));else{if(!(3072&e.currentToken))throw new Error(`Invalid or unsupported property definition in object literal: '${e.input}'`);{const{currentChar:n,currentToken:s,index:i}=e;ln(e),pn(e,1572879)?r.push(an(e,0,62,-513&t)):(e.currentChar=n,e.currentToken=s,e.index=i,r.push(an(e,0,450,-513&t)))}}1835018!==e.currentToken&&gn(e,1572876)}return gn(e,1835018),512&t?new Y(n,r):(e.assignable=!1,new G(n,r))}(e,r),t=0;break;case 540714:s=new Z([e.tokenValue]),e.assignable=!1,ln(e),t=0;break;case 540715:s=un(e,t,r,s,!1),t=0;break;case 4096:case 8192:s=new H(e.tokenValue),e.assignable=!1,ln(e),t=0;break;case 2050:case 2051:case 2049:case 2048:s=vn[63&e.currentToken],e.assignable=!1,ln(e),t=0;break;default:throw e.index>=e.length?new Error(`Unexpected end of expression: '${e.input}'`):new Error(`Unconsumed token: '${e.input}'`)}if(512&r)return function(e,t){if(0==(65536&t.$kind))throw new Error(`Invalid BindingIdentifier at left hand side of "of": '${e.input}'`);if(1051180!==e.currentToken)throw new Error(`Invalid BindingIdentifier at left hand side of "of": '${e.input}'`);ln(e);const n=t,r=an(e,0,61,0);return new ne(n,r)}(e,s);if(449<n)return s;let i=e.tokenValue;for(;(16384&e.currentToken)>0;){const n=[];let o;switch(e.currentToken){case 16393:if(e.assignable=!0,ln(e),0==(3072&e.currentToken))throw new Error(`Expected identifier: '${e.input}'`);if(i=e.tokenValue,ln(e),t=(1536&t)<<1|2048&t|(4096&t)>>1,671751===e.currentToken){0===t&&(t=2048);continue}s=1024&t?new _(i,s.ancestor):new F(s,i);continue;case 671757:e.assignable=!0,ln(e),t=4096,s=new K(s,an(e,0,62,r)),gn(e,1835022);break;case 671751:for(e.assignable=!1,ln(e);1835019!==e.currentToken&&(n.push(an(e,0,62,r)),pn(e,1572876)););gn(e,1835019),s=1024&t?new D(i,n,s.ancestor):2048&t?new q(s,i,n):new N(s,n),t=0;break;case 540714:e.assignable=!1,o=[e.tokenValue],s=new J(o,o,s),ln(e);break;case 540715:s=un(e,t,r,s,!0)}}}if(448<n)return s;for(;(65536&e.currentToken)>0;){const i=e.currentToken;if((448&i)<=n)break;ln(e),s=new R(vn[63&i],s,an(e,t,448&i,r)),e.assignable=!1}if(63<n)return s;if(pn(e,1572880)){const n=an(e,t,62,r);gn(e,1572879),s=new P(s,n,an(e,t,62,r)),e.assignable=!1}if(62<n)return s;if(pn(e,1048616)){if(!e.assignable)throw new Error(`Left hand side of expression is not assignable: '${e.input}'`);s=new V(s,an(e,t,62,r))}if(61<n)return s;for(;pn(e,1572884);){if(1572864===e.currentToken)throw new Error(`Expected identifier to come after ValueConverter operator: '${e.input}'`);const n=e.tokenValue;ln(e);const i=new Array;for(;pn(e,1572879);)i.push(an(e,t,62,r));s=new j(s,n,i)}for(;pn(e,1572883);){if(1572864===e.currentToken)throw new Error(`Expected identifier to come after BindingBehavior operator: '${e.input}'`);const n=e.tokenValue;ln(e);const i=new Array;for(;pn(e,1572879);)i.push(an(e,t,62,r));s=new B(s,n,i)}if(1572864!==e.currentToken){if(2048&r)return s;if("of"===e.tokenRaw)throw new Error(`Unexpected keyword "of": '${e.input}'`);throw new Error(`Unconsumed token: '${e.input}'`)}return s}function un(e,t,n,r,s){const i=[e.tokenValue];gn(e,540715);const o=[an(e,t,62,n)];for(;540714!==(e.currentToken=fn(e));)i.push(e.tokenValue),gn(e,540715),o.push(an(e,t,62,n));return i.push(e.tokenValue),e.assignable=!1,s?(ln(e),new J(i,i,r,o)):(ln(e),new Z(i,o))}function ln(e){for(;e.index<e.length;)if(e.startIndex=e.index,null!=(e.currentToken=Sn[e.currentChar](e)))return;e.currentToken=1572864}function cn(e){return e.currentChar=e.input.charCodeAt(++e.index)}function hn(e,t){let n=e.currentChar;if(!1===t){do{n=cn(e)}while(n<=57&&n>=48);if(46!==n)return e.tokenValue=parseInt(e.tokenRaw,10),8192;if(n=cn(e),e.index>=e.length)return e.tokenValue=parseInt(e.tokenRaw.slice(0,-1),10),8192}if(n<=57&&n>=48)do{n=cn(e)}while(n<=57&&n>=48);else e.currentChar=e.input.charCodeAt(--e.index);return e.tokenValue=parseFloat(e.tokenRaw),8192}function dn(e){let t=!0,n="";for(;96!==cn(e);)if(36===e.currentChar){if(e.index+1<e.length&&123===e.input.charCodeAt(e.index+1)){e.index++,t=!1;break}n+="$"}else if(92===e.currentChar)n+=String.fromCharCode(Gt(cn(e)));else{if(e.index>=e.length)throw new Error(`Unterminated template string: '${e.input}'`);n+=String.fromCharCode(e.currentChar)}return cn(e),e.tokenValue=n,t?540714:540715}function fn(e){if(e.index>=e.length)throw new Error(`Unterminated template string: '${e.input}'`);return e.index--,dn(e)}function pn(e,t){return e.currentToken===t&&(ln(e),!0)}function gn(e,t){if(e.currentToken!==t)throw new Error(`Missing expected token: '${e.input}'`);ln(e)}const vn=[Zt,Jt,Xt,Yt,"$this",null,"$parent","(","{",".","}",")",",","[","]",":","?","'",'"',"&","|","||","&&","==","!=","===","!==","<",">","<=",">=","in","instanceof","+","-","typeof","void","*","%","/","=","!",540714,540715,"of"],bn=Object.create(null);bn.true=2049,bn.null=2050,bn.false=2048,bn.undefined=2051,bn.$this=3076,bn.$parent=3078,bn.in=1640799,bn.instanceof=1640800,bn.typeof=34851,bn.void=34852,bn.of=1051180;const yn=[36,0,48,58,65,91,95,0,97,123],mn=[36,0,65,91,95,0,97,123,170,0,186,0,192,215,216,247,248,697,736,741,7424,7462,7468,7517,7522,7526,7531,7544,7545,7615,7680,7936,8305,0,8319,0,8336,8349,8490,8492,8498,0,8526,0,8544,8585,11360,11392,42786,42888,42891,42927,42928,42936,42999,43008,43824,43867,43868,43877,64256,64263,65313,65339,65345,65371],wn=[48,58],xn=[0,33,127,161];function Cn(e,t,n,r){const s=n.length;for(let i=0;i<s;i+=2){const s=n[i];let o=n[i+1];if(o=o>0?o:s+1,e&&e.fill(r,s,o),t)for(let e=s;e<o;e++)t.add(e)}}function kn(e){return t=>(cn(t),e)}const On=e=>{throw new Error(`Unexpected character: '${e.input}'`)};On.notMapped=!0;Cn(null,new Set,yn,!0);const Tn=new Uint8Array(65535);Cn(Tn,null,mn,1),Cn(Tn,null,wn,1);const Sn=new Array(65535);Sn.fill(On,0,65535),Cn(Sn,null,xn,(e=>(cn(e),null))),Cn(Sn,null,mn,(function(e){for(;Tn[cn(e)];);const t=bn[e.tokenValue=e.tokenRaw];return void 0===t?1024:t})),Cn(Sn,null,wn,(e=>hn(e,!1))),Sn[34]=Sn[39]=e=>function(e){const t=e.currentChar;cn(e);let n=0;const r=new Array;let s=e.index;for(;e.currentChar!==t;)if(92===e.currentChar)r.push(e.input.slice(s,e.index)),cn(e),n=Gt(e.currentChar),cn(e),r.push(String.fromCharCode(n)),s=e.index;else{if(e.index>=e.length)throw new Error(`Unterminated quote in string literal: '${e.input}'`);cn(e)}const i=e.input.slice(s,e.index);cn(e),r.push(i);const o=r.join("");return e.tokenValue=o,4096}(e),Sn[96]=e=>dn(e),Sn[33]=e=>61!==cn(e)?32809:61!==cn(e)?1638680:(cn(e),1638682),Sn[61]=e=>61!==cn(e)?1048616:61!==cn(e)?1638679:(cn(e),1638681),Sn[38]=e=>38!==cn(e)?1572883:(cn(e),1638614),Sn[124]=e=>124!==cn(e)?1572884:(cn(e),1638549),Sn[46]=e=>cn(e)<=57&&e.currentChar>=48?hn(e,!0):16393,Sn[60]=e=>61!==cn(e)?1638747:(cn(e),1638749),Sn[62]=e=>61!==cn(e)?1638748:(cn(e),1638750),Sn[37]=kn(1638886),Sn[40]=kn(671751),Sn[41]=kn(1835019),Sn[42]=kn(1638885),Sn[43]=kn(623009),Sn[44]=kn(1572876),Sn[45]=kn(623010),Sn[47]=kn(1638887),Sn[58]=kn(1572879),Sn[63]=kn(1572880),Sn[91]=kn(671757),Sn[93]=kn(1835022),Sn[123]=kn(131080),Sn[125]=kn(1835018);let $n=null;const Ln=[];let En=!1;function An(){return $n}function Un(e){if(null==e)throw new Error("Connectable cannot be null/undefined");if(null==$n)return $n=e,Ln[0]=$n,void(En=!0);if($n===e)throw new Error("Trying to enter an active connectable");Ln.push($n),$n=e,En=!0}function In(e){if(null==e)throw new Error("Connectable cannot be null/undefined");if($n!==e)throw new Error("Trying to exit an unactive connectable");Ln.pop(),$n=Ln.length>0?Ln[Ln.length-1]:null,En=null!=$n}const Bn=Object.freeze({get current(){return $n},get connecting(){return En},enter:Un,exit:In,pause:function(){En=!1},resume:function(){En=!0}}),jn=Reflect.get,Vn=Object.prototype.toString,Pn=new WeakMap;function Mn(e){switch(Vn.call(e)){case"[object Object]":case"[object Array]":case"[object Map]":case"[object Set]":return!0;default:return!1}}const _n="__raw__";function Fn(e){return Mn(e)?Kn(e):e}function Kn(e){var t;return null!==(t=Pn.get(e))&&void 0!==t?t:function(e){const t=e instanceof Array?zn:e instanceof Map||e instanceof Set?pr:Rn,n=new Proxy(e,t);return Pn.set(e,n),n}(e)}function Dn(e){var t;return null!==(t=e.__raw__)&&void 0!==t?t:e}function qn(e){return Mn(e)&&e.__raw__||e}function Nn(e){return"constructor"===e||"__proto__"===e||"$observers"===e||e===Symbol.toPrimitive||e===Symbol.toStringTag}const Rn={get(e,t,n){if(t===_n)return e;const r=An();return!En||Nn(t)||null==r?jn(e,t,n):(r.observeProperty(e,t),Fn(jn(e,t,n)))}},zn={get(e,t,n){if(t===_n)return e;const r=An();if(!En||Nn(t)||null==r)return jn(e,t,n);switch(t){case"length":return r.observeProperty(e,"length"),e.length;case"map":return Hn;case"includes":return Gn;case"indexOf":return Zn;case"lastIndexOf":return Jn;case"every":return Qn;case"filter":return Wn;case"find":return Yn;case"findIndex":return Xn;case"flat":return er;case"flatMap":return tr;case"join":return nr;case"push":return sr;case"pop":return rr;case"reduce":return dr;case"reduceRight":return fr;case"reverse":return ur;case"shift":return ir;case"unshift":return or;case"slice":return hr;case"splice":return ar;case"some":return lr;case"sort":return cr;case"keys":return Cr;case"values":case Symbol.iterator:return kr;case"entries":return Or}return r.observeProperty(e,t),Fn(jn(e,t,n))},ownKeys(e){var t;return null===(t=An())||void 0===t||t.observeProperty(e,"length"),Reflect.ownKeys(e)}};function Hn(e,t){var n;const r=Dn(this),s=r.map(((n,r)=>qn(e.call(t,Fn(n),r,this))));return null===(n=An())||void 0===n||n.observeCollection(r),Fn(s)}function Qn(e,t){var n;const r=Dn(this),s=r.every(((n,r)=>e.call(t,Fn(n),r,this)));return null===(n=An())||void 0===n||n.observeCollection(r),s}function Wn(e,t){var n;const r=Dn(this),s=r.filter(((n,r)=>qn(e.call(t,Fn(n),r,this))));return null===(n=An())||void 0===n||n.observeCollection(r),Fn(s)}function Gn(e){var t;const n=Dn(this),r=n.includes(qn(e));return null===(t=An())||void 0===t||t.observeCollection(n),r}function Zn(e){var t;const n=Dn(this),r=n.indexOf(qn(e));return null===(t=An())||void 0===t||t.observeCollection(n),r}function Jn(e){var t;const n=Dn(this),r=n.lastIndexOf(qn(e));return null===(t=An())||void 0===t||t.observeCollection(n),r}function Xn(e,t){var n;const r=Dn(this),s=r.findIndex(((n,r)=>qn(e.call(t,Fn(n),r,this))));return null===(n=An())||void 0===n||n.observeCollection(r),s}function Yn(e,t){var n;const r=Dn(this),s=r.find(((t,n)=>e(Fn(t),n,this)),t);return null===(n=An())||void 0===n||n.observeCollection(r),Fn(s)}function er(){var e;const t=Dn(this);return null===(e=An())||void 0===e||e.observeCollection(t),Fn(t.flat())}function tr(e,t){var n;const r=Dn(this);return null===(n=An())||void 0===n||n.observeCollection(r),Kn(r.flatMap(((n,r)=>Fn(e.call(t,Fn(n),r,this)))))}function nr(e){var t;const n=Dn(this);return null===(t=An())||void 0===t||t.observeCollection(n),n.join(e)}function rr(){return Fn(Dn(this).pop())}function sr(...e){return Dn(this).push(...e)}function ir(){return Fn(Dn(this).shift())}function or(...e){return Dn(this).unshift(...e)}function ar(...e){return Fn(Dn(this).splice(...e))}function ur(...e){var t;const n=Dn(this),r=n.reverse();return null===(t=An())||void 0===t||t.observeCollection(n),Fn(r)}function lr(e,t){var n;const r=Dn(this),s=r.some(((n,r)=>qn(e.call(t,Fn(n),r,this))));return null===(n=An())||void 0===n||n.observeCollection(r),s}function cr(e){var t;const n=Dn(this),r=n.sort(e);return null===(t=An())||void 0===t||t.observeCollection(n),Fn(r)}function hr(e,t){var n;const r=Dn(this);return null===(n=An())||void 0===n||n.observeCollection(r),Kn(r.slice(e,t))}function dr(e,t){var n;const r=Dn(this),s=r.reduce(((t,n,r)=>e(t,Fn(n),r,this)),t);return null===(n=An())||void 0===n||n.observeCollection(r),Fn(s)}function fr(e,t){var n;const r=Dn(this),s=r.reduceRight(((t,n,r)=>e(t,Fn(n),r,this)),t);return null===(n=An())||void 0===n||n.observeCollection(r),Fn(s)}const pr={get(e,t,n){if(t===_n)return e;const r=An();if(!En||Nn(t)||null==r)return jn(e,t,n);switch(t){case"size":return r.observeProperty(e,"size"),e.size;case"clear":return wr;case"delete":return xr;case"forEach":return gr;case"add":if(e instanceof Set)return mr;break;case"get":if(e instanceof Map)return br;break;case"set":if(e instanceof Map)return yr;break;case"has":return vr;case"keys":return Cr;case"values":return kr;case"entries":return Or;case Symbol.iterator:return e instanceof Map?Or:kr}return Fn(jn(e,t,n))}};function gr(e,t){var n;const r=Dn(this);return null===(n=An())||void 0===n||n.observeCollection(r),r.forEach(((n,r)=>{e.call(t,Fn(n),Fn(r),this)}))}function vr(e){var t;const n=Dn(this);return null===(t=An())||void 0===t||t.observeCollection(n),n.has(qn(e))}function br(e){var t;const n=Dn(this);return null===(t=An())||void 0===t||t.observeCollection(n),Fn(n.get(qn(e)))}function yr(e,t){return Fn(Dn(this).set(qn(e),qn(t)))}function mr(e){return Fn(Dn(this).add(qn(e)))}function wr(){return Fn(Dn(this).clear())}function xr(e){return Fn(Dn(this).delete(qn(e)))}function Cr(){var e;const t=Dn(this);null===(e=An())||void 0===e||e.observeCollection(t);const n=t.keys();return{next(){const e=n.next(),t=e.done;return t?{value:void 0,done:t}:{value:Fn(e.value),done:t}},[Symbol.iterator](){return this}}}function kr(){var e;const t=Dn(this);null===(e=An())||void 0===e||e.observeCollection(t);const n=t.values();return{next(){const e=n.next(),t=e.done;return t?{value:void 0,done:t}:{value:Fn(e.value),done:t}},[Symbol.iterator](){return this}}}function Or(){var e;const t=Dn(this);null===(e=An())||void 0===e||e.observeCollection(t);const n=t.entries();return{next(){const e=n.next(),t=e.value,r=e.done;return r?{value:void 0,done:r}:{value:[Fn(t[0]),Fn(t[1])],done:r}},[Symbol.iterator](){return this}}}const Tr=Object.freeze({getProxy:Kn,getRaw:Dn,wrap:Fn,unwrap:qn,rawKey:_n});class Sr{constructor(e,t,n,r,s){this.obj=e,this.get=t,this.set=n,this.useProxy=r,this.observerLocator=s,this.interceptor=this,this.type=1,this.value=void 0,this.oldValue=void 0,this.running=!1,this.isDirty=!1}static create(e,t,n,r,s){const i=new Sr(e,n.get,n.set,s,r),o=()=>i.getValue();return o.getObserver=()=>i,oe(e,t,{enumerable:n.enumerable,configurable:!0,get:o,set:e=>{i.setValue(e,0)}}),i}getValue(){return 0===this.subs.count?this.get.call(this.obj,this):(this.isDirty&&(this.compute(),this.isDirty=!1),this.value)}setValue(e,t){if("function"!=typeof this.set)throw new Error("Property is readonly");e!==this.value&&(this.running=!0,this.set.call(this.obj,e),this.running=!1,this.run())}handleChange(){this.isDirty=!0,this.subs.count>0&&this.run()}handleCollectionChange(){this.isDirty=!0,this.subs.count>0&&this.run()}subscribe(e){this.subs.add(e)&&1===this.subs.count&&(this.compute(),this.isDirty=!1)}unsubscribe(e){this.subs.remove(e)&&0===this.subs.count&&(this.isDirty=!0,this.obs.clear(!0))}flush(){$r=this.oldValue,this.oldValue=this.value,this.subs.notify(this.value,$r,0)}run(){if(this.running)return;const e=this.value,t=this.compute();this.isDirty=!1,Object.is(t,e)||(this.oldValue=e,this.queue.add(this))}compute(){this.running=!0,this.obs.version++;try{return Un(this),this.value=qn(this.get.call(this.useProxy?Fn(this.obj):this.obj,this))}finally{this.obs.clear(!1),this.running=!1,In(this)}}}let $r;Dt(Sr),me(Sr),Te(Sr);const Lr=r.createInterface("IDirtyChecker",(e=>e.singleton(Ur))),Er={timeoutsPerCheck:25,disabled:!1,throw:!1,resetToDefault(){this.timeoutsPerCheck=6,this.disabled=!1,this.throw=!1}},Ar={persistent:!0};class Ur{constructor(e){this.platform=e,this.tracked=[],this.task=null,this.elapsedFrames=0,this.check=()=>{if(Er.disabled)return;if(++this.elapsedFrames<Er.timeoutsPerCheck)return;this.elapsedFrames=0;const e=this.tracked,t=e.length;let n,r=0;for(;r<t;++r)n=e[r],n.isDirty()&&this.queue.add(n)}}createProperty(e,t){if(Er.throw)throw new Error(`Property '${t}' is being dirty-checked.`);return new Ir(this,e,t)}addProperty(e){this.tracked.push(e),1===this.tracked.length&&(this.task=this.platform.taskQueue.queueTask(this.check,Ar))}removeProperty(e){this.tracked.splice(this.tracked.indexOf(e),1),0===this.tracked.length&&(this.task.cancel(),this.task=null)}}Ur.inject=[h],Te(Ur);class Ir{constructor(e,t,n){this.dirtyChecker=e,this.obj=t,this.propertyKey=n,this.oldValue=void 0,this.type=0}getValue(){return this.obj[this.propertyKey]}setValue(e,t){throw new Error(`Trying to set value for property ${this.propertyKey} in dirty checker`)}isDirty(){return this.oldValue!==this.obj[this.propertyKey]}flush(){const e=this.oldValue,t=this.getValue();this.oldValue=t,this.subs.notify(t,e,0)}subscribe(e){this.subs.add(e)&&1===this.subs.count&&(this.oldValue=this.obj[this.propertyKey],this.dirtyChecker.addProperty(this))}unsubscribe(e){this.subs.remove(e)&&0===this.subs.count&&this.dirtyChecker.removeProperty(this)}}me(Ir);class Br{constructor(e,t){this.obj=e,this.propertyKey=t,this.type=0}get doNotCache(){return!0}getValue(){return this.obj[this.propertyKey]}setValue(){}subscribe(){}unsubscribe(){}}class jr{constructor(){this.type=0}getValue(e,t){return e[t]}setValue(e,t,n,r){n[r]=e}}let Vr;class Pr{constructor(e,t){this.obj=e,this.propertyKey=t,this.value=void 0,this.oldValue=void 0,this.observing=!1,this.type=1,this.f=0}getValue(){return this.value}setValue(e,t){if(this.observing){const n=this.value;if(Object.is(e,n))return;this.value=e,this.oldValue=n,this.f=t,this.queue.add(this)}else this.obj[this.propertyKey]=e}subscribe(e){!1===this.observing&&this.start(),this.subs.add(e)}flush(){Vr=this.oldValue,this.oldValue=this.value,this.subs.notify(this.value,Vr,this.f)}start(){return!1===this.observing&&(this.observing=!0,this.value=this.obj[this.propertyKey],oe(this.obj,this.propertyKey,{enumerable:!0,configurable:!0,get:()=>this.getValue(),set:e=>{this.setValue(e,0)}})),this}stop(){return this.observing&&(oe(this.obj,this.propertyKey,{enumerable:!0,configurable:!0,writable:!0,value:this.value}),this.observing=!1),this}}class Mr{constructor(e,t,n,r){this.type=1,this.v=void 0,this.oV=void 0,this.f=0,this.obj=e,this.s=n;const s=e[t];this.cb="function"==typeof s?s:void 0,this.v=r}getValue(){return this.v}setValue(e,t){var n;"function"==typeof this.s&&(e=this.s(e)),Object.is(e,this.v)||(this.oV=this.v,this.v=e,this.f=t,null===(n=this.cb)||void 0===n||n.call(this.obj,this.v,this.oV,t),this.queue.add(this))}flush(){Vr=this.oV,this.oV=this.v,this.subs.notify(this.v,Vr,this.f)}}me(Pr),me(Mr),Te(Pr),Te(Mr);const _r=new jr,Fr=r.createInterface("IObserverLocator",(e=>e.singleton(qr))),Kr=r.createInterface("INodeObserverLocator",(e=>e.cachedCallback((e=>(e.getAll(d).forEach((e=>{e.error("Using default INodeObserverLocator implementation. Will not be able to observe nodes (HTML etc...).")})),new Dr)))));class Dr{handles(){return!1}getObserver(){return _r}getAccessor(){return _r}}class qr{constructor(e,t){this.dirtyChecker=e,this.nodeObserverLocator=t,this.adapters=[]}addAdapter(e){this.adapters.push(e)}getObserver(e,t){var n,r;return null!==(r=null===(n=e.$observers)||void 0===n?void 0:n[t])&&void 0!==r?r:this.cache(e,t,this.createObserver(e,t))}getAccessor(e,t){var n;const r=null===(n=e.$observers)||void 0===n?void 0:n[t];return void 0!==r?r:this.nodeObserverLocator.handles(e,t,this)?this.nodeObserverLocator.getAccessor(e,t,this):_r}getArrayObserver(e){return nt(e)}getMapObserver(e){return It(e)}getSetObserver(e){return yt(e)}createObserver(e,t){var n,r,s,i;if(!(e instanceof Object))return new Br(e,t);if(this.nodeObserverLocator.handles(e,t,this))return this.nodeObserverLocator.getObserver(e,t,this);switch(t){case"length":if(e instanceof Array)return nt(e).getLengthObserver();break;case"size":if(e instanceof Map)return It(e).getLengthObserver();if(e instanceof Set)return yt(e).getLengthObserver();break;default:if(e instanceof Array&&c(t))return nt(e).getIndexObserver(Number(t))}let o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){let n=Object.getPrototypeOf(e);for(;null!==n&&(o=Object.getOwnPropertyDescriptor(n,t),void 0===o);)n=Object.getPrototypeOf(n)}if(void 0!==o&&!Object.prototype.hasOwnProperty.call(o,"value")){let a=this.getAdapterObserver(e,t,o);return null==a&&(a=null===(i=null!==(r=null===(n=o.get)||void 0===n?void 0:n.getObserver)&&void 0!==r?r:null===(s=o.set)||void 0===s?void 0:s.getObserver)||void 0===i?void 0:i(e,this)),null==a?o.configurable?Sr.create(e,t,o,this,!0):this.dirtyChecker.createProperty(e,t):a}return new Pr(e,t)}getAdapterObserver(e,t,n){if(this.adapters.length>0)for(const r of this.adapters){const s=r.getObserver(e,t,n,this);if(null!=s)return s}return null}cache(e,t,n){return!0===n.doNotCache?n:void 0===e.$observers?(oe(e,"$observers",{value:{[t]:n}}),n):e.$observers[t]=n}}function Nr(e){let t;return e instanceof Array?t=nt(e):e instanceof Map?t=It(e):e instanceof Set&&(t=yt(e)),t}qr.inject=[Lr,Kr];const Rr=r.createInterface("IObservation",(e=>e.singleton(zr)));class zr{constructor(e){this.observerLocator=e}static get inject(){return[Fr]}run(e){const t=new Hr(this.observerLocator,e);return t.run(),t}}class Hr{constructor(e,t){this.observerLocator=e,this.fn=t,this.interceptor=this,this.maxRunCount=10,this.queued=!1,this.running=!1,this.runCount=0,this.stopped=!1}handleChange(){this.queued=!0,this.run()}handleCollectionChange(){this.queued=!0,this.run()}run(){if(this.stopped)throw new Error("Effect has already been stopped");if(!this.running){++this.runCount,this.running=!0,this.queued=!1,++this.obs.version;try{Un(this),this.fn(this)}finally{this.obs.clear(!1),this.running=!1,In(this)}if(this.queued){if(this.runCount>this.maxRunCount)throw this.runCount=0,new Error("Maximum number of recursive effect run reached. Consider handle effect dependencies differently.");this.run()}else this.runCount=0}}stop(){this.stopped=!0,this.obs.clear(!0)}}Dt(Hr);const Qr={};function Wr(e,t,n){return null==t?(t,n,s)=>r(t,n,s,e):r(e,t,n);function r(e,t,n,r){var s;const i=void 0===t;if(r="object"!=typeof r?{name:r}:r||{},i&&(t=r.name),null==t||""===t)throw new Error("Invalid usage, cannot determine property name for @observable");const o=r.callback||`${String(t)}Changed`;let a=Qr;n?(delete n.value,delete n.writable,a=null===(s=n.initializer)||void 0===s?void 0:s.call(n),delete n.initializer):n={configurable:!0},"enumerable"in n||(n.enumerable=!0);const u=r.set;if(n.get=function(){var e;const n=Gr(this,t,o,a,u);return null===(e=An())||void 0===e||e.subscribeTo(n),n.getValue()},n.set=function(e){Gr(this,t,o,a,u).setValue(e,0)},n.get.getObserver=function(e){return Gr(e,t,o,a,u)},!i)return n;oe(e.prototype,t,n)}}function Gr(e,t,n,r,s){const i=function(e){return void 0===e.$observers&&oe(e,"$observers",{value:{}}),e.$observers}(e);let o=i[t];return null==o&&(o=new Mr(e,n,s,r===Qr?void 0:r),i[t]=o),o}export{Ht as Access,K as AccessKeyedExpression,F as AccessMemberExpression,_ as AccessScopeExpression,M as AccessThisExpression,pe as AccessorType,X as ArrayBindingPattern,tt as ArrayIndexObserver,W as ArrayLiteralExpression,et as ArrayObserver,V as AssignExpression,R as BinaryExpression,S as BindingBehavior,k as BindingBehaviorDefinition,B as BindingBehaviorExpression,O as BindingBehaviorFactory,x as BindingBehaviorStrategy,v as BindingContext,ee as BindingIdentifier,T as BindingInterceptor,qt as BindingMediator,le as BindingMode,Ft as BindingObserverRecord,nn as BindingType,N as CallFunctionExpression,q as CallMemberExpression,D as CallScopeExpression,zt as Char,fe as CollectionKind,Ee as CollectionLengthObserver,Ae as CollectionSizeObserver,Sr as ComputedObserver,P as ConditionalExpression,Bn as ConnectableSwitcher,I as CustomExpression,de as DelegationStrategy,Ir as DirtyCheckProperty,Er as DirtyCheckSettings,A as ExpressionKind,$e as FlushQueue,ne as ForOfStatement,Q as HtmlLiteralExpression,Lr as IDirtyChecker,Nt as IExpressionParser,Kr as INodeObserverLocator,Rr as IObservation,Fr as IObserverLocator,m as ISignaler,re as Interpolation,ce as LifecycleFlags,Ut as MapObserver,Y as ObjectBindingPattern,G as ObjectLiteralExpression,zr as Observation,qr as ObserverLocator,y as OverrideContext,rn as ParserState,Qt as Precedence,H as PrimitiveLiteralExpression,Br as PrimitiveObserver,jr as PropertyAccessor,Tr as ProxyObservable,b as Scope,bt as SetObserver,Pr as SetterObserver,xe as SubscriberRecord,J as TaggedTemplateExpression,Z as TemplateExpression,z as UnaryExpression,E as ValueConverter,L as ValueConverterDefinition,j as ValueConverterExpression,f as alias,rt as applyMutationsToIndices,C as bindingBehavior,be as cloneIndexMap,Dt as connectable,ge as copyIndexMap,ve as createIndexMap,Ye as disableArrayObservation,At as disableMapObservation,vt as disableSetObservation,Xe as enableArrayObservation,Et as enableMapObservation,gt as enableSetObservation,Nr as getCollectionObserver,ye as isIndexMap,Wr as observable,an as parse,on as parseExpression,p as registerAliases,me as subscriberCollection,st as synchronizeIndices,$ as valueConverter,Te as withFlushQueue};
