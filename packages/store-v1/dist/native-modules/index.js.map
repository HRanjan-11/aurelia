{"version":3,"file":"index.js","sources":["../../src/history.ts","../../../../node_modules/tslib/tslib.es6.js","../../src/middleware.ts","../../src/logging.ts","../../src/store.ts","../../src/test-helpers.ts","../../src/decorator.ts","../../src/index.ts"],"sourcesContent":["export interface StateHistory<T> {\n  past: T[];\n  present: T;\n  future: T[];\n}\n\nexport interface HistoryOptions {\n  undoable: boolean;\n  limit?: number;\n}\n\nexport function jump<T>(state: StateHistory<T>, n: number): StateHistory<T> {\n  if (!isStateHistory(state)) {\n    throw Error(\"Provided state is not of type StateHistory\");\n  }\n\n  if (n > 0) return jumpToFuture<T>(state, n - 1);\n  if (n < 0) return jumpToPast<T>(state, state.past.length + n);\n\n  return state;\n}\n\nfunction jumpToFuture<T>(state: StateHistory<T>, index: number): StateHistory<T> {\n  if (index < 0 || index >= state.future.length) {\n    return state;\n  }\n\n  const { past, future, present } = state;\n\n  const newPast = [...past, present, ...future.slice(0, index)];\n  const newPresent = future[index];\n  const newFuture = future.slice(index + 1);\n\n  return { past: newPast, present: newPresent, future: newFuture };\n}\n\nfunction jumpToPast<T>(state: StateHistory<T>, index: number): StateHistory<T> {\n  if (index < 0 || index >= state.past.length) {\n    return state;\n  }\n\n  const { past, future, present } = state;\n\n  const newPast = past.slice(0, index);\n  const newFuture = [...past.slice(index + 1), present, ...future];\n  const newPresent = past[index];\n\n  return { past: newPast, present: newPresent, future: newFuture };\n}\n\nexport function nextStateHistory<T>(presentStateHistory: StateHistory<T>, nextPresent: T): StateHistory<T> {\n  return {\n    ...presentStateHistory,\n    ...{\n      past: [...presentStateHistory.past, presentStateHistory.present],\n      present: nextPresent,\n      future: []\n    }\n  };\n}\n\nexport function applyLimits<T>(state: T, limit: number): T {\n  if (isStateHistory(state)) {\n    if (state.past.length > limit) {\n      state.past = state.past.slice(state.past.length - limit);\n    }\n\n    if (state.future.length > limit) {\n      state.future = state.future.slice(0, limit);\n    }\n  }\n\n  return state;\n}\n\nexport function isStateHistory<T>(history: Partial<StateHistory<T>>): history is StateHistory<T> {\n  return typeof history.present !== 'undefined' &&\n    typeof history.future !== 'undefined' &&\n    typeof history.past !== 'undefined' &&\n    Array.isArray(history.future) &&\n    Array.isArray(history.past);\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { IPlatform } from '@aurelia/kernel';\nimport { IWindow } from '@aurelia/runtime-html';\nimport { STORE } from './store.js';\n\nexport const DEFAULT_LOCAL_STORAGE_KEY = \"aurelia-store-state\";\n\nexport interface CallingAction {\n  name: string;\n  params?: unknown[];\n  pipedActions?: {\n    name: string;\n    params?: unknown[];\n  }[];\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type Middleware<T, S = any> = (state: T, originalState: T | undefined, settings: S, action?: CallingAction) => T | Promise<T | undefined | false> | void | false;\nexport enum MiddlewarePlacement {\n  Before = \"before\",\n  After = \"after\"\n}\n\nexport function logMiddleware(state: unknown, _: unknown, settings?: { logType: \"debug\" | \"error\" | \"info\" | \"log\" | \"trace\" | \"warn\" }): void {\n  const cons = STORE.container.get(IPlatform).console;\n  const logType = settings?.logType !== undefined && cons[settings.logType] !== undefined ? settings.logType : \"log\";\n\n  cons[logType](\"New state: \", state);\n}\n\nexport function localStorageMiddleware(state: unknown, _: unknown, settings?: { key: string }): void {\n  const localStorage = STORE.container.get(IWindow).localStorage;\n\n  if (localStorage !== undefined) {\n    const key = settings?.key !== undefined ? settings.key : DEFAULT_LOCAL_STORAGE_KEY;\n\n    localStorage.setItem(key, JSON.stringify(state));\n  }\n}\n\nexport function rehydrateFromLocalStorage<T>(state: T, key?: string): T {\n  const localStorage = STORE.container.get(IWindow).localStorage;\n\n  if (localStorage === undefined) {\n    return state;\n  }\n\n  const storedState = localStorage.getItem(key === undefined ? DEFAULT_LOCAL_STORAGE_KEY : key);\n  if (storedState === null || storedState === \"\") {\n    return state;\n  }\n\n  try {\n    return JSON.parse(storedState) as T;\n  } catch { /**/ }\n\n  return state;\n}\n","import type { StoreOptions } from './store.js';\n\nexport enum LogLevel {\n  trace = 'trace',\n  debug = 'debug',\n  info = 'info',\n  warn = 'warn',\n  error = 'error'\n}\n\nexport interface LogDefinitions {\n  performanceLog?: LogLevel;\n  dispatchedActions?: LogLevel;\n  devToolsStatus?: LogLevel;\n}\n\nexport function getLogType(\n  options: Partial<StoreOptions>,\n  definition: keyof LogDefinitions,\n  defaultLevel: LogLevel\n): LogLevel {\n  // eslint-disable-next-line no-prototype-builtins\n  if (options.logDefinitions?.hasOwnProperty(definition) &&\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    options.logDefinitions[definition] &&\n    Object.values(LogLevel).includes(options.logDefinitions[definition]!)) {\n    return options.logDefinitions[definition]!;\n  }\n\n  return defaultLevel;\n}\n","/* eslint-disable @typescript-eslint/strict-boolean-expressions */\nimport { IContainer, ILogger } from '@aurelia/kernel';\nimport { IWindow } from \"@aurelia/runtime-html\";\nimport { BehaviorSubject, Observable } from 'rxjs';\n\nimport { jump, applyLimits, HistoryOptions, isStateHistory } from './history.js';\nimport { Middleware, MiddlewarePlacement, CallingAction } from './middleware.js';\nimport { LogDefinitions, LogLevel, getLogType } from './logging.js';\nimport { DevToolsOptions, Action, DevToolsExtension, DevTools } from './devtools.js';\n\nexport type Reducer<T, P extends unknown[] = unknown[]> = (state: T, ...params: P) => T | false | Promise<T | false>;\n\nexport enum PerformanceMeasurement {\n  StartEnd = 'startEnd',\n  All = 'all'\n}\n\nexport interface StoreOptions {\n  history?: Partial<HistoryOptions>;\n  logDispatchedActions?: boolean;\n  measurePerformance?: PerformanceMeasurement;\n  propagateError?: boolean;\n  logDefinitions?: LogDefinitions;\n  devToolsOptions?: DevToolsOptions;\n}\n\nexport interface PipedDispatch<T> {\n  pipe: <P extends unknown[]>(reducer: Reducer<T, P> | string, ...params: P) => PipedDispatch<T>;\n  dispatch: () => Promise<void>;\n}\n\ninterface DispatchAction<T> {\n  reducer: Reducer<T>;\n  params: unknown[];\n}\n\ninterface DispatchQueueItem<T> {\n  actions: DispatchAction<T>[];\n  resolve: (value?: void | PromiseLike<void> | undefined) => void;\n  reject: (reason?: unknown) => void;\n}\n\nexport const STORE: { container: IContainer } = {\n  container: null!\n};\n\nexport interface IStoreWindow extends Window {\n  devToolsExtension?: DevToolsExtension;\n  __REDUX_DEVTOOLS_EXTENSION__?: DevToolsExtension;\n}\n\nexport class UnregisteredActionError<T, P extends unknown[]> extends Error {\n  public constructor(reducer?: string | Reducer<T, P>) {\n    super(`Tried to dispatch an unregistered action ${reducer !== undefined && (typeof reducer === \"string\" ? reducer : reducer.name)}`);\n  }\n}\n\nexport class DevToolsRemoteDispatchError extends Error {}\nexport class ActionRegistrationError extends Error {}\nexport class ReducerNoStateError extends Error {}\n\nexport interface MiddlewareSettings {\n  placement: MiddlewarePlacement;\n  settings?: unknown;\n}\n\nexport class Store<T> {\n  public readonly state: Observable<T>;\n  // TODO: need an alternative for the Reporter which supports multiple log levels\n  private devToolsAvailable: boolean = false;\n  private devTools?: DevTools<T>;\n  private readonly actions: Map<Reducer<T>, Action<string>> = new Map<Reducer<T>, Action<string>>();\n  private readonly middlewares: Map<Middleware<T>, MiddlewareSettings> = new Map<Middleware<T>, MiddlewareSettings>();\n  private readonly _state: BehaviorSubject<T>;\n  private readonly options: Partial<StoreOptions>;\n  private readonly dispatchQueue: DispatchQueueItem<T>[] = [];\n\n  public constructor(\n    private readonly initialState: T,\n    @ILogger private readonly logger: ILogger,\n    @IWindow private readonly window: IStoreWindow,\n    options?: Partial<StoreOptions>\n  ) {\n    this.options = options ?? {};\n    const isUndoable = this.options?.history?.undoable === true;\n    this._state = new BehaviorSubject<T>(initialState);\n    this.state = this._state.asObservable();\n\n    if (this.options?.devToolsOptions?.disable !== true) {\n      this.setupDevTools();\n    }\n\n    if (isUndoable) {\n      this.registerHistoryMethods();\n    }\n  }\n\n  public registerMiddleware(reducer: Middleware<T, undefined>, placement: MiddlewarePlacement): void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public registerMiddleware<S extends NonNullable<any>>(reducer: Middleware<T, S>, placement: MiddlewarePlacement, settings: S): void;\n  public registerMiddleware<S>(reducer: Middleware<T, S>, placement: MiddlewarePlacement, settings?: S): void {\n    this.middlewares.set(reducer, { placement, settings });\n  }\n\n  public unregisterMiddleware(reducer: Middleware<T>): void {\n    if (this.middlewares.has(reducer)) {\n      this.middlewares.delete(reducer);\n    }\n  }\n\n  public isMiddlewareRegistered(middleware: Middleware<T>): boolean {\n    return this.middlewares.has(middleware);\n  }\n\n  public registerAction(name: string, reducer: Reducer<T>): void {\n    if (reducer.length === 0) {\n      // The reducer is expected to have one or more parameters, where the first will be the present state\n      throw new ActionRegistrationError(\"The reducer is expected to have one or more parameters, where the first will be the present state\");\n    }\n\n    this.actions.set(reducer, { type: name });\n  }\n\n  public unregisterAction(reducer: Reducer<T>): void {\n    if (this.actions.has(reducer)) {\n      this.actions.delete(reducer);\n    }\n  }\n\n  public isActionRegistered(reducer: Reducer<T> | string): boolean {\n    if (typeof reducer === 'string') {\n      return Array.from(this.actions).find((action) => action[1].type === reducer) !== undefined;\n    }\n\n    return this.actions.has(reducer);\n  }\n\n  public resetToState(state: T): void {\n    this._state.next(state);\n  }\n\n  public async dispatch<P extends unknown[]>(reducer: Reducer<T, P> | string, ...params: P): Promise<void> {\n    const action = this.lookupAction(reducer as Reducer<T> | string);\n    if (!action) {\n      return Promise.reject(new UnregisteredActionError(reducer));\n    }\n\n    return this.queueDispatch([{\n      reducer: action,\n      params\n    }]);\n  }\n\n  public pipe<P extends unknown[]>(reducer: Reducer<T, P> | string, ...params: P): PipedDispatch<T> {\n    const pipeline: DispatchAction<T>[] = [];\n\n    const dispatchPipe: PipedDispatch<T> = {\n      dispatch: async () => this.queueDispatch(pipeline),\n      pipe: <NextP extends unknown[]>(nextReducer: Reducer<T, NextP> | string, ...nextParams: NextP) => {\n        const action = this.lookupAction(nextReducer as Reducer<T> | string);\n        if (!action) {\n          throw new UnregisteredActionError(reducer);\n        }\n        pipeline.push({ reducer: action, params: nextParams });\n        return dispatchPipe;\n      }\n    };\n\n    return dispatchPipe.pipe(reducer, ...params);\n  }\n\n  private lookupAction(reducer: Reducer<T> | string): Reducer<T> | undefined {\n    if (typeof reducer === \"string\") {\n      const result = Array.from(this.actions).find(([_, action]) => action.type === reducer);\n      if (result) {\n        return result[0];\n      }\n    } else if (this.actions.has(reducer)) {\n      return reducer;\n    }\n\n    return undefined;\n  }\n\n  private async queueDispatch(actions: DispatchAction<T>[]) {\n    return new Promise<void>((resolve, reject) => {\n      this.dispatchQueue.push({ actions, resolve, reject });\n      if (this.dispatchQueue.length === 1) {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.handleQueue();\n      }\n    });\n  }\n\n  private async handleQueue() {\n    if (this.dispatchQueue.length > 0) {\n      const queueItem = this.dispatchQueue[0];\n\n      try {\n        await this.internalDispatch(queueItem.actions);\n        queueItem.resolve();\n      } catch (e) {\n        queueItem.reject(e);\n      }\n\n      this.dispatchQueue.shift();\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.handleQueue();\n    }\n  }\n\n  private async internalDispatch(actions: DispatchAction<T>[]) {\n    const unregisteredAction = actions.find((a) => !this.actions.has(a.reducer));\n    if (unregisteredAction) {\n      throw new UnregisteredActionError(unregisteredAction.reducer);\n    }\n\n    STORE.container.get(IWindow).performance.mark(\"dispatch-start\");\n\n    const pipedActions = actions.map((a) => ({\n      type: this.actions.get(a.reducer)!.type,\n      params: a.params,\n      reducer: a.reducer\n    }));\n\n    const callingAction: CallingAction = {\n      name: pipedActions.map((a) => a.type).join(\"->\"),\n      params: pipedActions.reduce<unknown[]>((p, a) => p.concat(a.params), []),\n      pipedActions: pipedActions.map((a) => ({\n        name: a.type,\n        params: a.params\n      }))\n    };\n\n    if (this.options.logDispatchedActions) {\n      this.logger[getLogType(this.options, \"dispatchedActions\", LogLevel.info)](`Dispatching: ${callingAction.name}`);\n    }\n\n    // eslint-disable-next-line @typescript-eslint/await-thenable\n    const beforeMiddleswaresResult = await this.executeMiddlewares(\n      this._state.getValue(),\n      MiddlewarePlacement.Before,\n      callingAction\n    );\n\n    if (beforeMiddleswaresResult === false) {\n      STORE.container.get(IWindow).performance.clearMarks();\n      STORE.container.get(IWindow).performance.clearMeasures();\n\n      return;\n    }\n\n    let result: T | false = beforeMiddleswaresResult;\n    for (const action of pipedActions) {\n      // eslint-disable-next-line no-await-in-loop\n      result = await action.reducer(result, ...action.params);\n      if (result === false) {\n        STORE.container.get(IWindow).performance.clearMarks();\n        STORE.container.get(IWindow).performance.clearMeasures();\n\n        return;\n      }\n\n      STORE.container.get(IWindow).performance.mark(`dispatch-after-reducer-${action.type}`);\n\n      if (!result && typeof result !== \"object\") {\n        throw new ReducerNoStateError(\"The reducer has to return a new state\");\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/await-thenable\n    let resultingState = await this.executeMiddlewares(\n      result,\n      MiddlewarePlacement.After,\n      callingAction\n    );\n\n    if (resultingState === false) {\n      STORE.container.get(IWindow).performance.clearMarks();\n      STORE.container.get(IWindow).performance.clearMeasures();\n\n      return;\n    }\n\n    if (isStateHistory(resultingState) &&\n      this.options.history?.limit) {\n      resultingState = applyLimits(resultingState, this.options.history.limit);\n    }\n\n    this._state.next(resultingState);\n    STORE.container.get(IWindow).performance.mark(\"dispatch-end\");\n\n    if (this.options.measurePerformance === PerformanceMeasurement.StartEnd) {\n      STORE.container.get(IWindow).performance.measure(\n        \"startEndDispatchDuration\",\n        \"dispatch-start\",\n        \"dispatch-end\"\n      );\n\n      const measures = STORE.container.get(IWindow).performance.getEntriesByName(\"startEndDispatchDuration\");\n      this.logger[getLogType(this.options, \"performanceLog\", LogLevel.info)](\n        `Total duration ${measures[0].duration} of dispatched action ${callingAction.name}:`,\n        measures\n      );\n    } else if (this.options.measurePerformance === PerformanceMeasurement.All) {\n      const marks = STORE.container.get(IWindow).performance.getEntriesByType(\"mark\");\n      const totalDuration = marks[marks.length - 1].startTime - marks[0].startTime;\n      this.logger[getLogType(this.options, \"performanceLog\", LogLevel.info)](\n        `Total duration ${totalDuration} of dispatched action ${callingAction.name}:`,\n        marks\n      );\n    }\n\n    STORE.container.get(IWindow).performance.clearMarks();\n    STORE.container.get(IWindow).performance.clearMeasures();\n\n    this.updateDevToolsState({ type: callingAction.name, params: callingAction.params }, resultingState);\n  }\n\n  private executeMiddlewares(state: T, placement: MiddlewarePlacement, action: CallingAction): T | false {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return Array.from(this.middlewares)\n      .filter((middleware) => middleware[1].placement === placement)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      .reduce(async (prev: any, curr, _) => {\n        try {\n          const result = await curr[0](await prev, this._state.getValue(), curr[1].settings, action);\n\n          if (result === false) {\n            return false;\n          }\n\n          return result || await prev;\n        } catch (e) {\n          if (this.options.propagateError) {\n            throw e;\n          }\n\n          // eslint-disable-next-line @typescript-eslint/return-await\n          return await prev;\n        } finally {\n          STORE.container.get(IWindow).performance.mark(`dispatch-${placement}-${curr[0].name}`);\n        }\n      }, state);\n  }\n\n  private setupDevTools() {\n    // TODO: needs a better solution for global override\n    if (this.window.__REDUX_DEVTOOLS_EXTENSION__) {\n      this.logger[getLogType(this.options, \"devToolsStatus\", LogLevel.debug)](\"DevTools are available\");\n      this.devToolsAvailable = true;\n      // TODO: needs a better solution for global override\n      this.devTools = this.window.__REDUX_DEVTOOLS_EXTENSION__.connect(this.options.devToolsOptions);\n      this.devTools.init(this.initialState);\n\n      this.devTools.subscribe((message) => {\n        this.logger[getLogType(this.options, \"devToolsStatus\", LogLevel.debug)](`DevTools sent change ${message.type}`);\n\n        if (message.type === \"ACTION\" && message.payload !== undefined) {\n          const byName = Array.from(this.actions).find(function ([reducer]) {\n            return reducer.name === message.payload?.name;\n          });\n          const action = this.lookupAction(message.payload?.name) ?? byName?.[0];\n\n          if (!action) {\n            throw new DevToolsRemoteDispatchError(\"Tried to remotely dispatch an unregistered action\");\n          }\n\n          if (!message.payload.args || message.payload.args.length < 1) {\n            throw new DevToolsRemoteDispatchError(\"No action arguments provided\");\n          }\n\n          this.dispatch(action, ...message.payload.args.slice(1).map((arg: string) => JSON.parse(arg) as T)).catch(() => {\n            throw new DevToolsRemoteDispatchError(\"Issue when trying to dispatch an action through devtools\");\n          });\n          return;\n        }\n\n        if (message.type === \"DISPATCH\" && message.payload) {\n          switch (message.payload.type) {\n            case \"JUMP_TO_STATE\":\n            case \"JUMP_TO_ACTION\":\n              this._state.next(JSON.parse(message.state));\n              return;\n            case \"COMMIT\":\n              this.devTools!.init(this._state.getValue());\n              return;\n            case \"RESET\":\n              this.devTools!.init(this.initialState);\n              this.resetToState(this.initialState);\n              return;\n            case \"ROLLBACK\": {\n              const parsedState = JSON.parse(message.state) as T;\n\n              this.resetToState(parsedState);\n              this.devTools!.init(parsedState);\n              return;\n            }\n          }\n        }\n      });\n    }\n  }\n\n  private updateDevToolsState(action: Action<string>, state: T) {\n    if (this.devToolsAvailable && this.devTools) {\n      this.devTools.send(action, state);\n    }\n  }\n\n  private registerHistoryMethods() {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    this.registerAction(\"jump\", jump as Reducer<any>);\n  }\n}\n\nexport function dispatchify<T, P extends unknown[]>(action: Reducer<T, P> | string): (...params: P) => Promise<void> {\n  const store = STORE.container.get<Store<T>>(Store);\n\n  return async function (...params: P): Promise<void> {\n    return store.dispatch(action, ...params);\n  };\n}\n","import { skip as _skip, take as _take, delay as _delay } from \"rxjs/operators/index.js\";\nimport type { skip as $skip, take as $take, delay as $delay } from \"rxjs/operators\";\nconst skip = _skip as typeof $skip;\nconst take = _take as typeof $take;\nconst delay = _delay as typeof $delay;\n\nimport type { Store } from './store.js';\n\nexport type StepFn<T> = (res: T) => void;\n\nexport async function executeSteps<T>(store: Store<T>, shouldLogResults: boolean, ...steps: StepFn<T>[]) {\n  const logStep = (step: StepFn<T>, stepIdx: number) => (res: T) => {\n    if (shouldLogResults) {\n      console.group(`Step ${stepIdx}`);\n      console.log(res);\n      console.groupEnd();\n    }\n    step(res);\n  };\n\n  const tryStep = (step: StepFn<T>, reject: (reason?: unknown) => void) =>\n    (res: T) => {\n      try {\n        step(res);\n      } catch (err) {\n        reject(err);\n      }\n    };\n\n  const lastStep = (step: StepFn<T>, resolve: (value?: unknown) => void) =>\n    (res: T) => {\n      step(res);\n      resolve();\n    };\n\n  return new Promise((resolve, reject) => {\n    let currentStep = 0;\n\n    steps.slice(0, -1).forEach((step) => {\n      store.state.pipe(\n        skip(currentStep),\n        take(1),\n        delay(0)\n      ).subscribe(tryStep(logStep(step, currentStep), reject));\n      currentStep++;\n    });\n\n    store.state.pipe(\n      skip(currentStep),\n      take(1)\n    ).subscribe(\n      lastStep(tryStep(logStep(steps[steps.length - 1], currentStep), reject), resolve));\n  });\n}\n","/* eslint-disable @typescript-eslint/strict-boolean-expressions */\nimport { Controller } from \"@aurelia/runtime-html\";\nimport { Observable, Subscription } from 'rxjs';\n\nimport { Store, STORE } from './store.js';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport interface ConnectToSettings<T, R = T | any> {\n  onChanged?: string;\n  selector: ((store: Store<T>) => Observable<R>) | MultipleSelector<T, R>;\n  setup?: string;\n  target?: string;\n  teardown?: string;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport interface MultipleSelector<T, R = T | any> {\n  [key: string]: ((store: Store<T>) => Observable<R>);\n}\n\nconst defaultSelector = <T>(store: Store<T>) => store.state;\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function connectTo<T, R = any>(settings?: ((store: Store<T>) => Observable<R>) | ConnectToSettings<T, R>) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const _settings: ConnectToSettings<T, any> = {\n    selector: typeof settings === 'function' ? settings : defaultSelector,\n    ...settings\n  };\n\n  function getSource(store: Store<T>, selector: (((store: Store<T>) => Observable<R>))): Observable<unknown> {\n    const source = selector(store);\n\n    if (source instanceof Observable) {\n      return source;\n    }\n\n    return store.state;\n  }\n\n  function createSelectors() {\n    const isSelectorObj = typeof _settings.selector === \"object\";\n    const fallbackSelector = {\n      [_settings.target || 'state']: _settings.selector || defaultSelector\n    };\n\n    return Object.entries({\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      ...((isSelectorObj ? _settings.selector : fallbackSelector) as MultipleSelector<T, any>)\n    }).map(([target, selector]) => ({\n      targets: _settings.target && isSelectorObj ? [_settings.target, target] : [target],\n      selector,\n      // numbers are the starting index to slice all the change handling args,\n      // which are prop name, new state and old state\n      changeHandlers: {\n        [_settings.onChanged || '']: 1,\n        [`${_settings.target || target}Changed`]: _settings.target ? 0 : 1,\n        propertyChanged: 0\n      }\n    }));\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  return function (target: any) {\n    const originalSetup = typeof settings === 'object' && settings.setup\n      ? target.prototype[settings.setup]\n      : target.prototype.binding;\n    const originalTeardown = typeof settings === 'object' && settings.teardown\n      ? target.prototype[settings.teardown]\n      : target.prototype.bound;\n\n    target.prototype[typeof settings === 'object' && settings.setup !== undefined ? settings.setup : 'binding'] = function () {\n      if (typeof settings === 'object' &&\n        typeof settings.onChanged === 'string' &&\n        !(settings.onChanged in this)) {\n        // Provided onChanged handler does not exist on target VM\n        throw new Error('Provided onChanged handler does not exist on target VM');\n      }\n\n      const store = Controller.getCached(this)\n        ? Controller.getCached(this)!.container.get<Store<T>>(Store)\n        : STORE.container.get<Store<T>>(Store); // TODO: need to get rid of this helper for classic unit tests\n\n      this._stateSubscriptions = createSelectors().map(s => getSource(store, s.selector).subscribe((state: unknown) => {\n        const lastTargetIdx = s.targets.length - 1;\n        // eslint-disable-next-line default-param-last\n        const oldState = s.targets.reduce((accu = {}, curr) => accu[curr], this);\n\n        Object.entries(s.changeHandlers).forEach(([handlerName, args]) => {\n          if (handlerName in this) {\n            this[handlerName](...[ s.targets[lastTargetIdx], state, oldState ].slice(args, 3));\n          }\n        });\n\n        s.targets.reduce((accu, curr, idx) => {\n          accu[curr] = idx === lastTargetIdx ? state : accu[curr] || {};\n          return accu[curr];\n        }, this);\n      }));\n\n      if (originalSetup) {\n        // eslint-disable-next-line prefer-rest-params\n        return originalSetup.apply(this, arguments);\n      }\n    };\n\n    target.prototype[typeof settings === 'object' && settings.teardown ? settings.teardown : 'bound'] = function () {\n      if (this._stateSubscriptions && Array.isArray(this._stateSubscriptions)) {\n        this._stateSubscriptions.forEach((sub: Subscription) => {\n          if (sub instanceof Subscription && sub.closed === false) {\n            sub.unsubscribe();\n          }\n        });\n      }\n\n      if (originalTeardown) {\n        // eslint-disable-next-line prefer-rest-params\n        return originalTeardown.apply(this, arguments);\n      }\n    };\n  };\n}\n","import { IContainer, Registration, ILogger } from '@aurelia/kernel';\nimport { IWindow } from '@aurelia/runtime-html';\n\nimport { isStateHistory, StateHistory } from './history.js';\nimport { Store, STORE, StoreOptions } from './store.js';\n\nexport interface StorePluginOptions<T> extends StoreOptions {\n  initialState: T;\n}\n\nexport interface IConfigure {\n  withInitialState(state: unknown): IConfigure;\n  withOptions(options: Partial<StorePluginOptions<unknown>>): IConfigure;\n  register(container: IContainer): IContainer;\n}\n\nexport const StoreConfiguration: IConfigure = {\n  withInitialState(state: unknown): IConfigure {\n    Reflect.set(this, 'state', state);\n    return this;\n  },\n  withOptions(options: Partial<StorePluginOptions<unknown>>): IConfigure {\n    Reflect.set(this, 'options', options);\n    return this;\n  },\n  register(container: IContainer): IContainer {\n    // Stores a reference of the DI container for internal use\n    // TODO: get rid of this workaround for unit tests\n    STORE.container = container;\n\n    const state = Reflect.get(this, 'state') as unknown & Partial<StateHistory<unknown>>;\n    const options = Reflect.get(this, 'options') as Partial<StorePluginOptions<unknown>>;\n    const logger = container.get(ILogger);\n    const window = container.get(IWindow);\n\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    if (!state) {\n      throw new Error(\"initialState must be provided via withInitialState builder method\");\n    }\n\n    let initState: unknown = state;\n\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    if (options?.history?.undoable && !isStateHistory(state)) {\n      initState = { past: [], present: state, future: [] };\n    }\n\n    Registration.instance(Store, new Store(initState, logger, window, options)).register(container);\n\n    return container;\n  }\n};\n\nexport {\n  ActionRegistrationError,\n  DevToolsRemoteDispatchError,\n  IStoreWindow,\n  MiddlewareSettings,\n  PerformanceMeasurement,\n  PipedDispatch,\n  Reducer,\n  ReducerNoStateError,\n  STORE,\n  Store,\n  StoreOptions,\n  UnregisteredActionError,\n  dispatchify,\n} from './store.js';\nexport {\n  StepFn,\n  executeSteps\n} from './test-helpers.js';\nexport {\n  HistoryOptions,\n  StateHistory,\n  applyLimits,\n  isStateHistory,\n  jump,\n  nextStateHistory,\n} from './history.js';\nexport {\n  LogDefinitions,\n  LogLevel,\n  getLogType,\n} from './logging.js';\nexport {\n  CallingAction,\n  DEFAULT_LOCAL_STORAGE_KEY,\n  Middleware,\n  MiddlewarePlacement,\n  localStorageMiddleware,\n  logMiddleware,\n  rehydrateFromLocalStorage,\n} from './middleware.js';\nexport {\n  ConnectToSettings,\n  MultipleSelector,\n  connectTo,\n} from './decorator.js';\nexport {\n  Action,\n  ActionCreator,\n  DevTools,\n  DevToolsExtension,\n  DevToolsMessage,\n  DevToolsOptions,\n} from './devtools.js';\n"],"names":["_skip","_take","_delay"],"mappings":"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"}