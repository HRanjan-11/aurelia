{"version":3,"file":"index.js","sources":["../../../../node_modules/tslib/tslib.es6.js","../../src/interfaces.ts","../../src/http-utils.ts","../../src/file-utils.ts","../../src/request-handlers/file-server.ts","../../src/http-context.ts","../../src/http-server.ts","../../src/request-handlers/push-state-handler.ts","../../src/server-options.ts","../../src/configuration.ts","../../src/path-utils.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { DI, LogLevel as $LogLevel } from '@aurelia/kernel';\nimport { IHttpContext } from './http-context.js';\n\nexport const enum Encoding {\n  utf8 = 'utf8',\n}\n\nexport type LogLevel = 'trace' | 'debug' | 'info' | 'warn' | 'error' | 'fatal' | 'none';\nexport interface IHttpServerOptions {\n  readonly root: string;\n  readonly port: number;\n  readonly hostName: string;\n  readonly logLevel: LogLevel;\n  /** @internal */\n  readonly level: $LogLevel;\n  readonly useHttp2: boolean;\n  readonly useHttps: boolean;\n  readonly key?: string;\n  readonly cert?: string;\n  readonly responseCacheControl?: string;\n}\n\nexport class StartOutput {\n  public constructor(\n    public readonly realPort: number,\n  ) {}\n}\n\nexport interface IHttpServer {\n  start(): Promise<StartOutput>;\n  stop(): Promise<void>;\n}\n\nexport interface IRequestHandler {\n  handleRequest(context: IHttpContext): Promise<void>;\n}\n\nexport interface IHttp2FileServer {\n  handleRequest(context: IHttpContext): void;\n}\n\nexport const IHttpServerOptions = DI.createInterface<IHttpServerOptions>('IHttpServerOptions');\nexport const IHttpServer = DI.createInterface<IHttpServer>('IHttpServer');\nexport const IRequestHandler = DI.createInterface<IRequestHandler>('IRequestHandler');\nexport const IHttp2FileServer = DI.createInterface<IHttp2FileServer>('IHttp2FileServer');\n","import { IncomingMessage, IncomingHttpHeaders } from 'http';\nimport { Http2ServerRequest, IncomingHttpHeaders as IncomingHttp2Headers, constants } from 'http2';\n\nexport const enum HTTPStatusCode {\n  SwitchingProtocols = 101,\n\n  OK = 200,\n  Accepted = 202,\n  NoContent = 204,\n\n  Found = 302,\n\n  BadRequest = 400,\n  Unauthorized = 401,\n  Forbidden = 403,\n  NotFound = 404,\n  MethodNotAllowed = 405,\n\n  InternalServerError = 500,\n  BadGateway = 502,\n  ServiceUnavailable = 503,\n  GatewayTimeout = 504,\n}\n\nexport const enum ContentType {\n  unknown = '',\n  json = 'application/json; charset=utf-8',\n  javascript = 'application/javascript; charset=utf-8',\n  plain = 'text/plain; charset=utf-8',\n  html = 'text/html; charset=utf-8',\n  css = 'text/css; charset=utf-8',\n}\n\nexport const enum ContentEncoding {\n  identity = 'identity',\n  br = 'br',\n  gzip = 'gzip',\n  compress = 'compress',\n  // deflate = 'deflate', // Need to deal with this later. No known fixed file extension for deflate\n}\n\nexport class HTTPError extends Error {\n  public readonly statusCode: number;\n\n  public constructor(statusCode: number, message?: string) {\n    super(message);\n\n    this.statusCode = statusCode;\n  }\n}\n\nexport async function readBuffer(req: IncomingMessage | Http2ServerRequest): Promise<Buffer> {\n  let totalLength: number = 0;\n  const chunks: Buffer[] = [];\n\n  req.on('data', function (chunk: Buffer) {\n    chunks.push(chunk);\n    totalLength += chunk.length;\n  });\n\n  return new Promise(function (resolve, reject) {\n    req.on('end', function () {\n      const buffer = Buffer.concat(chunks, totalLength);\n\n      resolve(buffer);\n    });\n\n    req.on('error', reject);\n  });\n}\n\nexport function getContentType(path: string): ContentType {\n  const i = path.lastIndexOf('.');\n  if (i >= 0) {\n    switch (path.slice(i)) {\n      case '.js': return ContentType.javascript;\n      case '.css': return ContentType.css;\n      case '.json': return ContentType.json;\n      case '.html': return ContentType.html;\n    }\n  }\n\n  return ContentType.plain;\n}\n\nexport function getContentEncoding(path: string): ContentEncoding {\n  const i = path.lastIndexOf('.');\n  if (i >= 0) {\n    switch (path.slice(i)) {\n      case '.br': return ContentEncoding.br;\n      case '.gz': return ContentEncoding.gzip;\n      case '.lzw': return ContentEncoding.compress;\n    }\n  }\n\n  return ContentEncoding.identity;\n}\n\nexport type Headers = IncomingHttpHeaders | IncomingHttp2Headers;\n\nconst wildcardHeaderValue = {\n  [constants.HTTP2_HEADER_ACCEPT_ENCODING]: '*',\n  [constants.HTTP2_HEADER_ACCEPT]: '*/*',\n  [constants.HTTP2_HEADER_ACCEPT_CHARSET]: '*',\n  [constants.HTTP2_HEADER_ACCEPT_LANGUAGE]: '*',\n};\n\nexport class QualifiedHeaderValues {\n\n  public readonly headerName: string;\n  public readonly mostPrioritized: { name: string; q: number } | undefined;\n  private readonly parsedMap: Map<string, number>;\n\n  public constructor(\n    headerName: string,\n    headers: Headers\n  ) {\n    this.headerName = headerName.toLowerCase();\n    const rawValue: string = (headers[headerName] ?? headers[this.headerName]) as string;\n    headerName = this.headerName;\n    const parsedMap = this.parsedMap = new Map<string, number>();\n    if (rawValue === void 0) {\n      const wildcardValue = wildcardHeaderValue[headerName];\n      if (wildcardValue !== void 0) {\n        parsedMap.set(wildcardValue, 1);\n      }\n      return;\n    }\n\n    // TODO handle the partial values such as `text/html;q=0.8,text/*;q=0.8,*/*;q=0.8`, `*`, or `*;q=0.8`\n    /**\n     * Example:\n     * Header-Name: value1\n     * Header-Name: value1, value2, value3\n     * Header-Name: value1, value2;q=[0-1], value3;q=[0-1]\n     */\n\n    for (const item of rawValue.split(',')) {\n      // TODO validate the `value` against a set of acceptable values.\n      const [value, ...rest] = item.trim().split(';');\n      let qValue = 1;\n      const q = rest.find((x) => x.startsWith('q='));\n      if (q !== void 0) {\n        const rawQValue = q.substring(2);\n        qValue = Number(rawQValue);\n        if (Number.isNaN(qValue) || qValue < 0 || qValue > 1) {\n          throw new Error(`Invalid qValue ${rawQValue} for ${value} in ${headerName} header; raw values: ${rawValue}`);\n        }\n      }\n      parsedMap.set(value, qValue);\n      if (this.mostPrioritized === void 0 || this.mostPrioritized.q < qValue) {\n        this.mostPrioritized = { name: value, q: qValue };\n      }\n    }\n  }\n\n  public isAccepted(value: string) {\n    const qValue = this.parsedMap.get(value);\n    if (qValue !== void 0) {\n      return qValue !== 0;\n    }\n    return this.parsedMap.has(wildcardHeaderValue[this.headerName]);\n  }\n\n  public getQValueFor(value: string) {\n    const qValue = this.parsedMap.get(value);\n    return qValue ?? 0;\n  }\n}\n","import {\n  readFile as $readFile,\n  constants,\n  access,\n  exists as $exists,\n  mkdir as $mkdir,\n  lstat,\n  readdir as $readdir,\n  Stats,\n  rmdir as $rmdir,\n  unlink as $unlink\n} from \"fs\";\nimport { join } from 'path';\n\nexport async function readFile(path: string): Promise<Buffer>;\nexport async function readFile(path: string, options: string): Promise<string>;\nexport async function readFile(path: string, options: { encoding: BufferEncoding }): Promise<string>;\nexport async function readFile(path: string, options: { encoding?: null }): Promise<Buffer>;\nexport async function readFile(path: string, options?: string | { encoding?: null | BufferEncoding; flag?: string } | null) {\n\n  return new Promise<string | Buffer>(function (resolve, reject) {\n    $readFile(path, options, function (err, data) {\n      if (err !== null) {\n        reject(err);\n      } else {\n        resolve(data);\n      }\n    });\n  });\n\n}\n\nexport async function isReadable(path: string): Promise<boolean> {\n  return new Promise(function (resolve) {\n    access(path, constants.F_OK, (err) => {\n      resolve(err === null);\n    });\n  });\n}\n\nexport async function ensureDir(path: string): Promise<void> {\n\n  if (await exists(path)) { return; }\n\n  return mkdir(path);\n}\n\nexport async function exists(path: string) {\n  return new Promise<boolean>(res => { $exists(path, res); });\n}\n\nexport async function mkdir(path: string): Promise<void> {\n  return new Promise<void>(function (resolve, reject) {\n    $mkdir(path, { recursive: true }, function (err) {\n      if (err !== null) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nexport async function rimraf(path: string): Promise<void> {\n  const stats = await getStats(path);\n\n  if (stats.isDirectory()) {\n    await Promise.all((await readdir(path)).map(async x => rimraf(join(path, x))));\n    await rmdir(path);\n  } else if (stats.isFile() || stats.isSymbolicLink()) {\n    await unlink(path);\n  }\n}\n\nexport async function getStats(path: string): Promise<Stats> {\n  return new Promise<Stats>(function (resolve, reject) {\n    lstat(path, function (err, $stats) {\n      if (err !== null) {\n        reject(err);\n      } else {\n        resolve($stats);\n      }\n    });\n  });\n}\n\nexport async function readdir(path: string): Promise<string[]> {\n  return new Promise<string[]>(function (resolve, reject) {\n    $readdir(path, function (err, files) {\n      if (err !== null) {\n        reject(err);\n      } else {\n        resolve(files);\n      }\n    });\n  });\n}\n\nexport async function rmdir(path: string) {\n  return new Promise<void>(function (resolve, reject) {\n    $rmdir(path, function (err) {\n      if (err !== null) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nexport async function unlink(path: string) {\n  return new Promise<void>(function (resolve, reject) {\n    $unlink(path, function (err) {\n      if (err !== null) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n","import { statSync, openSync, readdirSync } from 'fs';\nimport { IncomingMessage, ServerResponse } from 'http';\nimport { ServerHttp2Stream, constants, Http2ServerRequest, Http2ServerResponse, OutgoingHttpHeaders } from 'http2';\nimport { join, resolve, relative, extname } from 'path';\nimport { ILogger } from '@aurelia/kernel';\nimport { IRequestHandler, IHttpServerOptions, IHttp2FileServer } from '../interfaces.js';\nimport { IHttpContext, HttpContextState } from '../http-context.js';\nimport { getContentType, HTTPStatusCode, getContentEncoding, ContentEncoding } from '../http-utils.js';\nimport { readFile, isReadable, exists } from '../file-utils.js';\n\nconst {\n  HTTP2_HEADER_PATH,\n  HTTP2_HEADER_CONTENT_LENGTH,\n  HTTP2_HEADER_LAST_MODIFIED,\n  HTTP2_HEADER_CONTENT_TYPE,\n  HTTP2_HEADER_ACCEPT_ENCODING,\n  HTTP2_HEADER_CONTENT_ENCODING,\n  HTTP2_HEADER_CACHE_CONTROL\n} = constants;\n\nconst contentEncodingExtensionMap = {\n  br: '.br',\n  gzip: '.gz',\n  compress: '.lzw'\n};\nconst compressedFileExtensions: Set<string> = new Set(Object.values(contentEncodingExtensionMap));\n\nexport class FileServer implements IRequestHandler {\n  private readonly root: string;\n  private readonly cacheControlDirective: string;\n\n  public constructor(\n    @IHttpServerOptions\n    private readonly opts: IHttpServerOptions,\n    @ILogger\n    private readonly logger: ILogger,\n  ) {\n    this.cacheControlDirective = this.opts.responseCacheControl ?? 'max-age=3600';\n    this.logger = logger.root.scopeTo('FileServer');\n\n    this.root = resolve(opts.root);\n\n    this.logger.debug(`Now serving files from: \"${this.root}\"`);\n  }\n\n  public async handleRequest(context: IHttpContext): Promise<void> {\n    const request = context.request;\n    const response = context.response;\n\n    if (!(request instanceof IncomingMessage && response instanceof ServerResponse)) { return; }\n    const parsedUrl = context.requestUrl;\n    const path = join(this.root, parsedUrl.path!);\n\n    if (await isReadable(path)) {\n      this.logger.debug(`Serving file \"${path}\"`);\n\n      const contentType = getContentType(path);\n      const clientEncoding = determineContentEncoding(context);\n\n      let contentEncoding: ContentEncoding = (void 0)!;\n      let content: any = (void 0)!;\n      if (\n        clientEncoding === 'br'\n        || clientEncoding === 'gzip'\n        || clientEncoding === 'compress'\n      ) {\n        const compressedFile = `${path}${contentEncodingExtensionMap[clientEncoding]}`;\n        if (await exists(compressedFile)) {\n          content = await readFile(compressedFile);\n          contentEncoding = getContentEncoding(compressedFile);\n        }\n      }\n      // handles 'identity' and 'deflate' (as no specific extension is known, and on-the-fly compression might be expensive)\n      if (contentEncoding === void 0 || content === void 0) {\n        content = await readFile(path);\n        contentEncoding = getContentEncoding(path);\n      }\n\n      response.writeHead(HTTPStatusCode.OK, {\n        'Content-Type': contentType,\n        'Content-Encoding': contentEncoding,\n        'Cache-Control': this.cacheControlDirective\n      });\n\n      await new Promise<void>(function (resolve) {\n        response.end(content, resolve);\n      });\n\n    } else {\n      this.logger.debug(`File \"${path}\" could not be found`);\n\n      response.writeHead(HTTPStatusCode.NotFound);\n\n      await new Promise(function (resolve) {\n        response.end(resolve);\n      });\n    }\n\n    context.state = HttpContextState.end;\n  }\n\n}\n\n/**\n * File server with HTTP/2 push support\n */\nexport class Http2FileServer implements IHttp2FileServer {\n\n  private readonly cacheControlDirective: string;\n  private readonly root: string;\n  private readonly filePushMap: Map<string, PushInfo> = new Map<string, PushInfo>();\n\n  public constructor(\n    @IHttpServerOptions\n    private readonly opts: IHttpServerOptions,\n    @ILogger\n    private readonly logger: ILogger,\n  ) {\n    this.cacheControlDirective = this.opts.responseCacheControl ?? 'max-age=3600';\n    this.logger = logger.root.scopeTo('Http2FileServer');\n\n    this.root = resolve(opts.root);\n    this.prepare();\n    this.logger.debug(`Now serving files from: \"${this.root}\"`);\n  }\n\n  public handleRequest(context: IHttpContext): void {\n    const request = context.request;\n    const response = context.response;\n\n    if (!(request instanceof Http2ServerRequest && response instanceof Http2ServerResponse)) { return; }\n    const parsedUrl = context.requestUrl;\n    const parsedPath = parsedUrl.path!;\n    const path = join(this.root, parsedPath);\n\n    const contentEncoding = determineContentEncoding(context);\n    const file = this.getPushInfo(parsedPath, contentEncoding);\n\n    if (file !== void 0) {\n      this.logger.debug(`Serving file \"${path}\"`);\n\n      const stream = response.stream;\n      // TODO make this configurable\n      if (parsedPath === '/index.html') {\n        this.pushAll(stream, contentEncoding);\n      }\n\n      stream.respondWithFD(file.fd, file.headers);\n\n    } else {\n      this.logger.debug(`File \"${path}\" could not be found`);\n      response.writeHead(HTTPStatusCode.NotFound);\n      response.end();\n    }\n\n    context.state = HttpContextState.end;\n  }\n\n  private pushAll(stream: ServerHttp2Stream, contentEncoding: string) {\n    for (const path of this.filePushMap.keys()) {\n      if (!path.endsWith('index.html') && !compressedFileExtensions.has(extname(path))) {\n        this.push(stream, path, this.getPushInfo(path, contentEncoding)!);\n      }\n    }\n  }\n\n  private push(stream: ServerHttp2Stream, filePath: string, { fd, headers }: PushInfo) {\n    const pushHeaders = { [HTTP2_HEADER_PATH]: filePath };\n\n    stream.pushStream(pushHeaders, (_err, pushStream) => {\n      // TODO handle error\n      this.logger.debug(`pushing ${filePath}`);\n      pushStream.respondWithFD(fd, headers);\n    });\n  }\n\n  private prepare(root = this.opts.root) {\n    const cacheControlDirective = this.cacheControlDirective;\n    for (const item of readdirSync(root)) {\n      const path = join(root, item);\n      const stats = statSync(path);\n      if (stats.isFile()) {\n        this.filePushMap.set(`/${relative(this.root, path)}`, PushInfo.create(path, cacheControlDirective));\n      } else {\n        this.prepare(path);\n      }\n    }\n  }\n\n  private getPushInfo(path: string, contentEncoding: string) {\n    if (\n      contentEncoding === 'br'\n      || contentEncoding === 'gzip'\n      || contentEncoding === 'compress'\n    ) {\n      const info = this.filePushMap.get(`${path}${contentEncodingExtensionMap[contentEncoding]}`);\n      if (info !== void 0) { return info; }\n    }\n    // handles 'identity' and 'deflate' (as no specific extension is known, and on-the-fly compression might be expensive)\n    return this.filePushMap.get(path);\n  }\n}\n\nclass PushInfo {\n  public static create(path: string, cacheControlDirective: string) {\n    const stat = statSync(path);\n    return new PushInfo(\n      openSync(path, 'r'),\n      {\n        [HTTP2_HEADER_CONTENT_LENGTH]: stat.size,\n        [HTTP2_HEADER_LAST_MODIFIED]: stat.mtime.toUTCString(),\n        [HTTP2_HEADER_CONTENT_TYPE]: getContentType(path),\n        [HTTP2_HEADER_CONTENT_ENCODING]: getContentEncoding(path),\n        [HTTP2_HEADER_CACHE_CONTROL]: cacheControlDirective\n      }\n    );\n  }\n  public constructor(\n    public fd: number,\n    public headers: OutgoingHttpHeaders,\n  ) { }\n}\n\nfunction determineContentEncoding(context: IHttpContext) {\n  const clientEncoding = context.getQualifiedRequestHeaderFor(HTTP2_HEADER_ACCEPT_ENCODING);\n\n  // if brotli compression is supported return `br`\n  if (clientEncoding.isAccepted('br')) {\n    return 'br';\n  }\n  // else return the highest prioritized content\n  return clientEncoding.mostPrioritized?.name ?? 'identity';\n}\n","import { IContainer } from '@aurelia/kernel';\nimport { IncomingMessage, ServerResponse } from 'http';\nimport { Http2ServerRequest, Http2ServerResponse } from 'http2';\nimport * as $url from 'url';\nimport { QualifiedHeaderValues } from './http-utils.js';\n\nexport const enum HttpContextState {\n  head = 1,\n  body = 2,\n  end = 3,\n}\n\nexport interface IHttpContext extends HttpContext { }\n\nexport class HttpContext implements IHttpContext {\n  public readonly container: IContainer;\n  public state: HttpContextState = HttpContextState.head;\n  private readonly parsedHeaders: Record<string, QualifiedHeaderValues> = Object.create(null);\n  private readonly _requestUrl: $url.UrlWithStringQuery;\n  private rewrittenUrl: $url.UrlWithStringQuery | null = null;\n\n  public constructor(\n    container: IContainer,\n    public readonly request: IncomingMessage | Http2ServerRequest,\n    public readonly response: ServerResponse | Http2ServerResponse,\n    public readonly requestBuffer: Buffer,\n  ) {\n    this.container = container.createChild();\n    this._requestUrl = $url.parse(request.url!);\n  }\n\n  public getQualifiedRequestHeaderFor(headerName: string): QualifiedHeaderValues {\n    return this.parsedHeaders[headerName]\n      ?? (this.parsedHeaders[headerName] = new QualifiedHeaderValues(headerName, this.request.headers));\n  }\n\n  public rewriteRequestUrl(url: string) {\n    this.rewrittenUrl = $url.parse(url);\n  }\n\n  public get requestUrl(): $url.UrlWithStringQuery {\n    return this.rewrittenUrl ?? this._requestUrl;\n  }\n}\n","import { readFileSync } from 'fs';\nimport { Server, createServer, IncomingMessage, ServerResponse, RequestListener } from 'http';\nimport * as https from 'https';\nimport { Http2Server as $Http2Server, createSecureServer, Http2ServerRequest, Http2ServerResponse } from 'http2';\n\nimport { ILogger, bound, all, IContainer } from '@aurelia/kernel';\nimport { IHttpServer, IHttpServerOptions, IRequestHandler, StartOutput, IHttp2FileServer } from './interfaces.js';\nimport { AddressInfo } from 'net';\nimport { HTTPStatusCode, readBuffer } from './http-utils.js';\nimport { HttpContext } from './http-context.js';\n\nexport class HttpServer implements IHttpServer {\n  private server: Server | null = null;\n\n  public constructor(\n    @ILogger\n    private readonly logger: ILogger,\n    @IHttpServerOptions\n    private readonly opts: IHttpServerOptions,\n    @IContainer\n    private readonly container: IContainer,\n    @all(IRequestHandler)\n    private readonly handlers: readonly IRequestHandler[],\n  ) {\n    this.logger = logger.root.scopeTo('HttpServer');\n  }\n\n  public async start(): Promise<StartOutput> {\n    this.logger.debug(`start()`);\n\n    const { hostName, port, useHttps, key, cert } = this.opts;\n\n    const server = this.server = (\n      useHttps\n        ? https.createServer({ key: readFileSync(key!), cert: readFileSync(cert!) }, this.handleRequest as RequestListener)\n        : createServer(this.handleRequest as RequestListener)\n    ).listen(port, hostName);\n    await new Promise(resolve => server.on('listening', resolve));\n\n    const { address, port: realPort } = this.server.address() as AddressInfo;\n    this.logger.info(`Now listening on ${address}:${realPort} (configured: ${hostName}:${port})`);\n\n    return new StartOutput(realPort);\n  }\n\n  public async stop(): Promise<void> {\n    this.logger.debug(`stop()`);\n\n    await new Promise(resolve => this.server!.close(resolve));\n  }\n\n  @bound\n  private async handleRequest(req: IncomingMessage, res: ServerResponse): Promise<void> {\n    this.logger.debug(`handleRequest(url=${req.url})`);\n\n    try {\n      const buffer = await readBuffer(req);\n      const context = new HttpContext(this.container, req, res, buffer);\n      for (const handler of this.handlers) {\n        // TODO: we need to identify here if the request is handled, if yes then break. Contextually, if the request is not handled by any handlers, we should panic, throw error and cause mayhem.\n        // eslint-disable-next-line no-await-in-loop\n        await handler.handleRequest(context);\n      }\n    } catch (err) {\n      this.logger.error(`handleRequest Error: ${err.message}\\n${err.stack}`);\n\n      res.statusCode = HTTPStatusCode.InternalServerError;\n      res.end();\n    }\n  }\n}\n\nexport class Http2Server implements IHttpServer {\n  private server: $Http2Server | null = null;\n\n  public constructor(\n    @ILogger\n    private readonly logger: ILogger,\n    @IHttpServerOptions\n    private readonly opts: IHttpServerOptions,\n    @IContainer\n    private readonly container: IContainer,\n    @IHttp2FileServer\n    private readonly http2FileServer: IHttp2FileServer,\n  ) {\n    this.logger = logger.root.scopeTo('Http2Server');\n  }\n\n  public async start(): Promise<StartOutput> {\n    this.logger.debug(`start()`);\n\n    const { hostName, port, cert, key } = this.opts;\n\n    const server = this.server = createSecureServer(\n      {\n        key: readFileSync(key!),\n        cert: readFileSync(cert!)\n      },\n      this.handleRequest // Do we need this at all?\n    ).listen(port, hostName);\n    await new Promise(resolve => server.on('listening', resolve));\n\n    const { address, port: realPort } = server.address() as AddressInfo;\n    this.logger.info(`Now listening on ${address}:${realPort} (configured: ${hostName}:${port})`);\n\n    return new StartOutput(realPort);\n  }\n\n  public async stop(): Promise<void> {\n    this.logger.debug(`stop()`);\n\n    await new Promise(resolve => this.server!.close(resolve));\n  }\n\n  @bound\n  private handleRequest(req: Http2ServerRequest, res: Http2ServerResponse): void {\n    this.logger.info(`handleRequest(url=${req.url})`);\n\n    try {\n      // const buffer = await readBuffer(req); // TODO handle this later\n      const context = new HttpContext(this.container, req, res, null!);\n      this.http2FileServer.handleRequest(context);\n    } catch (err) {\n      this.logger.error(`handleRequest Error: ${err.message}\\n${err.stack}`);\n\n      res.statusCode = HTTPStatusCode.InternalServerError;\n      res.end();\n    }\n  }\n}\n","import { constants } from 'http2';\nimport { IHttpContext } from '../http-context.js';\nimport { IRequestHandler } from '../interfaces.js';\n\nexport class PushStateHandler implements IRequestHandler {\n  public async handleRequest(context: IHttpContext): Promise<void> {\n    const request = context.request;\n    const url = context.requestUrl.href;\n\n    /**\n     * Ignore the request if one of the following is condition holds:\n     * 1. Not a GET request.\n     * 2. Client does not accept html.\n     * 3. The path has a dot (.) in the last fragment; dot rule.\n     */\n    if (\n      request.method !== 'GET'\n      || !context.getQualifiedRequestHeaderFor(constants.HTTP2_HEADER_ACCEPT).isAccepted('text/html')\n      || url.lastIndexOf('.') > url.lastIndexOf('/')\n    ) {\n      return;\n    }\n\n    context.rewriteRequestUrl('/index.html');\n  }\n}\n","import { LogLevel as $LogLevel } from '@aurelia/kernel';\nimport { EOL } from 'os';\nimport { resolve } from 'path';\nimport { IHttpServerOptions, LogLevel } from './interfaces.js';\n\nconst space = ' ';\n\nexport class HttpServerOptions implements IHttpServerOptions {\n  public constructor(\n    public root: string = './public/',\n    public hostName: string = '0.0.0.0',\n    public port: number = 8080,\n    public useHttp2: boolean = false,\n    public useHttps: boolean = false,\n    public key: string | undefined = undefined,\n    public cert: string | undefined = undefined,\n    public logLevel: LogLevel = 'info',\n    public responseCacheControl: string | undefined = 'max-age=3600',\n  ) { }\n\n  public applyConfig(config: Partial<IHttpServerOptions>) {\n    // non-nested object-tree is expected.\n    for (const [key, value] of Object.entries(config)) {\n      (this as any)[key] = value;\n    }\n  }\n\n  /** @internal */\n  public validate(): void {\n    const useHttp2 = this.useHttp2;\n    const useHttps = this.useHttps;\n    const key = this.key;\n    const cert = this.cert;\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    if ((useHttp2 || useHttps) && !(key && cert)) { // boolean coercion is needed\n      throw new Error(`key and cert are required for a HTTP/2 server`);\n    }\n  }\n\n  public toString(indent = '') {\n    const l2Indent = `${indent}${space.repeat(2)}`;\n    return `${indent}root${EOL}`\n      + `${l2Indent}Description: The HTTP or HTTP/2 server serves the files from this directory${EOL}`\n      + `${l2Indent}Value: ${this.root}${EOL}`\n      + `${indent}hostName${EOL}`\n      + `${l2Indent}Description: The host-name to be used${EOL}`\n      + `${l2Indent}Value: ${this.hostName}${EOL}`\n      + `${indent}port${EOL}`\n      + `${l2Indent}Description: The port to be used${EOL}`\n      + `${l2Indent}Value: ${this.port}${EOL}`\n      + `${indent}useHttp2${EOL}`\n      + `${l2Indent}Description: Whether to use HTTP/2 or not${EOL}`\n      + `${l2Indent}Value: ${this.useHttp2}${EOL}`\n      + `${indent}useHttps${EOL}`\n      + `${l2Indent}Description: Whether to use SSL or not${EOL}`\n      + `${l2Indent}Value: ${this.useHttps}${EOL}`\n      + `${indent}key${EOL}`\n      + `${l2Indent}Description: Optional path to the key file; required for https:// and HTTP/2${EOL}`\n      + `${l2Indent}Value: ${this.key}${EOL}`\n      + `${indent}cert${EOL}`\n      + `${l2Indent}Description: Optional path to the certificate file; required for https:// and HTTP/2${EOL}`\n      + `${l2Indent}Value: ${this.cert}${EOL}`\n      + `${indent}logLevel${EOL}`\n      + `${l2Indent}Description: Log level used by the HTTP server${EOL}`\n      + `${l2Indent}Value: ${this.logLevel}${EOL}`\n      ;\n  }\n\n  public get level(): $LogLevel {\n    const logLevel = this.logLevel;\n    if (typeof logLevel === 'number') { return logLevel; }\n    switch (logLevel) {\n      case 'trace': return $LogLevel.trace;\n      case 'debug': return $LogLevel.debug;\n      case 'info': return $LogLevel.info;\n      case 'warn': return $LogLevel.warn;\n      case 'error': return $LogLevel.error;\n      case 'fatal': return $LogLevel.fatal;\n      case 'none': return $LogLevel.none;\n    }\n  }\n\n  public applyOptionsFromCli(cwd: string, args: string[], argPrefix = '') {\n    const unconsumedArgs: string[] = [];\n    while (args.length > 0) {\n      const key = args[0].trim().replace(/-/g, '');\n      const value = args[1];\n      switch (key) {\n        case `${argPrefix}root`:\n          this.root = resolve(cwd, value);\n          break;\n        case `${argPrefix}hostName`:\n          this.hostName = value;\n          break;\n        case `${argPrefix}port`:\n          this.port = Number(value);\n          break;\n        case `${argPrefix}key`:\n          this.key = resolve(cwd, value);\n          break;\n        case `${argPrefix}cert`:\n          this.cert = resolve(cwd, value);\n          break;\n        case `${argPrefix}useHttp2`:\n          this.useHttp2 = value === 'true';\n          break;\n        case `${argPrefix}logLevel`:\n          this.logLevel = value as unknown as LogLevel;\n          break;\n        case `${argPrefix}responseCacheControl`:\n          this.responseCacheControl = value;\n          break;\n        default:\n          unconsumedArgs.push(key, value);\n          break;\n      }\n      args.splice(0, 2);\n    }\n\n    if (unconsumedArgs.length > 0) {\n      console.warn(`Following arguments are not consumed ${unconsumedArgs.join(',')}`);\n    }\n  }\n}\n","import { ColorOptions, ConsoleSink, IContainer, IPlatform, LoggerConfiguration, Platform, Registration } from '@aurelia/kernel';\nimport { Http2Server, HttpServer } from './http-server.js';\nimport { IHttp2FileServer, IHttpServer, IHttpServerOptions, IRequestHandler } from './interfaces.js';\nimport { FileServer, Http2FileServer } from './request-handlers/file-server.js';\nimport { PushStateHandler } from './request-handlers/push-state-handler.js';\nimport { HttpServerOptions } from './server-options.js';\n\nconst opts: HttpServerOptions = new HttpServerOptions();\n\nexport const HttpServerConfiguration = {\n  create(customization: Partial<IHttpServerOptions>) {\n    opts.applyConfig(customization);\n    opts.validate();\n    return {\n      register(container: IContainer): IContainer {\n        container.register(\n          Registration.instance(IHttpServerOptions, opts),\n          Registration.singleton(IRequestHandler, PushStateHandler),\n          Registration.singleton(IRequestHandler, FileServer),\n          Registration.singleton(IHttp2FileServer, Http2FileServer),\n          LoggerConfiguration.create({ sinks: [ConsoleSink], level: opts.level, colorOptions: ColorOptions.colors }),\n          Registration.instance(IPlatform, new Platform(globalThis)),\n        );\n\n        if (opts.useHttp2) {\n          container.register(Registration.singleton(IHttpServer, Http2Server));\n        } else {\n          container.register(Registration.singleton(IHttpServer, HttpServer));\n        }\n\n        return container;\n      },\n    };\n  }\n};\n","import { join, resolve } from 'path';\n\nexport const normalizePath = (function () {\n  const cache: Record<string, string | undefined> = Object.create(null);\n  const regex = /\\\\/g;\n  return function (path: string) {\n    let normalized = cache[path];\n    if (normalized === void 0) {\n      normalized = cache[path] = path.replace(regex, '/');\n    }\n    return normalized;\n  };\n})();\n\nexport function joinPath(...paths: string[]): string {\n  return normalizePath(join(...paths));\n}\n\nexport function resolvePath(...paths: string[]): string {\n  return normalizePath(resolve(...paths));\n}\n"],"names":["$readFile","constants","$exists"],"mappings":"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"}