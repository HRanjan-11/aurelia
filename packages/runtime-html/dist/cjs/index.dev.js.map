{"version":3,"file":"index.dev.js","sources":["../../../../node_modules/tslib/tslib.es6.js","../../src/bindable.ts","../../src/observation/bindable-observer.ts","../../src/resources/attribute-pattern.ts","../../src/utilities-html.ts","../../src/platform.ts","../../src/observation/svg-analyzer.ts","../../src/attribute-mapper.ts","../../src/binding/call-binding.ts","../../src/observation/element-attribute-observer.ts","../../src/binding/binding-utils.ts","../../src/binding/attribute.ts","../../src/binding/interpolation-binding.ts","../../src/binding/let-binding.ts","../../src/binding/property-binding.ts","../../src/binding/ref-binding.ts","../../src/app-task.ts","../../src/templating/children.ts","../../src/resources/custom-attribute.ts","../../src/watch.ts","../../src/resources/custom-element.ts","../../src/templating/view.ts","../../src/templating/render-context.ts","../../src/observation/class-attribute-accessor.ts","../../src/templating/styles.ts","../../src/templating/watchers.ts","../../src/templating/lifecycle-hooks.ts","../../src/templating/controller.ts","../../src/app-root.ts","../../src/dom.ts","../../src/binding/listener.ts","../../src/observation/event-delegator.ts","../../src/resources/slot-injectables.ts","../../src/renderer.ts","../../src/resources/binding-command.ts","../../src/template-element-factory.ts","../../src/utilities-di.ts","../../src/template-compiler.ts","../../src/binding-behaviors/binding-mode.ts","../../src/binding-behaviors/debounce.ts","../../src/binding-behaviors/signals.ts","../../src/binding-behaviors/throttle.ts","../../src/observation/data-attribute-accessor.ts","../../src/resources/binding-behaviors/attr.ts","../../src/resources/binding-behaviors/self.ts","../../src/observation/attribute-ns-accessor.ts","../../src/observation/checked-observer.ts","../../src/observation/select-value-observer.ts","../../src/observation/style-attribute-accessor.ts","../../src/observation/value-attribute-observer.ts","../../src/observation/observer-locator.ts","../../src/resources/binding-behaviors/update-trigger.ts","../../src/resources/custom-attributes/focus.ts","../../src/resources/custom-attributes/show.ts","../../src/resources/template-controllers/portal.ts","../../src/resources/template-controllers/flags.ts","../../src/resources/template-controllers/if.ts","../../src/resources/template-controllers/repeat.ts","../../src/resources/template-controllers/with.ts","../../src/resources/template-controllers/switch.ts","../../src/resources/template-controllers/promise.ts","../../src/create-element.ts","../../src/resources/custom-elements/au-render.ts","../../src/resources/custom-elements/au-compose.ts","../../src/resources/custom-elements/au-slot.ts","../../src/resources/value-converters/sanitize.ts","../../src/resources/value-converters/view.ts","../../src/configuration.ts","../../src/aurelia.ts","../../src/templating/dialog/dialog-interfaces.ts","../../src/templating/dialog/dialog-controller.ts","../../src/templating/dialog/dialog-service.ts","../../src/templating/dialog/dialog-default-impl.ts","../../src/templating/dialog/dialog-configuration.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { kebabCase, Metadata, Protocol, firstDefined, getPrototypeChain, noop } from '@aurelia/kernel';\nimport { BindingMode } from '@aurelia/runtime';\n\nimport type { Constructable, Writable } from '@aurelia/kernel';\nimport type { InterceptorFunc } from '@aurelia/runtime';\n\nexport type PartialBindableDefinition = {\n  mode?: BindingMode;\n  callback?: string;\n  attribute?: string;\n  property?: string;\n  primary?: boolean;\n  set?: InterceptorFunc;\n};\n\ntype PartialBindableDefinitionPropertyRequired = PartialBindableDefinition & {\n  property: string;\n};\n\ntype PartialBindableDefinitionPropertyOmitted = Omit<PartialBindableDefinition, 'property'>;\n\n/**\n * Decorator: Specifies custom behavior for a bindable property.\n *\n * @param config - The overrides\n */\nexport function bindable(config?: PartialBindableDefinitionPropertyOmitted): (target: {}, property: string) => void;\n/**\n * Decorator: Specifies a bindable property on a class.\n *\n * @param prop - The property name\n */\nexport function bindable(prop: string): (target: Constructable) => void;\n/**\n * Decorator: Specifies a bindable property on a class.\n *\n * @param target - The class\n * @param prop - The property name\n */\nexport function bindable(target: {}, prop: string): void;\nexport function bindable(configOrTarget?: PartialBindableDefinition | {}, prop?: string): void | ((target: {}, property: string) => void) | ((target: Constructable) => void) {\n  let config: PartialBindableDefinition;\n\n  function decorator($target: {}, $prop: string): void {\n    if (arguments.length > 1) {\n      // Non invocation:\n      // - @bindable\n      // Invocation with or w/o opts:\n      // - @bindable()\n      // - @bindable({...opts})\n      config.property = $prop;\n    }\n\n    Metadata.define(Bindable.name, BindableDefinition.create($prop, config), $target.constructor, $prop);\n    Protocol.annotation.appendTo($target.constructor as Constructable, Bindable.keyFrom($prop));\n  }\n\n  if (arguments.length > 1) {\n    // Non invocation:\n    // - @bindable\n    config = {};\n    decorator(configOrTarget!, prop!);\n    return;\n  } else if (typeof configOrTarget === 'string') {\n    // ClassDecorator\n    // - @bindable('bar')\n    // Direct call:\n    // - @bindable('bar')(Foo)\n    config = {};\n    return decorator;\n  }\n\n  // Invocation with or w/o opts:\n  // - @bindable()\n  // - @bindable({...opts})\n  config = configOrTarget === void 0 ? {} : configOrTarget;\n  return decorator;\n}\n\nfunction isBindableAnnotation(key: string): boolean {\n  return key.startsWith(Bindable.name);\n}\n\ntype BFluent = {\n  add(config: PartialBindableDefinitionPropertyRequired): BFluent;\n  add(property: string): BFluent & B12345;\n};\n\ntype B1<T = {}> = {\n  mode(mode: BindingMode): BFluent & T;\n};\n\ntype B2<T = {}> = {\n  callback(callback: string): BFluent & T;\n};\n\ntype B3<T = {}> = {\n  attribute(attribute: string): BFluent & T;\n};\n\ntype B4<T = {}> = {\n  primary(): BFluent & T;\n};\n\ntype B5<T = {}> = {\n  set(setterFn: InterceptorFunc): BFluent & T;\n};\n\n// An important self-imposed limitation for this to be viable (e.g. avoid exponential combination growth),\n// is to keep the fluent API invocation order in a single direction.\ntype B45 = B5 & B4<B5>;\ntype B345 = B45 & B3<B45>;\ntype B2345 = B345 & B2<B345>;\ntype B12345 = B2345 & B1<B2345>;\n\nexport const Bindable = {\n  name: Protocol.annotation.keyFor('bindable'),\n  keyFrom(name: string): string {\n    return `${Bindable.name}:${name}`;\n  },\n  from(...bindableLists: readonly (BindableDefinition | Record<string, PartialBindableDefinition> | readonly string[] | undefined)[]): Record<string, BindableDefinition> {\n    const bindables: Record<string, BindableDefinition> = {};\n\n    const isArray = Array.isArray as <T>(arg: unknown) => arg is readonly T[];\n\n    function addName(name: string): void {\n      bindables[name] = BindableDefinition.create(name);\n    }\n\n    function addDescription(name: string, def: PartialBindableDefinition): void {\n      bindables[name] = def instanceof BindableDefinition ? def : BindableDefinition.create(name, def);\n    }\n\n    function addList(maybeList: BindableDefinition | Record<string, PartialBindableDefinition> | readonly string[] | undefined): void {\n      if (isArray(maybeList)) {\n        maybeList.forEach(addName);\n      } else if (maybeList instanceof BindableDefinition) {\n        bindables[maybeList.property] = maybeList;\n      } else if (maybeList !== void 0) {\n        Object.keys(maybeList).forEach(name => addDescription(name, maybeList[name]));\n      }\n    }\n\n    bindableLists.forEach(addList);\n\n    return bindables;\n  },\n  for(Type: Constructable): BFluent {\n    let def: Writable<BindableDefinition>;\n\n    const builder: BFluent & B12345 = {\n      add(configOrProp: string | PartialBindableDefinitionPropertyRequired): BFluent & B12345 {\n        let prop: string;\n        let config: PartialBindableDefinitionPropertyRequired;\n        if (typeof configOrProp === 'string') {\n          prop = configOrProp;\n          config = { property: prop };\n        } else {\n          prop = configOrProp.property;\n          config = configOrProp;\n        }\n\n        def = BindableDefinition.create(prop, config) as Writable<BindableDefinition>;\n        if (!Metadata.hasOwn(Bindable.name, Type, prop)) {\n          Protocol.annotation.appendTo(Type, Bindable.keyFrom(prop));\n        }\n        Metadata.define(Bindable.name, def, Type, prop);\n\n        return builder;\n      },\n      mode(mode: BindingMode): BFluent & B12345 {\n        def.mode = mode;\n\n        return builder;\n      },\n      callback(callback: string): BFluent & B12345 {\n        def.callback = callback;\n\n        return builder;\n      },\n      attribute(attribute: string): BFluent & B12345 {\n        def.attribute = attribute;\n\n        return builder;\n      },\n      primary(): BFluent & B12345 {\n        def.primary = true;\n\n        return builder;\n      },\n      set(setInterpreter: InterceptorFunc): BFluent & B12345 {\n        def.set = setInterpreter;\n\n        return builder;\n      }\n    };\n\n    return builder;\n  },\n  getAll(Type: Constructable): readonly BindableDefinition[] {\n    const propStart = Bindable.name.length + 1;\n    const defs: BindableDefinition[] = [];\n    const prototypeChain = getPrototypeChain(Type);\n\n    let iProto = prototypeChain.length;\n    let iDefs = 0;\n    let keys: string[];\n    let keysLen: number;\n    let Class: Constructable;\n    while (--iProto >= 0) {\n      Class = prototypeChain[iProto];\n      keys = Protocol.annotation.getKeys(Class).filter(isBindableAnnotation);\n      keysLen = keys.length;\n      for (let i = 0; i < keysLen; ++i) {\n        defs[iDefs++] = Metadata.getOwn(Bindable.name, Class, keys[i].slice(propStart)) as BindableDefinition;\n      }\n    }\n    return defs;\n  },\n};\n\nexport class BindableDefinition {\n  private constructor(\n    public readonly attribute: string,\n    public readonly callback: string,\n    public readonly mode: BindingMode,\n    public readonly primary: boolean,\n    public readonly property: string,\n    public readonly set: InterceptorFunc,\n  ) { }\n\n  public static create(prop: string, def: PartialBindableDefinition = {}): BindableDefinition {\n    return new BindableDefinition(\n      firstDefined(def.attribute, kebabCase(prop)),\n      firstDefined(def.callback, `${prop}Changed`),\n      firstDefined(def.mode, BindingMode.toView),\n      firstDefined(def.primary, false),\n      firstDefined(def.property, prop),\n      firstDefined(def.set, noop),\n    );\n  }\n}\n\n/* eslint-disable @typescript-eslint/no-unused-vars,spaced-comment */\n/**\n * This function serves two purposes:\n * - A playground for contributors to try their changes to the APIs.\n * - Cause the API surface to be properly type-checked and protected against accidental type regressions.\n *\n * It will be automatically removed by dead code elimination.\n */\nfunction apiTypeCheck() {\n\n  @bindable('prop')\n  // > expected error - class decorator only accepts a string\n  //@bindable({})\n  class Foo {\n    @bindable\n    @bindable()\n    @bindable({})\n    // > expected error - 'property' does not exist on decorator input object\n    //@bindable({ property: 'prop' })\n    @bindable({ mode: BindingMode.twoWay })\n    @bindable({ callback: 'propChanged' })\n    @bindable({ attribute: 'prop' })\n    @bindable({ primary: true })\n    @bindable({ set: value => String(value) })\n    @bindable({ set: value => Number(value) })\n    @bindable({\n      mode: BindingMode.twoWay,\n      callback: 'propChanged',\n      attribute: 'prop',\n      primary: true,\n      set: value => String(value)\n    })\n    public prop: unknown;\n  }\n\n  Bindable.for(Foo)\n    // > expected error - there is no add() function with only optional params on the fluent api\n    //.add()\n    // > expected error - 'property' is a required property on the fluent api\n    //.add({})\n    .add({ property: 'prop' })\n    .add({ property: 'prop', mode: BindingMode.twoWay })\n    .add({ property: 'prop', callback: 'propChanged' })\n    .add({ property: 'prop', attribute: 'prop' })\n    .add({ property: 'prop', primary: true })\n    .add({ property: 'prop', mode: BindingMode.twoWay, callback: 'propChanged', attribute: 'prop', primary: true })\n    .add('prop')\n    // > expected error - the add() method that accepts an object literal does not return a fluent api\n    //.add({ property: 'prop' }).mode(BindingMode.twoWay)\n    //.add({ property: 'prop' }).callback('propChanged')\n    //.add({ property: 'prop' }).attribute('prop')\n    //.add({ property: 'prop' }).primary()\n    // > expected error - fluent api methods can only be invoked once per bindable\n    //.add('prop').mode(BindingMode.twoWay).mode(BindingMode.twoWay)\n    //.add('prop').mode(BindingMode.twoWay).callback('propChanged').mode(BindingMode.twoWay)\n    //.add('prop').mode(BindingMode.twoWay).callback('propChanged').callback('propChanged') // etc\n    // > expected error - wrong invocation order\n    //.add('prop').callback('propChanged').mode(BindingMode.twoWay)\n    //.add('prop').primary().mode(BindingMode.twoWay)  // etc\n    .add('prop').mode(BindingMode.twoWay)\n    .add('prop').mode(BindingMode.twoWay).callback('propChanged')\n    .add('prop').mode(BindingMode.twoWay).callback('propChanged').attribute('prop')\n    .add('prop').mode(BindingMode.twoWay).callback('propChanged').attribute('prop').primary()\n    .add('prop').mode(BindingMode.twoWay).set((value: unknown) => Number(value))\n    .add('prop').mode(BindingMode.twoWay).callback('propChanged').set(value => Number(value))\n    .add('prop').callback('propChanged')\n    .add('prop').callback('propChanged').attribute('prop')\n    .add('prop').callback('propChanged').attribute('prop').primary()\n    .add('prop').attribute('prop')\n    .add('prop').attribute('prop').primary()\n    .add('prop').primary();\n}\n/* eslint-enable @typescript-eslint/no-unused-vars,spaced-comment */\n","import { noop } from '@aurelia/kernel';\nimport { subscriberCollection, AccessorType, LifecycleFlags, withFlushQueue } from '@aurelia/runtime';\n\nimport type { IIndexable } from '@aurelia/kernel';\nimport type {\n  InterceptorFunc,\n  IObserver,\n  ISubscriber,\n  ISubscriberCollection,\n  IFlushable,\n  IWithFlushQueue,\n  FlushQueue,\n} from '@aurelia/runtime';\nimport type { IController } from '../templating/controller';\n\nexport interface BindableObserver extends IObserver, ISubscriberCollection {}\n\ninterface IMayHavePropertyChangedCallback {\n  propertyChanged?(name: string, newValue: unknown, oldValue: unknown, flags: LifecycleFlags): void;\n}\n\ntype HasPropertyChangedCallback = Required<IMayHavePropertyChangedCallback>;\n\nexport class BindableObserver implements IFlushable, IWithFlushQueue {\n  public get type(): AccessorType { return AccessorType.Observer; }\n  // todo: name too long. just value/oldValue, or v/oV\n  public value: unknown = void 0;\n  public oldValue: unknown = void 0;\n\n  public observing: boolean;\n  public queue!: FlushQueue;\n\n  private readonly cb: (newValue: unknown, oldValue: unknown, flags: LifecycleFlags) => void;\n  private readonly cbAll: HasPropertyChangedCallback['propertyChanged'];\n  private readonly hasCb: boolean;\n  private readonly hasCbAll: boolean;\n  private readonly hasSetter: boolean;\n  private f: LifecycleFlags = LifecycleFlags.none;\n\n  public constructor(\n    public readonly obj: IIndexable,\n    public readonly propertyKey: string,\n    cbName: string,\n    private readonly set: InterceptorFunc,\n    // todo: a future feature where the observer is not instantiated via a controller\n    // this observer can become more static, as in immediately available when used\n    // in the form of a decorator\n    public readonly $controller: IController | null,\n  ) {\n    const cb = obj[cbName] as typeof BindableObserver.prototype.cb;\n    const cbAll = (obj as IMayHavePropertyChangedCallback).propertyChanged!;\n    const hasCb = this.hasCb = typeof cb === 'function';\n    const hasCbAll = this.hasCbAll = typeof cbAll === 'function';\n    const hasSetter = this.hasSetter = set !== noop;\n\n    this.cb = hasCb ? cb : noop;\n    this.cbAll = hasCbAll ? cbAll : noop;\n    // when user declare @bindable({ set })\n    // it's expected to work from the start,\n    // regardless where the assignment comes from: either direct view model assignment or from binding during render\n    // so if either getter/setter config is present, alter the accessor straight await\n    if (this.cb === void 0 && !hasCbAll && !hasSetter) {\n      this.observing = false;\n    } else {\n      this.observing = true;\n\n      const val = obj[propertyKey];\n      this.value = hasSetter && val !== void 0 ? set(val) : val;\n      this.createGetterSetter();\n    }\n  }\n\n  public getValue(): unknown {\n    return this.value;\n  }\n\n  public setValue(newValue: unknown, flags: LifecycleFlags): void {\n    if (this.hasSetter) {\n      newValue = this.set(newValue);\n    }\n\n    if (this.observing) {\n      const currentValue = this.value;\n      if (Object.is(newValue, currentValue)) {\n        return;\n      }\n      this.value = newValue;\n      this.oldValue = currentValue;\n      this.f = flags;\n      // todo: controller (if any) state should determine the invocation instead\n      if (/* either not instantiated via a controller */this.$controller == null\n        /* or the controller instantiating this is bound */|| this.$controller.isBound\n      ) {\n        if (this.hasCb) {\n          this.cb.call(this.obj, newValue, currentValue, flags);\n        }\n        if (this.hasCbAll) {\n          this.cbAll.call(this.obj, this.propertyKey, newValue, currentValue, flags);\n        }\n      }\n      this.queue.add(this);\n      // this.subs.notify(newValue, currentValue, flags);\n    } else {\n      // See SetterObserver.setValue for explanation\n      this.obj[this.propertyKey] = newValue;\n    }\n  }\n\n  public subscribe(subscriber: ISubscriber): void {\n    if (!this.observing === false) {\n      this.observing = true;\n      const currentValue = this.obj[this.propertyKey];\n      this.value = this.hasSetter\n        ? this.set(currentValue)\n        : currentValue;\n      this.createGetterSetter();\n    }\n\n    this.subs.add(subscriber);\n  }\n\n  public flush(): void {\n    oV = this.oldValue;\n    this.oldValue = this.value;\n    this.subs.notify(this.value, oV, this.f);\n  }\n\n  private createGetterSetter(): void {\n    Reflect.defineProperty(\n      this.obj,\n      this.propertyKey,\n      {\n        enumerable: true,\n        configurable: true,\n        get: (/* Bindable Observer */) => this.value,\n        set: (/* Bindable Observer */value: unknown) => {\n          this.setValue(value, LifecycleFlags.none);\n        }\n      }\n    );\n  }\n}\n\nsubscriberCollection(BindableObserver);\nwithFlushQueue(BindableObserver);\n\n// a reusable variable for `.flush()` methods of observers\n// so that there doesn't need to create an env record for every call\nlet oV: unknown = void 0;\n","import { DI, Metadata, emptyArray, Protocol, Registration, all } from '@aurelia/kernel';\nimport type { Class, Constructable, IContainer, ResourceDefinition, ResourceType } from '@aurelia/kernel';\n\nexport interface AttributePatternDefinition {\n  pattern: string;\n  symbols: string;\n}\n\n/** @internal */\nexport interface ICharSpec {\n  chars: string;\n  repeat: boolean;\n  isSymbol: boolean;\n  isInverted: boolean;\n  has(char: string): boolean;\n  equals(other: ICharSpec): boolean;\n}\n\n/** @internal */\nexport class CharSpec implements ICharSpec {\n  public has: (char: string) => boolean;\n\n  public constructor(\n    public chars: string,\n    public repeat: boolean,\n    public isSymbol: boolean,\n    public isInverted: boolean,\n  ) {\n    if (isInverted) {\n      switch (chars.length) {\n        case 0:\n          this.has = this.hasOfNoneInverse;\n          break;\n        case 1:\n          this.has = this.hasOfSingleInverse;\n          break;\n        default:\n          this.has = this.hasOfMultipleInverse;\n      }\n    } else {\n      switch (chars.length) {\n        case 0:\n          this.has = this.hasOfNone;\n          break;\n        case 1:\n          this.has = this.hasOfSingle;\n          break;\n        default:\n          this.has = this.hasOfMultiple;\n      }\n    }\n  }\n\n  public equals(other: ICharSpec): boolean {\n    return this.chars === other.chars\n      && this.repeat === other.repeat\n      && this.isSymbol === other.isSymbol\n      && this.isInverted === other.isInverted;\n  }\n\n  private hasOfMultiple(char: string): boolean {\n    return this.chars.includes(char);\n  }\n\n  private hasOfSingle(char: string): boolean {\n    return this.chars === char;\n  }\n\n  private hasOfNone(char: string): boolean {\n    return false;\n  }\n\n  private hasOfMultipleInverse(char: string): boolean {\n    return !this.chars.includes(char);\n  }\n\n  private hasOfSingleInverse(char: string): boolean {\n    return this.chars !== char;\n  }\n\n  private hasOfNoneInverse(char: string): boolean {\n    return true;\n  }\n}\n\nexport class Interpretation {\n  public parts: readonly string[] = emptyArray;\n  public get pattern(): string | null {\n    const value = this._pattern;\n    if (value === '') {\n      return null;\n    } else {\n      return value;\n    }\n  }\n  public set pattern(value: string | null) {\n    if (value == null) {\n      this._pattern = '';\n      this.parts = emptyArray;\n    } else {\n      this._pattern = value;\n      this.parts = this.partsRecord[value];\n    }\n  }\n  private _pattern: string = '';\n  private readonly currentRecord: Record<string, string> = {};\n  private readonly partsRecord: Record<string, string[]> = {};\n\n  public append(pattern: string, ch: string): void {\n    const { currentRecord } = this;\n    if (currentRecord[pattern] === undefined) {\n      currentRecord[pattern] = ch;\n    } else {\n      currentRecord[pattern] += ch;\n    }\n  }\n\n  public next(pattern: string): void {\n    const { currentRecord } = this;\n    if (currentRecord[pattern] !== undefined) {\n      const { partsRecord } = this;\n      if (partsRecord[pattern] === undefined) {\n        partsRecord[pattern] = [currentRecord[pattern]];\n      } else {\n        partsRecord[pattern].push(currentRecord[pattern]);\n      }\n      currentRecord[pattern] = undefined!;\n    }\n  }\n}\n\n/** @internal */\nexport class State {\n  public nextStates: State[] = [];\n  public types: SegmentTypes | null = null;\n  public patterns: string[];\n  public isEndpoint: boolean = false;\n  public get pattern(): string | null {\n    return this.isEndpoint ? this.patterns[0] : null;\n  }\n\n  public constructor(\n    public charSpec: ICharSpec,\n    ...patterns: string[]\n  ) {\n    this.patterns = patterns;\n  }\n\n  public findChild(charSpec: ICharSpec): State {\n    const nextStates = this.nextStates;\n    const len = nextStates.length;\n    let child: State = null!;\n    for (let i = 0; i < len; ++i) {\n      child = nextStates[i];\n      if (charSpec.equals(child.charSpec)) {\n        return child;\n      }\n    }\n    return null!;\n  }\n\n  public append(charSpec: ICharSpec, pattern: string): State {\n    const { patterns } = this;\n    if (!patterns.includes(pattern)) {\n      patterns.push(pattern);\n    }\n    let state = this.findChild(charSpec);\n    if (state == null) {\n      state = new State(charSpec, pattern);\n      this.nextStates.push(state);\n      if (charSpec.repeat) {\n        state.nextStates.push(state);\n      }\n    }\n    return state;\n  }\n\n  public findMatches(ch: string, interpretation: Interpretation): State[] {\n    // TODO: reuse preallocated arrays\n    const results = [];\n    const nextStates = this.nextStates;\n    const len = nextStates.length;\n    let childLen = 0;\n    let child: State = null!;\n    let i = 0;\n    let j = 0;\n    for (; i < len; ++i) {\n      child = nextStates[i];\n      if (child.charSpec.has(ch)) {\n        results.push(child);\n        childLen = child.patterns.length;\n        j = 0;\n        if (child.charSpec.isSymbol) {\n          for (; j < childLen; ++j) {\n            interpretation.next(child.patterns[j]);\n          }\n        } else {\n          for (; j < childLen; ++j) {\n            interpretation.append(child.patterns[j], ch);\n          }\n        }\n      }\n    }\n    return results;\n  }\n}\n\n/** @internal */\nexport interface ISegment {\n  text: string;\n  eachChar(callback: (spec: CharSpec) => void): void;\n}\n\n/** @internal */\nexport class StaticSegment implements ISegment {\n  private readonly len: number;\n  private readonly specs: CharSpec[];\n\n  public constructor(\n    public text: string,\n  ) {\n    const len = this.len = text.length;\n    const specs = this.specs = [] as CharSpec[];\n    for (let i = 0; i < len; ++i) {\n      specs.push(new CharSpec(text[i], false, false, false));\n    }\n  }\n\n  public eachChar(callback: (spec: CharSpec) => void): void {\n    const { len, specs } = this;\n    for (let i = 0; i < len; ++i) {\n      callback(specs[i]);\n    }\n  }\n}\n\n/** @internal */\nexport class DynamicSegment implements ISegment {\n  public text: string = 'PART';\n  private readonly spec: CharSpec;\n\n  public constructor(symbols: string) {\n    this.spec = new CharSpec(symbols, true, false, true);\n  }\n\n  public eachChar(callback: (spec: CharSpec) => void): void {\n    callback(this.spec);\n  }\n}\n\n/** @internal */\nexport class SymbolSegment implements ISegment {\n  private readonly spec: CharSpec;\n\n  public constructor(\n    public text: string,\n  ) {\n    this.spec = new CharSpec(text, false, true, false);\n  }\n\n  public eachChar(callback: (spec: CharSpec) => void): void {\n    callback(this.spec);\n  }\n}\n\n/** @internal */\nexport class SegmentTypes {\n  public statics: number = 0;\n  public dynamics: number = 0;\n  public symbols: number = 0;\n}\n\nexport interface ISyntaxInterpreter extends SyntaxInterpreter {}\nexport const ISyntaxInterpreter = DI.createInterface<ISyntaxInterpreter>('ISyntaxInterpreter', x => x.singleton(SyntaxInterpreter));\n\nexport class SyntaxInterpreter {\n  public rootState: State = new State(null!);\n  private readonly initialStates: State[] = [this.rootState];\n\n  public add(def: AttributePatternDefinition): void;\n  public add(defs: AttributePatternDefinition[]): void;\n  public add(defOrDefs: AttributePatternDefinition | AttributePatternDefinition[]): void {\n    let i = 0;\n    if (Array.isArray(defOrDefs)) {\n      const ii = defOrDefs.length;\n      for (; i < ii; ++i) {\n        this.add(defOrDefs[i]);\n      }\n      return;\n    }\n    let currentState = this.rootState;\n    const def = defOrDefs;\n    const pattern = def.pattern;\n    const types = new SegmentTypes();\n    const segments = this.parse(def, types);\n    const len = segments.length;\n    const callback = (ch: ICharSpec): void => {\n      currentState = currentState.append(ch, pattern);\n    };\n    for (i = 0; i < len; ++i) {\n      segments[i].eachChar(callback);\n    }\n    currentState.types = types;\n    currentState.isEndpoint = true;\n  }\n\n  public interpret(name: string): Interpretation {\n    const interpretation = new Interpretation();\n    let states = this.initialStates;\n    const len = name.length;\n    for (let i = 0; i < len; ++i) {\n      states = this.getNextStates(states, name.charAt(i), interpretation);\n      if (states.length === 0) {\n        break;\n      }\n    }\n\n    states.sort((a, b) => {\n      if (a.isEndpoint) {\n        if (!b.isEndpoint) {\n          return -1;\n        }\n      } else if (b.isEndpoint) {\n        return 1;\n      } else {\n        return 0;\n      }\n      const aTypes = a.types!;\n      const bTypes = b.types!;\n      if (aTypes.statics !== bTypes.statics) {\n        return bTypes.statics - aTypes.statics;\n      }\n      if (aTypes.dynamics !== bTypes.dynamics) {\n        return bTypes.dynamics - aTypes.dynamics;\n      }\n      if (aTypes.symbols !== bTypes.symbols) {\n        return bTypes.symbols - aTypes.symbols;\n      }\n      return 0;\n    });\n\n    if (states.length > 0) {\n      const state = states[0];\n      if (!state.charSpec.isSymbol) {\n        interpretation.next(state.pattern!);\n      }\n      interpretation.pattern = state.pattern;\n    }\n    return interpretation;\n  }\n\n  public getNextStates(states: State[], ch: string, interpretation: Interpretation): State[] {\n    // TODO: reuse preallocated arrays\n    const nextStates: State[] = [];\n    let state: State = null!;\n    const len = states.length;\n    for (let i = 0; i < len; ++i) {\n      state = states[i];\n      nextStates.push(...state.findMatches(ch, interpretation));\n    }\n\n    return nextStates;\n  }\n\n  private parse(def: AttributePatternDefinition, types: SegmentTypes): ISegment[] {\n    const result = [];\n    const pattern = def.pattern;\n    const len = pattern.length;\n    let i = 0;\n    let start = 0;\n    let c = '';\n\n    while (i < len) {\n      c = pattern.charAt(i);\n      if (!def.symbols.includes(c)) {\n        if (i === start) {\n          if (c === 'P' && pattern.slice(i, i + 4) === 'PART') {\n            start = i = (i + 4);\n            result.push(new DynamicSegment(def.symbols));\n            ++types.dynamics;\n          } else {\n            ++i;\n          }\n        } else {\n          ++i;\n        }\n      } else if (i !== start) {\n        result.push(new StaticSegment(pattern.slice(start, i)));\n        ++types.statics;\n        start = i;\n      } else {\n        result.push(new SymbolSegment(pattern.slice(start, i + 1)));\n        ++types.symbols;\n        start = ++i;\n      }\n    }\n    if (start !== i) {\n      result.push(new StaticSegment(pattern.slice(start, i)));\n      ++types.statics;\n    }\n\n    return result;\n  }\n}\n\nexport class AttrSyntax {\n  public constructor(\n    public rawName: string,\n    public rawValue: string,\n    public target: string,\n    public command: string | null,\n  ) {}\n}\n\nexport interface IAttributePattern {\n  [pattern: string]: (rawName: string, rawValue: string, parts: readonly string[]) => AttrSyntax;\n}\n\nexport const IAttributePattern = DI.createInterface<IAttributePattern>('IAttributePattern');\n\nexport interface IAttributeParser extends AttributeParser {}\nexport const IAttributeParser = DI.createInterface<IAttributeParser>('IAttributeParser', x => x.singleton(AttributeParser));\n\nexport class AttributeParser {\n  private readonly cache: Record<string, Interpretation> = {};\n  private readonly patterns: Record<string, IAttributePattern>;\n\n  public constructor(\n    @ISyntaxInterpreter private readonly interpreter: ISyntaxInterpreter,\n    @all(IAttributePattern) attrPatterns: IAttributePattern[],\n  ) {\n    const patterns: AttributeParser['patterns'] = this.patterns = {};\n    attrPatterns.forEach(attrPattern => {\n      const defs = AttributePattern.getPatternDefinitions(attrPattern.constructor as Constructable);\n      interpreter.add(defs);\n      defs.forEach(def => {\n        patterns[def.pattern] = attrPattern as unknown as IAttributePattern;\n      });\n    });\n  }\n\n  public parse(name: string, value: string): AttrSyntax {\n    let interpretation = this.cache[name];\n    if (interpretation == null) {\n      interpretation = this.cache[name] = this.interpreter.interpret(name);\n    }\n    const pattern = interpretation.pattern;\n    if (pattern == null) {\n      return new AttrSyntax(name, value, name, null);\n    } else {\n      return this.patterns[pattern][pattern](name, value, interpretation.parts);\n    }\n  }\n}\n\ntype DecoratableAttributePattern<TProto, TClass> = Class<TProto & Partial<{} | IAttributePattern>, TClass>;\ntype DecoratedAttributePattern<TProto, TClass> = Class<TProto & IAttributePattern, TClass>;\n\ntype AttributePatternDecorator = <TProto, TClass>(target: DecoratableAttributePattern<TProto, TClass>) => DecoratedAttributePattern<TProto, TClass>;\n\nexport interface AttributePattern {\n  readonly name: string;\n  readonly definitionAnnotationKey: string;\n  define<TProto, TClass>(patternDefs: AttributePatternDefinition[], Type: DecoratableAttributePattern<TProto, TClass>): DecoratedAttributePattern<TProto, TClass>;\n  getPatternDefinitions<TProto, TClass>(Type: DecoratedAttributePattern<TProto, TClass>): AttributePatternDefinition[];\n}\n\nexport function attributePattern(...patternDefs: AttributePatternDefinition[]): AttributePatternDecorator {\n  return function decorator<TProto, TClass>(target: DecoratableAttributePattern<TProto, TClass>): DecoratedAttributePattern<TProto, TClass> {\n    return AttributePattern.define(patternDefs, target);\n  } as AttributePatternDecorator;\n}\n\nexport class AttributePatternResourceDefinition implements ResourceDefinition<Constructable, IAttributePattern> {\n  public name: string = (void 0)!;\n\n  public constructor(\n    public Type: ResourceType<Constructable, Partial<IAttributePattern>>,\n  ) { }\n\n  public register(container: IContainer): void {\n    Registration.singleton(IAttributePattern, this.Type).register(container);\n  }\n}\n\nexport const AttributePattern: AttributePattern = Object.freeze({\n  name: Protocol.resource.keyFor('attribute-pattern'),\n  definitionAnnotationKey: 'attribute-pattern-definitions',\n  define<TProto, TClass>(\n    patternDefs: AttributePatternDefinition[],\n    Type: DecoratableAttributePattern<TProto, TClass>,\n  ) {\n    const definition = new AttributePatternResourceDefinition(Type);\n    const { name, definitionAnnotationKey } = AttributePattern;\n    Metadata.define(name, definition, Type);\n    Protocol.resource.appendTo(Type, name);\n\n    Protocol.annotation.set(Type, definitionAnnotationKey, patternDefs);\n    Protocol.annotation.appendTo(Type, definitionAnnotationKey);\n\n    return Type as DecoratedAttributePattern<TProto, TClass>;\n  },\n  getPatternDefinitions<TProto, TClass>(Type: DecoratedAttributePattern<TProto, TClass>) {\n    return Protocol.annotation.get(Type, AttributePattern.definitionAnnotationKey) as AttributePatternDefinition[];\n  }\n});\n\n@attributePattern(\n  { pattern: 'PART.PART', symbols: '.' },\n  { pattern: 'PART.PART.PART', symbols: '.' }\n)\nexport class DotSeparatedAttributePattern {\n  public 'PART.PART'(rawName: string, rawValue: string, parts: string[]): AttrSyntax {\n    return new AttrSyntax(rawName, rawValue, parts[0], parts[1]);\n  }\n\n  public 'PART.PART.PART'(rawName: string, rawValue: string, parts: string[]): AttrSyntax {\n    return new AttrSyntax(rawName, rawValue, parts[0], parts[2]);\n  }\n}\n\n@attributePattern(\n  { pattern: 'ref', symbols: '' },\n  { pattern: 'PART.ref', symbols: '.' }\n)\nexport class RefAttributePattern {\n  public 'ref'(rawName: string, rawValue: string, parts: string[]): AttrSyntax {\n    return new AttrSyntax(rawName, rawValue, 'element', 'ref');\n  }\n\n  public 'PART.ref'(rawName: string, rawValue: string, parts: string[]): AttrSyntax {\n    return new AttrSyntax(rawName, rawValue, parts[0], 'ref');\n  }\n}\n\n@attributePattern({ pattern: ':PART', symbols: ':' })\nexport class ColonPrefixedBindAttributePattern {\n  public ':PART'(rawName: string, rawValue: string, parts: string[]): AttrSyntax {\n    return new AttrSyntax(rawName, rawValue, parts[0], 'bind');\n  }\n}\n\n@attributePattern({ pattern: '@PART', symbols: '@' })\nexport class AtPrefixedTriggerAttributePattern {\n  public '@PART'(rawName: string, rawValue: string, parts: string[]): AttrSyntax {\n    return new AttrSyntax(rawName, rawValue, parts[0], 'trigger');\n  }\n}\n","import type { ISVGAnalyzer } from './observation/svg-analyzer';\n\nconst IsDataAttribute: Record<string, boolean> = createLookup();\n\nexport function isDataAttribute(obj: Node, key: PropertyKey, svgAnalyzer: ISVGAnalyzer): boolean {\n  if (IsDataAttribute[key as string] === true) {\n    return true;\n  }\n  if (typeof key !== 'string') {\n    return false;\n  }\n  const prefix = key.slice(0, 5);\n  // https://html.spec.whatwg.org/multipage/dom.html#wai-aria\n  // https://html.spec.whatwg.org/multipage/dom.html#custom-data-attribute\n  return IsDataAttribute[key] =\n    prefix === 'aria-' ||\n    prefix === 'data-' ||\n    svgAnalyzer.isStandardSvgAttribute(obj, key);\n}\n\nexport function createLookup<T = unknown>(){\n  return Object.create(null) as Record<string, T>;\n}\n","import { BrowserPlatform } from '@aurelia/platform-browser';\nimport { InterfaceSymbol, IPlatform as $IPlatform } from '@aurelia/kernel';\n\nexport interface IPlatform extends BrowserPlatform {}\nexport const IPlatform = $IPlatform as InterfaceSymbol<IPlatform>;\n","import { DI, Registration } from '@aurelia/kernel';\nimport { IPlatform } from '../platform.js';\nimport { createLookup } from '../utilities-html.js';\n\nimport type { IContainer, IResolver } from '@aurelia/kernel';\nimport type { INode } from '../dom.js';\n\nexport interface ISVGAnalyzer extends NoopSVGAnalyzer {}\nexport const ISVGAnalyzer = DI.createInterface<ISVGAnalyzer>('ISVGAnalyzer', x => x.singleton(NoopSVGAnalyzer));\n\nexport class NoopSVGAnalyzer {\n  public isStandardSvgAttribute(node: INode, attributeName: string): boolean {\n    return false;\n  }\n}\n\nfunction o(keys: string[]): Record<string, true | undefined> {\n  const lookup = createLookup<true | undefined>();\n  let key: string;\n  for (key of keys) {\n    lookup[key] = true;\n  }\n  return lookup;\n}\n\nexport class SVGAnalyzer {\n  /**\n   * @internal\n   */\n  public static inject = [IPlatform];\n  public static register(container: IContainer): IResolver<ISVGAnalyzer> {\n    return Registration.singleton(ISVGAnalyzer, this).register(container);\n  }\n\n  private readonly svgElements: Record<string, Record<string, true | undefined> | undefined> = Object.assign(createLookup<Record<string, true | undefined> | undefined>(), {\n    'a': o(['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'target', 'transform', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'altGlyph': o(['class', 'dx', 'dy', 'externalResourcesRequired', 'format', 'glyphRef', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'altglyph': createLookup<true | undefined>(),\n    'altGlyphDef': o(['id', 'xml:base', 'xml:lang', 'xml:space']),\n    'altglyphdef': createLookup<true | undefined>(),\n    'altGlyphItem': o(['id', 'xml:base', 'xml:lang', 'xml:space']),\n    'altglyphitem': createLookup<true | undefined>(),\n    'animate': o(['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'animateColor': o(['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'animateMotion': o(['accumulate', 'additive', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keyPoints', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'origin', 'path', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'rotate', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'animateTransform': o(['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'type', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'circle': o(['class', 'cx', 'cy', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'r', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space']),\n    'clipPath': o(['class', 'clipPathUnits', 'externalResourcesRequired', 'id', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space']),\n    'color-profile': o(['id', 'local', 'name', 'rendering-intent', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'cursor': o(['externalResourcesRequired', 'id', 'requiredExtensions', 'requiredFeatures', 'systemLanguage', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'defs': o(['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space']),\n    'desc': o(['class', 'id', 'style', 'xml:base', 'xml:lang', 'xml:space']),\n    'ellipse': o(['class', 'cx', 'cy', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rx', 'ry', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space']),\n    'feBlend': o(['class', 'height', 'id', 'in', 'in2', 'mode', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feColorMatrix': o(['class', 'height', 'id', 'in', 'result', 'style', 'type', 'values', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feComponentTransfer': o(['class', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feComposite': o(['class', 'height', 'id', 'in', 'in2', 'k1', 'k2', 'k3', 'k4', 'operator', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feConvolveMatrix': o(['bias', 'class', 'divisor', 'edgeMode', 'height', 'id', 'in', 'kernelMatrix', 'kernelUnitLength', 'order', 'preserveAlpha', 'result', 'style', 'targetX', 'targetY', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feDiffuseLighting': o(['class', 'diffuseConstant', 'height', 'id', 'in', 'kernelUnitLength', 'result', 'style', 'surfaceScale', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feDisplacementMap': o(['class', 'height', 'id', 'in', 'in2', 'result', 'scale', 'style', 'width', 'x', 'xChannelSelector', 'xml:base', 'xml:lang', 'xml:space', 'y', 'yChannelSelector']),\n    'feDistantLight': o(['azimuth', 'elevation', 'id', 'xml:base', 'xml:lang', 'xml:space']),\n    'feFlood': o(['class', 'height', 'id', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feFuncA': o(['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space']),\n    'feFuncB': o(['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space']),\n    'feFuncG': o(['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space']),\n    'feFuncR': o(['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space']),\n    'feGaussianBlur': o(['class', 'height', 'id', 'in', 'result', 'stdDeviation', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feImage': o(['class', 'externalResourcesRequired', 'height', 'id', 'preserveAspectRatio', 'result', 'style', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feMerge': o(['class', 'height', 'id', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feMergeNode': o(['id', 'xml:base', 'xml:lang', 'xml:space']),\n    'feMorphology': o(['class', 'height', 'id', 'in', 'operator', 'radius', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feOffset': o(['class', 'dx', 'dy', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'fePointLight': o(['id', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'z']),\n    'feSpecularLighting': o(['class', 'height', 'id', 'in', 'kernelUnitLength', 'result', 'specularConstant', 'specularExponent', 'style', 'surfaceScale', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feSpotLight': o(['id', 'limitingConeAngle', 'pointsAtX', 'pointsAtY', 'pointsAtZ', 'specularExponent', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'z']),\n    'feTile': o(['class', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'feTurbulence': o(['baseFrequency', 'class', 'height', 'id', 'numOctaves', 'result', 'seed', 'stitchTiles', 'style', 'type', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'filter': o(['class', 'externalResourcesRequired', 'filterRes', 'filterUnits', 'height', 'id', 'primitiveUnits', 'style', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'font': o(['class', 'externalResourcesRequired', 'horiz-adv-x', 'horiz-origin-x', 'horiz-origin-y', 'id', 'style', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space']),\n    'font-face': o(['accent-height', 'alphabetic', 'ascent', 'bbox', 'cap-height', 'descent', 'font-family', 'font-size', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'hanging', 'id', 'ideographic', 'mathematical', 'overline-position', 'overline-thickness', 'panose-1', 'slope', 'stemh', 'stemv', 'strikethrough-position', 'strikethrough-thickness', 'underline-position', 'underline-thickness', 'unicode-range', 'units-per-em', 'v-alphabetic', 'v-hanging', 'v-ideographic', 'v-mathematical', 'widths', 'x-height', 'xml:base', 'xml:lang', 'xml:space']),\n    'font-face-format': o(['id', 'string', 'xml:base', 'xml:lang', 'xml:space']),\n    'font-face-name': o(['id', 'name', 'xml:base', 'xml:lang', 'xml:space']),\n    'font-face-src': o(['id', 'xml:base', 'xml:lang', 'xml:space']),\n    'font-face-uri': o(['id', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'foreignObject': o(['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'g': o(['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space']),\n    'glyph': o(['arabic-form', 'class', 'd', 'glyph-name', 'horiz-adv-x', 'id', 'lang', 'orientation', 'style', 'unicode', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space']),\n    'glyphRef': o(['class', 'dx', 'dy', 'format', 'glyphRef', 'id', 'style', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'glyphref': createLookup<true | undefined>(),\n    'hkern': o(['g1', 'g2', 'id', 'k', 'u1', 'u2', 'xml:base', 'xml:lang', 'xml:space']),\n    'image': o(['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'line': o(['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'x1', 'x2', 'xml:base', 'xml:lang', 'xml:space', 'y1', 'y2']),\n    'linearGradient': o(['class', 'externalResourcesRequired', 'gradientTransform', 'gradientUnits', 'id', 'spreadMethod', 'style', 'x1', 'x2', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y1', 'y2']),\n    'marker': o(['class', 'externalResourcesRequired', 'id', 'markerHeight', 'markerUnits', 'markerWidth', 'orient', 'preserveAspectRatio', 'refX', 'refY', 'style', 'viewBox', 'xml:base', 'xml:lang', 'xml:space']),\n    'mask': o(['class', 'externalResourcesRequired', 'height', 'id', 'maskContentUnits', 'maskUnits', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'metadata': o(['id', 'xml:base', 'xml:lang', 'xml:space']),\n    'missing-glyph': o(['class', 'd', 'horiz-adv-x', 'id', 'style', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space']),\n    'mpath': o(['externalResourcesRequired', 'id', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'path': o(['class', 'd', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'pathLength', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space']),\n    'pattern': o(['class', 'externalResourcesRequired', 'height', 'id', 'patternContentUnits', 'patternTransform', 'patternUnits', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'viewBox', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'polygon': o(['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'points', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space']),\n    'polyline': o(['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'points', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space']),\n    'radialGradient': o(['class', 'cx', 'cy', 'externalResourcesRequired', 'fx', 'fy', 'gradientTransform', 'gradientUnits', 'id', 'r', 'spreadMethod', 'style', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'rect': o(['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rx', 'ry', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'script': o(['externalResourcesRequired', 'id', 'type', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'set': o(['attributeName', 'attributeType', 'begin', 'dur', 'end', 'externalResourcesRequired', 'fill', 'id', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'stop': o(['class', 'id', 'offset', 'style', 'xml:base', 'xml:lang', 'xml:space']),\n    'style': o(['id', 'media', 'title', 'type', 'xml:base', 'xml:lang', 'xml:space']),\n    'svg': o(['baseProfile', 'class', 'contentScriptType', 'contentStyleType', 'externalResourcesRequired', 'height', 'id', 'onabort', 'onactivate', 'onclick', 'onerror', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'onresize', 'onscroll', 'onunload', 'onzoom', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'version', 'viewBox', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'zoomAndPan']),\n    'switch': o(['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space']),\n    'symbol': o(['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'preserveAspectRatio', 'style', 'viewBox', 'xml:base', 'xml:lang', 'xml:space']),\n    'text': o(['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'transform', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'textPath': o(['class', 'externalResourcesRequired', 'id', 'lengthAdjust', 'method', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'spacing', 'startOffset', 'style', 'systemLanguage', 'textLength', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space']),\n    'title': o(['class', 'id', 'style', 'xml:base', 'xml:lang', 'xml:space']),\n    'tref': o(['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'x', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'tspan': o(['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'use': o(['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y']),\n    'view': o(['externalResourcesRequired', 'id', 'preserveAspectRatio', 'viewBox', 'viewTarget', 'xml:base', 'xml:lang', 'xml:space', 'zoomAndPan']),\n    'vkern': o(['g1', 'g2', 'id', 'k', 'u1', 'u2', 'xml:base', 'xml:lang', 'xml:space']),\n  });\n\n  private readonly svgPresentationElements = o([\n    'a',\n    'altGlyph',\n    'animate',\n    'animateColor',\n    'circle',\n    'clipPath',\n    'defs',\n    'ellipse',\n    'feBlend',\n    'feColorMatrix',\n    'feComponentTransfer',\n    'feComposite',\n    'feConvolveMatrix',\n    'feDiffuseLighting',\n    'feDisplacementMap',\n    'feFlood',\n    'feGaussianBlur',\n    'feImage',\n    'feMerge',\n    'feMorphology',\n    'feOffset',\n    'feSpecularLighting',\n    'feTile',\n    'feTurbulence',\n    'filter',\n    'font',\n    'foreignObject',\n    'g',\n    'glyph',\n    'glyphRef',\n    'image',\n    'line',\n    'linearGradient',\n    'marker',\n    'mask',\n    'missing-glyph',\n    'path',\n    'pattern',\n    'polygon',\n    'polyline',\n    'radialGradient',\n    'rect',\n    'stop',\n    'svg',\n    'switch',\n    'symbol',\n    'text',\n    'textPath',\n    'tref',\n    'tspan',\n    'use',\n  ]);\n\n  private readonly svgPresentationAttributes = o([\n    'alignment-baseline',\n    'baseline-shift',\n    'clip-path',\n    'clip-rule',\n    'clip',\n    'color-interpolation-filters',\n    'color-interpolation',\n    'color-profile',\n    'color-rendering',\n    'color',\n    'cursor',\n    'direction',\n    'display',\n    'dominant-baseline',\n    'enable-background',\n    'fill-opacity',\n    'fill-rule',\n    'fill',\n    'filter',\n    'flood-color',\n    'flood-opacity',\n    'font-family',\n    'font-size-adjust',\n    'font-size',\n    'font-stretch',\n    'font-style',\n    'font-variant',\n    'font-weight',\n    'glyph-orientation-horizontal',\n    'glyph-orientation-vertical',\n    'image-rendering',\n    'kerning',\n    'letter-spacing',\n    'lighting-color',\n    'marker-end',\n    'marker-mid',\n    'marker-start',\n    'mask',\n    'opacity',\n    'overflow',\n    'pointer-events',\n    'shape-rendering',\n    'stop-color',\n    'stop-opacity',\n    'stroke-dasharray',\n    'stroke-dashoffset',\n    'stroke-linecap',\n    'stroke-linejoin',\n    'stroke-miterlimit',\n    'stroke-opacity',\n    'stroke-width',\n    'stroke',\n    'text-anchor',\n    'text-decoration',\n    'text-rendering',\n    'unicode-bidi',\n    'visibility',\n    'word-spacing',\n    'writing-mode',\n  ]);\n\n  private readonly SVGElement: typeof SVGElement;\n  public constructor(platform: IPlatform) {\n    this.SVGElement = platform.globalThis.SVGElement;\n\n    const div = platform.document.createElement('div');\n    div.innerHTML = '<svg><altGlyph /></svg>';\n    if (div.firstElementChild!.nodeName === 'altglyph') {\n      // handle chrome casing inconsistencies.\n      const svg = this.svgElements;\n      let tmp = svg.altGlyph;\n      svg.altGlyph = svg.altglyph;\n      svg.altglyph = tmp;\n      tmp = svg.altGlyphDef;\n      svg.altGlyphDef = svg.altglyphdef;\n      svg.altglyphdef = tmp;\n      tmp = svg.altGlyphItem;\n      svg.altGlyphItem = svg.altglyphitem;\n      svg.altglyphitem = tmp;\n      tmp = svg.glyphRef;\n      svg.glyphRef = svg.glyphref;\n      svg.glyphref = tmp;\n    }\n  }\n\n  public isStandardSvgAttribute(node: INode, attributeName: string): boolean {\n    if (!(node instanceof this.SVGElement)) {\n      return false;\n    }\n\n    return (\n      this.svgPresentationElements[node.nodeName] === true && this.svgPresentationAttributes[attributeName] === true ||\n      this.svgElements[node.nodeName]?.[attributeName] === true\n    );\n  }\n}\n","import { DI } from '@aurelia/kernel';\nimport { createLookup, isDataAttribute } from './utilities-html.js';\nimport { ISVGAnalyzer } from './observation/svg-analyzer.js';\n\nexport interface IAttrMapper extends AttrMapper {}\nexport const IAttrMapper = DI\n  .createInterface<IAttrMapper>('IAttrMapper', x => x.singleton(AttrMapper));\n\ntype IsTwoWayPredicate = (element: Element, attribute: string) => boolean;\n\nexport class AttrMapper {\n  /** @internal */\n  public static get inject(): unknown[] { return [ISVGAnalyzer]; }\n  /** @internal */\n  private readonly fns: IsTwoWayPredicate[] = [];\n  /** @internal */\n  private readonly tagAttrMap: Record<string, Record<string, PropertyKey>> = createLookup();\n  /** @internal */\n  private readonly globalAttrMap: Record<string, PropertyKey> = createLookup();\n\n  public constructor(\n    private readonly svg: ISVGAnalyzer,\n  ) {\n    this.useMapping({\n      LABEL: { for: 'htmlFor' },\n      IMG: { usemap: 'useMap' },\n      INPUT: {\n        maxlength: 'maxLength',\n        minlength: 'minLength',\n        formaction: 'formAction',\n        formenctype: 'formEncType',\n        formmethod: 'formMethod',\n        formnovalidate: 'formNoValidate',\n        formtarget: 'formTarget',\n        inputmode: 'inputMode',\n      },\n      TEXTAREA: { maxlength: 'maxLength' },\n      TD: { rowspan: 'rowSpan', colspan: 'colSpan' },\n      TH: { rowspan: 'rowSpan', colspan: 'colSpan' },\n    });\n    this.useGlobalMapping({\n      accesskey: 'accessKey',\n      contenteditable: 'contentEditable',\n      tabindex: 'tabIndex',\n      textcontent: 'textContent',\n      innerhtml: 'innerHTML',\n      scrolltop: 'scrollTop',\n      scrollleft: 'scrollLeft',\n      readonly: 'readOnly',\n    });\n  }\n\n  /**\n   * Allow application to teach Aurelia how to define how to map attributes to properties\n   * based on element tagName\n   */\n  public useMapping(config: Record<string, Record<string, PropertyKey>>): void {\n    let newAttrMapping: Record<string, PropertyKey>;\n    let targetAttrMapping: Record<string, PropertyKey>;\n    let tagName: string;\n    let attr: string;\n    for (tagName in config) {\n      newAttrMapping = config[tagName];\n      targetAttrMapping = this.tagAttrMap[tagName] ??= createLookup();\n      for (attr in newAttrMapping) {\n        if (targetAttrMapping[attr] !== void 0) {\n          throw createMappedError(attr, tagName);\n        }\n        targetAttrMapping[attr] = newAttrMapping[attr];\n      }\n    }\n  }\n\n  /**\n   * Allow applications to teach Aurelia how to define how to map attributes to properties\n   * for all elements\n   */\n  public useGlobalMapping(config: Record<string, PropertyKey>): void {\n    const mapper = this.globalAttrMap;\n    for (const attr in config) {\n      if (mapper[attr] !== void 0) {\n        throw createMappedError(attr, '*');\n      }\n      mapper[attr] = config[attr];\n    }\n  }\n\n  /**\n   * Add a given function to a list of fns that will be used\n   * to check if `'bind'` command can be understood as `'two-way'` command.\n   */\n  public useTwoWay(fn: IsTwoWayPredicate): void {\n    this.fns.push(fn);\n  }\n\n  /**\n   * Returns true if an attribute should be two way bound based on an element\n   */\n  public isTwoWay(node: Element, attrName: string): boolean {\n    return shouldDefaultToTwoWay(node, attrName)\n      || this.fns.length > 0 && this.fns.some(fn => fn(node, attrName));\n  }\n\n  /**\n   * Retrieves the mapping information this mapper have for an attribute on an element\n   */\n  public map(node: Element, attr: string): string | null {\n    return this.tagAttrMap[node.nodeName]?.[attr] as string\n      ?? this.globalAttrMap[attr]\n      ?? (isDataAttribute(node, attr, this.svg)\n        ? attr\n        : null);\n  }\n}\n\nfunction shouldDefaultToTwoWay(element: Element, attr: string): boolean {\n  switch (element.nodeName) {\n    case 'INPUT':\n      switch ((element as HTMLInputElement).type) {\n        case 'checkbox':\n        case 'radio':\n          return attr === 'checked';\n        // note:\n        // ideally, it should check for corresponding input type first\n        // as 'files' shouldn't be two way on a number input, for example\n        // but doing it this way is acceptable-ish, as the common user expectations,\n        // and the behavior of the control for these properties are the same,\n        // regardless the type of the <input>\n        default:\n          return attr === 'value' || attr === 'files' || attr === 'value-as-number' || attr === 'value-as-date';\n      }\n    case 'TEXTAREA':\n    case 'SELECT':\n      return attr === 'value';\n    default:\n      switch (attr) {\n        case 'textcontent':\n        case 'innerhtml':\n          return element.hasAttribute('contenteditable');\n        case 'scrolltop':\n        case 'scrollleft':\n          return true;\n        default:\n          return false;\n      }\n  }\n}\n\nfunction createMappedError(attr: string, tagName: string) {\n  return new Error(`Attribute ${attr} has been already registered for ${tagName === '*' ? 'all elements' : `<${tagName}/>`}`);\n}\n","import { LifecycleFlags } from '@aurelia/runtime';\n\nimport type { IServiceLocator } from '@aurelia/kernel';\nimport type { IAccessor, IConnectableBinding, IObserverLocator, IsBindingBehavior, Scope } from '@aurelia/runtime';\n\nexport interface CallBinding extends IConnectableBinding {}\nexport class CallBinding {\n  public interceptor: this = this;\n\n  public isBound: boolean = false;\n  public $scope?: Scope;\n  public $hostScope: Scope | null = null;\n\n  public targetObserver: IAccessor;\n\n  public constructor(\n    public sourceExpression: IsBindingBehavior,\n    public readonly target: object,\n    public readonly targetProperty: string,\n    observerLocator: IObserverLocator,\n    public locator: IServiceLocator,\n  ) {\n    this.targetObserver = observerLocator.getAccessor(target, targetProperty);\n  }\n\n  public callSource(args: object): unknown {\n    const overrideContext = this.$scope!.overrideContext;\n    overrideContext.$event = args;\n    const result = this.sourceExpression.evaluate(LifecycleFlags.mustEvaluate, this.$scope!, this.$hostScope, this.locator, null);\n    Reflect.deleteProperty(overrideContext, '$event');\n\n    return result;\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.isBound) {\n      if (this.$scope === scope) {\n        return;\n      }\n\n      this.interceptor.$unbind(flags | LifecycleFlags.fromBind);\n    }\n\n    this.$scope = scope;\n    this.$hostScope = hostScope;\n\n    if (this.sourceExpression.hasBind) {\n      this.sourceExpression.bind(flags, scope, hostScope, this.interceptor);\n    }\n\n    this.targetObserver.setValue(($args: object) => this.interceptor.callSource($args), flags, this.target, this.targetProperty);\n\n    // add isBound flag and remove isBinding flag\n    this.isBound = true;\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n\n    if (this.sourceExpression.hasUnbind) {\n      this.sourceExpression.unbind(flags, this.$scope!, this.$hostScope, this.interceptor);\n    }\n\n    this.$scope = void 0;\n    this.targetObserver.setValue(null, flags, this.target, this.targetProperty);\n\n    this.isBound = false;\n  }\n\n  public observeProperty(obj: object, propertyName: string): void {\n    return;\n  }\n\n  public handleChange(newValue: unknown, previousValue: unknown, flags: LifecycleFlags): void {\n    return;\n  }\n}\n","import { LifecycleFlags, subscriberCollection, AccessorType, withFlushQueue } from '@aurelia/runtime';\nimport { IPlatform } from '../platform.js';\n\nimport type {\n  IObserver,\n  IObserverLocator,\n  ISubscriber,\n  ISubscriberCollection,\n  IFlushable,\n  IWithFlushQueue,\n  FlushQueue,\n} from '@aurelia/runtime';\n\nexport interface IHtmlElement extends HTMLElement {\n  $mObserver: MutationObserver;\n  $eMObservers: Set<ElementMutationSubscription>;\n}\n\nexport interface ElementMutationSubscription {\n  handleMutation(mutationRecords: MutationRecord[]): void;\n}\n\nexport interface AttributeObserver extends\n  IObserver,\n  ISubscriber,\n  ISubscriberCollection { }\n\n/**\n * Observer for handling two-way binding with attributes\n * Has different strategy for class/style and normal attributes\n * TODO: handle SVG/attributes with namespace\n */\nexport class AttributeObserver implements AttributeObserver, ElementMutationSubscription, IWithFlushQueue, IFlushable {\n  public value: unknown = null;\n  public oldValue: unknown = null;\n\n  public hasChanges: boolean = false;\n  // layout is not certain, depends on the attribute being flushed to owner element\n  // but for simple start, always treat as such\n  public type: AccessorType = AccessorType.Node | AccessorType.Observer | AccessorType.Layout;\n\n  public readonly queue!: FlushQueue;\n  private f: LifecycleFlags = LifecycleFlags.none;\n\n  public constructor(\n    private readonly platform: IPlatform,\n    public readonly observerLocator: IObserverLocator,\n    public readonly obj: IHtmlElement,\n    public readonly propertyKey: string,\n    public readonly targetAttribute: string,\n  ) {\n  }\n\n  public getValue(): unknown {\n    // is it safe to assume the observer has the latest value?\n    // todo: ability to turn on/off cache based on type\n    return this.value;\n  }\n\n  public setValue(value: unknown, flags: LifecycleFlags): void {\n    this.value = value;\n    this.hasChanges = value !== this.oldValue;\n    if ((flags & LifecycleFlags.noFlush) === 0) {\n      this.flushChanges(flags);\n    }\n  }\n\n  public flushChanges(flags: LifecycleFlags): void {\n    if (this.hasChanges) {\n      this.hasChanges = false;\n      const value = this.value;\n      const attr = this.targetAttribute;\n      this.oldValue = value;\n      switch (attr) {\n        case 'class': {\n          // Why does class attribute observer setValue look different with class attribute accessor?\n          // ==============\n          // For class list\n          // newValue is simply checked if truthy or falsy\n          // and toggle the class accordingly\n          // -- the rule of this is quite different to normal attribute\n          //\n          // for class attribute, observer is different in a way that it only observes one class at a time\n          // this also comes from syntax, where it would typically be my-class.class=\"someProperty\"\n          //\n          // so there is no need for separating class by space and add all of them like class accessor\n          this.obj.classList.toggle(this.propertyKey, !!value);\n          break;\n        }\n        case 'style': {\n          let priority = '';\n          let newValue = value as string;\n          if (typeof newValue === 'string' && newValue.includes('!important')) {\n            priority = 'important';\n            newValue = newValue.replace('!important', '');\n          }\n          this.obj.style.setProperty(this.propertyKey, newValue, priority);\n          break;\n        }\n        default: {\n          if (value == null) {\n            this.obj.removeAttribute(attr);\n          } else {\n            this.obj.setAttribute(attr, String(value));\n          }\n        }\n      }\n    }\n  }\n\n  public handleMutation(mutationRecords: MutationRecord[]): void {\n    let shouldProcess = false;\n    for (let i = 0, ii = mutationRecords.length; ii > i; ++i) {\n      const record = mutationRecords[i];\n      if (record.type === 'attributes' && record.attributeName === this.propertyKey) {\n        shouldProcess = true;\n        break;\n      }\n    }\n\n    if (shouldProcess) {\n      let newValue;\n      switch (this.targetAttribute) {\n        case 'class':\n          newValue = this.obj.classList.contains(this.propertyKey);\n          break;\n        case 'style':\n          newValue = this.obj.style.getPropertyValue(this.propertyKey);\n          break;\n        default:\n          throw new Error(`Unsupported observation of attribute: ${this.targetAttribute}`);\n      }\n\n      if (newValue !== this.value) {\n        this.oldValue = this.value;\n        this.value = newValue;\n        this.hasChanges = false;\n        this.f = LifecycleFlags.none;\n        this.queue.add(this);\n      }\n    }\n  }\n\n  public subscribe(subscriber: ISubscriber): void {\n    if (this.subs.add(subscriber) && this.subs.count === 1) {\n      this.value = this.oldValue = this.obj.getAttribute(this.propertyKey);\n      startObservation(this.obj.ownerDocument.defaultView!.MutationObserver, this.obj, this);\n    }\n  }\n\n  public unsubscribe(subscriber: ISubscriber): void {\n    if (this.subs.remove(subscriber) && this.subs.count === 0) {\n      stopObservation(this.obj, this);\n    }\n  }\n\n  public flush(): void {\n    oV = this.oldValue;\n    this.oldValue = this.value;\n    this.subs.notify(this.value, oV, this.f);\n  }\n}\n\nsubscriberCollection(AttributeObserver);\nwithFlushQueue(AttributeObserver);\n\nconst startObservation = ($MutationObserver: typeof MutationObserver, element: IHtmlElement, subscription: ElementMutationSubscription): void => {\n  if (element.$eMObservers === undefined) {\n    element.$eMObservers = new Set();\n  }\n  if (element.$mObserver === undefined) {\n    (element.$mObserver = new $MutationObserver(handleMutation)).observe(element, { attributes: true });\n  }\n  element.$eMObservers.add(subscription);\n};\n\nconst stopObservation = (element: IHtmlElement, subscription: ElementMutationSubscription): boolean => {\n  const $eMObservers = element.$eMObservers;\n  if ($eMObservers && $eMObservers.delete(subscription)) {\n    if ($eMObservers.size === 0) {\n      element.$mObserver.disconnect();\n      element.$mObserver = undefined!;\n    }\n    return true;\n  }\n  return false;\n};\n\nconst handleMutation = (mutationRecords: MutationRecord[]): void => {\n  (mutationRecords[0].target as IHtmlElement).$eMObservers.forEach(invokeHandleMutation, mutationRecords);\n};\n\nfunction invokeHandleMutation(this: MutationRecord[], s: ElementMutationSubscription): void {\n  s.handleMutation(this);\n}\n\n// a reusable variable for `.flush()` methods of observers\n// so that there doesn't need to create an env record for every call\nlet oV: unknown = void 0;\n","import type {\n  ForOfStatement,\n  IConnectableBinding,\n  IsBindingBehavior,\n  ISubscriber,\n  LifecycleFlags,\n} from '@aurelia/runtime';\n\ninterface ITwoWayBindingImpl extends IConnectableBinding {\n  sourceExpression: IsBindingBehavior | ForOfStatement;\n  updateSource(value: unknown, flags: LifecycleFlags): void;\n}\n\n/**\n * A subscriber that is used for subcribing to target observer & invoking `updateSource` on a binding\n */\nexport class BindingTargetSubscriber implements ISubscriber {\n  public constructor(\n    private readonly b: ITwoWayBindingImpl,\n  ) { }\n\n  // deepscan-disable-next-line\n  public handleChange(value: unknown, _: unknown, flags: LifecycleFlags): void {\n    const b = this.b;\n    if (value !== b.sourceExpression.evaluate(flags, b.$scope!, b.$hostScope, b.locator, null)) {\n      b.updateSource(value, flags);\n    }\n  }\n}\n","import { IServiceLocator } from '@aurelia/kernel';\nimport {\n  BindingMode,\n  connectable,\n  ExpressionKind,\n  LifecycleFlags,\n  AccessorType,\n  IObserver,\n} from '@aurelia/runtime';\n\nimport { AttributeObserver } from '../observation/element-attribute-observer.js';\nimport { IPlatform } from '../platform.js';\nimport { CustomElementDefinition } from '../resources/custom-element.js';\nimport { BindingTargetSubscriber } from './binding-utils.js';\n\nimport type {\n  IConnectableBinding,\n  ForOfStatement,\n  IObserverLocator,\n  IPartialConnectableBinding,\n  IsBindingBehavior,\n  ITask,\n  QueueTaskOptions,\n  Scope,\n} from '@aurelia/runtime';\nimport type { IHtmlElement } from '../observation/element-attribute-observer.js';\nimport type { INode } from '../dom.js';\n\n// BindingMode is not a const enum (and therefore not inlined), so assigning them to a variable to save a member accessor is a minor perf tweak\nconst { oneTime, toView, fromView } = BindingMode;\n\n// pre-combining flags for bitwise checks is a minor perf tweak\nconst toViewOrOneTime = toView | oneTime;\n\nconst taskOptions: QueueTaskOptions = {\n  reusable: false,\n  preempt: true,\n};\n\nexport interface AttributeBinding extends IConnectableBinding {}\n\n/**\n * Attribute binding. Handle attribute binding betwen view/view model. Understand Html special attributes\n */\nexport class AttributeBinding implements IPartialConnectableBinding {\n  public interceptor: this = this;\n\n  public isBound: boolean = false;\n  public $platform: IPlatform;\n  public $scope: Scope = null!;\n  public $hostScope: Scope | null = null;\n  public projection?: CustomElementDefinition;\n  public task: ITask | null = null;\n  private targetSubscriber: BindingTargetSubscriber | null = null;\n\n  /**\n   * Target key. In case Attr has inner structure, such as class -> classList, style -> CSSStyleDeclaration\n   */\n\n  public targetObserver!: IObserver;\n\n  public persistentFlags: LifecycleFlags = LifecycleFlags.none;\n\n  public target: Element;\n  public value: unknown = void 0;\n\n  public constructor(\n    public sourceExpression: IsBindingBehavior | ForOfStatement,\n    target: INode,\n    // some attributes may have inner structure\n    // such as class -> collection of class names\n    // such as style -> collection of style rules\n    //\n    // for normal attributes, targetAttribute and targetProperty are the same and can be ignore\n    public targetAttribute: string,\n    public targetProperty: string,\n    public mode: BindingMode,\n    public observerLocator: IObserverLocator,\n    public locator: IServiceLocator,\n  ) {\n    this.target = target as Element;\n    this.$platform = locator.get(IPlatform);\n  }\n\n  public updateTarget(value: unknown, flags: LifecycleFlags): void {\n    flags |= this.persistentFlags;\n    this.targetObserver.setValue(value, flags, this.target, this.targetProperty);\n  }\n\n  public updateSource(value: unknown, flags: LifecycleFlags): void {\n    flags |= this.persistentFlags;\n    this.sourceExpression.assign!(flags, this.$scope, this.$hostScope, this.locator, value);\n  }\n\n  public handleChange(newValue: unknown, _previousValue: unknown, flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n\n    flags |= this.persistentFlags;\n\n    const mode = this.mode;\n    const interceptor = this.interceptor;\n    const sourceExpression = this.sourceExpression;\n    const $scope = this.$scope;\n    const locator = this.locator;\n    const targetObserver = this.targetObserver;\n    // Alpha: during bind a simple strategy for bind is always flush immediately\n    // todo:\n    //  (1). determine whether this should be the behavior\n    //  (2). if not, then fix tests to reflect the changes/platform to properly yield all with aurelia.start()\n    const shouldQueueFlush = (flags & LifecycleFlags.fromBind) === 0 && (targetObserver.type & AccessorType.Layout) > 0;\n\n    if (sourceExpression.$kind !== ExpressionKind.AccessScope || this.obs.count > 1) {\n      const shouldConnect = (mode & oneTime) === 0;\n      if (shouldConnect) {\n        this.obs.version++;\n      }\n      newValue = sourceExpression.evaluate(flags, $scope, this.$hostScope, locator, interceptor);\n      if (shouldConnect) {\n        this.obs.clear(false);\n      }\n    }\n\n    let task: ITask | null;\n    if (newValue !== this.value) {\n      this.value = newValue;\n      if (shouldQueueFlush) {\n        // Queue the new one before canceling the old one, to prevent early yield\n        task = this.task;\n        this.task = this.$platform.domWriteQueue.queueTask(() => {\n          this.task = null;\n          interceptor.updateTarget(newValue, flags);\n        }, taskOptions);\n        task?.cancel();\n      } else {\n        interceptor.updateTarget(newValue, flags);\n      }\n    }\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null, projection?: CustomElementDefinition): void {\n    if (this.isBound) {\n      if (this.$scope === scope) {\n        return;\n      }\n      this.interceptor.$unbind(flags | LifecycleFlags.fromBind);\n    }\n\n    // Store flags which we can only receive during $bind and need to pass on\n    // to the AST during evaluate/connect/assign\n    this.persistentFlags = flags & LifecycleFlags.persistentBindingFlags;\n\n    this.$scope = scope;\n    this.$hostScope = hostScope;\n    this.projection = projection;\n\n    let sourceExpression = this.sourceExpression;\n    if (sourceExpression.hasBind) {\n      sourceExpression.bind(flags, scope, hostScope, this.interceptor);\n    }\n\n    let targetObserver = this.targetObserver as IObserver;\n    if (!targetObserver) {\n      targetObserver = this.targetObserver = new AttributeObserver(\n        this.$platform,\n        this.observerLocator,\n        this.target as IHtmlElement,\n        this.targetProperty,\n        this.targetAttribute,\n      );\n    }\n\n    // during bind, binding behavior might have changed sourceExpression\n    sourceExpression = this.sourceExpression;\n    const $mode = this.mode;\n    const interceptor = this.interceptor;\n\n    if ($mode & toViewOrOneTime) {\n      const shouldConnect = ($mode & toView) > 0;\n      interceptor.updateTarget(\n        this.value = sourceExpression.evaluate(flags, scope, this.$hostScope, this.locator, shouldConnect ? interceptor : null),\n        flags\n      );\n    }\n    if ($mode & fromView) {\n      targetObserver.subscribe(this.targetSubscriber ??= new BindingTargetSubscriber(interceptor));\n    }\n\n    this.isBound = true;\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n\n    // clear persistent flags\n    this.persistentFlags = LifecycleFlags.none;\n\n    if (this.sourceExpression.hasUnbind) {\n      this.sourceExpression.unbind(flags, this.$scope, this.$hostScope, this.interceptor);\n    }\n    this.$scope\n      = this.$hostScope\n      = null!;\n    this.value = void 0;\n\n    if (this.targetSubscriber) {\n      (this.targetObserver as IObserver).unsubscribe(this.targetSubscriber);\n    }\n\n    this.task?.cancel();\n    this.task = null;\n    this.obs.clear(true);\n\n    // remove isBound and isUnbinding flags\n    this.isBound = false;\n  }\n}\n\nconnectable(AttributeBinding);\n","import {\n  AccessorOrObserver,\n  AccessorType,\n  BindingMode,\n  ExpressionKind,\n  LifecycleFlags,\n  connectable,\n} from '@aurelia/runtime';\n\nimport type { IIndexable, IServiceLocator, ITask, QueueTaskOptions, TaskQueue } from '@aurelia/kernel';\nimport type {\n  ICollectionSubscriber,\n  IndexMap,\n  Interpolation,\n  IConnectableBinding,\n  IObserverLocator,\n  IsExpression,\n  IBinding,\n  Scope,\n} from '@aurelia/runtime';\nimport type {\n  IPlatform,\n} from '../platform';\n\nconst { toView } = BindingMode;\nconst queueTaskOptions: QueueTaskOptions = {\n  reusable: false,\n  preempt: true,\n};\n\n// a pseudo binding to manage multiple InterpolationBinding s\n// ========\n// Note: the child expressions of an Interpolation expression are full Aurelia expressions, meaning they may include\n// value converters and binding behaviors.\n// Each expression represents one ${interpolation}, and for each we create a child TextBinding unless there is only one,\n// in which case the renderer will create the TextBinding directly\nexport class InterpolationBinding implements IBinding {\n  public interceptor: this = this;\n\n  public isBound: boolean = false;\n  public $scope?: Scope = void 0;\n  public $hostScope: Scope | null = null;\n\n  public partBindings: InterpolationPartBinding[];\n\n  private readonly targetObserver: AccessorOrObserver;\n  private task: ITask | null = null;\n\n  public constructor(\n    public observerLocator: IObserverLocator,\n    public interpolation: Interpolation,\n    public target: object,\n    public targetProperty: string,\n    public mode: BindingMode,\n    public locator: IServiceLocator,\n    private readonly taskQueue: TaskQueue,\n  ) {\n    this.targetObserver = observerLocator.getAccessor(target, targetProperty);\n    const expressions = interpolation.expressions;\n    const partBindings = this.partBindings = Array(expressions.length);\n    for (let i = 0, ii = expressions.length; i < ii; ++i) {\n      partBindings[i] = new InterpolationPartBinding(expressions[i], target, targetProperty, locator, observerLocator, this);\n    }\n  }\n\n  public updateTarget(value: unknown, flags: LifecycleFlags): void {\n    const partBindings = this.partBindings;\n    const staticParts = this.interpolation.parts;\n    const ii = partBindings.length;\n    let result = '';\n    if (ii === 1) {\n      result = staticParts[0] + partBindings[0].value + staticParts[1];\n    } else {\n      result = staticParts[0];\n      for (let i = 0; ii > i; ++i) {\n        result += partBindings[i].value + staticParts[i + 1];\n      }\n    }\n\n    const targetObserver = this.targetObserver;\n    // Alpha: during bind a simple strategy for bind is always flush immediately\n    // todo:\n    //  (1). determine whether this should be the behavior\n    //  (2). if not, then fix tests to reflect the changes/platform to properly yield all with aurelia.start().wait()\n    const shouldQueueFlush = (flags & LifecycleFlags.fromBind) === 0 && (targetObserver.type & AccessorType.Layout) > 0;\n    if (shouldQueueFlush) {\n      // Queue the new one before canceling the old one, to prevent early yield\n      const task = this.task;\n      this.task = this.taskQueue.queueTask(() => {\n        this.task = null;\n        targetObserver.setValue(result, flags, this.target, this.targetProperty);\n      }, queueTaskOptions);\n      task?.cancel();\n    } else {\n      targetObserver.setValue(result, flags, this.target, this.targetProperty);\n    }\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.isBound) {\n      if (this.$scope === scope) {\n        return;\n      }\n      this.interceptor.$unbind(flags);\n    }\n    this.isBound = true;\n    this.$scope = scope;\n    const partBindings = this.partBindings;\n    for (let i = 0, ii = partBindings.length; ii > i; ++i) {\n      partBindings[i].$bind(flags, scope, hostScope);\n    }\n    this.updateTarget(void 0, flags);\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n    this.isBound = false;\n    this.$scope = void 0;\n    const partBindings = this.partBindings;\n    for (let i = 0, ii = partBindings.length; i < ii; ++i) {\n      partBindings[i].interceptor.$unbind(flags);\n    }\n    this.task?.cancel();\n    this.task = null;\n  }\n}\n\n// a pseudo binding, part of a larger interpolation binding\n// employed to support full expression per expression part of an interpolation\nexport interface InterpolationPartBinding extends IConnectableBinding {}\n\nexport class InterpolationPartBinding implements InterpolationPartBinding, ICollectionSubscriber {\n  public interceptor: this = this;\n\n  // at runtime, mode may be overriden by binding behavior\n  // but it wouldn't matter here, just start with something for later check\n  public readonly mode: BindingMode = BindingMode.toView;\n  public value: unknown = '';\n  public $scope?: Scope;\n  public $hostScope: Scope | null = null;\n  public task: ITask | null = null;\n  public isBound: boolean = false;\n\n  public constructor(\n    public readonly sourceExpression: IsExpression,\n    public readonly target: object,\n    public readonly targetProperty: string,\n    public readonly locator: IServiceLocator,\n    public readonly observerLocator: IObserverLocator,\n    public readonly owner: InterpolationBinding,\n  ) {\n\n  }\n\n  public handleChange(newValue: unknown, oldValue: unknown, flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n    const sourceExpression = this.sourceExpression;\n    const obsRecord = this.obs;\n    const canOptimize = sourceExpression.$kind === ExpressionKind.AccessScope && obsRecord.count === 1;\n    if (!canOptimize) {\n      const shouldConnect = (this.mode & toView) > 0;\n      if (shouldConnect) {\n        obsRecord.version++;\n      }\n      newValue = sourceExpression.evaluate(flags, this.$scope!, this.$hostScope, this.locator, shouldConnect ? this.interceptor : null);\n      if (shouldConnect) {\n        obsRecord.clear(false);\n      }\n    }\n    if (newValue != this.value) {\n      this.value = newValue;\n      if (newValue instanceof Array) {\n        this.observeCollection(newValue);\n      }\n      this.owner.updateTarget(newValue, flags);\n    }\n  }\n\n  public handleCollectionChange(indexMap: IndexMap, flags: LifecycleFlags): void {\n    this.owner.updateTarget(void 0, flags);\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.isBound) {\n      if (this.$scope === scope) {\n        return;\n      }\n      this.interceptor.$unbind(flags);\n    }\n\n    this.isBound = true;\n    this.$scope = scope;\n    this.$hostScope = hostScope;\n\n    if (this.sourceExpression.hasBind) {\n      this.sourceExpression.bind(flags, scope, hostScope, this.interceptor as IIndexable & this);\n    }\n\n    const v = this.value = this.sourceExpression.evaluate(\n      flags,\n      scope,\n      hostScope,\n      this.locator,\n      (this.mode & toView) > 0 ?  this.interceptor : null,\n    );\n    if (v instanceof Array) {\n      this.observeCollection(v);\n    }\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n    this.isBound = false;\n\n    if (this.sourceExpression.hasUnbind) {\n      this.sourceExpression.unbind(flags, this.$scope!, this.$hostScope, this.interceptor);\n    }\n\n    this.$scope = void 0;\n    this.$hostScope = null;\n    this.obs.clear(true);\n  }\n}\n\nconnectable(InterpolationPartBinding);\n\nexport interface ContentBinding extends IConnectableBinding {}\n\n/**\n * A binding for handling the element content interpolation\n */\nexport class ContentBinding implements ContentBinding, ICollectionSubscriber {\n  public interceptor: this = this;\n\n  // at runtime, mode may be overriden by binding behavior\n  // but it wouldn't matter here, just start with something for later check\n  public readonly mode: BindingMode = BindingMode.toView;\n  public value: unknown = '';\n  public $scope?: Scope;\n  public $hostScope: Scope | null = null;\n  public task: ITask | null = null;\n  public isBound: boolean = false;\n\n  public constructor(\n    public readonly sourceExpression: IsExpression,\n    public readonly target: Text,\n    public readonly locator: IServiceLocator,\n    public readonly observerLocator: IObserverLocator,\n    private readonly p: IPlatform,\n    private readonly strict: boolean,\n  ) {\n\n  }\n\n  public updateTarget(value: unknown, flags: LifecycleFlags): void {\n    const target = this.target;\n    const NodeCtor = this.p.Node;\n    const oldValue = this.value;\n    this.value = value;\n    if (oldValue instanceof NodeCtor) {\n      oldValue.parentNode?.removeChild(oldValue);\n    }\n    if (value instanceof NodeCtor) {\n      target.textContent = '';\n      target.parentNode?.insertBefore(value, target);\n    } else {\n      target.textContent = String(value);\n    }\n  }\n\n  public handleChange(newValue: unknown, oldValue: unknown, flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n    const sourceExpression = this.sourceExpression;\n    const obsRecord = this.obs;\n    const canOptimize = sourceExpression.$kind === ExpressionKind.AccessScope && obsRecord.count === 1;\n    if (!canOptimize) {\n      const shouldConnect = (this.mode & toView) > 0;\n      if (shouldConnect) {\n        obsRecord.version++;\n      }\n      flags |= this.strict ? LifecycleFlags.isStrictBindingStrategy : 0;\n      newValue = sourceExpression.evaluate(flags, this.$scope!, this.$hostScope, this.locator, shouldConnect ? this.interceptor : null);\n      if (shouldConnect) {\n        obsRecord.clear(false);\n      }\n    }\n    if (newValue === this.value) {\n      // in a frequent update, e.g collection mutation in a loop\n      // value could be changing frequently and previous update task may be stale at this point\n      // cancel if any task going on because the latest value is already the same\n      this.task?.cancel();\n      this.task = null;\n      return;\n    }\n    // Alpha: during bind a simple strategy for bind is always flush immediately\n    // todo:\n    //  (1). determine whether this should be the behavior\n    //  (2). if not, then fix tests to reflect the changes/platform to properly yield all with aurelia.start().wait()\n    const shouldQueueFlush = (flags & LifecycleFlags.fromBind) === 0;\n    if (shouldQueueFlush) {\n      this.queueUpdate(newValue, flags);\n    } else {\n      this.updateTarget(newValue, flags);\n    }\n  }\n\n  public handleCollectionChange(): void {\n    this.queueUpdate(this.value, LifecycleFlags.none);\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.isBound) {\n      if (this.$scope === scope) {\n        return;\n      }\n      this.interceptor.$unbind(flags);\n    }\n\n    this.isBound = true;\n    this.$scope = scope;\n    this.$hostScope = hostScope;\n\n    if (this.sourceExpression.hasBind) {\n      this.sourceExpression.bind(flags, scope, hostScope, this.interceptor as IIndexable & this);\n    }\n\n    flags |= this.strict ? LifecycleFlags.isStrictBindingStrategy : 0;\n\n    const v = this.value = this.sourceExpression.evaluate(\n      flags,\n      scope,\n      hostScope,\n      this.locator,\n      (this.mode & toView) > 0 ?  this.interceptor : null,\n    );\n    if (v instanceof Array) {\n      this.observeCollection(v);\n    }\n    this.updateTarget(v, flags);\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n    this.isBound = false;\n\n    if (this.sourceExpression.hasUnbind) {\n      this.sourceExpression.unbind(flags, this.$scope!, this.$hostScope, this.interceptor);\n    }\n\n    // TODO: should existing value (either connected node, or a string)\n    // be removed when this binding is unbound?\n    // this.updateTarget('', flags);\n    this.$scope = void 0;\n    this.$hostScope = null;\n    this.obs.clear(true);\n    this.task?.cancel();\n    this.task = null;\n  }\n\n  // queue a force update\n  private queueUpdate(newValue: unknown, flags: LifecycleFlags): void {\n    const task = this.task;\n    this.task = this.p.domWriteQueue.queueTask(() => {\n      this.task = null;\n      this.updateTarget(newValue, flags);\n    }, queueTaskOptions);\n    task?.cancel();\n  }\n}\n\nconnectable(ContentBinding);\n","import { connectable, LifecycleFlags } from '@aurelia/runtime';\n\nimport type { ITask } from '@aurelia/platform';\nimport type { IIndexable, IServiceLocator } from '@aurelia/kernel';\nimport type {\n  IConnectableBinding,\n  IObservable,\n  IObserverLocator,\n  IPartialConnectableBinding,\n  IsExpression,\n  Scope,\n} from '@aurelia/runtime';\n\nexport interface LetBinding extends IConnectableBinding {}\n\nexport class LetBinding implements IPartialConnectableBinding {\n  public interceptor: this = this;\n\n  public isBound: boolean = false;\n  public $scope?: Scope = void 0;\n  public $hostScope: Scope | null = null;\n\n  public task: ITask | null = null;\n\n  public target: (IObservable & IIndexable) | null = null;\n\n  public constructor(\n    public sourceExpression: IsExpression,\n    public targetProperty: string,\n    public observerLocator: IObserverLocator,\n    public locator: IServiceLocator,\n    private readonly toBindingContext: boolean = false,\n  ) {\n  }\n\n  public handleChange(newValue: unknown, _previousValue: unknown, flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n\n    const target = this.target as IIndexable;\n    const targetProperty = this.targetProperty as string;\n    const previousValue: unknown = target[targetProperty];\n    this.obs.version++;\n    newValue = this.sourceExpression.evaluate(flags, this.$scope!, this.$hostScope, this.locator, this.interceptor);\n    this.obs.clear(false);\n    if (newValue !== previousValue) {\n      target[targetProperty] = newValue;\n    }\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.isBound) {\n      if (this.$scope === scope) {\n        return;\n      }\n      this.interceptor.$unbind(flags | LifecycleFlags.fromBind);\n    }\n\n    this.$scope = scope;\n    this.$hostScope = hostScope;\n    this.target = (this.toBindingContext ? (hostScope ?? scope).bindingContext : (hostScope ?? scope).overrideContext) as IIndexable;\n\n    const sourceExpression = this.sourceExpression;\n    if (sourceExpression.hasBind) {\n      sourceExpression.bind(flags, scope, hostScope, this.interceptor);\n    }\n    // sourceExpression might have been changed during bind\n    this.target[this.targetProperty]\n      = this.sourceExpression.evaluate(flags | LifecycleFlags.fromBind, scope, hostScope, this.locator, this.interceptor);\n\n    // add isBound flag and remove isBinding flag\n    this.isBound = true;\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n\n    const sourceExpression = this.sourceExpression;\n    if (sourceExpression.hasUnbind) {\n      sourceExpression.unbind(flags, this.$scope!, this.$hostScope, this.interceptor);\n    }\n    this.$scope = void 0;\n    this.$hostScope = null;\n    this.obs.clear(true);\n\n    // remove isBound and isUnbinding flags\n    this.isBound = false;\n  }\n}\n\nconnectable(LetBinding);\n","import { AccessorType, BindingMode, connectable, ExpressionKind, LifecycleFlags } from '@aurelia/runtime';\nimport { BindingTargetSubscriber } from './binding-utils.js';\n\nimport type { IServiceLocator, ITask, QueueTaskOptions, TaskQueue } from '@aurelia/kernel';\nimport type {\n  AccessorOrObserver,\n  ForOfStatement,\n  IConnectableBinding,\n  IObserver,\n  IObserverLocator,\n  IPartialConnectableBinding,\n  IsBindingBehavior,\n  Scope,\n} from '@aurelia/runtime';\n\n// BindingMode is not a const enum (and therefore not inlined), so assigning them to a variable to save a member accessor is a minor perf tweak\nconst { oneTime, toView, fromView } = BindingMode;\n\n// pre-combining flags for bitwise checks is a minor perf tweak\nconst toViewOrOneTime = toView | oneTime;\n\nexport interface PropertyBinding extends IConnectableBinding {}\n\nconst updateTaskOpts: QueueTaskOptions = {\n  reusable: false,\n  preempt: true,\n};\n\nexport class PropertyBinding implements IPartialConnectableBinding {\n  public interceptor: this = this;\n\n  public isBound: boolean = false;\n  public $scope?: Scope = void 0;\n  public $hostScope: Scope | null = null;\n\n  public targetObserver?: AccessorOrObserver = void 0;\n\n  public persistentFlags: LifecycleFlags = LifecycleFlags.none;\n\n  private task: ITask | null = null;\n  private targetSubscriber: BindingTargetSubscriber | null = null;\n\n  public constructor(\n    public sourceExpression: IsBindingBehavior | ForOfStatement,\n    public target: object,\n    public targetProperty: string,\n    public mode: BindingMode,\n    public observerLocator: IObserverLocator,\n    public locator: IServiceLocator,\n    private readonly taskQueue: TaskQueue,\n  ) {\n  }\n\n  public updateTarget(value: unknown, flags: LifecycleFlags): void {\n    flags |= this.persistentFlags;\n    this.targetObserver!.setValue(value, flags, this.target, this.targetProperty);\n  }\n\n  public updateSource(value: unknown, flags: LifecycleFlags): void {\n    flags |= this.persistentFlags;\n    this.sourceExpression.assign!(flags, this.$scope!, this.$hostScope, this.locator, value);\n  }\n\n  public handleChange(newValue: unknown, _previousValue: unknown, flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n\n    flags |= this.persistentFlags;\n\n    const targetObserver = this.targetObserver!;\n    const interceptor = this.interceptor;\n    const sourceExpression = this.sourceExpression;\n    const $scope = this.$scope;\n    const locator = this.locator;\n\n    // Alpha: during bind a simple strategy for bind is always flush immediately\n    // todo:\n    //  (1). determine whether this should be the behavior\n    //  (2). if not, then fix tests to reflect the changes/platform to properly yield all with aurelia.start()\n    const shouldQueueFlush = (flags & LifecycleFlags.fromBind) === 0 && (targetObserver.type & AccessorType.Layout) > 0;\n    const obsRecord = this.obs;\n\n    // if the only observable is an AccessScope then we can assume the passed-in newValue is the correct and latest value\n    if (sourceExpression.$kind !== ExpressionKind.AccessScope || obsRecord.count > 1) {\n      // todo: in VC expressions, from view also requires connect\n      const shouldConnect = this.mode > oneTime;\n      if (shouldConnect) {\n        obsRecord.version++;\n      }\n      newValue = sourceExpression.evaluate(flags, $scope!, this.$hostScope, locator, interceptor);\n      if (shouldConnect) {\n        obsRecord.clear(false);\n      }\n    }\n\n    if (shouldQueueFlush) {\n      // Queue the new one before canceling the old one, to prevent early yield\n      const task = this.task;\n      this.task = this.taskQueue.queueTask(() => {\n        interceptor.updateTarget(newValue, flags);\n        this.task = null;\n      }, updateTaskOpts);\n      task?.cancel();\n    } else {\n      interceptor.updateTarget(newValue, flags);\n    }\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.isBound) {\n      if (this.$scope === scope) {\n        return;\n      }\n      this.interceptor.$unbind(flags | LifecycleFlags.fromBind);\n    }\n    // Force property binding to always be strict\n    flags |= LifecycleFlags.isStrictBindingStrategy;\n\n    // Store flags which we can only receive during $bind and need to pass on\n    // to the AST during evaluate/connect/assign\n    this.persistentFlags = flags & LifecycleFlags.persistentBindingFlags;\n\n    this.$scope = scope;\n    this.$hostScope = hostScope;\n\n    let sourceExpression = this.sourceExpression;\n    if (sourceExpression.hasBind) {\n      sourceExpression.bind(flags, scope, hostScope, this.interceptor);\n    }\n\n    const $mode = this.mode;\n    let targetObserver = this.targetObserver;\n    if (!targetObserver) {\n      const observerLocator = this.observerLocator;\n      if ($mode & fromView) {\n        targetObserver = observerLocator.getObserver(this.target, this.targetProperty);\n      } else {\n        targetObserver = observerLocator.getAccessor(this.target, this.targetProperty);\n      }\n      this.targetObserver = targetObserver;\n    }\n\n    // during bind, binding behavior might have changed sourceExpression\n    // deepscan-disable-next-line\n    sourceExpression = this.sourceExpression;\n    const interceptor = this.interceptor;\n\n    const shouldConnect = ($mode & toView) > 0;\n    if ($mode & toViewOrOneTime) {\n      interceptor.updateTarget(\n        sourceExpression.evaluate(flags, scope, this.$hostScope, this.locator, shouldConnect ? interceptor : null),\n        flags,\n      );\n    }\n    if ($mode & fromView) {\n      (targetObserver as IObserver).subscribe(this.targetSubscriber ??= new BindingTargetSubscriber(interceptor));\n      if (!shouldConnect) {\n        interceptor.updateSource(targetObserver.getValue(this.target, this.targetProperty), flags);\n      }\n    }\n\n    this.isBound = true;\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n\n    this.persistentFlags = LifecycleFlags.none;\n\n    if (this.sourceExpression.hasUnbind) {\n      this.sourceExpression.unbind(flags, this.$scope!, this.$hostScope, this.interceptor);\n    }\n\n    this.$scope = void 0;\n    this.$hostScope = null;\n\n    const task = this.task;\n\n    if (this.targetSubscriber) {\n      (this.targetObserver as IObserver).unsubscribe(this.targetSubscriber);\n    }\n    if (task != null) {\n      task.cancel();\n      this.task = null;\n    }\n    this.obs.clear(true);\n\n    this.isBound = false;\n  }\n}\n\nconnectable(PropertyBinding);\n","import { LifecycleFlags } from '@aurelia/runtime';\n\nimport type { IIndexable, IServiceLocator } from '@aurelia/kernel';\nimport type { IBinding, IConnectableBinding, IsBindingBehavior, Scope } from '@aurelia/runtime';\n\nexport interface RefBinding extends IConnectableBinding {}\nexport class RefBinding implements IBinding {\n  public interceptor: this = this;\n\n  public isBound: boolean = false;\n  public $scope?: Scope = void 0;\n  public $hostScope: Scope | null = null;\n\n  public constructor(\n    public sourceExpression: IsBindingBehavior,\n    public target: object,\n    public locator: IServiceLocator,\n  ) {}\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.isBound) {\n      if (this.$scope === scope) {\n        return;\n      }\n\n      this.interceptor.$unbind(flags | LifecycleFlags.fromBind);\n    }\n\n    this.$scope = scope;\n    this.$hostScope = hostScope;\n\n    if (this.sourceExpression.hasBind) {\n      this.sourceExpression.bind(flags, scope, hostScope, this);\n    }\n\n    this.sourceExpression.assign!(flags, this.$scope, hostScope, this.locator, this.target);\n\n    // add isBound flag and remove isBinding flag\n    this.isBound = true;\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n\n    let sourceExpression = this.sourceExpression;\n    if (sourceExpression.evaluate(flags, this.$scope!, this.$hostScope, this.locator, null) === this.target) {\n      sourceExpression.assign!(flags, this.$scope!, this.$hostScope, this.locator, null);\n    }\n\n    // source expression might have been modified durring assign, via a BB\n    // deepscan-disable-next-line\n    sourceExpression = this.sourceExpression;\n    if (sourceExpression.hasUnbind) {\n      sourceExpression.unbind(flags, this.$scope!, this.$hostScope, this.interceptor);\n    }\n\n    this.$scope = void 0;\n    this.$hostScope = null;\n\n    this.isBound = false;\n  }\n\n  public observeProperty(obj: IIndexable, propertyName: string): void {\n    return;\n  }\n\n  public handleChange(newValue: unknown, previousValue: unknown, flags: LifecycleFlags): void {\n    return;\n  }\n}\n","import { DI, Registration } from '@aurelia/kernel';\nimport type { IContainer, IRegistry, Key, Resolved } from '@aurelia/kernel';\n\nexport type TaskSlot = (\n  'beforeCreate' |\n  'hydrating' |\n  'hydrated' |\n  'beforeActivate' |\n  'afterActivate' |\n  'beforeDeactivate' |\n  'afterDeactivate'\n);\n\nexport const IAppTask = DI.createInterface<IAppTask>('IAppTask');\nexport interface IAppTask extends Pick<\n  $AppTask,\n  'slot' |\n  'run' |\n  'register'\n> {}\n\nclass $AppTask<K extends Key = Key> {\n  public readonly slot: TaskSlot;\n  /** @internal */\n  private c: IContainer = (void 0)!;\n  /** @internal */\n  private readonly k: K | null;\n  /** @internal */\n  private readonly cb: AppTaskCallback<K> | AppTaskCallbackNoArg;\n\n  public constructor(\n    slot: TaskSlot,\n    key: K | null,\n    cb: AppTaskCallback<K> | AppTaskCallbackNoArg,\n  ) {\n    this.slot = slot;\n    this.k = key;\n    this.cb = cb;\n  }\n\n  public register(container: IContainer): IContainer {\n    return this.c = container.register(Registration.instance(IAppTask, this));\n  }\n\n  public run(): void | Promise<void> {\n    const key = this.k;\n    const cb = this.cb;\n    return key === null\n      ? (cb as AppTaskCallbackNoArg)()\n      : cb(this.c.get(key));\n  }\n}\n\nexport const AppTask = Object.freeze({\n  beforeCreate: createAppTaskSlotHook('beforeCreate'),\n  hydrating: createAppTaskSlotHook('hydrating'),\n  hydrated: createAppTaskSlotHook('hydrated'),\n  beforeActivate: createAppTaskSlotHook('beforeActivate'),\n  afterActivate: createAppTaskSlotHook('afterActivate'),\n  beforeDeactivate: createAppTaskSlotHook('beforeDeactivate'),\n  afterDeactivate: createAppTaskSlotHook('afterDeactivate'),\n});\n\nexport type AppTaskCallbackNoArg = () => void | Promise<void>;\nexport type AppTaskCallback<T> = (arg: Resolved<T>) => void | Promise<void>;\n\nfunction createAppTaskSlotHook(slotName: TaskSlot) {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  function appTaskFactory<T extends Key = Key>(callback: AppTaskCallbackNoArg): IRegistry;\n  function appTaskFactory<T extends Key = Key>(key: T, callback: AppTaskCallback<T>): IRegistry;\n  function appTaskFactory<T extends Key = Key>(keyOrCallback: T | AppTaskCallback<T> | AppTaskCallbackNoArg, callback?: AppTaskCallback<T>): IRegistry {\n    if (typeof callback === 'function') {\n      return new $AppTask(slotName, keyOrCallback as T, callback);\n    }\n    return new $AppTask(slotName, null, keyOrCallback as Exclude<typeof keyOrCallback, T>);\n  }\n  return appTaskFactory;\n}\n","import { Protocol, Metadata, firstDefined, getPrototypeChain, emptyArray } from '@aurelia/kernel';\nimport { LifecycleFlags, subscriberCollection } from '@aurelia/runtime';\nimport { CustomElement } from '../resources/custom-element.js';\n\nimport type { IIndexable, Constructable } from '@aurelia/kernel';\nimport type { ISubscriberCollection, IAccessor, ISubscribable, IObserver } from '@aurelia/runtime';\nimport type { INode } from '../dom.js';\nimport type { ICustomElementViewModel, ICustomElementController } from './controller.js';\n\nexport type PartialChildrenDefinition = {\n  callback?: string;\n  property?: string;\n  options?: MutationObserverInit;\n  query?: (controller: ICustomElementController) => ArrayLike<Node>;\n  filter?: (node: Node, controller?: ICustomElementController | null, viewModel?: ICustomElementViewModel) => boolean;\n  map?: (node: Node, controller?: ICustomElementController | null, viewModel?: ICustomElementViewModel) => any;\n};\n\n/**\n * Decorator: Specifies custom behavior for an array children property that synchronizes its items with child content nodes of the element.\n *\n * @param config - The overrides\n */\nexport function children(config?: PartialChildrenDefinition): PropertyDecorator;\n/**\n * Decorator: Specifies an array property on a class that synchronizes its items with child content nodes of the element.\n *\n * @param prop - The property name\n */\nexport function children(prop: string): ClassDecorator;\n/**\n * Decorator: Decorator: Specifies an array property that synchronizes its items with child content nodes of the element.\n *\n * @param target - The class\n * @param prop - The property name\n */\nexport function children(target: {}, prop: string): void;\nexport function children(configOrTarget?: PartialChildrenDefinition | {}, prop?: string): void | PropertyDecorator | ClassDecorator {\n  let config: PartialChildrenDefinition;\n\n  function decorator($target: {}, $prop: symbol | string): void {\n    if (arguments.length > 1) {\n      // Non invocation:\n      // - @children\n      // Invocation with or w/o opts:\n      // - @children()\n      // - @children({...opts})\n      config.property = $prop as string;\n    }\n\n    Metadata.define(Children.name, ChildrenDefinition.create($prop as string, config), $target.constructor, $prop);\n    Protocol.annotation.appendTo($target.constructor as Constructable, Children.keyFrom($prop as string));\n  }\n\n  if (arguments.length > 1) {\n    // Non invocation:\n    // - @children\n    config = {};\n    decorator(configOrTarget!, prop!);\n    return;\n  } else if (typeof configOrTarget === 'string') {\n    // ClassDecorator\n    // - @children('bar')\n    // Direct call:\n    // - @children('bar')(Foo)\n    config = {};\n    return decorator;\n  }\n\n  // Invocation with or w/o opts:\n  // - @children()\n  // - @children({...opts})\n  config = configOrTarget === void 0 ? {} : configOrTarget;\n  return decorator;\n}\n\nfunction isChildrenObserverAnnotation(key: string): boolean {\n  return key.startsWith(Children.name);\n}\n\nexport const Children = {\n  name: Protocol.annotation.keyFor('children-observer'),\n  keyFrom(name: string): string {\n    return `${Children.name}:${name}`;\n  },\n  from(...childrenObserverLists: readonly (ChildrenDefinition | Record<string, PartialChildrenDefinition> | readonly string[] | undefined)[]): Record<string, ChildrenDefinition> {\n    const childrenObservers: Record<string, ChildrenDefinition> = {};\n\n    const isArray = Array.isArray as <T>(arg: unknown) => arg is readonly T[];\n\n    function addName(name: string): void {\n      childrenObservers[name] = ChildrenDefinition.create(name);\n    }\n\n    function addDescription(name: string, def: PartialChildrenDefinition): void {\n      childrenObservers[name] = ChildrenDefinition.create(name, def);\n    }\n\n    function addList(maybeList: ChildrenDefinition | Record<string, PartialChildrenDefinition> | readonly string[] | undefined): void {\n      if (isArray(maybeList)) {\n        maybeList.forEach(addName);\n      } else if (maybeList instanceof ChildrenDefinition) {\n        childrenObservers[maybeList.property] = maybeList;\n      } else if (maybeList !== void 0) {\n        Object.keys(maybeList).forEach(name => addDescription(name, maybeList));\n      }\n    }\n\n    childrenObserverLists.forEach(addList);\n\n    return childrenObservers;\n  },\n  getAll(Type: Constructable): readonly ChildrenDefinition[] {\n    const propStart = Children.name.length + 1;\n    const defs: ChildrenDefinition[] = [];\n    const prototypeChain = getPrototypeChain(Type);\n\n    let iProto = prototypeChain.length;\n    let iDefs = 0;\n    let keys: string[];\n    let keysLen: number;\n    let Class: Constructable;\n    while (--iProto >= 0) {\n      Class = prototypeChain[iProto];\n      keys = Protocol.annotation.getKeys(Class).filter(isChildrenObserverAnnotation);\n      keysLen = keys.length;\n      for (let i = 0; i < keysLen; ++i) {\n        defs[iDefs++] = Metadata.getOwn(Children.name, Class, keys[i].slice(propStart));\n      }\n    }\n    return defs;\n  },\n};\n\nconst childObserverOptions = { childList: true };\nexport class ChildrenDefinition {\n  private constructor(\n    public readonly callback: string,\n    public readonly property: string,\n    public readonly options?: MutationObserverInit,\n    public readonly query?: (controller: ICustomElementController) => ArrayLike<Node>,\n    public readonly filter?: (node: Node, controller?: ICustomElementController | null, viewModel?: ICustomElementViewModel) => boolean,\n    public readonly map?: (node: Node, controller?: ICustomElementController | null, viewModel?: ICustomElementViewModel) => any,\n  ) {}\n\n  public static create(prop: string, def: PartialChildrenDefinition = {}): ChildrenDefinition {\n    return new ChildrenDefinition(\n      firstDefined(def.callback, `${prop}Changed`),\n      firstDefined(def.property, prop),\n      def.options ?? childObserverOptions,\n      def.query,\n      def.filter,\n      def.map,\n    );\n  }\n}\n\nexport interface ChildrenObserver extends\n  IAccessor,\n  ISubscribable,\n  ISubscriberCollection,\n  IObserver { }\n\n/**\n * @internal\n *\n * A special observer for observing the children of a custom element. Unlike other observer that starts/stops\n * based on the changes in the subscriber addition/removal, this is a controlled observers.\n *\n * The controller of a custom element should totally control when this observer starts/stops.\n */\n@subscriberCollection()\nexport class ChildrenObserver {\n  public observing: boolean = false;\n\n  private readonly callback: () => void;\n  private children: unknown[] = (void 0)!;\n  private observer: MutationObserver | undefined = void 0;\n\n  public constructor(\n    private readonly controller: ICustomElementController,\n    public readonly obj: IIndexable,\n    public readonly propertyKey: string,\n    cbName: string,\n    private readonly query = defaultChildQuery,\n    private readonly filter = defaultChildFilter,\n    private readonly map = defaultChildMap,\n    private readonly options?: MutationObserverInit\n  ) {\n    this.callback = obj[cbName] as typeof ChildrenObserver.prototype.callback;\n    Reflect.defineProperty(\n      this.obj,\n      this.propertyKey,\n      {\n        enumerable: true,\n        configurable: true,\n        get: () => this.getValue(),\n        set: () => { return; },\n      }\n    );\n  }\n\n  public getValue(): unknown[] {\n    return this.observing ? this.children : this.get();\n  }\n\n  public setValue(value: unknown): void { /* do nothing */ }\n\n  public start(): void {\n    if (!this.observing) {\n      this.observing = true;\n      this.children = this.get();\n      (this.observer ??= new this.controller.host.ownerDocument.defaultView!.MutationObserver(() => { this.onChildrenChanged(); }))\n        .observe(this.controller.host, this.options);\n    }\n  }\n\n  public stop(): void {\n    if (this.observing) {\n      this.observing = false;\n      this.observer!.disconnect();\n      this.children = emptyArray;\n    }\n  }\n\n  private onChildrenChanged(): void {\n    this.children = this.get();\n\n    if (this.callback !== void 0) {\n      this.callback.call(this.obj);\n    }\n\n    this.subs.notify(this.children, undefined, LifecycleFlags.none);\n  }\n\n  // freshly retrieve the children everytime\n  // in case this observer is not observing\n  private get() {\n    return filterChildren(this.controller, this.query, this.filter, this.map);\n  }\n}\n\nfunction defaultChildQuery(controller: ICustomElementController): ArrayLike<INode> {\n  return controller.host.childNodes;\n}\n\nfunction defaultChildFilter(node: INode, controller?: ICustomElementController | null, viewModel?: any): boolean {\n  return !!viewModel;\n}\n\nfunction defaultChildMap(node: INode, controller?: ICustomElementController | null, viewModel?: any): any {\n  return viewModel;\n}\n\nconst forOpts = { optional: true } as const;\n\n/** @internal */\nexport function filterChildren(\n  controller: ICustomElementController,\n  query: typeof defaultChildQuery,\n  filter: typeof defaultChildFilter,\n  map: typeof defaultChildMap\n): any[] {\n  const nodes = query(controller);\n  const ii = nodes.length;\n  const children = [];\n\n  let node: INode;\n  let $controller: ICustomElementController | null;\n  let viewModel: ICustomElementViewModel | null;\n  let i = 0;\n  for (; i < ii; ++i) {\n    node = nodes[i];\n    $controller = CustomElement.for(node, forOpts);\n    viewModel = $controller?.viewModel ?? null;\n\n    if (filter(node, $controller, viewModel)) {\n      children.push(map(node, $controller, viewModel));\n    }\n  }\n\n  return children;\n}\n","import { Registration, Protocol, Metadata, mergeArrays, firstDefined } from '@aurelia/kernel';\nimport { BindingMode, registerAliases } from '@aurelia/runtime';\nimport { Bindable } from '../bindable.js';\nimport { Watch } from '../watch.js';\nimport { getRef } from '../dom.js';\n\nimport type {\n  Constructable,\n  IContainer,\n  IResourceKind,\n  ResourceDefinition,\n  PartialResourceDefinition,\n  ResourceType,\n} from '@aurelia/kernel';\nimport type { BindableDefinition, PartialBindableDefinition } from '../bindable.js';\nimport type { ICustomAttributeViewModel, ICustomAttributeController } from '../templating/controller.js';\nimport type { IWatchDefinition } from '../watch.js';\n\ndeclare module '@aurelia/kernel' {\n  interface IContainer {\n    find<T extends ICustomAttributeViewModel>(kind: typeof CustomAttribute, name: string): CustomAttributeDefinition<Constructable<T>> | null;\n  }\n}\n\nexport type PartialCustomAttributeDefinition = PartialResourceDefinition<{\n  readonly defaultBindingMode?: BindingMode;\n  readonly isTemplateController?: boolean;\n  readonly bindables?: Record<string, PartialBindableDefinition> | readonly string[];\n  /**\n   * A config that can be used by template compliler to change attr value parsing mode\n   * `true` to always parse as a single value, mostly will be string in URL scenario\n   * Example:\n   * ```html\n   * <div goto=\"http://bla.bla.com\">\n   * ```\n   * With `noMultiBinding: true`, user does not need to escape the `:` with `\\`\n   * or use binding command to escape it.\n   *\n   * With `noMultiBinding: false (default)`, the above will be parsed as it's binding\n   * to a property name `http`, with value equal to literal string `//bla.bla.com`\n   */\n  readonly noMultiBindings?: boolean;\n  readonly watches?: IWatchDefinition[];\n}>;\n\nexport type CustomAttributeType<T extends Constructable = Constructable> = ResourceType<T, ICustomAttributeViewModel, PartialCustomAttributeDefinition>;\nexport type CustomAttributeKind = IResourceKind<CustomAttributeType, CustomAttributeDefinition> & {\n  for<C extends ICustomAttributeViewModel = ICustomAttributeViewModel>(node: Node, name: string): ICustomAttributeController<C> | undefined;\n  isType<T>(value: T): value is (T extends Constructable ? CustomAttributeType<T> : never);\n  define<T extends Constructable>(name: string, Type: T): CustomAttributeType<T>;\n  define<T extends Constructable>(def: PartialCustomAttributeDefinition, Type: T): CustomAttributeType<T>;\n  define<T extends Constructable>(nameOrDef: string | PartialCustomAttributeDefinition, Type: T): CustomAttributeType<T>;\n  getDefinition<T extends Constructable>(Type: T): CustomAttributeDefinition<T>;\n  annotate<K extends keyof PartialCustomAttributeDefinition>(Type: Constructable, prop: K, value: PartialCustomAttributeDefinition[K]): void;\n  getAnnotation<K extends keyof PartialCustomAttributeDefinition>(Type: Constructable, prop: K): PartialCustomAttributeDefinition[K];\n};\n\nexport type CustomAttributeDecorator = <T extends Constructable>(Type: T) => CustomAttributeType<T>;\n\n/**\n * Decorator: Indicates that the decorated class is a custom attribute.\n */\nexport function customAttribute(definition: PartialCustomAttributeDefinition): CustomAttributeDecorator;\nexport function customAttribute(name: string): CustomAttributeDecorator;\nexport function customAttribute(nameOrDef: string | PartialCustomAttributeDefinition): CustomAttributeDecorator;\nexport function customAttribute(nameOrDef: string | PartialCustomAttributeDefinition): CustomAttributeDecorator {\n  return function (target) {\n    return CustomAttribute.define(nameOrDef, target);\n  };\n}\n\n/**\n * Decorator: Applied to custom attributes. Indicates that whatever element the\n * attribute is placed on should be converted into a template and that this\n * attribute controls the instantiation of the template.\n */\nexport function templateController(definition: Omit<PartialCustomAttributeDefinition, 'isTemplateController'>): CustomAttributeDecorator;\nexport function templateController(name: string): CustomAttributeDecorator;\nexport function templateController(nameOrDef: string | Omit<PartialCustomAttributeDefinition, 'isTemplateController'>): CustomAttributeDecorator;\nexport function templateController(nameOrDef: string | Omit<PartialCustomAttributeDefinition, 'isTemplateController'>): CustomAttributeDecorator {\n  return function (target) {\n    return CustomAttribute.define(\n      typeof nameOrDef === 'string'\n        ? { isTemplateController: true, name: nameOrDef }\n        : { isTemplateController: true, ...nameOrDef },\n      target\n    );\n  };\n}\n\nexport class CustomAttributeDefinition<T extends Constructable = Constructable> implements ResourceDefinition<T, ICustomAttributeViewModel, PartialCustomAttributeDefinition> {\n  private constructor(\n    public readonly Type: CustomAttributeType<T>,\n    public readonly name: string,\n    public readonly aliases: readonly string[],\n    public readonly key: string,\n    public readonly defaultBindingMode: BindingMode,\n    public readonly isTemplateController: boolean,\n    public readonly bindables: Record<string, BindableDefinition>,\n    public readonly noMultiBindings: boolean,\n    public readonly watches: IWatchDefinition[],\n  ) {}\n\n  public static create<T extends Constructable = Constructable>(\n    nameOrDef: string | PartialCustomAttributeDefinition,\n    Type: CustomAttributeType<T>,\n  ): CustomAttributeDefinition<T> {\n\n    let name: string;\n    let def: PartialCustomAttributeDefinition;\n    if (typeof nameOrDef === 'string') {\n      name = nameOrDef;\n      def = { name };\n    } else {\n      name = nameOrDef.name;\n      def = nameOrDef;\n    }\n\n    return new CustomAttributeDefinition(\n      Type,\n      firstDefined(CustomAttribute.getAnnotation(Type, 'name'), name),\n      mergeArrays(CustomAttribute.getAnnotation(Type, 'aliases'), def.aliases, Type.aliases),\n      CustomAttribute.keyFrom(name),\n      firstDefined(CustomAttribute.getAnnotation(Type, 'defaultBindingMode'), def.defaultBindingMode, Type.defaultBindingMode, BindingMode.toView),\n      firstDefined(CustomAttribute.getAnnotation(Type, 'isTemplateController'), def.isTemplateController, Type.isTemplateController, false),\n      Bindable.from(...Bindable.getAll(Type), CustomAttribute.getAnnotation(Type, 'bindables'), Type.bindables, def.bindables),\n      firstDefined(CustomAttribute.getAnnotation(Type, 'noMultiBindings'), def.noMultiBindings, Type.noMultiBindings, false),\n      mergeArrays(Watch.getAnnotation(Type), Type.watches),\n    );\n  }\n\n  public register(container: IContainer): void {\n    const { Type, key, aliases } = this;\n    Registration.transient(key, Type).register(container);\n    Registration.aliasTo(key, Type).register(container);\n    registerAliases(aliases, CustomAttribute, key, container);\n  }\n}\n\nexport const CustomAttribute: CustomAttributeKind = {\n  name: Protocol.resource.keyFor('custom-attribute'),\n  keyFrom(name: string): string {\n    return `${CustomAttribute.name}:${name}`;\n  },\n  isType<T>(value: T): value is (T extends Constructable ? CustomAttributeType<T> : never) {\n    return typeof value === 'function' && Metadata.hasOwn(CustomAttribute.name, value);\n  },\n  for<C extends ICustomAttributeViewModel = ICustomAttributeViewModel>(node: Node, name: string): ICustomAttributeController<C> | undefined {\n    return (getRef(node, CustomAttribute.keyFrom(name)) ?? void 0) as ICustomAttributeController<C> | undefined;\n  },\n  define<T extends Constructable>(nameOrDef: string | PartialCustomAttributeDefinition, Type: T): CustomAttributeType<T> {\n    const definition = CustomAttributeDefinition.create(nameOrDef, Type as Constructable);\n    Metadata.define(CustomAttribute.name, definition, definition.Type);\n    Metadata.define(CustomAttribute.name, definition, definition);\n    Protocol.resource.appendTo(Type, CustomAttribute.name);\n\n    return definition.Type as CustomAttributeType<T>;\n  },\n  getDefinition<T extends Constructable>(Type: T): CustomAttributeDefinition<T> {\n    const def = Metadata.getOwn(CustomAttribute.name, Type) as CustomAttributeDefinition<T>;\n    if (def === void 0) {\n      throw new Error(`No definition found for type ${Type.name}`);\n    }\n\n    return def;\n  },\n  annotate<K extends keyof PartialCustomAttributeDefinition>(Type: Constructable, prop: K, value: PartialCustomAttributeDefinition[K]): void {\n    Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n  },\n  getAnnotation<K extends keyof PartialCustomAttributeDefinition>(Type: Constructable, prop: K): PartialCustomAttributeDefinition[K] {\n    return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n  },\n};\n","import { Protocol, Metadata, emptyArray } from '@aurelia/kernel';\nimport type { Constructable } from '@aurelia/kernel';\nimport type { IConnectable } from '@aurelia/runtime';\n\nimport { CustomAttribute } from './resources/custom-attribute.js';\nimport { CustomElement } from './resources/custom-element.js';\n\nexport type IDepCollectionFn<TType extends object, TReturn = unknown> = (vm: TType, watcher: IConnectable) => TReturn;\nexport type IWatcherCallback<TType extends object, TValue = unknown>\n  = (this: TType, newValue: TValue, oldValue: TValue, vm: TType) => unknown;\n\nexport interface IWatchDefinition<T extends object = object> {\n  expression: PropertyKey | IDepCollectionFn<T>;\n  callback: keyof T | IWatcherCallback<T>;\n}\n\ntype AnyMethod<R = unknown> = (...args: unknown[]) => R;\ntype WatchClassDecorator<T extends object> = <K extends Constructable<T>>(target: K) => void;\ntype WatchMethodDecorator<T> = <R, K extends AnyMethod<R> = AnyMethod<R>>(target: T, key: string | symbol, descriptor: PropertyDescriptor) => PropertyDescriptor;\ntype MethodsOf<Type> = {\n  [Key in keyof Type]: Type[Key] extends AnyMethod ? Key : never\n}[keyof Type];\n\n// for\n//    @watch('some.expression', (v) => ...)\n//    @watch('some.expression', 'method')\n//    @watch(Symbol, (v) => ...)\n//    @watch(Symbol, 'method')\n//    @watch(a => ..., 'method')\n//    @watch(a => ..., v => ...)\n//    class A {\n//      method() {...}\n//    }\nexport function watch<T extends object, D = unknown>(\n  expressionOrPropertyAccessFn: PropertyKey,\n  changeHandlerOrCallback: MethodsOf<T> | IWatcherCallback<T, D>,\n): WatchClassDecorator<T>;\n\nexport function watch<T extends object, D = unknown>(\n  expressionOrPropertyAccessFn: IDepCollectionFn<T, D>,\n  changeHandlerOrCallback: MethodsOf<T> | IWatcherCallback<T, D>,\n): WatchClassDecorator<T>;\n\n// for\n// class A {\n//    @watch('some.expression')\n//    @watch(Symbol)\n//    @watch(a => ...)\n//    method() {...}\n// }\nexport function watch<T extends object = object, D = unknown>(\n  expressionOrPropertyAccessFn: PropertyKey | IDepCollectionFn<T, D>\n): WatchMethodDecorator<T>;\n\nexport function watch<T extends object = object>(\n  expressionOrPropertyAccessFn: PropertyKey | IDepCollectionFn<object>,\n  changeHandlerOrCallback?: PropertyKey | IWatcherCallback<T>,\n): WatchClassDecorator<T> | WatchMethodDecorator<T> {\n  if (!expressionOrPropertyAccessFn) {\n    throw new Error('Invalid watch config. Expected an expression or a fn');\n  }\n\n  return function decorator(\n    target: Constructable<T> | Constructable<T>['prototype'],\n    key?: PropertyKey,\n    descriptor?: PropertyDescriptor,\n  ): void {\n    const isClassDecorator = key == null;\n    const Type = isClassDecorator ? target : target.constructor;\n    const watchDef = new WatchDefinition(expressionOrPropertyAccessFn, isClassDecorator ? changeHandlerOrCallback : descriptor!.value);\n\n    // basic validation\n    if (isClassDecorator) {\n      if (typeof changeHandlerOrCallback !== 'function'\n        && (changeHandlerOrCallback == null || !(changeHandlerOrCallback in Type.prototype))\n      ) {\n        throw new Error(`Invalid change handler config. Method \"${String(changeHandlerOrCallback)}\" not found in class ${Type.name}`);\n      }\n    } else if (typeof descriptor?.value !== 'function') {\n      throw new Error(`decorated target ${String(key)} is not a class method.`);\n    }\n\n    Watch.add(Type, watchDef);\n\n    // if the code looks like this:\n    // @watch(...)\n    // @customAttribute(...)\n    // class Abc {}\n    //\n    // then @watch is called after @customAttribute\n    // which means the attribute definition won't have the watch definition\n    //\n    // temporarily works around this order sensitivity by manually add the watch def\n    // manual\n    if (CustomAttribute.isType(Type)) {\n      CustomAttribute.getDefinition(Type).watches.push(watchDef);\n    }\n    if (CustomElement.isType(Type)) {\n      CustomElement.getDefinition(Type).watches.push(watchDef);\n    }\n  };\n}\n\nclass WatchDefinition<T extends object> implements IWatchDefinition<T> {\n  public constructor(\n    public expression: PropertyKey | IDepCollectionFn<T>,\n    public callback: IWatcherCallback<T>,\n  ) {}\n}\n\nconst noDefinitions: IWatchDefinition[] = emptyArray;\nexport const Watch = {\n  name: Protocol.annotation.keyFor('watch'),\n  add(Type: Constructable, definition: IWatchDefinition): void {\n    let watchDefinitions: IWatchDefinition[] = Metadata.getOwn(Watch.name, Type);\n    if (watchDefinitions == null) {\n      Metadata.define(Watch.name, watchDefinitions = [], Type);\n    }\n    watchDefinitions.push(definition);\n  },\n  getAnnotation(Type: Constructable): IWatchDefinition[] {\n    return Metadata.getOwn(Watch.name, Type) ?? noDefinitions;\n  },\n};\n","import {\n  DI,\n  Registration,\n  Protocol,\n  Metadata,\n  mergeArrays,\n  fromDefinitionOrDefault,\n  pascalCase,\n  fromAnnotationOrTypeOrDefault,\n  fromAnnotationOrDefinitionOrTypeOrDefault,\n  emptyArray,\n} from '@aurelia/kernel';\nimport { registerAliases } from '@aurelia/runtime';\nimport { Bindable } from '../bindable.js';\nimport { getEffectiveParentNode, getRef } from '../dom.js';\nimport { Children } from '../templating/children.js';\nimport { Watch } from '../watch.js';\n\nimport type {\n  Constructable,\n  IContainer,\n  IResourceKind,\n  ResourceType,\n  PartialResourceDefinition,\n  Key,\n  ResourceDefinition,\n  Injectable,\n  IResolver,\n  Writable,\n} from '@aurelia/kernel';\nimport type { BindableDefinition, PartialBindableDefinition } from '../bindable.js';\nimport type { INode } from '../dom.js';\nimport type { PartialChildrenDefinition, ChildrenDefinition } from '../templating/children.js';\nimport type { Controller, ICustomElementViewModel, ICustomElementController } from '../templating/controller.js';\nimport type { IPlatform } from '../platform.js';\nimport type { IInstruction } from '../renderer.js';\nimport type { IWatchDefinition } from '../watch.js';\n\ndeclare module '@aurelia/kernel' {\n  interface IContainer {\n    find<T extends ICustomElementViewModel>(kind: CustomElementKind, name: string): CustomElementDefinition<Constructable<T>> | null;\n  }\n}\n\nexport type PartialCustomElementDefinition = PartialResourceDefinition<{\n  readonly cache?: '*' | number;\n  readonly template?: null | string | Node;\n  readonly instructions?: readonly (readonly IInstruction[])[];\n  readonly dependencies?: readonly Key[];\n  readonly injectable?: InjectableToken | null;\n  readonly needsCompile?: boolean;\n  readonly surrogates?: readonly IInstruction[];\n  readonly bindables?: Record<string, PartialBindableDefinition> | readonly string[];\n  readonly childrenObservers?: Record<string, PartialChildrenDefinition>;\n  readonly containerless?: boolean;\n  readonly isStrictBinding?: boolean;\n  readonly shadowOptions?: { mode: 'open' | 'closed' } | null;\n  readonly hasSlots?: boolean;\n  readonly enhance?: boolean;\n  readonly watches?: IWatchDefinition[];\n  readonly processContent?: ProcessContentHook | null;\n}>;\n\nexport type CustomElementType<C extends Constructable = Constructable> = ResourceType<C, ICustomElementViewModel & (C extends Constructable<infer P> ? P : {}), PartialCustomElementDefinition>;\nexport type CustomElementKind = IResourceKind<CustomElementType, CustomElementDefinition> & {\n  /**\n   * Returns the closest controller that is associated with either this node (if it is a custom element) or the first\n   * parent node (including containerless) that is a custom element.\n   *\n   * As long as the provided node was directly or indirectly created by Aurelia, this method is guaranteed to return a controller.\n   *\n   * @param node - The node relative to which to get the closest controller.\n   * @param searchParents - Also search the parent nodes (including containerless).\n   * @returns The closest controller relative to the provided node.\n   * @throws - If neither the node or any of its effective parent nodes host a custom element, an error will be thrown.\n   */\n  for<C extends ICustomElementViewModel = ICustomElementViewModel>(node: Node, opts: { searchParents: true }): ICustomElementController<C>;\n  /**\n   * Returns the controller that is associated with this node, if it is a custom element with the provided name.\n   *\n   * @param node - The node to retrieve the controller for, if it is a custom element with the provided name.\n   * @returns The controller associated with the provided node, if it is a custom element with the provided name, or otherwise `undefined`.\n   * @throws - If the node does not host a custom element, an error will be thrown.\n   */\n  for<C extends ICustomElementViewModel = ICustomElementViewModel>(node: Node, opts: { name: string }): ICustomElementController<C> | undefined;\n  /**\n   * Returns the closest controller that is associated with either this node (if it is a custom element) or the first\n   * parent node (including containerless) that is a custom element with the provided name.\n   *\n   * @param node - The node relative to which to get the closest controller of a custom element with the provided name.\n   * @param searchParents - Also search the parent nodes (including containerless).\n   * @returns The closest controller of a custom element with the provided name, relative to the provided node, if one can be found, or otherwise `undefined`.\n   * @throws - If neither the node or any of its effective parent nodes host a custom element, an error will be thrown.\n   */\n  for<C extends ICustomElementViewModel = ICustomElementViewModel>(node: Node, opts: { name: string; searchParents: true }): ICustomElementController<C> | undefined;\n  /**\n   * Returns the controller that is associated with this node, if it is a custom element.\n   *\n   * @param node - The node to retrieve the controller for, if it is a custom element.\n   * @param optional - If `true`, do not throw if the provided node is not a custom element.\n   * @returns The controller associated with the provided node, if it is a custom element\n   * @throws - If the node does not host a custom element, an error will be thrown.\n   */\n  for<C extends ICustomElementViewModel = ICustomElementViewModel>(node: Node): ICustomElementController<C>;\n  /**\n   * Returns the controller that is associated with this node, if it is a custom element.\n   *\n   * @param node - The node to retrieve the controller for, if it is a custom element.\n   * @param optional - If `true`, do not throw if the provided node is not a custom element.\n   * @returns The controller associated with the provided node, if it is a custom element, otherwise `null`\n   */\n  for<C extends ICustomElementViewModel = ICustomElementViewModel>(node: Node, opts: { optional: true }): ICustomElementController<C> | null;\n  isType<C>(value: C): value is (C extends Constructable ? CustomElementType<C> : never);\n  define<C extends Constructable >(name: string, Type: C): CustomElementType<C>;\n  define<C extends Constructable >(def: PartialCustomElementDefinition, Type: C): CustomElementType<C>;\n  define<C extends Constructable >(def: PartialCustomElementDefinition, Type?: null): CustomElementType<C>;\n  define<C extends Constructable >(nameOrDef: string | PartialCustomElementDefinition, Type: C): CustomElementType<C>;\n  getDefinition<C extends Constructable>(Type: C): CustomElementDefinition<C>;\n  annotate<K extends keyof PartialCustomElementDefinition>(Type: Constructable, prop: K, value: PartialCustomElementDefinition[K]): void;\n  getAnnotation<K extends keyof PartialCustomElementDefinition>(Type: Constructable, prop: K): PartialCustomElementDefinition[K];\n  generateName(): string;\n  createInjectable<T extends Key = Key>(): InjectableToken;\n  generateType<P extends {} = {}>(\n    name: string,\n    proto?: P,\n  ): CustomElementType<Constructable<P>>;\n};\n\nexport type CustomElementDecorator = <T extends Constructable>(Type: T) => CustomElementType<T>;\n\n/**\n * Decorator: Indicates that the decorated class is a custom element.\n */\nexport function customElement(definition: PartialCustomElementDefinition): CustomElementDecorator;\nexport function customElement(name: string): CustomElementDecorator;\nexport function customElement(nameOrDef: string | PartialCustomElementDefinition): CustomElementDecorator;\nexport function customElement(nameOrDef: string | PartialCustomElementDefinition): CustomElementDecorator {\n  return function (target) {\n    return CustomElement.define(nameOrDef, target);\n  };\n}\n\ntype ShadowOptions = Pick<PartialCustomElementDefinition, 'shadowOptions'>['shadowOptions'];\n\n/**\n * Decorator: Indicates that the custom element should render its view in ShadowDOM.\n */\nexport function useShadowDOM(options?: ShadowOptions): (target: Constructable) => void;\n/**\n * Decorator: Indicates that the custom element should render its view in ShadowDOM.\n */\nexport function useShadowDOM(target: Constructable): void;\nexport function useShadowDOM(targetOrOptions?: Constructable | ShadowOptions): void | ((target: Constructable) => void) {\n  if (targetOrOptions === void 0) {\n    return function ($target: Constructable) {\n      CustomElement.annotate($target, 'shadowOptions', { mode: 'open' });\n    };\n  }\n\n  if (typeof targetOrOptions !== 'function') {\n    return function ($target: Constructable) {\n      CustomElement.annotate($target, 'shadowOptions', targetOrOptions);\n    };\n  }\n\n  CustomElement.annotate(targetOrOptions, 'shadowOptions', { mode: 'open' });\n}\n\n/**\n * Decorator: Indicates that the custom element should be rendered without its element container.\n */\nexport function containerless(target: Constructable): void;\n/**\n * Decorator: Indicates that the custom element should be rendered without its element container.\n */\nexport function containerless(): (target: Constructable) => void;\nexport function containerless(target?: Constructable): void | ((target: Constructable) => void) {\n  if (target === void 0) {\n    return function ($target: Constructable) {\n      CustomElement.annotate($target, 'containerless', true);\n    };\n  }\n\n  CustomElement.annotate(target, 'containerless', true);\n}\n\n/**\n * Decorator: Indicates that the custom element should be rendered with the strict binding option. undefined/null -> 0 or '' based on type\n */\nexport function strict(target: Constructable): void;\n/**\n * Decorator: Indicates that the custom element should be rendered with the strict binding option. undefined/null -> 0 or '' based on type\n */\nexport function strict(): (target: Constructable) => void;\nexport function strict(target?: Constructable): void | ((target: Constructable) => void) {\n  if (target === void 0) {\n    return function ($target: Constructable) {\n      CustomElement.annotate($target, 'isStrictBinding', true);\n    };\n  }\n\n  CustomElement.annotate(target, 'isStrictBinding', true);\n}\n\nconst definitionLookup = new WeakMap<PartialCustomElementDefinition, CustomElementDefinition>();\n\nexport class CustomElementDefinition<C extends Constructable = Constructable> implements ResourceDefinition<C, ICustomElementViewModel, PartialCustomElementDefinition> {\n  private constructor(\n    public readonly Type: CustomElementType<C>,\n    public readonly name: string,\n    public readonly aliases: string[],\n    public readonly key: string,\n    public readonly cache: '*' | number,\n    public readonly template: null | string | Node,\n    public readonly instructions: readonly (readonly IInstruction[])[],\n    public readonly dependencies: readonly Key[],\n    public readonly injectable: InjectableToken<C> | null,\n    public readonly needsCompile: boolean,\n    public readonly surrogates: readonly IInstruction[],\n    public readonly bindables: Record<string, BindableDefinition>,\n    public readonly childrenObservers: Record<string, ChildrenDefinition>,\n    public readonly containerless: boolean,\n    public readonly isStrictBinding: boolean,\n    public readonly shadowOptions: { mode: 'open' | 'closed' } | null,\n    public readonly hasSlots: boolean,\n    public readonly enhance: boolean,\n    public readonly watches: IWatchDefinition[],\n    public readonly processContent: ProcessContentHook | null,\n  ) {}\n\n  public static create<T extends Constructable = Constructable>(\n    def: PartialCustomElementDefinition,\n    Type?: null,\n  ): CustomElementDefinition;\n  public static create<T extends Constructable = Constructable>(\n    name: string,\n    Type: CustomElementType,\n  ): CustomElementDefinition;\n  public static create<T extends Constructable = Constructable>(\n    nameOrDef: string | PartialCustomElementDefinition,\n    Type?: CustomElementType | null,\n  ): CustomElementDefinition;\n  public static create<T extends Constructable = Constructable>(\n    nameOrDef: string | PartialCustomElementDefinition,\n    Type: CustomElementType | null = null,\n  ): CustomElementDefinition {\n    if (Type === null) {\n      const def = nameOrDef;\n      if (typeof def === 'string') {\n        throw new Error(`Cannot create a custom element definition with only a name and no type: ${nameOrDef}`);\n      }\n\n      const name = fromDefinitionOrDefault('name', def, CustomElement.generateName);\n      if (typeof (def as CustomElementDefinition).Type === 'function') {\n        // This needs to be a clone (it will usually be the compiler calling this signature)\n\n        // TODO: we need to make sure it's documented that passing in the type via the definition (while passing in null\n        // as the \"Type\" parameter) effectively skips type analysis, so it should only be used this way for cloning purposes.\n        Type = (def as CustomElementDefinition).Type as CustomElementType;\n      } else {\n        Type = CustomElement.generateType(pascalCase(name)) as CustomElementType;\n      }\n\n      return new CustomElementDefinition(\n        Type,\n        name,\n        mergeArrays(def.aliases),\n        fromDefinitionOrDefault('key', def as CustomElementDefinition, () => CustomElement.keyFrom(name)),\n        fromDefinitionOrDefault('cache', def, () => 0),\n        fromDefinitionOrDefault('template', def, () => null),\n        mergeArrays(def.instructions),\n        mergeArrays(def.dependencies),\n        fromDefinitionOrDefault('injectable', def, () => null),\n        fromDefinitionOrDefault('needsCompile', def, () => true),\n        mergeArrays(def.surrogates),\n        Bindable.from(def.bindables),\n        Children.from(def.childrenObservers),\n        fromDefinitionOrDefault('containerless', def, () => false),\n        fromDefinitionOrDefault('isStrictBinding', def, () => false),\n        fromDefinitionOrDefault('shadowOptions', def, () => null),\n        fromDefinitionOrDefault('hasSlots', def, () => false),\n        fromDefinitionOrDefault('enhance', def, () => false),\n        fromDefinitionOrDefault('watches', def as CustomElementDefinition, () => emptyArray),\n        fromAnnotationOrTypeOrDefault('processContent', Type, () => null),\n      );\n    }\n\n    // If a type is passed in, we ignore the Type property on the definition if it exists.\n    // TODO: document this behavior\n\n    if (typeof nameOrDef === 'string') {\n      return new CustomElementDefinition(\n        Type,\n        nameOrDef,\n        mergeArrays(CustomElement.getAnnotation(Type, 'aliases'), Type.aliases),\n        CustomElement.keyFrom(nameOrDef),\n        fromAnnotationOrTypeOrDefault('cache', Type, () => 0),\n        fromAnnotationOrTypeOrDefault('template', Type, () => null),\n        mergeArrays(CustomElement.getAnnotation(Type, 'instructions'), Type.instructions),\n        mergeArrays(CustomElement.getAnnotation(Type, 'dependencies'), Type.dependencies),\n        fromAnnotationOrTypeOrDefault('injectable', Type, () => null),\n        fromAnnotationOrTypeOrDefault('needsCompile', Type, () => true),\n        mergeArrays(CustomElement.getAnnotation(Type, 'surrogates'), Type.surrogates),\n        Bindable.from(\n          ...Bindable.getAll(Type),\n          CustomElement.getAnnotation(Type, 'bindables'),\n          Type.bindables,\n        ),\n        Children.from(\n          ...Children.getAll(Type),\n          CustomElement.getAnnotation(Type, 'childrenObservers'),\n          Type.childrenObservers,\n        ),\n        fromAnnotationOrTypeOrDefault('containerless', Type, () => false),\n        fromAnnotationOrTypeOrDefault('isStrictBinding', Type, () => false),\n        fromAnnotationOrTypeOrDefault('shadowOptions', Type, () => null),\n        fromAnnotationOrTypeOrDefault('hasSlots', Type, () => false),\n        fromAnnotationOrTypeOrDefault('enhance', Type, () => false),\n        mergeArrays(Watch.getAnnotation(Type), Type.watches),\n        fromAnnotationOrTypeOrDefault('processContent', Type, () => null),\n      );\n    }\n\n    // This is the typical default behavior, e.g. from regular CustomElement.define invocations or from @customElement deco\n    // The ViewValueConverter also uses this signature and passes in a definition where everything except for the 'hooks'\n    // property needs to be copied. So we have that exception for 'hooks', but we may need to revisit that default behavior\n    // if this turns out to be too opinionated.\n\n    const name = fromDefinitionOrDefault('name', nameOrDef, CustomElement.generateName);\n    return new CustomElementDefinition(\n      Type,\n      name,\n      mergeArrays(CustomElement.getAnnotation(Type, 'aliases'), nameOrDef.aliases, Type.aliases),\n      CustomElement.keyFrom(name),\n      fromAnnotationOrDefinitionOrTypeOrDefault('cache', nameOrDef, Type, () => 0),\n      fromAnnotationOrDefinitionOrTypeOrDefault('template', nameOrDef, Type, () => null),\n      mergeArrays(CustomElement.getAnnotation(Type, 'instructions'), nameOrDef.instructions, Type.instructions),\n      mergeArrays(CustomElement.getAnnotation(Type, 'dependencies'), nameOrDef.dependencies, Type.dependencies),\n      fromAnnotationOrDefinitionOrTypeOrDefault('injectable', nameOrDef, Type, () => null),\n      fromAnnotationOrDefinitionOrTypeOrDefault('needsCompile', nameOrDef, Type, () => true),\n      mergeArrays(CustomElement.getAnnotation(Type, 'surrogates'), nameOrDef.surrogates, Type.surrogates),\n      Bindable.from(\n        ...Bindable.getAll(Type),\n        CustomElement.getAnnotation(Type, 'bindables'),\n        Type.bindables,\n        nameOrDef.bindables,\n      ),\n      Children.from(\n        ...Children.getAll(Type),\n        CustomElement.getAnnotation(Type, 'childrenObservers'),\n        Type.childrenObservers,\n        nameOrDef.childrenObservers,\n      ),\n      fromAnnotationOrDefinitionOrTypeOrDefault('containerless', nameOrDef, Type, () => false),\n      fromAnnotationOrDefinitionOrTypeOrDefault('isStrictBinding', nameOrDef, Type, () => false),\n      fromAnnotationOrDefinitionOrTypeOrDefault('shadowOptions', nameOrDef, Type, () => null),\n      fromAnnotationOrDefinitionOrTypeOrDefault('hasSlots', nameOrDef, Type, () => false),\n      fromAnnotationOrDefinitionOrTypeOrDefault('enhance', nameOrDef, Type, () => false),\n      mergeArrays(nameOrDef.watches, Watch.getAnnotation(Type), Type.watches),\n      fromAnnotationOrDefinitionOrTypeOrDefault('processContent', nameOrDef, Type, () => null),\n    );\n  }\n\n  public static getOrCreate(partialDefinition: PartialCustomElementDefinition): CustomElementDefinition {\n    if (partialDefinition instanceof CustomElementDefinition) {\n      return partialDefinition;\n    }\n\n    if (definitionLookup.has(partialDefinition)) {\n      return definitionLookup.get(partialDefinition)!;\n    }\n\n    const definition = CustomElementDefinition.create(partialDefinition);\n    definitionLookup.set(partialDefinition, definition);\n    // Make sure the full definition can be retrieved from dynamically created classes as well\n    Metadata.define(CustomElement.name, definition, definition.Type);\n    return definition;\n  }\n\n  public register(container: IContainer): void {\n    const { Type, key, aliases } = this;\n    if (!container.has(key, false)) {\n      Registration.transient(key, Type).register(container);\n      Registration.aliasTo(key, Type).register(container);\n      registerAliases(aliases, CustomElement, key, container);\n    }\n  }\n}\n\nexport type InjectableToken<K = any> = (target: Injectable<K>, property: string, index: number) => void;\ntype InternalInjectableToken<K = any> = InjectableToken<K> & {\n  register?(container: IContainer): IResolver<K>;\n};\n\ntype ForOpts = {\n  name?: string;\n  searchParents?: boolean;\n  optional?: boolean;\n};\nconst defaultForOpts: ForOpts = {\n  name: undefined,\n  searchParents: false,\n  optional: false,\n};\n\nexport const CustomElement: CustomElementKind = {\n  name: Protocol.resource.keyFor('custom-element'),\n  keyFrom(name: string): string {\n    return `${CustomElement.name}:${name}`;\n  },\n  isType<C>(value: C): value is (C extends Constructable ? CustomElementType<C> : never) {\n    return typeof value === 'function' && Metadata.hasOwn(CustomElement.name, value);\n  },\n  for<C extends ICustomElementViewModel = ICustomElementViewModel>(node: Node, opts: ForOpts = defaultForOpts): ICustomElementController<C> {\n    if (opts.name === void 0 && opts.searchParents !== true) {\n      const controller = getRef(node, CustomElement.name) as Controller<C> | null;\n      if (controller === null) {\n        if (opts.optional === true) {\n          return null!;\n        }\n        throw new Error(`The provided node is not a custom element or containerless host.`);\n      }\n      return controller as unknown as ICustomElementController<C>;\n    }\n    if (opts.name !== void 0) {\n      if (opts.searchParents !== true) {\n        const controller = getRef(node, CustomElement.name) as Controller<C> | null;\n        if (controller === null) {\n          throw new Error(`The provided node is not a custom element or containerless host.`);\n        }\n\n        if (controller.is(opts.name)) {\n          return controller as unknown as ICustomElementController<C>;\n        }\n\n        return (void 0)!;\n      }\n\n      let cur = node as INode | null;\n      let foundAController = false;\n      while (cur !== null) {\n        const controller = getRef(cur, CustomElement.name) as Controller<C> | null;\n        if (controller !== null) {\n          foundAController = true;\n          if (controller.is(opts.name)) {\n            return controller as unknown as ICustomElementController<C>;\n          }\n        }\n\n        cur = getEffectiveParentNode(cur);\n      }\n\n      if (foundAController) {\n        return (void 0)!;\n      }\n\n      throw new Error(`The provided node does does not appear to be part of an Aurelia app DOM tree, or it was added to the DOM in a way that Aurelia cannot properly resolve its position in the component tree.`);\n    }\n\n    let cur = node as INode | null;\n    while (cur !== null) {\n      const controller = getRef(cur, CustomElement.name) as Controller<C> | null;\n      if (controller !== null) {\n        return controller as unknown as ICustomElementController<C>;\n      }\n\n      cur = getEffectiveParentNode(cur);\n    }\n\n    throw new Error(`The provided node does does not appear to be part of an Aurelia app DOM tree, or it was added to the DOM in a way that Aurelia cannot properly resolve its position in the component tree.`);\n  },\n  define<C extends Constructable>(nameOrDef: string | PartialCustomElementDefinition, Type?: C | null): CustomElementType<C> {\n    const definition = CustomElementDefinition.create(nameOrDef, Type as Constructable | null);\n    Metadata.define(CustomElement.name, definition, definition.Type);\n    Metadata.define(CustomElement.name, definition, definition);\n    Protocol.resource.appendTo(definition.Type, CustomElement.name);\n\n    return definition.Type as CustomElementType<C>;\n  },\n  getDefinition<C extends Constructable>(Type: C): CustomElementDefinition<C> {\n    const def = Metadata.getOwn(CustomElement.name, Type) as CustomElementDefinition<C>;\n    if (def === void 0) {\n      throw new Error(`No definition found for type ${Type.name}`);\n    }\n\n    return def;\n  },\n  annotate<K extends keyof PartialCustomElementDefinition>(Type: Constructable, prop: K, value: PartialCustomElementDefinition[K]): void {\n    Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n  },\n  getAnnotation<K extends keyof PartialCustomElementDefinition>(Type: Constructable, prop: K): PartialCustomElementDefinition[K] {\n    return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n  },\n  generateName: (function () {\n    let id = 0;\n\n    return function () {\n      return `unnamed-${++id}`;\n    };\n  })(),\n  createInjectable<K extends Key = Key>(): InjectableToken<K> {\n    const $injectable: InternalInjectableToken<K> = function (target, property, index): any {\n      const annotationParamtypes = DI.getOrCreateAnnotationParamTypes(target);\n      annotationParamtypes[index] = $injectable;\n      return target;\n    };\n\n    $injectable.register = function (container) {\n      // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n      return {\n        resolve(container, requestor) {\n          if (requestor.has($injectable, true)) {\n            return requestor.get($injectable);\n          } else {\n            return null;\n          }\n        },\n      } as IResolver;\n    };\n\n    return $injectable;\n  },\n  generateType: (function () {\n    const nameDescriptor: PropertyDescriptor = {\n      value: '',\n      writable: false,\n      enumerable: false,\n      configurable: true,\n    };\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const defaultProto = {} as any;\n\n    return function <P extends {} = {}> (\n      name: string,\n      proto: P = defaultProto,\n    ): CustomElementType<Constructable<P>> {\n      // Anonymous class ensures that minification cannot cause unintended side-effects, and keeps the class\n      // looking similarly from the outside (when inspected via debugger, etc).\n      const Type = class {} as CustomElementType<Constructable<P>>;\n\n      // Define the name property so that Type.name can be used by end users / plugin authors if they really need to,\n      // even when minified.\n      nameDescriptor.value = name;\n      Reflect.defineProperty(Type, 'name', nameDescriptor);\n\n      // Assign anything from the prototype that was passed in\n      if (proto !== defaultProto) {\n        Object.assign(Type.prototype, proto);\n      }\n\n      return Type;\n    };\n  })(),\n};\n\ntype DecoratorFactoryMethod<TClass> = (target: Constructable<TClass>, propertyKey: string, descriptor: PropertyDescriptor) => void;\ntype ProcessContentHook = (node: INode, platform: IPlatform) => boolean | void;\n\nconst pcHookMetadataProperty = Protocol.annotation.keyFor('processContent');\nexport function processContent(hook: ProcessContentHook): CustomElementDecorator;\nexport function processContent<TClass>(): DecoratorFactoryMethod<TClass>;\nexport function processContent<TClass>(hook?: ProcessContentHook): CustomElementDecorator | DecoratorFactoryMethod<TClass> {\n  return hook === void 0\n    ? function (target: Constructable<TClass>, propertyKey: string, _descriptor: PropertyDescriptor) {\n      Metadata.define(pcHookMetadataProperty, ensureHook(target, propertyKey), target);\n    }\n    : function (target: Constructable<TClass>) {\n      hook = ensureHook(target, hook!);\n      const def = Metadata.getOwn(CustomElement.name, target) as CustomElementDefinition<Constructable<TClass>>;\n      if (def !== void 0) {\n        (def as Writable<CustomElementDefinition<Constructable<TClass>>>).processContent = hook;\n      } else {\n        Metadata.define(pcHookMetadataProperty, hook, target);\n      }\n      return target;\n    };\n}\n\nfunction ensureHook<TClass>(target: Constructable<TClass>, hook: string | ProcessContentHook): ProcessContentHook {\n  if (typeof hook === 'string') {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-explicit-any\n    hook = (target as any)[hook] as ProcessContentHook;\n  }\n\n  const hookType = typeof hook;\n  if (hookType !== 'function') {\n    throw new Error(`Invalid @processContent hook. Expected the hook to be a function (when defined in a class, it needs to be a static function) but got a ${hookType}.`);\n  }\n  return hook;\n}\n","import { DI, Metadata, Protocol } from '@aurelia/kernel';\nimport { Scope } from '@aurelia/runtime';\nimport { CustomElement, CustomElementDefinition } from '../resources/custom-element.js';\nimport { Controller } from './controller.js';\n\nimport type { Constructable, ConstructableClass, IContainer } from '@aurelia/kernel';\nimport type { LifecycleFlags } from '@aurelia/runtime';\nimport type {\n  ICustomElementViewModel,\n  ISyntheticView,\n  IDryCustomElementController,\n  IContextualCustomElementController,\n  ICompiledCustomElementController,\n  ICustomElementController,\n  ICustomAttributeController,\n  IHydratedController,\n  IHydratedParentController,\n} from './controller.js';\nimport type { IRenderContext } from './render-context.js';\nimport type { PartialCustomElementDefinition } from '../resources/custom-element.js';\n\nexport interface IViewFactory extends ViewFactory {}\nexport const IViewFactory = DI.createInterface<IViewFactory>('IViewFactory');\nexport class ViewFactory implements IViewFactory {\n  public static maxCacheSize: number = 0xFFFF;\n\n  public readonly container: IContainer;\n  public isCaching: boolean = false;\n\n  private cache: ISyntheticView[] = null!;\n  private cacheSize: number = -1;\n\n  public constructor(\n    public name: string,\n    public readonly context: IRenderContext,\n  ) {\n    this.container = context.container;\n  }\n\n  public setCacheSize(size: number | '*', doNotOverrideIfAlreadySet: boolean): void {\n    if (size) {\n      if (size === '*') {\n        size = ViewFactory.maxCacheSize;\n      } else if (typeof size === 'string') {\n        size = parseInt(size, 10);\n      }\n\n      if (this.cacheSize === -1 || !doNotOverrideIfAlreadySet) {\n        this.cacheSize = size;\n      }\n    }\n\n    if (this.cacheSize > 0) {\n      this.cache = [];\n    } else {\n      this.cache = null!;\n    }\n\n    this.isCaching = this.cacheSize > 0;\n  }\n\n  public canReturnToCache(controller: ISyntheticView): boolean {\n    return this.cache != null && this.cache.length < this.cacheSize;\n  }\n\n  public tryReturnToCache(controller: ISyntheticView): boolean {\n    if (this.canReturnToCache(controller)) {\n      this.cache.push(controller);\n      return true;\n    }\n\n    return false;\n  }\n\n  public create(\n    flags?: LifecycleFlags,\n    parentController?: ISyntheticView | ICustomElementController | ICustomAttributeController | undefined,\n  ): ISyntheticView {\n    const cache = this.cache;\n    let controller: ISyntheticView;\n\n    if (cache != null && cache.length > 0) {\n      controller = cache.pop()!;\n      return controller;\n    }\n\n    controller = Controller.forSyntheticView(null, this.context, this, flags, parentController);\n    return controller;\n  }\n}\n\nconst seenViews = new WeakSet();\nfunction notYetSeen($view: PartialCustomElementDefinition): boolean {\n  return !seenViews.has($view);\n}\nfunction toCustomElementDefinition($view: PartialCustomElementDefinition): CustomElementDefinition {\n  seenViews.add($view);\n  return CustomElementDefinition.create($view);\n}\n\nexport const Views = {\n  name: Protocol.resource.keyFor('views'),\n  has(value: object): boolean {\n    return typeof value === 'function' && (Metadata.hasOwn(Views.name, value) || '$views' in value);\n  },\n  get(value: object | Constructable): readonly CustomElementDefinition[] {\n    if (typeof value === 'function' && '$views' in value) {\n      // TODO: a `get` operation with side effects is not a good thing. Should refactor this to a proper resource kind.\n      const $views = (value as { $views: PartialCustomElementDefinition[] }).$views;\n      const definitions = $views.filter(notYetSeen).map(toCustomElementDefinition);\n      for (const def of definitions) {\n        Views.add(value, def);\n      }\n    }\n    let views = Metadata.getOwn(Views.name, value) as CustomElementDefinition[] | undefined;\n    if (views === void 0) {\n      Metadata.define(Views.name, views = [], value);\n    }\n    return views;\n  },\n  add<T extends Constructable>(Type: T, partialDefinition: PartialCustomElementDefinition): readonly CustomElementDefinition[] {\n    const definition = CustomElementDefinition.create(partialDefinition);\n    let views = Metadata.getOwn(Views.name, Type) as CustomElementDefinition[] | undefined;\n    if (views === void 0) {\n      Metadata.define(Views.name, views = [definition], Type);\n    } else {\n      views.push(definition);\n    }\n    return views;\n  },\n};\n\nexport function view(v: PartialCustomElementDefinition) {\n  return function<T extends Constructable> (target: T) {\n    Views.add(target, v);\n  };\n}\n\nexport type ClassInstance<T> = T & {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  readonly constructor: Function;\n};\n\nexport type ViewSelector = (object: ICustomElementViewModel, views: readonly PartialCustomElementDefinition[]) => string;\nexport type ComposableObjectComponentType<T extends ICustomElementViewModel>\n  = ConstructableClass<{ viewModel: T } & ICustomElementViewModel>;\n\nexport const IViewLocator = DI.createInterface<IViewLocator>('IViewLocator', x => x.singleton(ViewLocator));\nexport interface IViewLocator extends ViewLocator {}\n\nexport class ViewLocator {\n  private readonly modelInstanceToBoundComponent: WeakMap<object, Record<string, ComposableObjectComponentType<ICustomElementViewModel>>> = new WeakMap();\n  private readonly modelTypeToUnboundComponent: Map<object, Record<string, ComposableObjectComponentType<ICustomElementViewModel>>> = new Map();\n\n  public getViewComponentForObject<T extends ClassInstance<ICustomElementViewModel>>(\n    object: T | null | undefined,\n    viewNameOrSelector?: string | ViewSelector\n  ): ComposableObjectComponentType<T> | null {\n    if (object) {\n      const availableViews = Views.has(object.constructor) ? Views.get(object.constructor) : [];\n      const resolvedViewName = typeof viewNameOrSelector === 'function'\n        ? viewNameOrSelector(object, availableViews)\n        : this.getViewName(availableViews, viewNameOrSelector);\n\n      return this.getOrCreateBoundComponent(\n        object,\n        availableViews,\n        resolvedViewName\n      );\n    }\n\n    return null;\n  }\n\n  private getOrCreateBoundComponent<T extends ClassInstance<ICustomElementViewModel>>(\n    object: T,\n    availableViews: readonly CustomElementDefinition[],\n    resolvedViewName: string\n  ): ComposableObjectComponentType<T> {\n    let lookup = this.modelInstanceToBoundComponent.get(object);\n    let BoundComponent: ComposableObjectComponentType<T> | undefined;\n\n    if (lookup === void 0) {\n      lookup = {};\n      this.modelInstanceToBoundComponent.set(object, lookup);\n    } else {\n      BoundComponent = lookup[resolvedViewName] as ComposableObjectComponentType<T>;\n    }\n\n    if (BoundComponent === void 0) {\n      const UnboundComponent = this.getOrCreateUnboundComponent(\n        object,\n        availableViews,\n        resolvedViewName\n      );\n\n      BoundComponent = CustomElement.define<ComposableObjectComponentType<T>>(\n        CustomElement.getDefinition(UnboundComponent),\n        class extends UnboundComponent {\n          public constructor() {\n            super(object);\n          }\n        }\n      );\n\n      lookup[resolvedViewName] = BoundComponent;\n    }\n\n    return BoundComponent;\n  }\n\n  private getOrCreateUnboundComponent<T extends ClassInstance<ICustomElementViewModel>>(\n    object: T,\n    availableViews: readonly CustomElementDefinition[],\n    resolvedViewName: string\n  ): ComposableObjectComponentType<T> {\n    let lookup = this.modelTypeToUnboundComponent.get(object.constructor);\n    let UnboundComponent: ComposableObjectComponentType<T> | undefined;\n\n    if (lookup === void 0) {\n      lookup = {};\n      this.modelTypeToUnboundComponent.set(object.constructor, lookup);\n    } else {\n      UnboundComponent = lookup[resolvedViewName] as ComposableObjectComponentType<T>;\n    }\n\n    if (UnboundComponent === void 0) {\n      UnboundComponent = CustomElement.define<ComposableObjectComponentType<T>>(\n        this.getView(availableViews, resolvedViewName),\n        class {\n          public constructor(public viewModel: T) {}\n\n          public define(\n            controller: IDryCustomElementController<T>,\n            parentContainer: IContainer,\n            definition: CustomElementDefinition,\n          ): PartialCustomElementDefinition | void {\n            const vm = this.viewModel;\n            controller.scope = Scope.fromParent(controller.scope, vm);\n\n            if (vm.define !== void 0) {\n              return vm.define(controller, parentContainer, definition);\n            }\n          }\n        }\n      );\n\n      const proto = UnboundComponent.prototype;\n\n      if ('hydrating' in object) {\n        proto.hydrating = function hydrating(\n          controller: IContextualCustomElementController,\n        ): void {\n          this.viewModel.hydrating!(controller as IContextualCustomElementController<T>);\n        };\n      }\n      if ('hydrated' in object) {\n        proto.hydrated = function hydrated(\n          controller: ICompiledCustomElementController,\n        ): void {\n          this.viewModel.hydrated!(controller as ICompiledCustomElementController<T>);\n        };\n      }\n      if ('created' in object) {\n        proto.created = function created(\n          controller: ICustomElementController,\n        ): void {\n          this.viewModel.created!(controller as ICustomElementController<T>);\n        };\n      }\n\n      if ('binding' in object) {\n        proto.binding = function binding(\n          initiator: IHydratedController,\n          parent: IHydratedParentController | null,\n          flags: LifecycleFlags,\n        ): void | Promise<void> {\n          return this.viewModel.binding!(initiator, parent, flags);\n        };\n      }\n      if ('bound' in object) {\n        proto.bound = function bound(\n          initiator: IHydratedController,\n          parent: IHydratedParentController | null,\n          flags: LifecycleFlags,\n        ): void | Promise<void> {\n          return this.viewModel.bound!(initiator, parent, flags);\n        };\n      }\n      if ('attaching' in object) {\n        proto.attaching = function attaching(\n          initiator: IHydratedController,\n          parent: IHydratedParentController | null,\n          flags: LifecycleFlags,\n        ): void | Promise<void> {\n          return this.viewModel.attaching!(initiator, parent, flags);\n        };\n      }\n      if ('attached' in object) {\n        proto.attached = function attached(\n          initiator: IHydratedController,\n          flags: LifecycleFlags,\n        ): void | Promise<void> {\n          return this.viewModel.attached!(initiator, flags);\n        };\n      }\n\n      if ('detaching' in object) {\n        proto.detaching = function detaching(\n          initiator: IHydratedController,\n          parent: IHydratedParentController | null,\n          flags: LifecycleFlags,\n        ): void | Promise<void> {\n          return this.viewModel.detaching!(initiator, parent, flags);\n        };\n      }\n      if ('unbinding' in object) {\n        proto.unbinding = function unbinding(\n          initiator: IHydratedController,\n          parent: IHydratedParentController | null,\n          flags: LifecycleFlags,\n        ): void | Promise<void> {\n          return this.viewModel.unbinding!(initiator, parent, flags);\n        };\n      }\n\n      if ('dispose' in object) {\n        proto.dispose = function dispose(): void {\n          this.viewModel.dispose!();\n        };\n      }\n\n      lookup[resolvedViewName] = UnboundComponent;\n    }\n\n    return UnboundComponent;\n  }\n\n  private getViewName(views: readonly CustomElementDefinition[], requestedName?: string) {\n    if (requestedName) {\n      return requestedName;\n    }\n\n    if (views.length === 1) {\n      return views[0].name;\n    }\n\n    return 'default-view';\n  }\n\n  private getView(views: readonly CustomElementDefinition[], name: string): CustomElementDefinition {\n    const v = views.find(x => x.name === name);\n\n    if (v === void 0) {\n      throw new Error(`Could not find view: ${name}`);\n    }\n\n    return v;\n  }\n}\n","import { FragmentNodeSequence, INode, INodeSequence } from '../dom.js';\nimport { IRenderer, ITemplateCompiler, IInstruction, ICompliationInstruction } from '../renderer.js';\nimport { CustomElementDefinition } from '../resources/custom-element.js';\nimport { IViewFactory, ViewFactory } from './view.js';\nimport { IPlatform } from '../platform.js';\nimport { IController } from './controller.js';\n\nimport type { IContainer } from '@aurelia/kernel';\nimport type { LifecycleFlags } from '@aurelia/runtime';\nimport type { IHydratableController } from './controller.js';\nimport type { InstructionTypeName } from '../renderer.js';\nimport type { PartialCustomElementDefinition } from '../resources/custom-element.js';\n\nconst definitionContainerLookup = new WeakMap<CustomElementDefinition, WeakMap<IContainer, RenderContext>>();\nconst fragmentCache = new WeakMap<CustomElementDefinition, Node | null>();\n\nexport function isRenderContext(value: unknown): value is IRenderContext {\n  return value instanceof RenderContext;\n}\n\n/**\n * A render context that wraps an `IContainer` and must be compiled before it can be used for composing.\n */\nexport interface IRenderContext {\n  readonly platform: IPlatform;\n\n  /**\n   * The `CustomElementDefinition` that this `IRenderContext` was created with.\n   *\n   * If a `PartialCustomElementDefinition` was used to create this context, then this property will be the return value of `CustomElementDefinition.getOrCreate`.\n   */\n  readonly definition: CustomElementDefinition;\n\n  /**\n   * The `IContainer` (which may be, but is not guaranteed to be, an `IRenderContext`) that this `IRenderContext` was created with.\n   */\n  // readonly parentContainer: IContainer;\n\n  readonly container: IContainer;\n\n  /**\n   * Compiles the backing `CustomElementDefinition` (if needed) and returns the compiled `IRenderContext` that exposes the compiled `CustomElementDefinition` as well as composing operations.\n   *\n   * This operation is idempotent.\n   *\n   * @returns The compiled `IRenderContext`.\n   */\n  compile(compilationInstruction: ICompliationInstruction | null): ICompiledRenderContext;\n\n  /**\n   * Creates an (or returns the cached) `IViewFactory` that can be used to create synthetic view controllers.\n   *\n   * @returns Either a new `IViewFactory` (if this is the first call), or a cached one.\n   */\n  getViewFactory(name?: string): IViewFactory;\n}\n\n/**\n * A compiled `IRenderContext` that can create instances of `INodeSequence` (based on the template of the compiled definition)\n * and begin a component operation to create new component instances.\n */\nexport interface ICompiledRenderContext extends IRenderContext {\n  /**\n   * The compiled `CustomElementDefinition`.\n   *\n   * If the passed-in `PartialCustomElementDefinition` had a non-null `template` and `needsCompile` set to `true`, this will be a new definition created by the `ITemplateCompiler`.\n   */\n  readonly compiledDefinition: CustomElementDefinition;\n\n  /**\n   * Returns a new `INodeSequence` based on the document fragment from the compiled `CustomElementDefinition`.\n   *\n   * A new instance will be created from a clone of the fragment on each call.\n   *\n   * @returns An new instance of `INodeSequence` if there is a template, otherwise a shared empty instance.\n   */\n  createNodes(): INodeSequence;\n\n  render(\n    flags: LifecycleFlags,\n    controller: IController,\n    targets: ArrayLike<INode>,\n    templateDefinition: CustomElementDefinition,\n    host: INode | null | undefined,\n  ): void;\n\n  renderChildren(\n    flags: LifecycleFlags,\n    instructions: readonly IInstruction[],\n    controller: IController,\n    target: unknown,\n  ): void;\n}\n\nlet renderContextCount = 0;\nexport function getRenderContext(\n  partialDefinition: PartialCustomElementDefinition,\n  container: IContainer,\n): IRenderContext {\n  const definition = CustomElementDefinition.getOrCreate(partialDefinition);\n\n  let containerLookup = definitionContainerLookup.get(definition);\n  if (containerLookup === void 0) {\n    definitionContainerLookup.set(\n      definition,\n      containerLookup = new WeakMap(),\n    );\n  }\n\n  let context = containerLookup.get(container);\n  if (context === void 0) {\n    containerLookup.set(\n      container,\n      context = new RenderContext(definition, container),\n    );\n  }\n\n  return context;\n}\ngetRenderContext.count = 0;\n// A simple counter for debugging purposes only\nReflect.defineProperty(getRenderContext, 'count', {\n  get: () => renderContextCount\n});\n\nconst emptyNodeCache = new WeakMap<IPlatform, FragmentNodeSequence>();\nconst getRenderersSymb = Symbol();\nconst compiledDefCache = new WeakMap<IContainer, WeakMap<PartialCustomElementDefinition, CustomElementDefinition>>();\n\nexport class RenderContext implements ICompiledRenderContext {\n  public get id(): number {\n    return this.container.id;\n  }\n\n  public readonly root: IContainer;\n  public readonly container: IContainer;\n\n  private fragment: Node | null = null;\n  private factory: IViewFactory | undefined = void 0;\n  private isCompiled: boolean = false;\n\n  public readonly platform: IPlatform;\n  private readonly renderers: Record<InstructionTypeName, IRenderer> = Object.create(null);\n\n  public compiledDefinition: CustomElementDefinition = (void 0)!;\n\n  public constructor(\n    public readonly definition: CustomElementDefinition,\n    container: IContainer,\n  ) {\n    ++renderContextCount;\n    this.container = container;\n    // note: it's incorrect to get rendereres only from root,\n    //       as they could also be considered normal resources\n    //       though it's highly practical for limiting renderers to the global scope\n    const renderers = (container.root as any)[getRenderersSymb] ??= container.root.getAll(IRenderer);\n    let i = 0;\n    let renderer: IRenderer;\n    for (; i < renderers.length; ++i) {\n      renderer = renderers[i];\n      this.renderers[renderer.instructionType as string] = renderer;\n    }\n\n    this.root = container.root;\n    this.platform = container.get(IPlatform);\n  }\n\n  // #region IRenderContext api\n  public compile(compilationInstruction: ICompliationInstruction | null): ICompiledRenderContext {\n    let compiledDefinition: CustomElementDefinition;\n    if (this.isCompiled) {\n      return this;\n    }\n    this.isCompiled = true;\n\n    const definition = this.definition;\n    if (definition.needsCompile) {\n      const container = this.container;\n      const compiler = container.get(ITemplateCompiler);\n      let compiledMap = compiledDefCache.get(container.root);\n      if (compiledMap == null) {\n        compiledDefCache.set(container.root, compiledMap = new WeakMap());\n      }\n      let compiled = compiledMap.get(definition);\n      if (compiled == null) {\n        compiledMap.set(definition, compiled = compiler.compile(definition, container, compilationInstruction));\n      } else {\n        container.register(...compiled.dependencies);\n      }\n      compiledDefinition = this.compiledDefinition = compiled;\n    } else {\n      compiledDefinition = this.compiledDefinition = definition;\n    }\n\n    // Support Recursive Components by adding self to own context\n    compiledDefinition.register(this.container);\n\n    if (fragmentCache.has(compiledDefinition)) {\n      this.fragment = fragmentCache.get(compiledDefinition)!;\n    } else {\n      const doc = this.platform.document;\n      const template = compiledDefinition.template;\n      if (template === null || this.definition.enhance === true) {\n        this.fragment = null;\n      } else if (template instanceof this.platform.Node) {\n        if (template.nodeName === 'TEMPLATE') {\n          this.fragment = doc.adoptNode((template as HTMLTemplateElement).content);\n        } else {\n          (this.fragment = doc.adoptNode(doc.createDocumentFragment())).appendChild(template);\n        }\n      } else {\n        const tpl = doc.createElement('template');\n        doc.adoptNode(tpl.content);\n        if (typeof template === 'string') {\n          tpl.innerHTML = template;\n        }\n        this.fragment = tpl.content;\n      }\n      fragmentCache.set(compiledDefinition, this.fragment);\n    }\n\n    return this;\n  }\n\n  public getViewFactory(name?: string): IViewFactory {\n    let factory = this.factory;\n    if (factory === void 0) {\n      if (name === void 0) {\n        name = this.definition.name;\n      }\n      factory = this.factory = new ViewFactory(name, this);\n    }\n    return factory;\n  }\n  // #endregion\n\n  // #region ICompiledRenderContext api\n\n  public createNodes(): INodeSequence {\n    if (this.compiledDefinition.enhance === true) {\n      return new FragmentNodeSequence(this.platform, this.compiledDefinition.template as DocumentFragment);\n    }\n    if (this.fragment === null) {\n      let emptyNodes = emptyNodeCache.get(this.platform);\n      if (emptyNodes === void 0) {\n        emptyNodeCache.set(this.platform, emptyNodes = new FragmentNodeSequence(this.platform, this.platform.document.createDocumentFragment()));\n      }\n      return emptyNodes;\n    }\n    return new FragmentNodeSequence(this.platform, this.fragment.cloneNode(true) as DocumentFragment);\n  }\n  // #endregion\n\n  // public create\n\n  // #region IComponentFactory api\n\n  public render(\n    flags: LifecycleFlags,\n    controller: IHydratableController,\n    targets: ArrayLike<INode>,\n    definition: CustomElementDefinition,\n    host: INode | null | undefined,\n  ): void {\n    if (targets.length !== definition.instructions.length) {\n      throw new Error(`The compiled template is not aligned with the render instructions. There are ${targets.length} targets and ${definition.instructions.length} instructions.`);\n    }\n\n    for (let i = 0; i < targets.length; ++i) {\n      this.renderChildren(\n        /* flags        */flags,\n        /* instructions */definition.instructions[i],\n        /* controller   */controller,\n        /* target       */targets[i],\n      );\n    }\n\n    if (host !== void 0 && host !== null) {\n      this.renderChildren(\n        /* flags        */flags,\n        /* instructions */definition.surrogates,\n        /* controller   */controller,\n        /* target       */host,\n      );\n    }\n  }\n\n  public renderChildren(\n    flags: LifecycleFlags,\n    instructions: readonly IInstruction[],\n    controller: IHydratableController,\n    target: unknown,\n  ): void {\n    for (let i = 0; i < instructions.length; ++i) {\n      const current = instructions[i];\n      this.renderers[current.type].render(flags, this, controller, target, current);\n    }\n  }\n\n  public dispose(): void {\n    throw new Error('Cannot dispose a render context');\n  }\n  // #endregion\n}\n","import { emptyArray } from '@aurelia/kernel';\nimport { AccessorType, LifecycleFlags } from '@aurelia/runtime';\n\nimport type { IAccessor } from '@aurelia/runtime';\n\nexport class ClassAttributeAccessor implements IAccessor {\n  public value: unknown = '';\n  public oldValue: unknown = '';\n\n  public readonly doNotCache: true = true;\n  public nameIndex: Record<string, number> = {};\n  public version: number = 0;\n\n  public hasChanges: boolean = false;\n  public isActive: boolean = false;\n  public type: AccessorType = AccessorType.Node | AccessorType.Layout;\n\n  public constructor(\n    public readonly obj: HTMLElement,\n  ) {\n  }\n\n  public getValue(): unknown {\n    // is it safe to assume the observer has the latest value?\n    // todo: ability to turn on/off cache based on type\n    return this.value;\n  }\n\n  public setValue(newValue: unknown, flags: LifecycleFlags): void {\n    this.value = newValue;\n    this.hasChanges = newValue !== this.oldValue;\n    if ((flags & LifecycleFlags.noFlush) === 0) {\n      this.flushChanges(flags);\n    }\n  }\n\n  public flushChanges(flags: LifecycleFlags): void {\n    if (this.hasChanges) {\n      this.hasChanges = false;\n      const currentValue = this.value;\n      const nameIndex = this.nameIndex;\n      let version = this.version;\n      this.oldValue = currentValue;\n\n      const classesToAdd = getClassesToAdd(currentValue as any);\n\n      // Get strings split on a space not including empties\n      if (classesToAdd.length > 0) {\n        this.addClassesAndUpdateIndex(classesToAdd);\n      }\n\n      this.version += 1;\n\n      // First call to setValue?  We're done.\n      if (version === 0) {\n        return;\n      }\n\n      // Remove classes from previous version.\n      version -= 1;\n      for (const name in nameIndex) {\n        if (!Object.prototype.hasOwnProperty.call(nameIndex, name) || nameIndex[name] !== version) {\n          continue;\n        }\n\n        // TODO: this has the side-effect that classes already present which are added again,\n        // will be removed if they're not present in the next update.\n        // Better would be do have some configurability for this behavior, allowing the user to\n        // decide whether initial classes always need to be kept, always removed, or something in between\n        this.obj.classList.remove(name);\n      }\n    }\n  }\n\n  private addClassesAndUpdateIndex(classes: string[]) {\n    const node = this.obj;\n    for (let i = 0, ii = classes.length; i < ii; i++) {\n      const className = classes[i];\n      if (className.length === 0) {\n        continue;\n      }\n      this.nameIndex[className] = this.version;\n      node.classList.add(className);\n    }\n  }\n}\n\nexport function getClassesToAdd(object: Record<string, unknown> | [] | string): string[] {\n  if (typeof object === 'string') {\n    return splitClassString(object);\n  }\n  if (typeof object !== 'object') {\n    return emptyArray;\n  }\n\n  if (object instanceof Array) {\n    const len = object.length;\n    if (len > 0) {\n      const classes: string[] = [];\n      for (let i = 0; i < len; ++i) {\n        classes.push(...getClassesToAdd(object[i]));\n      }\n      return classes;\n    } else {\n      return emptyArray;\n    }\n  }\n\n  const classes: string[] = [];\n  for (const property in object) {\n    // Let non typical values also evaluate true so disable bool check\n    if (Boolean(object[property])) {\n      // We must do this in case object property has a space in the name which results in two classes\n      if (property.includes(' ')) {\n        classes.push(...splitClassString(property));\n      } else {\n        classes.push(property);\n      }\n    }\n  }\n  return classes;\n}\n\nfunction splitClassString(classString: string): string[] {\n  const matches = classString.match(/\\S+/g);\n  if (matches === null) {\n    return emptyArray;\n  }\n  return matches;\n}\n","import { IContainer, Registration, DI, noop } from '@aurelia/kernel';\nimport { AppTask } from '../app-task.js';\nimport { INode } from '../dom.js';\nimport { getClassesToAdd } from '../observation/class-attribute-accessor.js';\nimport { IPlatform } from '../platform.js';\nimport { CustomAttribute } from '../resources/custom-attribute.js';\n\nimport type { IRegistry } from '@aurelia/kernel';\n\nexport function cssModules(...modules: (Record<string, string>)[]): CSSModulesProcessorRegistry {\n  return new CSSModulesProcessorRegistry(modules);\n}\n\nexport class CSSModulesProcessorRegistry implements IRegistry {\n  public constructor(\n    private readonly modules: Record<string, string>[],\n  ) {}\n\n  public register(container: IContainer): void {\n    const classLookup = Object.assign({}, ...this.modules) as Record<string, string>;\n    const ClassCustomAttribute = CustomAttribute.define({\n      name: 'class',\n      bindables: ['value'],\n    }, class CustomAttributeClass {\n      public static inject: any[] = [INode];\n\n      public value!: string;\n      public constructor(\n        private readonly element: INode<HTMLElement>,\n      ) {}\n\n      public binding() {\n        this.valueChanged();\n      }\n\n      public valueChanged() {\n        if (!this.value) {\n          this.element.className = '';\n          return;\n        }\n\n        this.element.className = getClassesToAdd(this.value).map(x => classLookup[x] || x).join(' ');\n      }\n    });\n\n    container.register(ClassCustomAttribute);\n  }\n}\n\nexport function shadowCSS(...css: (string | CSSStyleSheet)[]): ShadowDOMRegistry {\n  return new ShadowDOMRegistry(css);\n}\n\nexport interface IShadowDOMStyleFactory {\n  createStyles(localStyles: (string | CSSStyleSheet)[], sharedStyles: IShadowDOMStyles | null): IShadowDOMStyles;\n}\n\nexport const IShadowDOMStyleFactory = DI.createInterface<IShadowDOMStyleFactory>('IShadowDOMStyleFactory', x => x.cachedCallback(handler => {\n  if (AdoptedStyleSheetsStyles.supported(handler.get(IPlatform))) {\n    return handler.get(AdoptedStyleSheetsStylesFactory);\n  }\n  return handler.get(StyleElementStylesFactory);\n}));\n\nexport class ShadowDOMRegistry implements IRegistry {\n  public constructor(\n    private readonly css: (string | CSSStyleSheet)[],\n  ) { }\n\n  public register(container: IContainer): void {\n    const sharedStyles = container.get(IShadowDOMGlobalStyles);\n    const factory = container.get(IShadowDOMStyleFactory);\n    container.register(Registration.instance(IShadowDOMStyles, factory.createStyles(this.css, sharedStyles)));\n  }\n}\n\nclass AdoptedStyleSheetsStylesFactory {\n  private readonly cache = new Map();\n\n  public constructor(@IPlatform private readonly p: IPlatform) {}\n\n  public createStyles(localStyles: (string | CSSStyleSheet)[], sharedStyles: IShadowDOMStyles | null): IShadowDOMStyles {\n    return new AdoptedStyleSheetsStyles(this.p, localStyles, this.cache, sharedStyles);\n  }\n}\n\nclass StyleElementStylesFactory {\n  public constructor(@IPlatform private readonly p: IPlatform) {}\n\n  public createStyles(localStyles: string[], sharedStyles: IShadowDOMStyles | null): IShadowDOMStyles {\n    return new StyleElementStyles(this.p, localStyles, sharedStyles);\n  }\n}\n\ntype HasAdoptedStyleSheets = ShadowRoot & {\n  adoptedStyleSheets: CSSStyleSheet[];\n};\n\nexport interface IShadowDOMStyles {\n  applyTo(shadowRoot: ShadowRoot): void;\n}\n\nexport const IShadowDOMStyles = DI.createInterface<IShadowDOMStyles>('IShadowDOMStyles');\nexport const IShadowDOMGlobalStyles = DI.createInterface<IShadowDOMStyles>('IShadowDOMGlobalStyles', x => x.instance({ applyTo: noop }));\n\nexport class AdoptedStyleSheetsStyles implements IShadowDOMStyles {\n  private readonly styleSheets: CSSStyleSheet[];\n\n  public constructor(\n    p: IPlatform,\n    localStyles: (string | CSSStyleSheet)[],\n    styleSheetCache: Map<string, CSSStyleSheet>,\n    private readonly sharedStyles: IShadowDOMStyles | null = null\n  ) {\n    this.styleSheets = localStyles.map(x => {\n      let sheet: CSSStyleSheet | undefined;\n\n      if (x instanceof p.CSSStyleSheet) {\n        sheet = x;\n      } else {\n        sheet = styleSheetCache.get(x);\n\n        if (sheet === void 0) {\n          sheet = new p.CSSStyleSheet();\n          (sheet as any).replaceSync(x);\n          styleSheetCache.set(x, sheet);\n        }\n      }\n\n      return sheet;\n    });\n  }\n\n  public static supported(p: IPlatform): boolean {\n    return 'adoptedStyleSheets' in p.ShadowRoot.prototype;\n  }\n\n  public applyTo(shadowRoot: HasAdoptedStyleSheets): void {\n    if (this.sharedStyles !== null) {\n      this.sharedStyles.applyTo(shadowRoot);\n    }\n\n    // https://wicg.github.io/construct-stylesheets/\n    // https://developers.google.com/web/updates/2019/02/constructable-stylesheets\n    shadowRoot.adoptedStyleSheets = [\n      ...shadowRoot.adoptedStyleSheets,\n      ...this.styleSheets\n    ];\n  }\n}\n\nexport class StyleElementStyles implements IShadowDOMStyles {\n  public constructor(\n    private readonly p: IPlatform,\n    private readonly localStyles: string[],\n    private readonly sharedStyles: IShadowDOMStyles | null = null\n  ) { }\n\n  public applyTo(shadowRoot: ShadowRoot): void {\n    const styles = this.localStyles;\n    const p = this.p;\n\n    for (let i = styles.length - 1; i > -1; --i) {\n      const element = p.document.createElement('style');\n      element.innerHTML = styles[i];\n      shadowRoot.prepend(element);\n    }\n\n    if (this.sharedStyles !== null) {\n      this.sharedStyles.applyTo(shadowRoot);\n    }\n  }\n}\n\nexport interface IShadowDOMConfiguration {\n  sharedStyles?: (string | CSSStyleSheet)[];\n}\n\nexport const StyleConfiguration = {\n  shadowDOM(config: IShadowDOMConfiguration): IRegistry {\n    return AppTask.beforeCreate(IContainer, container => {\n      if (config.sharedStyles != null) {\n        const factory = container.get(IShadowDOMStyleFactory);\n        container.register(Registration.instance(IShadowDOMGlobalStyles, factory.createStyles(config.sharedStyles, null)));\n      }\n    });\n  }\n};\n","import {\n  connectable,\n  ConnectableSwitcher,\n  ExpressionKind,\n  LifecycleFlags,\n  ProxyObservable,\n} from '@aurelia/runtime';\nimport type { IServiceLocator } from '@aurelia/kernel';\nimport type {\n  ICollectionSubscriber,\n  IConnectable,\n  IConnectableBinding,\n  IObservable,\n  IObserverLocator,\n  IsBindingBehavior,\n  ISubscriber,\n  Scope,\n} from '@aurelia/runtime';\nimport type { IWatcherCallback } from '../watch.js';\n\nconst { enter, exit } = ConnectableSwitcher;\nconst { wrap, unwrap } = ProxyObservable;\n\n// watchers (Computed & Expression) are basically binding,\n// they are treated as special and setup before all other bindings\n\nexport interface ComputedWatcher extends IConnectableBinding { }\n\nexport class ComputedWatcher implements IConnectableBinding, ISubscriber, ICollectionSubscriber {\n  public interceptor = this;\n\n  public value: unknown = void 0;\n  public isBound: boolean = false;\n\n  // todo: maybe use a counter allow recursive call to a certain level\n  private running: boolean = false;\n\n  public constructor(\n    public readonly obj: IObservable,\n    public readonly observerLocator: IObserverLocator,\n    public readonly get: (obj: object, watcher: IConnectable) => unknown,\n    private readonly cb: IWatcherCallback<object>,\n    public readonly useProxy: boolean,\n  ) {\n  }\n\n  public handleChange(): void {\n    this.run();\n  }\n\n  public handleCollectionChange(): void {\n    this.run();\n  }\n\n  public $bind(): void {\n    if (this.isBound) {\n      return;\n    }\n    this.isBound = true;\n    this.compute();\n  }\n\n  public $unbind(): void {\n    if (!this.isBound) {\n      return;\n    }\n    this.isBound = false;\n    this.obs.clear(true);\n  }\n\n  private run(): void {\n    if (!this.isBound || this.running) {\n      return;\n    }\n    const obj = this.obj;\n    const oldValue = this.value;\n    const newValue = this.compute();\n\n    if (!Object.is(newValue, oldValue)) {\n      // should optionally queue\n      this.cb.call(obj, newValue, oldValue, obj);\n    }\n  }\n\n  private compute(): unknown {\n    this.running = true;\n    this.obs.version++;\n    try {\n      enter(this);\n      return this.value = unwrap(this.get.call(void 0, this.useProxy ? wrap(this.obj) : this.obj, this));\n    } finally {\n      this.obs.clear(false);\n      this.running = false;\n      exit(this);\n    }\n  }\n}\n\n/**\n * The interface describes methods added by `connectable` & `subscriberCollection` decorators\n *\n * @internal\n */\nexport interface ExpressionWatcher extends IConnectableBinding { }\n\nexport class ExpressionWatcher implements IConnectableBinding {\n  public interceptor = this;\n  /**\n   * @internal\n   */\n  private readonly obj: object;\n\n  public value: unknown;\n  public isBound: boolean = false;\n\n  public constructor(\n    public scope: Scope,\n    public locator: IServiceLocator,\n    public observerLocator: IObserverLocator,\n    private readonly expression: IsBindingBehavior,\n    private readonly callback: IWatcherCallback<object>,\n  ) {\n    this.obj = scope.bindingContext;\n  }\n\n  public handleChange(value: unknown): void {\n    const expr = this.expression;\n    const obj = this.obj;\n    const oldValue = this.value;\n    const canOptimize = expr.$kind === ExpressionKind.AccessScope && this.obs.count === 1;\n    if (!canOptimize) {\n      this.obs.version++;\n      value = expr.evaluate(0, this.scope, null, this.locator, this);\n      this.obs.clear(false);\n    }\n    if (!Object.is(value, oldValue)) {\n      this.value = value;\n      // should optionally queue for batch synchronous\n      this.callback.call(obj, value, oldValue, obj);\n    }\n  }\n\n  public $bind(): void {\n    if (this.isBound) {\n      return;\n    }\n    this.isBound = true;\n    this.obs.version++;\n    this.value = this.expression.evaluate(LifecycleFlags.none, this.scope, null, this.locator, this);\n    this.obs.clear(false);\n  }\n\n  public $unbind(): void {\n    if (!this.isBound) {\n      return;\n    }\n    this.isBound = false;\n    this.obs.clear(true);\n    this.value = void 0;\n  }\n}\n\nconnectable(ComputedWatcher);\nconnectable(ExpressionWatcher);\n","import { DI, Metadata, Protocol, Registration } from '@aurelia/kernel';\nimport type { Constructable, IContainer } from '@aurelia/kernel';\n\ntype FuncPropNames<T> = {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  [K in keyof T]: K extends 'constructor' ? never : Required<T>[K] extends Function ? K : never;\n}[keyof T];\nexport type LifecycleHook<TViewModel, TKey extends FuncPropNames<TViewModel>> = (vm: TViewModel, ...args: Parameters<Required<TViewModel>[TKey]>) => ReturnType<Required<TViewModel>[TKey]>;\n\nexport type ILifecycleHooks<TViewModel = {}, TKey extends FuncPropNames<TViewModel> = FuncPropNames<TViewModel>> = { [K in TKey]: LifecycleHook<TViewModel, K>; };\nexport const ILifecycleHooks = DI.createInterface<ILifecycleHooks>('ILifecycleHooks');\n\nexport type LifecycleHooksLookup<TViewModel = {}> = {\n  [K in FuncPropNames<TViewModel>]?: readonly LifecycleHooksEntry<TViewModel, K>[];\n};\nexport class LifecycleHooksEntry<TViewModel = {}, TKey extends FuncPropNames<TViewModel> = FuncPropNames<TViewModel>, THooks extends Constructable = Constructable> {\n  public constructor(\n    public readonly definition: LifecycleHooksDefinition<THooks>,\n    public readonly instance: ILifecycleHooks<TViewModel, TKey>,\n  ) {}\n}\n\n/**\n * This definition has no specific properties yet other than the type, but is in place for future extensions.\n *\n * See: https://github.com/aurelia/aurelia/issues/1044\n */\nexport class LifecycleHooksDefinition<T extends Constructable = Constructable> {\n  private constructor(\n    public readonly Type: T,\n    public readonly propertyNames: ReadonlySet<string>,\n  ) {}\n\n  /**\n   * @param def - Placeholder for future extensions. Currently always an empty object.\n   */\n  public static create<T extends Constructable>(def: {}, Type: T): LifecycleHooksDefinition<T> {\n    const propertyNames = new Set<string>();\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n    let proto = Type.prototype;\n    while (proto !== Object.prototype) {\n      for (const name of Object.getOwnPropertyNames(proto)) {\n        // This is the only check we will do for now. Filtering on e.g. function types might not always work properly when decorators come into play. This would need more testing first.\n        if (name !== 'constructor') {\n          propertyNames.add(name);\n        }\n      }\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      proto = Object.getPrototypeOf(proto);\n    }\n\n    return new LifecycleHooksDefinition(Type, propertyNames);\n  }\n\n  public register(container: IContainer): void {\n    Registration.singleton(ILifecycleHooks, this.Type).register(container);\n  }\n}\n\nconst containerLookup = new WeakMap<IContainer, LifecycleHooksLookup<any>>();\n\nexport const LifecycleHooks = {\n  name: Protocol.annotation.keyFor('lifecycle-hooks'),\n  /**\n   * @param def - Placeholder for future extensions. Currently always an empty object.\n   */\n  define<T extends Constructable>(def: {}, Type: T): T {\n    const definition = LifecycleHooksDefinition.create(def, Type);\n    Metadata.define(LifecycleHooks.name, definition, Type);\n    Protocol.resource.appendTo(Type, LifecycleHooks.name);\n    return definition.Type;\n  },\n  resolve(ctx: IContainer): LifecycleHooksLookup {\n    let lookup = containerLookup.get(ctx);\n    if (lookup === void 0) {\n      lookup = new LifecycleHooksLookupImpl();\n      const root = ctx.root;\n      const instances = root.id === ctx.id\n        ? ctx.getAll(ILifecycleHooks)\n        // if it's not root, only resolve it from the current context when it has the resolver\n        // to maintain resources semantic: current -> root\n        : ctx.has(ILifecycleHooks, false)\n          ? [...root.getAll(ILifecycleHooks), ...ctx.getAll(ILifecycleHooks)]\n          : root.getAll(ILifecycleHooks);\n\n      let instance: ILifecycleHooks;\n      let definition: LifecycleHooksDefinition;\n      let entry: LifecycleHooksEntry;\n      let name: string;\n      let entries: LifecycleHooksEntry[];\n\n      for (instance of instances) {\n        definition = Metadata.getOwn(LifecycleHooks.name, instance.constructor);\n        entry = new LifecycleHooksEntry(definition, instance);\n        for (name of definition.propertyNames) {\n          entries = lookup[name] as LifecycleHooksEntry[];\n          if (entries === void 0) {\n            lookup[name] = [entry];\n          } else {\n            entries.push(entry);\n          }\n        }\n      }\n    }\n    return lookup;\n  },\n};\n\nclass LifecycleHooksLookupImpl implements LifecycleHooksLookup {}\n\n/**\n * Decorator: Indicates that the decorated class is a custom element.\n */\nexport function lifecycleHooks(): <T extends Constructable>(target: T) => T {\n  return function decorator<T extends Constructable>(target: T): T {\n    return LifecycleHooks.define({}, target);\n  };\n}\n","/* eslint-disable @typescript-eslint/no-unnecessary-type-assertion */\nimport {\n  nextId,\n  isObject,\n  ILogger,\n  LogLevel,\n  DI,\n  emptyArray,\n  InstanceProvider,\n  optional,\n} from '@aurelia/kernel';\nimport {\n  AccessScopeExpression,\n  BindingType,\n  Scope,\n  LifecycleFlags,\n  IObserverLocator,\n  IExpressionParser,\n} from '@aurelia/runtime';\nimport { BindableObserver } from '../observation/bindable-observer.js';\nimport { convertToRenderLocation, setRef } from '../dom.js';\nimport { CustomElementDefinition, CustomElement } from '../resources/custom-element.js';\nimport { CustomAttributeDefinition, CustomAttribute } from '../resources/custom-attribute.js';\nimport { IRenderContext, getRenderContext, RenderContext, ICompiledRenderContext } from './render-context.js';\nimport { ChildrenDefinition, ChildrenObserver } from './children.js';\nimport { IAppRoot } from '../app-root.js';\nimport { IPlatform } from '../platform.js';\nimport { IShadowDOMGlobalStyles, IShadowDOMStyles } from './styles.js';\nimport { ComputedWatcher, ExpressionWatcher } from './watchers.js';\nimport { LifecycleHooks } from './lifecycle-hooks.js';\n\nimport type {\n  IContainer,\n  IIndexable,\n  Writable,\n  Constructable,\n  IDisposable,\n  IServiceLocator,\n} from '@aurelia/kernel';\nimport type {\n  IBinding,\n  IObservable,\n  IsBindingBehavior,\n} from '@aurelia/runtime';\nimport type { IProjections } from '../resources/slot-injectables.js';\nimport type { BindableDefinition } from '../bindable.js';\nimport type { LifecycleHooksLookup } from './lifecycle-hooks.js';\nimport type { INode, INodeSequence, IRenderLocation } from '../dom.js';\nimport type { IViewFactory } from './view.js';\nimport type { Instruction } from '../renderer.js';\nimport type { IWatchDefinition, IWatcherCallback } from '../watch.js';\nimport type { PartialCustomElementDefinition } from '../resources/custom-element.js';\n\ntype BindingContext<C extends IViewModel> = Required<ICompileHooks> & Required<IActivationHooks<IHydratedController | null>> & C;\n\nexport const enum MountTarget {\n  none = 0,\n  host = 1,\n  shadowRoot = 2,\n  location = 3,\n}\n\nconst optionalCeFind = { optional: true } as const;\n\nconst controllerLookup: WeakMap<object, Controller> = new WeakMap();\nexport class Controller<C extends IViewModel = IViewModel> implements IController<C> {\n  public readonly id: number = nextId('au$component');\n\n  public head: IHydratedController | null = null;\n  public tail: IHydratedController | null = null;\n  public next: IHydratedController | null = null;\n\n  public parent: IHydratedController | null = null;\n  public bindings: IBinding[] | null = null;\n  public children: Controller[] | null = null;\n\n  public hasLockedScope: boolean = false;\n\n  public isStrictBinding: boolean = false;\n\n  public scope: Scope | null = null;\n  public hostScope: Scope | null = null;\n  public isBound: boolean = false;\n\n  // If a host from another custom element was passed in, then this will be the controller for that custom element (could be `au-viewport` for example).\n  // In that case, this controller will create a new host node (with the definition's name) and use that as the target host for the nodes instead.\n  // That host node is separately mounted to the host controller's original host node.\n  public hostController: Controller | null = null;\n  public mountTarget: MountTarget = MountTarget.none;\n  public shadowRoot: ShadowRoot | null = null;\n  public nodes: INodeSequence | null = null;\n  public context: RenderContext | null = null;\n  public location: IRenderLocation | null = null;\n  public lifecycleHooks: LifecycleHooksLookup | null = null;\n\n  public state: State = State.none;\n  public get isActive(): boolean {\n    return (this.state & (State.activating | State.activated)) > 0 && (this.state & State.deactivating) === 0;\n  }\n\n  private get name(): string {\n    if (this.parent === null) {\n      switch (this.vmKind) {\n        case ViewModelKind.customAttribute:\n          return `[${this.definition!.name}]`;\n        case ViewModelKind.customElement:\n          return this.definition!.name;\n        case ViewModelKind.synthetic:\n          return this.viewFactory!.name;\n      }\n    }\n    switch (this.vmKind) {\n      case ViewModelKind.customAttribute:\n        return `${(this.parent as Controller).name}>[${this.definition!.name}]`;\n      case ViewModelKind.customElement:\n        return `${(this.parent as Controller).name}>${this.definition!.name}`;\n      case ViewModelKind.synthetic:\n        return this.viewFactory!.name === this.parent.definition?.name\n          ? `${(this.parent as Controller).name}[view]`\n          : `${(this.parent as Controller).name}[view:${this.viewFactory!.name}]`;\n    }\n  }\n\n  private logger: ILogger | null = null;\n  private debug: boolean = false;\n  private fullyNamed: boolean = false;\n  private childrenObs: ChildrenObserver[] = emptyArray;\n\n  public readonly platform: IPlatform;\n  public readonly hooks: HooksDefinition;\n\n  public constructor(\n    public root: IAppRoot | null,\n    public ctxCt: IContainer,\n    public container: IContainer,\n    public readonly vmKind: ViewModelKind,\n    public flags: LifecycleFlags,\n    public readonly definition: CustomElementDefinition | CustomAttributeDefinition | null,\n    /**\n     * The viewFactory. Only present for synthetic views.\n     */\n    public viewFactory: IViewFactory | null,\n    /**\n     * The backing viewModel. Only present for custom attributes and elements.\n     */\n    public viewModel: BindingContext<C> | null,\n    /**\n     * The physical host dom node.\n     *\n     * For containerless elements, this node will be removed from the DOM and replaced by a comment, which is assigned to the `location` property.\n     *\n     * For ShadowDOM elements, this will be the original declaring element, NOT the shadow root (the shadow root is stored on the `shadowRoot` property)\n     */\n    public host: HTMLElement | null,\n  ) {\n    if (root === null && container.has(IAppRoot, true)) {\n      this.root = container.get<IAppRoot>(IAppRoot);\n    }\n    this.platform = container.get(IPlatform);\n    switch (vmKind) {\n      case ViewModelKind.customAttribute:\n      case ViewModelKind.customElement:\n        // todo: cache-able based on constructor type\n        this.hooks = new HooksDefinition(viewModel!);\n        break;\n      case ViewModelKind.synthetic:\n        this.hooks = HooksDefinition.none;\n        break;\n    }\n  }\n\n  public static getCached<C extends ICustomElementViewModel = ICustomElementViewModel>(viewModel: C): ICustomElementController<C> | undefined {\n    return controllerLookup.get(viewModel) as ICustomElementController<C> | undefined;\n  }\n\n  public static getCachedOrThrow<C extends ICustomElementViewModel = ICustomElementViewModel>(viewModel: C): ICustomElementController<C> {\n    const controller = Controller.getCached(viewModel);\n    if (controller === void 0) {\n      throw new Error(`There is no cached controller for the provided ViewModel: ${String(viewModel)}`);\n    }\n    return controller as ICustomElementController<C>;\n  }\n\n  public static forCustomElement<C extends ICustomElementViewModel = ICustomElementViewModel>(\n    root: IAppRoot | null,\n    // todo: it's not a great API that both parent and child containers\n    //       are required to instantiate a controller\n    //       though refactoring this won't be simple. Should be done after other refactorings\n    contextCt: IContainer,\n    ownCt: IContainer,\n    viewModel: C,\n    host: HTMLElement,\n    hydrationInst: IControllerElementHydrationInstruction | null,\n    flags: LifecycleFlags = LifecycleFlags.none,\n    hydrate: boolean = true,\n    // Use this when `instance.constructor` is not a custom element type\n    // to pass on the CustomElement definition\n    definition: CustomElementDefinition | undefined = void 0,\n  ): ICustomElementController<C> {\n    if (controllerLookup.has(viewModel)) {\n      return controllerLookup.get(viewModel) as unknown as ICustomElementController<C>;\n    }\n\n    definition = definition ?? CustomElement.getDefinition(viewModel.constructor as Constructable);\n\n    const controller = new Controller<C>(\n      /* root           */root,\n      /* context ct     */contextCt,\n      /* own ct         */ownCt,\n      /* vmKind         */ViewModelKind.customElement,\n      /* flags          */flags,\n      /* definition     */definition,\n      /* viewFactory    */null,\n      /* viewModel      */viewModel as BindingContext<C>,\n      /* host           */host,\n    );\n\n    ownCt.register(...definition.dependencies);\n    ownCt.registerResolver(IHydrationContext, new InstanceProvider(\n      'IHydrationContext',\n      new HydrationContext(\n        controller,\n        hydrationInst,\n        /* parent context */contextCt.get(optional(IHydrationContext)),\n      )\n    ));\n    controllerLookup.set(viewModel, controller as Controller);\n\n    if (hydrate) {\n      controller.hydrateCustomElement(hydrationInst);\n    }\n\n    return controller as ICustomElementController<C>;\n  }\n\n  public static forCustomAttribute<C extends ICustomAttributeViewModel = ICustomAttributeViewModel>(\n    root: IAppRoot | null,\n    context: IContainer,\n    viewModel: C,\n    host: HTMLElement,\n    flags: LifecycleFlags = LifecycleFlags.none,\n    /**\n     * The definition that will be used to hydrate the custom attribute view model\n     *\n     * If not given, will be the one associated with the constructor of the attribute view model given.\n     */\n    definition?: CustomAttributeDefinition,\n  ): ICustomAttributeController<C> {\n    if (controllerLookup.has(viewModel)) {\n      return controllerLookup.get(viewModel) as unknown as ICustomAttributeController<C>;\n    }\n\n    definition = definition ?? CustomAttribute.getDefinition(viewModel.constructor as Constructable);\n\n    const controller = new Controller<C>(\n      /* root           */root,\n      /* context ct     */context,\n      // CA does not have its own container\n      /* own ct         */context,\n      /* vmKind         */ViewModelKind.customAttribute,\n      /* flags          */flags,\n      /* definition     */definition,\n      /* viewFactory    */null,\n      /* viewModel      */viewModel as BindingContext<C>,\n      /* host           */host\n    );\n\n    controllerLookup.set(viewModel, controller as Controller);\n\n    controller.hydrateCustomAttribute();\n\n    return controller as unknown as ICustomAttributeController<C>;\n  }\n\n  public static forSyntheticView(\n    root: IAppRoot | null,\n    context: IRenderContext,\n    viewFactory: IViewFactory,\n    flags: LifecycleFlags = LifecycleFlags.none,\n    parentController: ISyntheticView | ICustomElementController | ICustomAttributeController | undefined = void 0,\n  ): ISyntheticView {\n    const controller = new Controller(\n      /* root           */root,\n      // todo: view factory should carry its own container\n      /* container      */context.container,\n      /* container      */context.container,\n      /* vmKind         */ViewModelKind.synthetic,\n      /* flags          */flags,\n      /* definition     */null,\n      /* viewFactory    */viewFactory,\n      /* viewModel      */null,\n      /* host           */null,\n    );\n    controller.parent = parentController ?? null;\n\n    controller.hydrateSynthetic(context);\n\n    return controller as unknown as ISyntheticView;\n  }\n\n  /** @internal */\n  public hydrateCustomElement(\n    hydrationInst: IControllerElementHydrationInstruction | null\n  ): void {\n    this.logger = this.container.get(ILogger).root;\n    this.debug = this.logger.config.level <= LogLevel.debug;\n    if (this.debug) {\n      this.logger = this.logger.scopeTo(this.name);\n    }\n\n    const container = this.container;\n    const flags = this.flags;\n    const instance = this.viewModel as BindingContext<C>;\n    let definition = this.definition as CustomElementDefinition;\n\n    this.scope = Scope.create(instance, null, true);\n\n    if (definition.watches.length > 0) {\n      createWatchers(this, container, definition, instance);\n    }\n    createObservers(this, definition, flags, instance);\n    this.childrenObs = createChildrenObservers(this as Controller, definition, flags, instance);\n\n    if (this.hooks.hasDefine) {\n      if (this.debug) { this.logger.trace(`invoking define() hook`); }\n      const result = instance.define(\n        /* controller      */this as ICustomElementController,\n        /* parentContainer */this.ctxCt,\n        /* definition      */definition,\n      );\n      if (result !== void 0 && result !== definition) {\n        definition = CustomElementDefinition.getOrCreate(result);\n      }\n    }\n\n    this.context = getRenderContext(definition, container) as RenderContext;\n    this.lifecycleHooks = LifecycleHooks.resolve(container);\n    // Support Recursive Components by adding self to own context\n    definition.register(container);\n\n    if (definition.injectable !== null) {\n      container.registerResolver(\n        definition.injectable,\n        new InstanceProvider('definition.injectable', instance as ICustomElementViewModel),\n      );\n    }\n\n    // If this is the root controller, then the AppRoot will invoke things in the following order:\n    // - Controller.hydrateCustomElement\n    // - runAppTasks('hydrating') // may return a promise\n    // - Controller.compile\n    // - runAppTasks('hydrated') // may return a promise\n    // - Controller.compileChildren\n    // This keeps hydration synchronous while still allowing the composition root compile hooks to do async work.\n    if ((this.root?.controller as this | undefined) !== this) {\n      this.hydrate(hydrationInst);\n      this.hydrateChildren();\n    }\n  }\n\n  /** @internal */\n  public hydrate(hydrationInst: IControllerElementHydrationInstruction | null): void {\n    if (this.hooks.hasHydrating) {\n      if (this.debug) { this.logger!.trace(`invoking hydrating() hook`); }\n      (this.viewModel as BindingContext<C>).hydrating(this as ICustomElementController);\n    }\n\n    const compiledContext = this.context!.compile(hydrationInst);\n    const { shadowOptions, isStrictBinding, hasSlots, containerless } = compiledContext.compiledDefinition;\n\n    this.isStrictBinding = isStrictBinding;\n\n    if ((this.hostController = CustomElement.for(this.host!, optionalCeFind) as Controller | null) !== null) {\n      this.host = this.platform.document.createElement(this.context!.definition.name);\n    }\n\n    setRef(this.host!, CustomElement.name, this as IHydratedController);\n    setRef(this.host!, this.definition!.key, this as IHydratedController);\n    if (shadowOptions !== null || hasSlots) {\n      if (containerless) { throw new Error('You cannot combine the containerless custom element option with Shadow DOM.'); }\n      setRef(this.shadowRoot = this.host!.attachShadow(shadowOptions ?? defaultShadowOptions), CustomElement.name, this as IHydratedController);\n      setRef(this.shadowRoot!, this.definition!.key, this as IHydratedController);\n      this.mountTarget = MountTarget.shadowRoot;\n    } else if (containerless) {\n      setRef(this.location = convertToRenderLocation(this.host!), CustomElement.name, this as IHydratedController);\n      setRef(this.location!, this.definition!.key, this as IHydratedController);\n      this.mountTarget = MountTarget.location;\n    } else {\n      this.mountTarget = MountTarget.host;\n    }\n\n    (this.viewModel as Writable<C>).$controller = this;\n    this.nodes = compiledContext.createNodes();\n\n    if (this.hooks.hasHydrated) {\n      if (this.debug) { this.logger!.trace(`invoking hydrated() hook`); }\n      (this.viewModel as BindingContext<C>).hydrated(this as ICustomElementController);\n    }\n  }\n\n  /** @internal */\n  public hydrateChildren(): void {\n    const targets = this.nodes!.findTargets();\n    this.context!.render(\n      /* flags      */this.flags,\n      /* controller */this as ICustomElementController,\n      /* targets    */targets,\n      /* definition */this.context!.compiledDefinition,\n      /* host       */this.host,\n    );\n\n    if (this.hooks.hasCreated) {\n      if (this.debug) { this.logger!.trace(`invoking created() hook`); }\n      (this.viewModel as BindingContext<C>).created(this as ICustomElementController);\n    }\n  }\n\n  private hydrateCustomAttribute(): void {\n    const definition = this.definition as CustomElementDefinition;\n    const instance = this.viewModel!;\n\n    if (definition.watches.length > 0) {\n      createWatchers(this, this.container, definition, instance);\n    }\n    createObservers(this, definition, this.flags, instance);\n\n    (instance as Writable<C>).$controller = this;\n    this.lifecycleHooks = LifecycleHooks.resolve(this.container);\n\n    if (this.hooks.hasCreated) {\n      if (this.debug) { this.logger!.trace(`invoking created() hook`); }\n      (this.viewModel as BindingContext<C>).created(this as ICustomAttributeController);\n    }\n  }\n\n  private hydrateSynthetic(context: IRenderContext): void {\n    this.context = context as RenderContext;\n    const compiledContext = context.compile(null);\n    const compiledDefinition = compiledContext.compiledDefinition;\n\n    this.isStrictBinding = compiledDefinition.isStrictBinding;\n\n    const nodes = this.nodes = compiledContext.createNodes();\n    const targets = nodes.findTargets();\n    compiledContext.render(\n      /* flags      */this.flags,\n      /* controller */this,\n      /* targets    */targets,\n      /* definition */compiledDefinition,\n      /* host       */void 0,\n    );\n  }\n\n  private $initiator: IHydratedController = null!;\n  private $flags: LifecycleFlags = LifecycleFlags.none;\n  public activate(\n    initiator: IHydratedController,\n    parent: IHydratedController | null,\n    flags: LifecycleFlags,\n    scope?: Scope | null,\n    hostScope?: Scope | null,\n  ): void | Promise<void> {\n    switch (this.state) {\n      case State.none:\n      case State.deactivated:\n        if (!(parent === null || parent.isActive)) {\n          // If this is not the root, and the parent is either:\n          // 1. Not activated, or activating children OR\n          // 2. Deactivating itself\n          // abort.\n          return;\n        }\n        // Otherwise, proceed normally.\n        // 'deactivated' and 'none' are treated the same because, from an activation perspective, they mean the same thing.\n        this.state = State.activating;\n        break;\n      case State.activated:\n        // If we're already activated, no need to do anything.\n        return;\n      case State.disposed:\n        throw new Error(`${this.name} trying to activate a controller that is disposed.`);\n      default:\n        throw new Error(`${this.name} unexpected state: ${stringifyState(this.state)}.`);\n    }\n\n    this.parent = parent;\n    if (this.debug && !this.fullyNamed) {\n      this.fullyNamed = true;\n      (this.logger ??= this.container.get(ILogger).root.scopeTo(this.name))\n        .trace(`activate()`);\n    }\n    if (this.vmKind === ViewModelKind.synthetic) {\n      this.hostScope = hostScope ?? null;\n    }\n    flags |= LifecycleFlags.fromBind;\n\n    switch (this.vmKind) {\n      case ViewModelKind.customElement:\n        // Custom element scope is created and assigned during hydration\n        (this.scope as Writable<Scope>).parentScope = scope ?? null;\n        break;\n      case ViewModelKind.customAttribute:\n        this.scope = scope ?? null;\n        break;\n      case ViewModelKind.synthetic:\n        // maybe only check when there's not already a scope\n        if (scope === void 0 || scope === null) {\n          throw new Error(`Scope is null or undefined`);\n        }\n\n        if (!this.hasLockedScope) {\n          this.scope = scope;\n        }\n        break;\n    }\n\n    if (this.isStrictBinding) {\n      flags |= LifecycleFlags.isStrictBindingStrategy;\n    }\n\n    this.$initiator = initiator;\n    this.$flags = flags;\n\n    // opposing leave is called in attach() (which will trigger attached())\n    this.enterActivating();\n\n    if (this.hooks.hasBinding) {\n      if (this.debug) { this.logger!.trace(`binding()`); }\n\n      const ret = this.viewModel!.binding(this.$initiator, this.parent, this.$flags);\n      if (ret instanceof Promise) {\n        this.ensurePromise();\n        ret.then(() => {\n          this.bind();\n        }).catch(err => {\n          this.reject(err);\n        });\n        return this.$promise;\n      }\n    }\n\n    this.bind();\n    return this.$promise;\n  }\n\n  private bind(): void {\n    if (this.debug) { this.logger!.trace(`bind()`); }\n\n    // timing: after binding, before bound\n    // reason: needs to start observing before all the bindings finish their $bind phase,\n    //         so that changes in one binding can be reflected into the other, regardless the index of the binding\n    //\n    // todo: is this timing appropriate?\n    if (this.childrenObs.length) {\n      for (let i = 0; i < this.childrenObs.length; ++i) {\n        this.childrenObs[i].start();\n      }\n    }\n\n    if (this.bindings !== null) {\n      for (let i = 0; i < this.bindings.length; ++i) {\n        this.bindings[i].$bind(this.$flags, this.scope!, this.hostScope);\n      }\n    }\n\n    if (this.hooks.hasBound) {\n      if (this.debug) { this.logger!.trace(`bound()`); }\n\n      const ret = this.viewModel!.bound(this.$initiator, this.parent, this.$flags);\n      if (ret instanceof Promise) {\n        this.ensurePromise();\n        ret.then(() => {\n          this.isBound = true;\n          this.attach();\n        }).catch(err => {\n          this.reject(err);\n        });\n        return;\n      }\n    }\n\n    this.isBound = true;\n    this.attach();\n  }\n\n  private append(...nodes: Node[]): void {\n    switch (this.mountTarget) {\n      case MountTarget.host:\n        this.host!.append(...nodes);\n        break;\n      case MountTarget.shadowRoot:\n        this.shadowRoot!.append(...nodes);\n        break;\n      case MountTarget.location:\n        for (let i = 0; i < nodes.length; ++i) {\n          this.location!.parentNode!.insertBefore(nodes[i], this.location);\n        }\n        break;\n    }\n  }\n\n  private attach(): void {\n    if (this.debug) { this.logger!.trace(`attach()`); }\n\n    if (this.hostController !== null) {\n      switch (this.mountTarget) {\n        case MountTarget.host:\n        case MountTarget.shadowRoot:\n          this.hostController.append(this.host!);\n          break;\n        case MountTarget.location:\n          this.hostController.append(this.location!.$start!, this.location!);\n          break;\n      }\n    }\n\n    switch (this.mountTarget) {\n      case MountTarget.host:\n        this.nodes!.appendTo(this.host!, (this.definition as CustomElementDefinition | null)?.enhance);\n        break;\n      case MountTarget.shadowRoot: {\n        const container = this.container;\n        const styles = container.has(IShadowDOMStyles, false)\n          ? container.get(IShadowDOMStyles)\n          : container.get(IShadowDOMGlobalStyles);\n        styles.applyTo(this.shadowRoot!);\n        this.nodes!.appendTo(this.shadowRoot!);\n        break;\n      }\n      case MountTarget.location:\n        this.nodes!.insertBefore(this.location!);\n        break;\n    }\n\n    if (this.hooks.hasAttaching) {\n      if (this.debug) { this.logger!.trace(`attaching()`); }\n\n      const ret = this.viewModel!.attaching(this.$initiator, this.parent, this.$flags);\n      if (ret instanceof Promise) {\n        this.ensurePromise();\n        this.enterActivating();\n        ret.then(() => {\n          this.leaveActivating();\n        }).catch(err => {\n          this.reject(err);\n        });\n      }\n    }\n\n    // attaching() and child activation run in parallel, and attached() is called when both are finished\n    if (this.children !== null) {\n      for (let i = 0; i < this.children.length; ++i) {\n        // Any promises returned from child activation are cumulatively awaited before this.$promise resolves\n        void this.children[i].activate(this.$initiator, this as IHydratedController, this.$flags, this.scope, this.hostScope);\n      }\n    }\n\n    // attached() is invoked by Controller#leaveActivating when `activatingStack` reaches 0\n    this.leaveActivating();\n  }\n\n  public deactivate(\n    initiator: IHydratedController,\n    parent: IHydratedController | null,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    switch ((this.state & ~State.released)) {\n      case State.activated:\n        // We're fully activated, so proceed with normal deactivation.\n        this.state = State.deactivating;\n        break;\n      case State.none:\n      case State.deactivated:\n      case State.disposed:\n      case State.deactivated | State.disposed:\n        // If we're already deactivated (or even disposed), or never activated in the first place, no need to do anything.\n        return;\n      default:\n        throw new Error(`${this.name} unexpected state: ${stringifyState(this.state)}.`);\n    }\n\n    if (this.debug) { this.logger!.trace(`deactivate()`); }\n\n    this.$initiator = initiator;\n    this.$flags = flags;\n\n    if (initiator === this) {\n      this.enterDetaching();\n    }\n\n    // timing: before deactiving\n    // reason: avoid queueing a callback from the mutation observer, caused by the changes of nodes by repeat/if etc...\n    // todo: is this appropriate timing?\n    if (this.childrenObs.length) {\n      for (let i = 0; i < this.childrenObs.length; ++i) {\n        this.childrenObs[i].stop();\n      }\n    }\n\n    if (this.children !== null) {\n      for (let i = 0; i < this.children.length; ++i) {\n        // Child promise results are tracked by enter/leave combo's\n        void this.children[i].deactivate(initiator, this as IHydratedController, flags);\n      }\n    }\n\n    if (this.hooks.hasDetaching) {\n      if (this.debug) { this.logger!.trace(`detaching()`); }\n\n      const ret = this.viewModel!.detaching(this.$initiator, this.parent, this.$flags);\n      if (ret instanceof Promise) {\n        this.ensurePromise();\n        (initiator as Controller).enterDetaching();\n        ret.then(() => {\n          (initiator as Controller).leaveDetaching();\n        }).catch(err => {\n          (initiator as Controller).reject(err);\n        });\n      }\n    }\n\n    // Note: if a 3rd party plugin happens to do any async stuff in a template controller before calling deactivate on its view,\n    // then the linking will become out of order.\n    // For framework components, this shouldn't cause issues.\n    // We can only prevent that by linking up after awaiting the detaching promise, which would add an extra tick + a fair bit of\n    // overhead on this hot path, so it's (for now) a deliberate choice to not account for such situation.\n    // Just leaving the note here so that we know to look here if a weird detaching-related timing issue is ever reported.\n    if (initiator.head === null) {\n      initiator.head = this as IHydratedController;\n    } else {\n      initiator.tail!.next = this as IHydratedController;\n    }\n    initiator.tail = this as IHydratedController;\n\n    if (initiator !== this) {\n      // Only detaching is called + the linked list is built when any controller that is not the initiator, is deactivated.\n      // The rest is handled by the initiator.\n      // This means that descendant controllers have to make sure to await the initiator's promise before doing any subsequent\n      // controller api calls, or race conditions might occur.\n      return;\n    }\n\n    this.leaveDetaching();\n    return this.$promise;\n  }\n\n  private removeNodes(): void {\n    switch (this.vmKind) {\n      case ViewModelKind.customElement:\n      case ViewModelKind.synthetic:\n        this.nodes!.remove();\n        this.nodes!.unlink();\n    }\n\n    if (this.hostController !== null) {\n      switch (this.mountTarget) {\n        case MountTarget.host:\n        case MountTarget.shadowRoot:\n          this.host!.remove();\n          break;\n        case MountTarget.location:\n          this.location!.$start!.remove();\n          this.location!.remove();\n          break;\n      }\n    }\n  }\n\n  private unbind(): void {\n    if (this.debug) { this.logger!.trace(`unbind()`); }\n\n    const flags = this.$flags | LifecycleFlags.fromUnbind;\n\n    if (this.bindings !== null) {\n      for (let i = 0; i < this.bindings.length; ++i) {\n        this.bindings[i].$unbind(flags);\n      }\n    }\n\n    this.parent = null;\n\n    switch (this.vmKind) {\n      case ViewModelKind.customAttribute:\n        this.scope = null;\n        break;\n      case ViewModelKind.synthetic:\n        if (!this.hasLockedScope) {\n          this.scope = null;\n        }\n\n        if (\n          (this.state & State.released) === State.released &&\n          !this.viewFactory!.tryReturnToCache(this as ISyntheticView) &&\n          this.$initiator === this\n        ) {\n          this.dispose();\n        }\n        break;\n      case ViewModelKind.customElement:\n        (this.scope as Writable<Scope>).parentScope = null;\n        break;\n    }\n\n    if ((flags & LifecycleFlags.dispose) === LifecycleFlags.dispose && this.$initiator === this) {\n      this.dispose();\n    }\n    this.state = (this.state & State.disposed) | State.deactivated;\n    this.$initiator = null!;\n    this.resolve();\n  }\n\n  private $resolve: (() => void) | undefined = void 0;\n  private $reject: ((err: unknown) => void) | undefined = void 0;\n  private $promise: Promise<void> | undefined = void 0;\n\n  private ensurePromise(): void {\n    if (this.$promise === void 0) {\n      this.$promise = new Promise((resolve, reject) => {\n        this.$resolve = resolve;\n        this.$reject = reject;\n      });\n      if (this.$initiator !== this) {\n        (this.parent as Controller).ensurePromise();\n      }\n    }\n  }\n\n  private resolve(): void {\n    if (this.$promise !== void 0) {\n      const resolve = this.$resolve!;\n      this.$resolve = this.$reject = this.$promise = void 0;\n      resolve();\n    }\n  }\n\n  private reject(err: Error): void {\n    if (this.$promise !== void 0) {\n      const reject = this.$reject!;\n      this.$resolve = this.$reject = this.$promise = void 0;\n      reject(err);\n    }\n    if (this.$initiator !== this) {\n      (this.parent as Controller).reject(err);\n    }\n  }\n\n  private activatingStack: number = 0;\n  private enterActivating(): void {\n    ++this.activatingStack;\n    if (this.$initiator !== this) {\n      (this.parent as Controller).enterActivating();\n    }\n  }\n  private leaveActivating(): void {\n    if (--this.activatingStack === 0) {\n      if (this.hooks.hasAttached) {\n        if (this.debug) { this.logger!.trace(`attached()`); }\n\n        const ret = this.viewModel!.attached!(this.$initiator, this.$flags);\n        if (ret instanceof Promise) {\n          this.ensurePromise();\n          ret.then(() => {\n            this.state = State.activated;\n            // Resolve this.$promise, signaling that activation is done (path 1 of 2)\n            this.resolve();\n            if (this.$initiator !== this) {\n              (this.parent as Controller).leaveActivating();\n            }\n          }).catch(err => {\n            this.reject(err);\n          });\n          return;\n        }\n      }\n\n      this.state = State.activated;\n      // Resolve this.$promise (if present), signaling that activation is done (path 2 of 2)\n      this.resolve();\n    }\n    if (this.$initiator !== this) {\n      (this.parent as Controller).leaveActivating();\n    }\n  }\n\n  private detachingStack: number = 0;\n  private enterDetaching(): void {\n    ++this.detachingStack;\n  }\n  private leaveDetaching(): void {\n    if (--this.detachingStack === 0) {\n      // Note: this controller is the initiator (detach is only ever called on the initiator)\n      if (this.debug) { this.logger!.trace(`detach()`); }\n\n      this.enterUnbinding();\n      this.removeNodes();\n\n      let cur = this.$initiator.head as Controller | null;\n      while (cur !== null) {\n        if (cur !== this) {\n          if (cur.debug) { cur.logger!.trace(`detach()`); }\n\n          cur.removeNodes();\n        }\n\n        if (cur.hooks.hasUnbinding) {\n          if (cur.debug) { cur.logger!.trace('unbinding()'); }\n\n          const ret = cur.viewModel!.unbinding(cur.$initiator, cur.parent, cur.$flags);\n          if (ret instanceof Promise) {\n            this.ensurePromise();\n            this.enterUnbinding();\n            ret.then(() => {\n              this.leaveUnbinding();\n            }).catch(err => {\n              this.reject(err);\n            });\n          }\n        }\n\n        cur = cur.next as Controller;\n      }\n\n      this.leaveUnbinding();\n    }\n  }\n\n  private unbindingStack: number = 0;\n  private enterUnbinding(): void {\n    ++this.unbindingStack;\n  }\n  private leaveUnbinding(): void {\n    if (--this.unbindingStack === 0) {\n      if (this.debug) { this.logger!.trace(`unbind()`); }\n\n      let cur = this.$initiator.head as Controller | null;\n      let next: Controller | null = null;\n      while (cur !== null) {\n        if (cur !== this) {\n          cur.isBound = false;\n          cur.unbind();\n        }\n        next = cur.next as Controller;\n        cur.next = null;\n        cur = next;\n      }\n\n      this.head = this.tail = null;\n      this.isBound = false;\n      this.unbind();\n    }\n  }\n\n  public addBinding(binding: IBinding): void {\n    if (this.bindings === null) {\n      this.bindings = [binding];\n    } else {\n      this.bindings[this.bindings.length] = binding;\n    }\n  }\n\n  public addChild(controller: Controller): void {\n    if (this.children === null) {\n      this.children = [controller];\n    } else {\n      this.children[this.children.length] = controller;\n    }\n  }\n\n  public is(name: string): boolean {\n    switch (this.vmKind) {\n      case ViewModelKind.customAttribute: {\n        const def = CustomAttribute.getDefinition(this.viewModel!.constructor as Constructable);\n        return def.name === name;\n      }\n      case ViewModelKind.customElement: {\n        const def = CustomElement.getDefinition(this.viewModel!.constructor as Constructable);\n        return def.name === name;\n      }\n      case ViewModelKind.synthetic:\n        return this.viewFactory!.name === name;\n    }\n  }\n\n  public lockScope(scope: Writable<Scope>): void {\n    this.scope = scope;\n    this.hasLockedScope = true;\n  }\n\n  public setHost(host: HTMLElement): this {\n    if (this.vmKind === ViewModelKind.customElement) {\n      setRef(host, CustomElement.name, this as IHydratedController);\n      setRef(host, this.definition!.key, this as IHydratedController);\n    }\n    this.host = host;\n    this.mountTarget = MountTarget.host;\n    return this;\n  }\n\n  public setShadowRoot(shadowRoot: ShadowRoot): this {\n    if (this.vmKind === ViewModelKind.customElement) {\n      setRef(shadowRoot, CustomElement.name, this as IHydratedController);\n      setRef(shadowRoot, this.definition!.key, this as IHydratedController);\n    }\n    this.shadowRoot = shadowRoot;\n    this.mountTarget = MountTarget.shadowRoot;\n    return this;\n  }\n\n  public setLocation(location: IRenderLocation): this {\n    if (this.vmKind === ViewModelKind.customElement) {\n      setRef(location, CustomElement.name, this as IHydratedController);\n      setRef(location, this.definition!.key, this as IHydratedController);\n    }\n    this.location = location;\n    this.mountTarget = MountTarget.location;\n    return this;\n  }\n\n  public release(): void {\n    this.state |= State.released;\n  }\n\n  public dispose(): void {\n    if (this.debug) { this.logger!.trace(`dispose()`); }\n\n    if ((this.state & State.disposed) === State.disposed) {\n      return;\n    }\n    this.state |= State.disposed;\n\n    if (this.hooks.hasDispose) {\n      this.viewModel!.dispose();\n    }\n\n    if (this.children !== null) {\n      this.children.forEach(callDispose);\n      this.children = null;\n    }\n\n    this.hostController = null;\n    this.scope = null;\n\n    this.nodes = null;\n    this.context = null;\n    this.location = null;\n\n    this.viewFactory = null;\n    if (this.viewModel !== null) {\n      controllerLookup.delete(this.viewModel);\n      this.viewModel = null;\n    }\n    this.viewModel = null;\n    this.host = null;\n    this.shadowRoot = null;\n    this.root = null;\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    if (visitor(this as IHydratedController) === true) {\n      return true;\n    }\n\n    if (this.hooks.hasAccept && this.viewModel!.accept(visitor) === true) {\n      return true;\n    }\n\n    if (this.children !== null) {\n      const { children } = this;\n      for (let i = 0, ii = children.length; i < ii; ++i) {\n        if (children[i].accept(visitor) === true) {\n          return true;\n        }\n      }\n    }\n  }\n}\n\nfunction getLookup(instance: IIndexable): Record<string, BindableObserver | ChildrenObserver> {\n  let lookup = instance.$observers;\n  if (lookup === void 0) {\n    Reflect.defineProperty(\n      instance,\n      '$observers',\n      {\n        enumerable: false,\n        value: lookup = {},\n      },\n    );\n  }\n  return lookup as Record<string, BindableObserver | ChildrenObserver>;\n}\n\nfunction createObservers(\n  controller: Controller,\n  definition: CustomElementDefinition | CustomAttributeDefinition,\n  // deepscan-disable-next-line\n  _flags: LifecycleFlags,\n  instance: object,\n): void {\n  const bindables = definition.bindables;\n  const observableNames = Object.getOwnPropertyNames(bindables);\n  const length = observableNames.length;\n  if (length > 0) {\n    let name: string;\n    let bindable: BindableDefinition;\n    let i = 0;\n    const observers = getLookup(instance as IIndexable);\n\n    for (; i < length; ++i) {\n      name = observableNames[i];\n\n      if (observers[name] === void 0) {\n        bindable = bindables[name];\n\n        observers[name] = new BindableObserver(\n          instance as IIndexable,\n          name,\n          bindable.callback,\n          bindable.set,\n          controller,\n        );\n      }\n    }\n  }\n}\n\nfunction createChildrenObservers(\n  controller: Controller,\n  definition: CustomElementDefinition,\n  // deepscan-disable-next-line\n  _flags: LifecycleFlags,\n  instance: object,\n): ChildrenObserver[] {\n  const childrenObservers = definition.childrenObservers;\n  const childObserverNames = Object.getOwnPropertyNames(childrenObservers);\n  const length = childObserverNames.length;\n  if (length > 0) {\n    const observers = getLookup(instance as IIndexable);\n    const obs: ChildrenObserver[] = [];\n\n    let name: string;\n    let i = 0;\n    let childrenDescription: ChildrenDefinition;\n    for (; i < length; ++i) {\n      name = childObserverNames[i];\n\n      if (observers[name] == void 0) {\n        childrenDescription = childrenObservers[name];\n        obs[obs.length] = observers[name] = new ChildrenObserver(\n          controller as ICustomElementController,\n          instance as IIndexable,\n          name,\n          childrenDescription.callback,\n          childrenDescription.query,\n          childrenDescription.filter,\n          childrenDescription.map,\n          childrenDescription.options,\n        );\n      }\n    }\n    return obs;\n  }\n\n  return emptyArray;\n}\n\nconst AccessScopeAstMap = new Map<PropertyKey, AccessScopeExpression>();\nconst getAccessScopeAst = (key: PropertyKey) => {\n  let ast = AccessScopeAstMap.get(key);\n  if (ast == null) {\n    ast = new AccessScopeExpression(key as string, 0);\n    AccessScopeAstMap.set(key, ast);\n  }\n  return ast;\n};\n\nfunction createWatchers(\n  controller: Controller,\n  context: IServiceLocator,\n  definition: CustomElementDefinition | CustomAttributeDefinition,\n  instance: object,\n) {\n  const observerLocator = context!.get(IObserverLocator);\n  const expressionParser = context.get(IExpressionParser);\n  const watches = definition.watches;\n  const scope: Scope = controller.vmKind === ViewModelKind.customElement\n    ? controller.scope!\n    // custom attribute does not have own scope\n    : Scope.create(instance, null, true);\n  const ii = watches.length;\n  let expression: IWatchDefinition['expression'];\n  let callback: IWatchDefinition['callback'];\n  let ast: IsBindingBehavior;\n  let i = 0;\n\n  for (; ii > i; ++i) {\n    ({ expression, callback } = watches[i]);\n    callback = typeof callback === 'function'\n      ? callback\n      : Reflect.get(instance, callback) as IWatcherCallback<object>;\n    if (typeof callback !== 'function') {\n      throw new Error(`Invalid callback for @watch decorator: ${String(callback)}`);\n    }\n    if (typeof expression === 'function') {\n      controller.addBinding(new ComputedWatcher(\n        instance as IObservable,\n        observerLocator,\n        expression,\n        callback,\n        // there should be a flag to purposely disable proxy\n        // AOT: not true for IE11\n        true,\n      ));\n    } else {\n      ast = typeof expression === 'string'\n        ? expressionParser.parse(expression, BindingType.BindCommand)\n        : getAccessScopeAst(expression);\n\n      controller.addBinding(new ExpressionWatcher(\n        scope,\n        context,\n        observerLocator,\n        ast,\n        callback\n      ) as unknown as IBinding);\n    }\n  }\n}\n\nexport function isCustomElementController<C extends ICustomElementViewModel = ICustomElementViewModel>(value: unknown): value is ICustomElementController<C> {\n  return value instanceof Controller && value.vmKind === ViewModelKind.customElement;\n}\n\nexport function isCustomElementViewModel(value: unknown): value is ICustomElementViewModel {\n  return isObject(value) && CustomElement.isType(value.constructor);\n}\n\nexport class HooksDefinition {\n  public static readonly none: Readonly<HooksDefinition> = new HooksDefinition({});\n\n  public readonly hasDefine: boolean;\n\n  public readonly hasHydrating: boolean;\n  public readonly hasHydrated: boolean;\n  public readonly hasCreated: boolean;\n\n  public readonly hasBinding: boolean;\n  public readonly hasBound: boolean;\n  public readonly hasAttaching: boolean;\n  public readonly hasAttached: boolean;\n\n  public readonly hasDetaching: boolean;\n  public readonly hasUnbinding: boolean;\n\n  public readonly hasDispose: boolean;\n  public readonly hasAccept: boolean;\n\n  public constructor(target: object) {\n    this.hasDefine = 'define' in target;\n\n    this.hasHydrating = 'hydrating' in target;\n    this.hasHydrated = 'hydrated' in target;\n    this.hasCreated = 'created' in target;\n\n    this.hasBinding = 'binding' in target;\n    this.hasBound = 'bound' in target;\n    this.hasAttaching = 'attaching' in target;\n    this.hasAttached = 'attached' in target;\n\n    this.hasDetaching = 'detaching' in target;\n    this.hasUnbinding = 'unbinding' in target;\n\n    this.hasDispose = 'dispose' in target;\n    this.hasAccept = 'accept' in target;\n  }\n}\n\nconst defaultShadowOptions = {\n  mode: 'open' as 'open' | 'closed'\n};\n\nexport const enum ViewModelKind {\n  customElement,\n  customAttribute,\n  synthetic\n}\n\n/**\n * A controller that is ready for activation. It can be `ISyntheticView`, `ICustomElementController` or `ICustomAttributeController`.\n *\n * In terms of specificity this is identical to `IController`. The only difference is that this\n * type is further initialized and thus has more properties and APIs available.\n */\nexport type IHydratedController = ISyntheticView | ICustomElementController | ICustomAttributeController;\n/**\n * A controller that is ready for activation. It can be `ICustomElementController` or `ICustomAttributeController`.\n *\n * This type of controller is backed by a real component (hence the name) and therefore has ViewModel and may have lifecycle hooks.\n *\n * In contrast, `ISyntheticView` has neither a view model nor lifecycle hooks (but its child controllers, if any, may).\n */\nexport type IHydratedComponentController = ICustomElementController | ICustomAttributeController;\n/**\n * A controller that is ready for activation. It can be `ISyntheticView` or `ICustomElementController`.\n *\n * This type of controller may have child controllers (hence the name) and bindings directly placed on it during hydration.\n *\n * In contrast, `ICustomAttributeController` has neither child controllers nor bindings directly placed on it (but the backing component may).\n *\n * Note: the parent of a `ISyntheticView` is always a `IHydratedComponentController` because views cannot directly own other views. Views may own components, and components may own views or components.\n */\nexport type IHydratedParentController = ISyntheticView | ICustomElementController;\n\n/**\n * A callback that is invoked on each controller in the component tree.\n *\n * Return `true` to stop traversal.\n */\nexport type ControllerVisitor = (controller: IHydratedController) => void | true;\n\n/**\n * The base type for all controller types.\n *\n * Every controller, regardless of their type and state, will have at least the properties/methods in this interface.\n */\nexport interface IController<C extends IViewModel = IViewModel> extends IDisposable {\n  /** @internal */readonly id: number;\n  /**\n   * The container associated with this controller.\n   * By default, CE should have their own container while custom attribute & synthetic view\n   * will use the parent container one, since they do not need to manage one\n   */\n  readonly container: IContainer;\n  readonly platform: IPlatform;\n  readonly root: IAppRoot | null;\n  readonly flags: LifecycleFlags;\n  readonly vmKind: ViewModelKind;\n  readonly definition: CustomElementDefinition | CustomAttributeDefinition | null;\n  readonly host: HTMLElement | null;\n  readonly state: State;\n  readonly isActive: boolean;\n  readonly parent: IHydratedController | null;\n  readonly isBound: boolean;\n\n  /** @internal */head: IHydratedController | null;\n  /** @internal */tail: IHydratedController | null;\n  /** @internal */next: IHydratedController | null;\n\n  /**\n   * Return `true` to stop traversal.\n   */\n  accept(visitor: ControllerVisitor): void | true;\n}\n\n/**\n * The base type for `ICustomAttributeController` and `ICustomElementController`.\n *\n * Both of those types have the `viewModel` property which represent the user instance containing the bound properties and hooks for this component.\n */\nexport interface IComponentController<C extends IViewModel = IViewModel> extends IController<C> {\n  readonly vmKind: ViewModelKind.customAttribute | ViewModelKind.customElement;\n  readonly definition: CustomElementDefinition | CustomAttributeDefinition;\n\n  /**\n   * The user instance containing the bound properties. This is always an instance of a class, which may either be user-defined, or generated by a view locator.\n   */\n  readonly viewModel: C;\n\n}\n\n/**\n * The base type for `ISyntheticView` and `ICustomElementController`.\n *\n * Both of those types can:\n * - Have `bindings` and `children` which are populated during hydration (hence, 'Hydratable').\n * - Have physical DOM nodes that can be mounted.\n */\nexport interface IHydratableController<C extends IViewModel = IViewModel> extends IController<C> {\n  readonly vmKind: ViewModelKind.customElement | ViewModelKind.synthetic;\n  readonly mountTarget: MountTarget;\n  readonly definition: CustomElementDefinition | null;\n\n  readonly bindings: readonly IBinding[] | null;\n  readonly children: readonly IHydratedController[] | null;\n\n  addBinding(binding: IBinding): void;\n  addChild(controller: IController): void;\n}\n\nexport const enum State {\n  none                     = 0b00_00_00,\n  activating               = 0b00_00_01,\n  activated                = 0b00_00_10,\n  deactivating             = 0b00_01_00,\n  deactivated              = 0b00_10_00,\n  released                 = 0b01_00_00,\n  disposed                 = 0b10_00_00,\n}\n\nexport function stringifyState(state: State): string {\n  const names: string[] = [];\n\n  if ((state & State.activating) === State.activating) { names.push('activating'); }\n  if ((state & State.activated) === State.activated) { names.push('activated'); }\n  if ((state & State.deactivating) === State.deactivating) { names.push('deactivating'); }\n  if ((state & State.deactivated) === State.deactivated) { names.push('deactivated'); }\n  if ((state & State.released) === State.released) { names.push('released'); }\n  if ((state & State.disposed) === State.disposed) { names.push('disposed'); }\n\n  return names.length === 0 ? 'none' : names.join('|');\n}\n\n/**\n * The controller for a synthetic view, that is, a controller created by an `IViewFactory`.\n *\n * A synthetic view, typically created when composing a template controller (`if`, `repeat`, etc), is a hydratable component with mountable DOM nodes that has no user view model.\n *\n * It has either its own synthetic binding context or is locked to some externally sourced scope (in the case of `au-compose`)\n */\nexport interface ISyntheticView extends IHydratableController {\n  readonly vmKind: ViewModelKind.synthetic;\n  readonly definition: null;\n  readonly viewModel: null;\n  hostScope: Scope | null;\n  /**\n   * The compiled render context used for composing this view. Compilation was done by the `IViewFactory` prior to creating this view.\n   */\n  readonly context: ICompiledRenderContext;\n  readonly isStrictBinding: boolean;\n  /**\n   * The physical DOM nodes that will be appended during the attach operation.\n   */\n  readonly nodes: INodeSequence;\n\n  activate(\n    initiator: IHydratedController,\n    parent: IHydratedController,\n    flags: LifecycleFlags,\n    scope: Scope,\n    hostScope?: Scope | null,\n  ): void | Promise<void>;\n  deactivate(\n    initiator: IHydratedController,\n    parent: IHydratedController,\n    flags: LifecycleFlags,\n  ): void | Promise<void>;\n  /**\n   * Lock this view's scope to the provided `Scope`. The scope, which is normally set during `activate()`, will then not change anymore.\n   *\n   * This is used by `au-compose` to set the binding context of a view to a particular component instance.\n   *\n   * @param scope - The scope to lock this view to.\n   */\n  lockScope(scope: Scope): void;\n  /**\n   * The scope that belongs to this view. This property will always be defined when the `state` property of this view indicates that the view is currently bound.\n   *\n   * The `scope` may be set during `activate()` and unset during `deactivate()`, or it may be statically set during composing with `lockScope()`.\n   */\n  readonly scope: Scope;\n\n  /**\n   * Set the render location that this view will be inserted before.\n   */\n  setLocation(location: IRenderLocation): this;\n  /**\n   * The DOM node that this view will be inserted before (if set).\n   */\n  readonly location: IRenderLocation | null;\n\n  /**\n   * Set the host that this view will be appended to.\n   */\n  setHost(host: Node & ParentNode): this;\n  /**\n   * The DOM node that this view will be appended to (if set).\n   */\n  readonly host: HTMLElement | null;\n\n  /**\n   * Set the `ShadowRoot` that this view will be appended to.\n   */\n  setShadowRoot(shadowRoot: ShadowRoot): this;\n  /**\n   * The ShadowRoot that this view will be appended to (if set).\n   */\n  readonly shadowRoot: ShadowRoot | null;\n\n  /**\n   * Mark this view as not-in-use, so that it can either be disposed or returned to cache after finishing the deactivate lifecycle.\n   *\n   * If this view is cached and later retrieved from the cache, it will be marked as in-use again before starting the activate lifecycle, so this method must be called each time.\n   *\n   * If this method is *not* called before `deactivate()`, this view will neither be cached nor disposed.\n   */\n  release(): void;\n}\n\nexport interface ICustomAttributeController<C extends ICustomAttributeViewModel = ICustomAttributeViewModel> extends IComponentController<C> {\n  readonly vmKind: ViewModelKind.customAttribute;\n  readonly definition: CustomAttributeDefinition;\n  /**\n   * @inheritdoc\n   */\n  readonly viewModel: C;\n  readonly lifecycleHooks: LifecycleHooksLookup;\n  /**\n   * The scope that belongs to this custom attribute. This property will always be defined when the `state` property of this view indicates that the view is currently bound.\n   *\n   * The `scope` will be set during `activate()` and unset during `deactivate()`.\n   *\n   * The scope's `bindingContext` will be the same instance as this controller's `viewModel` property.\n   */\n  readonly scope: Scope;\n  hostScope: Scope | null;\n  readonly children: null;\n  readonly bindings: null;\n  activate(\n    initiator: IHydratedController,\n    parent: IHydratedController,\n    flags: LifecycleFlags,\n    scope: Scope,\n    hostScope?: Scope | null,\n  ): void | Promise<void>;\n  deactivate(\n    initiator: IHydratedController,\n    parent: IHydratedController,\n    flags: LifecycleFlags,\n  ): void | Promise<void>;\n}\n\n/**\n * A representation of `IController` specific to a custom element whose `create` hook is about to be invoked (if present).\n *\n * It is not yet hydrated (hence 'dry') with any render-specific information.\n */\nexport interface IDryCustomElementController<C extends IViewModel = IViewModel> extends IComponentController<C>, IHydratableController<C> {\n  readonly vmKind: ViewModelKind.customElement;\n  readonly definition: CustomElementDefinition;\n  /**\n   * The scope that belongs to this custom element. This property is set immediately after the controller is created and is always guaranteed to be available.\n   *\n   * It may be overwritten by end user during the `create()` hook.\n   *\n   * By default, the scope's `bindingContext` will be the same instance as this controller's `viewModel` property.\n   */\n  scope: Scope;\n  hostScope: Scope | null;\n  /**\n   * The original host dom node.\n   *\n   * For containerless elements, this node will be removed from the DOM and replaced by a comment, which is assigned to the `location` property.\n   *\n   * For ShadowDOM elements, this will be the original declaring element, NOT the shadow root (the shadow root is stored on the `shadowRoot` property)\n   */\n  readonly host: HTMLElement;\n}\n\n/**\n * A representation of `IController` specific to a custom element whose `hydrating` hook is about to be invoked (if present).\n *\n * It has the same properties as `IDryCustomElementController`, as well as a render context (hence 'contextual').\n */\nexport interface IContextualCustomElementController<C extends IViewModel = IViewModel> extends IDryCustomElementController<C> {\n  /**\n   * The non-compiled render context used for compiling this component's `CustomElementDefinition`.\n   */\n  readonly context: IRenderContext;\n}\n\n/**\n * A representation of `IController` specific to a custom element whose `hydrated` hook is about to be invoked (if present).\n *\n * It has the same properties as `IContextualCustomElementController`, except the context is now compiled (hence 'compiled'), as well as the nodes, and projector.\n */\nexport interface ICompiledCustomElementController<C extends IViewModel = IViewModel> extends IContextualCustomElementController<C> {\n  /**\n   * The compiled render context used for hydrating this controller.\n   */\n  readonly context: ICompiledRenderContext;\n  readonly isStrictBinding: boolean;\n  /**\n   * The ShadowRoot, if this custom element uses ShadowDOM.\n   */\n  readonly shadowRoot: ShadowRoot | null;\n  /**\n   * The renderLocation, if this is a `containerless` custom element.\n   */\n  readonly location: IRenderLocation | null;\n  /**\n   * The physical DOM nodes that will be appended during the `mount()` operation.\n   */\n  readonly nodes: INodeSequence;\n}\n\n/**\n * A fully hydrated custom element controller.\n */\nexport interface ICustomElementController<C extends ICustomElementViewModel = ICustomElementViewModel> extends ICompiledCustomElementController<C> {\n  /**\n   * @inheritdoc\n   */\n  readonly viewModel: C;\n  readonly lifecycleHooks: LifecycleHooksLookup;\n\n  activate(\n    initiator: IHydratedController,\n    parent: IHydratedController | null,\n    flags: LifecycleFlags,\n    scope?: Scope,\n    hostScope?: Scope | null,\n  ): void | Promise<void>;\n  deactivate(\n    initiator: IHydratedController,\n    parent: IHydratedController | null,\n    flags: LifecycleFlags,\n  ): void | Promise<void>;\n}\n\nexport const IController = DI.createInterface<IController>('IController');\n\nexport const IHydrationContext = DI.createInterface<IHydrationContext>('IHydrationContext');\nexport interface IHydrationContext<T = unknown> extends HydrationContext<T> {\n}\n\nclass HydrationContext<T extends ICustomElementViewModel> {\n  public readonly controller: ICustomElementController<T>;\n  public constructor(\n    controller: Controller,\n    public readonly instruction: IControllerElementHydrationInstruction | null,\n    public readonly parent: IHydrationContext | undefined,\n  ) {\n    this.controller = controller as ICustomElementController<T>;\n  }\n}\n\nexport interface IActivationHooks<TParent> {\n  binding?(\n    initiator: IHydratedController,\n    parent: TParent,\n    flags: LifecycleFlags,\n  ): void | Promise<void>;\n  bound?(\n    initiator: IHydratedController,\n    parent: TParent,\n    flags: LifecycleFlags,\n  ): void | Promise<void>;\n  attaching?(\n    initiator: IHydratedController,\n    parent: TParent,\n    flags: LifecycleFlags,\n  ): void | Promise<void>;\n  attached?(\n    initiator: IHydratedController,\n    flags: LifecycleFlags,\n  ): void | Promise<void>;\n\n  detaching?(\n    initiator: IHydratedController,\n    parent: TParent,\n    flags: LifecycleFlags,\n  ): void | Promise<void>;\n  unbinding?(\n    initiator: IHydratedController,\n    parent: TParent,\n    flags: LifecycleFlags,\n  ): void | Promise<void>;\n\n  dispose?(): void;\n  /**\n   * If this component controls the instantiation and lifecycles of one or more controllers,\n   * implement this hook to enable component tree traversal for plugins that use it (such as the router).\n   *\n   * Return `true` to stop traversal.\n   */\n  accept?(visitor: ControllerVisitor): void | true;\n}\n\nexport interface ICompileHooks {\n  define?(\n    controller: IDryCustomElementController<this>,\n    parentContainer: IContainer,\n    definition: CustomElementDefinition,\n  ): PartialCustomElementDefinition | void;\n  hydrating?(\n    controller: IContextualCustomElementController<this>,\n  ): void;\n  hydrated?(\n    controller: ICompiledCustomElementController<this>,\n  ): void;\n  created?(\n    controller: ICustomElementController<this> | ICustomAttributeController<this>,\n  ): void;\n}\n\n/**\n * Defines optional lifecycle hooks that will be called only when they are implemented.\n */\nexport interface IViewModel {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  constructor: Function;\n  readonly $controller?: IController<this>;\n}\n\nexport interface ICustomElementViewModel extends IViewModel, IActivationHooks<IHydratedController | null>, ICompileHooks {\n  readonly $controller?: ICustomElementController<this>;\n  created?(\n    controller: ICustomElementController<this>,\n  ): void;\n}\n\nexport interface ICustomAttributeViewModel extends IViewModel, IActivationHooks<IHydratedController> {\n  readonly $controller?: ICustomAttributeController<this>;\n  link?(\n    flags: LifecycleFlags,\n    parentContext: ICompiledRenderContext,\n    controller: IHydratableController,\n    childController: ICustomAttributeController,\n    target: INode,\n    instruction: Instruction,\n  ): void;\n  created?(\n    controller: ICustomAttributeController<this>,\n  ): void;\n}\n\nexport interface IHydratedCustomElementViewModel extends ICustomElementViewModel {\n  readonly $controller: ICustomElementController<this>;\n}\n\nexport interface IHydratedCustomAttributeViewModel extends ICustomAttributeViewModel {\n  readonly $controller: ICustomAttributeController<this>;\n}\n\nexport interface IControllerElementHydrationInstruction {\n  readonly projections: IProjections | null;\n}\n\nfunction callDispose(disposable: IDisposable): void {\n  disposable.dispose();\n}\n","import { DI, Registration, InstanceProvider, onResolve, resolveAll, ILogger } from '@aurelia/kernel';\nimport { LifecycleFlags } from '@aurelia/runtime';\nimport { INode } from './dom.js';\nimport { IAppTask } from './app-task.js';\nimport { CustomElement, CustomElementDefinition } from './resources/custom-element.js';\nimport { Controller } from './templating/controller.js';\n\nimport type { Constructable, IContainer, IDisposable } from '@aurelia/kernel';\nimport type { TaskSlot } from './app-task.js';\nimport type { ICustomElementViewModel, ICustomElementController } from './templating/controller.js';\nimport type { IPlatform } from './platform.js';\n\nexport interface ISinglePageApp {\n  host: HTMLElement;\n  component: unknown;\n}\n\nexport interface IAppRoot extends AppRoot {}\nexport const IAppRoot = DI.createInterface<IAppRoot>('IAppRoot');\n\nexport interface IWorkTracker extends WorkTracker {}\nexport const IWorkTracker = DI.createInterface<IWorkTracker>('IWorkTracker', x => x.singleton(WorkTracker));\nexport class WorkTracker {\n  private stack: number = 0;\n  private promise: Promise<void> | null = null;\n  private resolve: (() => void) | null = null;\n\n  public constructor(@ILogger private readonly logger: ILogger) {\n    this.logger = logger.scopeTo('WorkTracker');\n  }\n\n  public start(): void {\n    this.logger.trace(`start(stack:${this.stack})`);\n    ++this.stack;\n  }\n\n  public finish(): void {\n    this.logger.trace(`finish(stack:${this.stack})`);\n    if (--this.stack === 0) {\n      const resolve = this.resolve;\n      if (resolve !== null) {\n        this.resolve  = this.promise = null;\n        resolve();\n      }\n    }\n  }\n\n  public wait(): Promise<void> {\n    this.logger.trace(`wait(stack:${this.stack})`);\n    if (this.promise === null) {\n      if (this.stack === 0) {\n        return Promise.resolve();\n      }\n      this.promise = new Promise(resolve => {\n        this.resolve = resolve;\n      });\n    }\n    return this.promise;\n  }\n}\n\nexport class AppRoot implements IDisposable {\n  public readonly host: HTMLElement;\n\n  public controller: ICustomElementController = (void 0)!;\n  public work: IWorkTracker;\n\n  private hydratePromise: Promise<void> | void = void 0;\n  private readonly enhanceDefinition: CustomElementDefinition | undefined;\n\n  public constructor(\n    public readonly config: ISinglePageApp,\n    public readonly platform: IPlatform,\n    public readonly container: IContainer,\n    rootProvider: InstanceProvider<IAppRoot>,\n    enhance: boolean = false,\n  ) {\n    this.host = config.host;\n    this.work = container.get(IWorkTracker);\n    rootProvider.prepare(this);\n    // if (container.has(INode, false) && container.get(INode) !== config.host) {\n    //   this.container = container.createChild();\n    // }\n    this.container.register(Registration.instance(INode, config.host));\n\n    if (enhance) {\n      const component = config.component as Constructable | ICustomElementViewModel;\n      this.enhanceDefinition = CustomElement.getDefinition(\n        CustomElement.isType(component)\n          ? CustomElement.define({ ...CustomElement.getDefinition(component), template: this.host, enhance: true }, component)\n          : CustomElement.define({ name: (void 0)!, template: this.host, enhance: true })\n      );\n    }\n\n    this.hydratePromise = onResolve(this.runAppTasks('beforeCreate'), () => {\n      const component = config.component as Constructable | ICustomElementViewModel;\n      const ownContainer = container.createChild();\n      let instance: object;\n      if (CustomElement.isType(component)) {\n        instance = this.container.get(component);\n      } else {\n        instance = config.component as ICustomElementViewModel;\n      }\n\n      const controller = (this.controller = Controller.forCustomElement(\n        this,\n        container,\n        ownContainer,\n        instance,\n        this.host,\n        null,\n        LifecycleFlags.none,\n        false,\n        this.enhanceDefinition,\n      )) as Controller;\n\n      controller.hydrateCustomElement(null);\n      return onResolve(this.runAppTasks('hydrating'), () => {\n        controller.hydrate(null);\n        return onResolve(this.runAppTasks('hydrated'), () => {\n          controller.hydrateChildren();\n          this.hydratePromise = void 0;\n        });\n      });\n    });\n  }\n\n  public activate(): void | Promise<void> {\n    return onResolve(this.hydratePromise, () => {\n      return onResolve(this.runAppTasks('beforeActivate'), () => {\n        return onResolve(this.controller.activate(this.controller, null, LifecycleFlags.fromBind, void 0), () => {\n          return this.runAppTasks('afterActivate');\n        });\n      });\n    });\n  }\n\n  public deactivate(): void | Promise<void> {\n    return onResolve(this.runAppTasks('beforeDeactivate'), () => {\n      return onResolve(this.controller.deactivate(this.controller, null, LifecycleFlags.none), () => {\n        return this.runAppTasks('afterDeactivate');\n      });\n    });\n  }\n\n  /** @internal */\n  public runAppTasks(slot: TaskSlot): void | Promise<void> {\n    return resolveAll(...this.container.getAll(IAppTask).reduce((results, task) => {\n      if (task.slot === slot) {\n        results.push(task.run());\n      }\n      return results;\n    }, [] as (void | Promise<void>)[]));\n  }\n\n  public dispose(): void {\n    this.controller?.dispose();\n  }\n}\n","import { DI, Writable } from '@aurelia/kernel';\nimport { IAppRoot } from './app-root.js';\nimport { IPlatform } from './platform.js';\nimport { CustomElement } from './resources/custom-element.js';\nimport { MountTarget } from './templating/controller.js';\nimport type { IHydratedController } from './templating/controller.js';\n\nexport class Refs {\n  [key: string]: IHydratedController | undefined;\n}\n\nexport function getRef(node: INode, name: string): IHydratedController | null {\n  return node.$au?.[name] ?? null;\n}\n\nexport function setRef(node: INode, name: string, controller: IHydratedController): void {\n  ((node as Writable<INode>).$au ??= new Refs())[name] = controller;\n}\n\nexport type INode<T extends Node = Node> = T & {\n  readonly $au?: Refs;\n};\nexport const INode = DI.createInterface<INode>('INode');\n\nexport type IEventTarget<T extends EventTarget = EventTarget> = T;\nexport const IEventTarget = DI.createInterface<IEventTarget>('IEventTarget', x => x.cachedCallback(handler => {\n  if (handler.has(IAppRoot, true)) {\n    return handler.get(IAppRoot).host;\n  }\n  return handler.get(IPlatform).document;\n}));\n\nexport const IRenderLocation = DI.createInterface<IRenderLocation>('IRenderLocation');\nexport type IRenderLocation<T extends ChildNode = ChildNode> = T & {\n  $start?: IRenderLocation<T>;\n};\n\n/**\n * Represents a DocumentFragment\n */\nexport interface INodeSequence<T extends INode = INode> {\n  readonly platform: IPlatform;\n  readonly isMounted: boolean;\n  readonly isLinked: boolean;\n\n  readonly next?: INodeSequence<T>;\n\n  /**\n   * The nodes of this sequence.\n   */\n  readonly childNodes: ArrayLike<T>;\n\n  readonly firstChild: T;\n\n  readonly lastChild: T;\n\n  /**\n   * Find all instruction targets in this sequence.\n   */\n  findTargets(): ArrayLike<T>;\n\n  /**\n   * Insert this sequence as a sibling before refNode\n   */\n  insertBefore(refNode: T | IRenderLocation): void;\n\n  /**\n   * Append this sequence as a child to parent\n   */\n  appendTo(parent: T, enhance?: boolean): void;\n\n  /**\n   * Remove this sequence from the DOM.\n   */\n  remove(): void;\n\n  addToLinked(): void;\n\n  unlink(): void;\n\n  link(next: INodeSequence<T> | IRenderLocation | undefined): void;\n}\n\nexport const enum NodeType {\n  Element = 1,\n  Attr = 2,\n  Text = 3,\n  CDATASection = 4,\n  EntityReference = 5,\n  Entity = 6,\n  ProcessingInstruction = 7,\n  Comment = 8,\n  Document = 9,\n  DocumentType = 10,\n  DocumentFragment = 11,\n  Notation = 12\n}\n\nconst effectiveParentNodeOverrides = new WeakMap<Node, Node>();\n\n/**\n * Returns the effective parentNode according to Aurelia's component hierarchy.\n *\n * Used by Aurelia to find the closest parent controller relative to a node.\n *\n * This method supports 3 additional scenarios that `node.parentNode` does not support:\n * - Containerless elements. The parentNode in this case is a comment precending the element under specific conditions, rather than a node wrapping the element.\n * - ShadowDOM. If a `ShadowRoot` is encountered, this method retrieves the associated controller via the metadata api to locate the original host.\n * - Portals. If the provided node was moved to a different location in the DOM by a `portal` attribute, then the original parent of the node will be returned.\n *\n * @param node - The node to get the parent for.\n * @returns Either the closest parent node, the closest `IRenderLocation` (comment node that is the containerless host), original portal host, or `null` if this is either the absolute document root or a disconnected node.\n */\nexport function getEffectiveParentNode(node: Node): Node | null {\n  // TODO: this method needs more tests!\n  // First look for any overrides\n  if (effectiveParentNodeOverrides.has(node)) {\n    return effectiveParentNodeOverrides.get(node)!;\n  }\n\n  // Then try to get the nearest au-start render location, which would be the containerless parent,\n  // again looking for any overrides along the way.\n  // otherwise return the normal parent node\n  let containerlessOffset = 0;\n  let next = node.nextSibling;\n  while (next !== null) {\n    if (next.nodeType === NodeType.Comment) {\n      switch (next.textContent) {\n        case 'au-start':\n          // If we see an au-start before we see au-end, it will precede the host of a sibling containerless element rather than a parent.\n          // So we use the offset to ignore the next au-end\n          ++containerlessOffset;\n          break;\n        case 'au-end':\n          if (containerlessOffset-- === 0) {\n            return next;\n          }\n      }\n    }\n    next = next.nextSibling;\n  }\n\n  if (node.parentNode === null && node.nodeType === NodeType.DocumentFragment) {\n    // Could be a shadow root; see if there's a controller and if so, get the original host via the projector\n    const controller = CustomElement.for(node);\n    if (controller === void 0) {\n      // Not a shadow root (or at least, not one created by Aurelia)\n      // Nothing more we can try, just return null\n      return null;\n    }\n    if (controller.mountTarget === MountTarget.shadowRoot) {\n      return getEffectiveParentNode(controller.host);\n    }\n  }\n\n  return node.parentNode;\n}\n\n/**\n * Set the effective parentNode, overriding the DOM-based structure that `getEffectiveParentNode` otherwise defaults to.\n *\n * Used by Aurelia's `portal` template controller to retain the linkage between the portaled nodes (after they are moved to the portal target) and the original `portal` host.\n *\n * @param nodeSequence - The node sequence whose children that, when `getEffectiveParentNode` is called on, return the supplied `parentNode`.\n * @param parentNode - The node to return when `getEffectiveParentNode` is called on any child of the supplied `nodeSequence`.\n */\nexport function setEffectiveParentNode(nodeSequence: INodeSequence, parentNode: Node): void;\n/**\n * Set the effective parentNode, overriding the DOM-based structure that `getEffectiveParentNode` otherwise defaults to.\n *\n * Used by Aurelia's `portal` template controller to retain the linkage between the portaled nodes (after they are moved to the portal target) and the original `portal` host.\n *\n * @param childNode - The node that, when `getEffectiveParentNode` is called on, returns the supplied `parentNode`.\n * @param parentNode - The node to return when `getEffectiveParentNode` is called on the supplied `childNode`.\n */\nexport function setEffectiveParentNode(childNode: Node, parentNode: Node): void;\nexport function setEffectiveParentNode(childNodeOrNodeSequence: Node | INodeSequence, parentNode: Node): void {\n  if ((childNodeOrNodeSequence as INodeSequence).platform !== void 0 && !(childNodeOrNodeSequence instanceof (childNodeOrNodeSequence as INodeSequence).platform.Node)) {\n    const nodes = childNodeOrNodeSequence.childNodes;\n    for (let i = 0, ii = nodes.length; i < ii; ++i) {\n      effectiveParentNodeOverrides.set(nodes[i] as Node, parentNode);\n    }\n  } else {\n    effectiveParentNodeOverrides.set(childNodeOrNodeSequence as Node, parentNode);\n  }\n}\n\nexport function convertToRenderLocation(node: Node): IRenderLocation {\n  if (isRenderLocation(node)) {\n    return node; // it's already a IRenderLocation (converted by FragmentNodeSequence)\n  }\n\n  const locationEnd = node.ownerDocument!.createComment('au-end');\n  const locationStart = node.ownerDocument!.createComment('au-start');\n\n  if (node.parentNode !== null) {\n    node.parentNode.replaceChild(locationEnd, node);\n    locationEnd.parentNode!.insertBefore(locationStart, locationEnd);\n  }\n\n  (locationEnd as IRenderLocation).$start = locationStart as IRenderLocation;\n\n  return locationEnd as IRenderLocation;\n}\n\nexport function isRenderLocation(node: INode | INodeSequence): node is IRenderLocation {\n  return (node as Comment).textContent === 'au-end';\n}\n\nexport class FragmentNodeSequence implements INodeSequence {\n  public isMounted: boolean = false;\n  public isLinked: boolean = false;\n\n  public firstChild: Node;\n  public lastChild: Node;\n  public childNodes: Node[];\n\n  public next?: INodeSequence = void 0;\n\n  private refNode?: Node = void 0;\n\n  private readonly targets: ArrayLike<Node>;\n\n  public constructor(\n    public readonly platform: IPlatform,\n    private readonly fragment: DocumentFragment,\n  ) {\n    const targetNodeList = fragment.querySelectorAll('.au');\n    let i = 0;\n    let ii = targetNodeList.length;\n    const targets = this.targets = Array(ii);\n\n    while (i < ii) {\n      // eagerly convert all markers to RenderLocations (otherwise the renderer\n      // will do it anyway) and store them in the target list (since the comments\n      // can't be queried)\n      const target = targetNodeList[i];\n\n      if (target.nodeName === 'AU-M') {\n        // note the renderer will still call this method, but it will just return the\n        // location if it sees it's already a location\n        targets[i] = convertToRenderLocation(target);\n      } else {\n        // also store non-markers for consistent ordering\n        targets[i] = target;\n      }\n      ++i;\n    }\n\n    const childNodeList = fragment.childNodes;\n    i = 0;\n    ii = childNodeList.length;\n    const childNodes = this.childNodes = Array(ii);\n    while (i < ii) {\n      childNodes[i] = childNodeList[i] as Writable<Node>;\n      ++i;\n    }\n\n    this.firstChild = fragment.firstChild!;\n    this.lastChild = fragment.lastChild!;\n  }\n\n  public findTargets(): ArrayLike<Node> {\n    return this.targets;\n  }\n\n  public insertBefore(refNode: IRenderLocation & Comment): void {\n    if (this.isLinked && !!this.refNode) {\n      this.addToLinked();\n    } else {\n      const parent = refNode.parentNode!;\n      if (this.isMounted) {\n        let current = this.firstChild;\n        const end = this.lastChild;\n        let next: Node;\n\n        while (current != null) {\n          next = current.nextSibling!;\n          parent.insertBefore(current, refNode);\n\n          if (current === end) {\n            break;\n          }\n\n          current = next;\n        }\n      } else {\n        this.isMounted = true;\n        refNode.parentNode!.insertBefore(this.fragment, refNode);\n      }\n    }\n  }\n\n  public appendTo(parent: Node, enhance: boolean = false): void {\n    if (this.isMounted) {\n      let current = this.firstChild;\n      const end = this.lastChild;\n      let next: Node;\n\n      while (current != null) {\n        next = current.nextSibling!;\n        parent.appendChild(current);\n\n        if (current === end) {\n          break;\n        }\n\n        current = next;\n      }\n    } else {\n      this.isMounted = true;\n      if (!enhance) {\n        parent.appendChild(this.fragment);\n      }\n    }\n  }\n\n  public remove(): void {\n    if (this.isMounted) {\n      this.isMounted = false;\n\n      const fragment = this.fragment;\n      const end = this.lastChild;\n      let next: Node;\n\n      let current = this.firstChild;\n      while (current !== null) {\n        next = current.nextSibling!;\n        fragment.appendChild(current);\n\n        if (current === end) {\n          break;\n        }\n\n        current = next;\n      }\n    }\n  }\n\n  public addToLinked(): void {\n    const refNode = this.refNode!;\n    const parent = refNode.parentNode!;\n    if (this.isMounted) {\n      let current = this.firstChild;\n      const end = this.lastChild;\n      let next: Node;\n\n      while (current != null) {\n        next = current.nextSibling!;\n        parent.insertBefore(current, refNode);\n\n        if (current === end) {\n          break;\n        }\n\n        current = next;\n      }\n    } else {\n      this.isMounted = true;\n      parent.insertBefore(this.fragment, refNode);\n    }\n  }\n\n  public unlink(): void {\n    this.isLinked = false;\n    this.next = void 0;\n    this.refNode = void 0;\n  }\n\n  public link(next: INodeSequence | IRenderLocation & Comment | undefined): void {\n    this.isLinked = true;\n    if (isRenderLocation(next!)) {\n      this.refNode = next;\n    } else {\n      this.next = next;\n      this.obtainRefNode();\n    }\n  }\n\n  private obtainRefNode(): void {\n    if (this.next !== void 0) {\n      this.refNode = this.next.firstChild;\n    } else {\n      this.refNode = void 0;\n    }\n  }\n}\n\nexport const IWindow = DI.createInterface<IWindow>('IWindow', x => x.callback(handler => handler.get(IPlatform).window));\nexport interface IWindow extends Window { }\n\nexport const ILocation = DI.createInterface<ILocation>('ILocation', x => x.callback(handler => handler.get(IWindow).location));\nexport interface ILocation extends Location { }\n\nexport const IHistory = DI.createInterface<IHistory>('IHistory', x => x.callback(handler => handler.get(IWindow).history));\n// NOTE: `IHistory` is documented\n/**\n * https://developer.mozilla.org/en-US/docs/Web/API/History\n *\n * A convenience interface that (unless explicitly overridden in DI) resolves directly to the native browser `history` object.\n *\n * Allows manipulation of the browser session history, that is the pages visited in the tab or frame that the current page is loaded in.\n */\nexport interface IHistory extends History {\n  /**\n   * Returns an integer representing the number of elements in the session history, including the currently loaded page.\n   * For example, for a page loaded in a new tab this property returns 1.\n   */\n  readonly length: number;\n  /**\n   * Allows web applications to explicitly set default scroll restoration behavior on history navigation.\n   *\n   * - `auto` The location on the page to which the user has scrolled will be restored.\n   * - `manual` The location on the page is not restored. The user will have to scroll to the location manually.\n   */\n  scrollRestoration: ScrollRestoration;\n  /**\n   * Returns a value representing the state at the top of the history stack.\n   * This is a way to look at the state without having to wait for a popstate event\n   */\n  readonly state: unknown;\n  /**\n   * Causes the browser to move back one page in the session history.\n   * It has the same effect as calling history.go(-1).\n   * If there is no previous page, this method call does nothing.\n   *\n   * This method is asynchronous.\n   * Add a listener for the `popstate` event in order to determine when the navigation has completed.\n   */\n  back(): void;\n  /**\n   * Causes the browser to move forward one page in the session history.\n   * It has the same effect as calling `history.go(1)`.\n   *\n   * This method is asynchronous.\n   * Add a listener for the `popstate` event in order to determine when the navigation has completed.\n   */\n  forward(): void;\n  /**\n   * https://developer.mozilla.org/en-US/docs/Web/API/History/go\n   *\n   * Loads a specific page from the session history.\n   * You can use it to move forwards and backwards through the history depending on the value of a parameter.\n   *\n   * This method is asynchronous.\n   * Add a listener for the `popstate` event in order to determine when the navigation has completed.\n   *\n   * @param delta - The position in the history to which you want to move, relative to the current page.\n   * A negative value moves backwards, a positive value moves forwards.\n   * So, for example, `history.go(2)` moves forward two pages and `history.go(-2)` moves back two pages.\n   * If no value is passed or if `delta` equals 0, it has the same result as calling `location.reload()`.\n   */\n  go(delta?: number): void;\n  /**\n   * https://developer.mozilla.org/en-US/docs/Web/API/History/pushState\n   *\n   * Adds a state to the browser's session history stack.\n   *\n   * @param state - An object which is associated with the new history entry created by `pushState`.\n   * Whenever the user navigates to the new state, a `popstate` event is fired, and the state property of the event contains a copy of the history entry's state object.\n   * The state object can be anything that can be serialized.\n   * @param title - Most browsers currently ignores this parameter, although they may use it in the future.\n   * Passing the empty string here should be safe against future changes to the method.\n   * Alternatively, you could pass a short title for the state.\n   * @param url - The new history entry's URL is given by this parameter.\n   * Note that the browser won't attempt to load this URL after a call to pushState(), but it might attempt to load the URL later, for instance after the user restarts the browser.\n   * The new URL does not need to be absolute; if it's relative, it's resolved relative to the current URL.\n   * The new URL must be of the same origin as the current URL; otherwise, pushState() will throw an exception.\n   * If this parameter isn't specified, it's set to the document's current URL.\n   */\n  pushState(state: {} | null, title: string, url?: string | null): void;\n  /**\n   * https://developer.mozilla.org/en-US/docs/Web/API/History/replaceState\n   *\n   * Modifies the current history entry, replacing it with the stateObj, title, and URL passed in the method parameters.\n   *\n   * This method is particularly useful when you want to update the state object or URL of the current history entry in response to some user action.\n   *\n   * @param state - An object which is associated with the history entry passed to the `replaceState` method.\n   * @param title - Most browsers currently ignores this parameter, although they may use it in the future.\n   * Passing the empty string here should be safe against future changes to the method.\n   * Alternatively, you could pass a short title for the state.\n   * @param url - The URL of the history entry.\n   * The new URL must be of the same origin as the current URL; otherwise `replaceState` throws an exception.\n   */\n  replaceState(state: {} | null, title: string, url?: string | null): void;\n}\n","import {\n  DelegationStrategy,\n  LifecycleFlags,\n} from '@aurelia/runtime';\n\nimport { IEventTarget } from '../dom.js';\n\nimport type { IDisposable, IIndexable, IServiceLocator } from '@aurelia/kernel';\nimport type { IBinding, IConnectableBinding, IsBindingBehavior, Scope } from '@aurelia/runtime';\nimport type { IEventDelegator } from '../observation/event-delegator.js';\nimport type { IPlatform } from '../platform.js';\n\nconst options = {\n  [DelegationStrategy.capturing]: { capture: true } as const,\n  [DelegationStrategy.bubbling]: { capture: false } as const,\n} as const;\n\nexport interface Listener extends IConnectableBinding {}\n/**\n * Listener binding. Handle event binding between view and view model\n */\nexport class Listener implements IBinding {\n  public interceptor: this = this;\n\n  public isBound: boolean = false;\n  public $scope!: Scope;\n  public $hostScope: Scope | null = null;\n\n  private handler: IDisposable = null!;\n\n  public constructor(\n    public platform: IPlatform,\n    public targetEvent: string,\n    public delegationStrategy: DelegationStrategy,\n    public sourceExpression: IsBindingBehavior,\n    public target: Node,\n    public preventDefault: boolean,\n    public eventDelegator: IEventDelegator,\n    public locator: IServiceLocator,\n  ) {}\n\n  public callSource(event: Event): ReturnType<IsBindingBehavior['evaluate']> {\n    const overrideContext = this.$scope.overrideContext;\n    overrideContext.$event = event;\n\n    const result = this.sourceExpression.evaluate(LifecycleFlags.mustEvaluate, this.$scope, this.$hostScope, this.locator, null);\n\n    Reflect.deleteProperty(overrideContext, '$event');\n\n    if (result !== true && this.preventDefault) {\n      event.preventDefault();\n    }\n\n    return result;\n  }\n\n  public handleEvent(event: Event): void {\n    this.interceptor.callSource(event);\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.isBound) {\n      if (this.$scope === scope) {\n        return;\n      }\n\n      this.interceptor.$unbind(flags | LifecycleFlags.fromBind);\n    }\n\n    this.$scope = scope;\n    this.$hostScope = hostScope;\n\n    const sourceExpression = this.sourceExpression;\n    if (sourceExpression.hasBind) {\n      sourceExpression.bind(flags, scope, hostScope, this.interceptor);\n    }\n\n    if (this.delegationStrategy === DelegationStrategy.none) {\n      this.target.addEventListener(this.targetEvent, this);\n    } else {\n      const eventTarget = this.locator.get(IEventTarget);\n      this.handler = this.eventDelegator.addEventListener(\n        eventTarget,\n        this.target,\n        this.targetEvent,\n        this,\n        options[this.delegationStrategy],\n      );\n    }\n\n    // add isBound flag and remove isBinding flag\n    this.isBound = true;\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    if (!this.isBound) {\n      return;\n    }\n\n    const sourceExpression = this.sourceExpression;\n    if (sourceExpression.hasUnbind) {\n      sourceExpression.unbind(flags, this.$scope, this.$hostScope, this.interceptor);\n    }\n\n    this.$scope = null!;\n    if (this.delegationStrategy === DelegationStrategy.none) {\n      this.target.removeEventListener(this.targetEvent, this);\n    } else {\n      this.handler.dispose();\n      this.handler = null!;\n    }\n\n    // remove isBound and isUnbinding flags\n    this.isBound = false;\n  }\n\n  public observeProperty(obj: IIndexable, propertyName: string): void {\n    return;\n  }\n\n  public handleChange(newValue: unknown, previousValue: unknown, flags: LifecycleFlags): void {\n    return;\n  }\n}\n","import { DI } from '@aurelia/kernel';\nimport type { NodeObserverConfig } from './observer-locator';\nimport type { IDisposable } from '@aurelia/kernel';\n\nconst defaultOptions: AddEventListenerOptions = {\n  capture: false,\n};\n\nclass ListenerTracker implements IDisposable {\n  private count: number = 0;\n  private readonly captureLookups: Map<EventTarget, Record<string, EventListenerOrEventListenerObject | undefined>> = new Map();\n  private readonly bubbleLookups: Map<EventTarget, Record<string, EventListenerOrEventListenerObject | undefined>> = new Map();\n\n  public constructor(\n    private readonly publisher: EventTarget,\n    private readonly eventName: string,\n    private readonly options: AddEventListenerOptions = defaultOptions,\n  ) {}\n\n  public increment(): void {\n    if (++this.count === 1) {\n      this.publisher.addEventListener(this.eventName, this, this.options);\n    }\n  }\n\n  public decrement(): void {\n    if (--this.count === 0) {\n      this.publisher.removeEventListener(this.eventName, this, this.options);\n    }\n  }\n\n  public dispose(): void {\n    if (this.count > 0) {\n      this.count = 0;\n      this.publisher.removeEventListener(this.eventName, this, this.options);\n    }\n    this.captureLookups.clear();\n    this.bubbleLookups.clear();\n  }\n\n  /** @internal */\n  public getLookup(target: EventTarget): Record<string, EventListenerOrEventListenerObject | undefined> {\n    const lookups = this.options.capture === true ? this.captureLookups : this.bubbleLookups;\n    let lookup = lookups.get(target);\n    if (lookup === void 0) {\n      lookups.set(target, lookup = Object.create(null) as Record<string, EventListenerOrEventListenerObject | undefined>);\n    }\n    return lookup;\n  }\n\n  /** @internal */\n  public handleEvent(event: Event): void {\n    const lookups = this.options.capture === true ? this.captureLookups : this.bubbleLookups;\n    const path = event.composedPath();\n    if (this.options.capture === true) {\n      path.reverse();\n    }\n    for (const target of path) {\n      const lookup = lookups.get(target);\n      if (lookup === void 0) {\n        continue;\n      }\n      const listener = lookup[this.eventName];\n      if (listener === void 0) {\n        continue;\n      }\n      if (typeof listener === 'function') {\n        listener(event);\n      } else {\n        listener.handleEvent(event);\n      }\n      if (event.cancelBubble === true) {\n        return;\n      }\n    }\n  }\n}\n\n/**\n * Enable dispose() pattern for `delegate` & `capture` commands\n */\nexport class DelegateSubscription implements IDisposable {\n  public constructor(\n    private readonly tracker: ListenerTracker,\n    private readonly lookup: Record<string, EventListenerOrEventListenerObject | undefined>,\n    private readonly eventName: string,\n    callback: EventListenerOrEventListenerObject\n  ) {\n    tracker.increment();\n    lookup[eventName] = callback;\n  }\n\n  public dispose(): void {\n    this.tracker.decrement();\n    this.lookup[this.eventName] = void 0;\n  }\n}\n\nexport class EventSubscriber {\n  private target: EventTarget | null = null;\n  private handler: EventListenerOrEventListenerObject | null = null;\n\n  public constructor(\n    public readonly config: NodeObserverConfig,\n  ) {}\n\n  public subscribe(node: EventTarget, callbackOrListener: EventListenerOrEventListenerObject): void {\n    this.target = node;\n    this.handler = callbackOrListener;\n    for (const event of this.config.events) {\n      node.addEventListener(event, callbackOrListener);\n    }\n  }\n\n  public dispose(): void {\n    const { target, handler } = this;\n    if (target !== null && handler !== null) {\n      for (const event of this.config.events) {\n        target.removeEventListener(event, handler);\n      }\n    }\n\n    this.target = this.handler = null!;\n  }\n}\n\nexport interface IEventDelegator extends EventDelegator {}\nexport const IEventDelegator = DI.createInterface<IEventDelegator>('IEventDelegator', x => x.singleton(EventDelegator));\n\nexport class EventDelegator implements IDisposable {\n  private readonly trackerMaps: Record<string, Map<EventTarget, ListenerTracker> | undefined> = Object.create(null);\n\n  // eslint-disable-next-line @typescript-eslint/no-useless-constructor\n  public constructor() { /* do not remove, is necessary for fulfilling the TS (new() => ...) type */ }\n\n  public addEventListener(\n    publisher: EventTarget,\n    target: Node,\n    eventName: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: AddEventListenerOptions,\n  ): IDisposable {\n    const trackerMap = this.trackerMaps[eventName] ??= new Map<EventTarget, ListenerTracker>();\n    let tracker = trackerMap.get(publisher);\n    if (tracker === void 0) {\n      trackerMap.set(publisher, tracker = new ListenerTracker(publisher, eventName, options));\n    }\n    return new DelegateSubscription(tracker, tracker.getLookup(target), eventName, listener);\n  }\n\n  public dispose(): void {\n    for (const eventName in this.trackerMaps) {\n      const trackerMap = this.trackerMaps[eventName]!;\n      for (const tracker of trackerMap.values()) {\n        tracker.dispose();\n      }\n      trackerMap.clear();\n    }\n  }\n}\n","// A specific file for primitive of au slot to avoid circular dependencies\nimport { DI } from '@aurelia/kernel';\nimport { CustomElementDefinition } from './custom-element.js';\n\nexport type IProjections = Record<string, CustomElementDefinition>;\nexport const IProjections = DI.createInterface<IProjections>(\"IProjections\");\n\nexport interface IAuSlotsInfo extends AuSlotsInfo { }\nexport const IAuSlotsInfo = DI.createInterface<IAuSlotsInfo>('IAuSlotsInfo');\nexport class AuSlotsInfo {\n  /**\n   * @param {string[]} projectedSlots - Name of the slots to which content are projected.\n   */\n  public constructor(\n    public readonly projectedSlots: string[],\n  ) { }\n}\n","import { Metadata, Registration, DI, emptyArray, InstanceProvider, Constructable, IResolver } from '@aurelia/kernel';\nimport {\n  BindingMode,\n  BindingType,\n  IExpressionParser,\n  IObserverLocator,\n  LifecycleFlags,\n  BindingBehaviorExpression,\n  BindingBehaviorFactory,\n  ExpressionKind,\n} from '@aurelia/runtime';\nimport { CallBinding } from './binding/call-binding.js';\nimport { AttributeBinding } from './binding/attribute.js';\nimport { InterpolationBinding, InterpolationPartBinding, ContentBinding } from './binding/interpolation-binding.js';\nimport { LetBinding } from './binding/let-binding.js';\nimport { PropertyBinding } from './binding/property-binding.js';\nimport { RefBinding } from './binding/ref-binding.js';\nimport { Listener } from './binding/listener.js';\nimport { IEventDelegator } from './observation/event-delegator.js';\nimport { CustomElement, CustomElementDefinition } from './resources/custom-element.js';\nimport { getRenderContext } from './templating/render-context.js';\nimport { AuSlotsInfo, IAuSlotsInfo, IProjections } from './resources/slot-injectables.js';\nimport { CustomAttribute, CustomAttributeDefinition } from './resources/custom-attribute.js';\nimport { convertToRenderLocation, IRenderLocation, INode, setRef } from './dom.js';\nimport { Controller, ICustomElementController, ICustomElementViewModel, IController, ICustomAttributeViewModel } from './templating/controller.js';\nimport { IPlatform } from './platform.js';\nimport { IViewFactory } from './templating/view.js';\n\nimport type { IServiceLocator, IContainer, Class, IRegistry } from '@aurelia/kernel';\nimport type {\n  Interpolation,\n  IsBindingBehavior,\n  AnyBindingExpression,\n  BindingBehaviorInstance,\n  IInterceptableBinding,\n  IObservable,\n  ForOfStatement,\n  DelegationStrategy,\n} from '@aurelia/runtime';\nimport type { IHydratableController } from './templating/controller.js';\nimport type { PartialCustomElementDefinition } from './resources/custom-element.js';\nimport type { ICompiledRenderContext } from './templating/render-context.js';\n\nexport const enum InstructionType {\n  hydrateElement = 'ra',\n  hydrateAttribute = 'rb',\n  hydrateTemplateController = 'rc',\n  hydrateLetElement = 'rd',\n  setProperty = 're',\n  interpolation = 'rf',\n  propertyBinding = 'rg',\n  callBinding = 'rh',\n  letBinding = 'ri',\n  refBinding = 'rj',\n  iteratorBinding = 'rk',\n  textBinding = 'ha',\n  listenerBinding = 'hb',\n  attributeBinding = 'hc',\n  stylePropertyBinding = 'hd',\n  setAttribute = 'he',\n  setClassAttribute = 'hf',\n  setStyleAttribute = 'hg',\n}\n\nexport type NodeInstruction =\n  HydrateElementInstruction |\n  HydrateTemplateController |\n  HydrateLetElementInstruction |\n  TextBindingInstruction;\n\nexport type AttributeInstruction =\n  InterpolationInstruction |\n  PropertyBindingInstruction |\n  IteratorBindingInstruction |\n  CallBindingInstruction |\n  RefBindingInstruction |\n  SetPropertyInstruction |\n  LetBindingInstruction |\n  HydrateAttributeInstruction |\n  ListenerBindingInstruction |\n  AttributeBindingInstruction |\n  StylePropertyBindingInstruction |\n  SetAttributeInstruction |\n  SetClassAttributeInstruction |\n  SetStyleAttributeInstruction;\n\nexport type Instruction = NodeInstruction | AttributeInstruction;\nexport type InstructionRow = [Instruction, ...AttributeInstruction[]];\n\nexport type InstructionTypeName = string;\n\nexport interface IInstruction {\n  readonly type: InstructionTypeName;\n}\nexport const IInstruction = DI.createInterface<IInstruction>('Instruction');\n\nexport function isInstruction(value: unknown): value is IInstruction {\n  const type = (value as { type?: string }).type;\n  return typeof type === 'string' && type.length === 2;\n}\n\nexport class InterpolationInstruction {\n  public get type(): InstructionType.interpolation { return InstructionType.interpolation; }\n\n  public constructor(\n    public from: string | Interpolation,\n    public to: string,\n  ) {}\n}\n\nexport class PropertyBindingInstruction {\n  public get type(): InstructionType.propertyBinding { return InstructionType.propertyBinding; }\n\n  public constructor(\n    public from: string | IsBindingBehavior,\n    public to: string,\n    public mode: BindingMode,\n  ) {}\n}\n\nexport class IteratorBindingInstruction {\n  public get type(): InstructionType.iteratorBinding { return InstructionType.iteratorBinding; }\n\n  public constructor(\n    public from: string | ForOfStatement,\n    public to: string,\n  ) {}\n}\n\nexport class CallBindingInstruction {\n  public get type(): InstructionType.callBinding { return InstructionType.callBinding; }\n\n  public constructor(\n    public from: string | IsBindingBehavior,\n    public to: string,\n  ) {}\n}\n\nexport class RefBindingInstruction {\n  public get type(): InstructionType.refBinding { return InstructionType.refBinding; }\n\n  public constructor(\n    public readonly from: string | IsBindingBehavior,\n    public readonly to: string\n  ) {}\n}\n\nexport class SetPropertyInstruction {\n  public get type(): InstructionType.setProperty { return InstructionType.setProperty; }\n\n  public constructor(\n    public value: unknown,\n    public to: string,\n  ) {}\n}\n\nexport class HydrateElementInstruction {\n  public get type(): InstructionType.hydrateElement { return InstructionType.hydrateElement; }\n\n  /**\n   * A special property that can be used to store <au-slot/> usage information\n   */\n  public auSlot: { name: string; fallback: CustomElementDefinition } | null = null;\n\n  public constructor(\n    /**\n     * The name of the custom element this instruction is associated with\n     */\n    // in theory, Constructor of resources should be accepted too\n    // though it would be unnecessary right now\n    public res: string | /* Constructable |  */CustomElementDefinition,\n    public alias: string | undefined,\n    /**\n     * Bindable instructions for the custom element instance\n     */\n    public instructions: IInstruction[],\n    /**\n     * Indicates what projections are associated with the element usage\n     */\n    public projections: Record<string, CustomElementDefinition> | null,\n    /**\n     * Indicates whether the usage of the custom element was with a containerless attribute or not\n     */\n    public containerless: boolean,\n  ) {\n  }\n}\n\nexport class HydrateAttributeInstruction {\n  public get type(): InstructionType.hydrateAttribute { return InstructionType.hydrateAttribute; }\n\n  public constructor(\n    // in theory, Constructor of resources should be accepted too\n    // though it would be unnecessary right now\n    public res: string | /* Constructable |  */CustomAttributeDefinition,\n    public alias: string | undefined,\n    /**\n     * Bindable instructions for the custom attribute instance\n     */\n    public instructions: IInstruction[],\n  ) {}\n}\n\nexport class HydrateTemplateController {\n  public get type(): InstructionType.hydrateTemplateController { return InstructionType.hydrateTemplateController; }\n\n  public constructor(\n    public def: PartialCustomElementDefinition,\n    // in theory, Constructor of resources should be accepted too\n    // though it would be unnecessary right now\n    public res: string | /* Constructable |  */CustomAttributeDefinition,\n    public alias: string | undefined,\n    /**\n     * Bindable instructions for the template controller instance\n     */\n    public instructions: IInstruction[],\n  ) {}\n}\n\nexport class HydrateLetElementInstruction {\n  public get type(): InstructionType.hydrateLetElement { return InstructionType.hydrateLetElement; }\n\n  public constructor(\n    public instructions: LetBindingInstruction[],\n    public toBindingContext: boolean,\n  ) {}\n}\n\nexport class LetBindingInstruction {\n  public get type(): InstructionType.letBinding { return InstructionType.letBinding; }\n\n  public constructor(\n    public from: string | IsBindingBehavior | Interpolation,\n    public to: string,\n  ) {}\n}\n\nexport class TextBindingInstruction {\n  public get type(): InstructionType.textBinding { return InstructionType.textBinding; }\n\n  public constructor(\n    public from: string | Interpolation,\n    /**\n     * Indicates whether the value of the expression \"from\"\n     * should be evaluated in strict mode.\n     *\n     * In none strict mode, \"undefined\" and \"null\" are coerced into empty string\n     */\n    public strict: boolean,\n  ) {}\n}\n\nexport class ListenerBindingInstruction {\n  public get type(): InstructionType.listenerBinding { return InstructionType.listenerBinding; }\n\n  public constructor(\n    public from: string | IsBindingBehavior,\n    public to: string,\n    public preventDefault: boolean,\n    public strategy: DelegationStrategy,\n  ) {}\n}\nexport class StylePropertyBindingInstruction {\n  public get type(): InstructionType.stylePropertyBinding { return InstructionType.stylePropertyBinding; }\n\n  public constructor(\n    public from: string | IsBindingBehavior,\n    public to: string,\n  ) {}\n}\n\nexport class SetAttributeInstruction {\n  public get type(): InstructionType.setAttribute { return InstructionType.setAttribute; }\n\n  public constructor(\n    public value: string,\n    public to: string,\n  ) {}\n}\n\nexport class SetClassAttributeInstruction {\n  public readonly type: InstructionType.setClassAttribute = InstructionType.setClassAttribute;\n\n  public constructor(\n    public readonly value: string,\n  ) {}\n}\n\nexport class SetStyleAttributeInstruction {\n  public readonly type: InstructionType.setStyleAttribute = InstructionType.setStyleAttribute;\n\n  public constructor(\n    public readonly value: string,\n  ) {}\n}\n\nexport class AttributeBindingInstruction {\n  public get type(): InstructionType.attributeBinding { return InstructionType.attributeBinding; }\n\n  public constructor(\n    /**\n     * `attr` and `to` have the same value on a normal attribute\n     * Will be different on `class` and `style`\n     * on `class`: attr = `class` (from binding command), to = attribute name\n     * on `style`: attr = `style` (from binding command), to = attribute name\n     */\n    public attr: string,\n    public from: string | IsBindingBehavior,\n    public to: string,\n  ) {}\n}\n\nexport const ITemplateCompiler = DI.createInterface<ITemplateCompiler>('ITemplateCompiler');\nexport interface ITemplateCompiler {\n  /**\n   * Indicates whether this compiler should compile template in debug mode\n   *\n   * For the default compiler, this means all expressions are kept as is on the template\n   */\n  debug: boolean;\n  /**\n   * Experimental API, for optimization.\n   *\n   * `true` to create CustomElement/CustomAttribute instructions\n   * with resolved resources constructor during compilation, instead of name\n   */\n  resolveResources: boolean;\n  compile(\n    partialDefinition: PartialCustomElementDefinition,\n    context: IContainer,\n    compilationInstruction: ICompliationInstruction | null,\n  ): CustomElementDefinition;\n}\n\nexport interface ICompliationInstruction {\n  /**\n   * A record of projections available for compiling a template.\n   * Where each key is the matching slot name for <au-slot/> inside,\n   * and each value is the definition to render and project\n   */\n  projections: IProjections | null;\n}\n\nexport interface IInstructionTypeClassifier<TType extends string = string> {\n  instructionType: TType;\n}\nexport interface IRenderer<\n  TType extends InstructionTypeName = InstructionTypeName\n> extends Partial<IInstructionTypeClassifier<TType>> {\n  render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    /**\n     * The controller that is current invoking this renderer\n     */\n    renderingController: IHydratableController,\n    target: unknown,\n    instruction: IInstruction,\n  ): void;\n}\n\nexport const IRenderer = DI.createInterface<IRenderer>('IRenderer');\n\ntype DecoratableInstructionRenderer<TType extends string, TProto, TClass> = Class<TProto & Partial<IInstructionTypeClassifier<TType> & Pick<IRenderer, 'render'>>, TClass> & Partial<IRegistry>;\ntype DecoratedInstructionRenderer<TType extends string, TProto, TClass> =  Class<TProto & IInstructionTypeClassifier<TType> & Pick<IRenderer, 'render'>, TClass> & IRegistry;\n\ntype InstructionRendererDecorator<TType extends string> = <TProto, TClass>(target: DecoratableInstructionRenderer<TType, TProto, TClass>) => DecoratedInstructionRenderer<TType, TProto, TClass>;\n\nexport function renderer<TType extends string>(instructionType: TType): InstructionRendererDecorator<TType> {\n  return function decorator<TProto, TClass>(target: DecoratableInstructionRenderer<TType, TProto, TClass>): DecoratedInstructionRenderer<TType, TProto, TClass> {\n    // wrap the constructor to set the instructionType to the instance (for better performance than when set on the prototype)\n    const decoratedTarget = function (...args: unknown[]): TProto {\n      const instance = new target(...args);\n      instance.instructionType = instructionType;\n      return instance;\n    } as unknown as DecoratedInstructionRenderer<TType, TProto, TClass>;\n    // make sure we register the decorated constructor with DI\n    decoratedTarget.register = function register(container: IContainer): void {\n      Registration.singleton(IRenderer, decoratedTarget).register(container);\n    };\n    // copy over any metadata such as annotations (set by preceding decorators) as well as static properties set by the user\n    // also copy the name, to be less confusing to users (so they can still use constructor.name for whatever reason)\n    // the length (number of ctor arguments) is copied for the same reason\n    const metadataKeys = Metadata.getOwnKeys(target);\n    for (const key of metadataKeys) {\n      Metadata.define(key, Metadata.getOwn(key, target), decoratedTarget);\n    }\n    const ownProperties = Object.getOwnPropertyDescriptors(target);\n    Object.keys(ownProperties).filter(prop => prop !== 'prototype').forEach(prop => {\n      Reflect.defineProperty(decoratedTarget, prop, ownProperties[prop]);\n    });\n    return decoratedTarget;\n  };\n}\n\nfunction ensureExpression<TFrom>(parser: IExpressionParser, srcOrExpr: TFrom, bindingType: BindingType): Exclude<TFrom, string> {\n  if (typeof srcOrExpr === 'string') {\n    return parser.parse(srcOrExpr, bindingType) as unknown as Exclude<TFrom, string>;\n  }\n  return srcOrExpr as Exclude<TFrom, string>;\n}\n\nfunction getTarget(potentialTarget: object): object {\n  if ((potentialTarget as { viewModel?: object }).viewModel != null) {\n    return (potentialTarget as { viewModel: object }).viewModel;\n  }\n  return potentialTarget;\n}\n\nfunction getRefTarget(refHost: INode, refTargetName: string): object {\n  if (refTargetName === 'element') {\n    return refHost;\n  }\n  switch (refTargetName) {\n    case 'controller':\n      // this means it supports returning undefined\n      return CustomElement.for(refHost)!;\n    case 'view':\n      // todo: returns node sequences for fun?\n      throw new Error('Not supported API');\n    case 'view-model':\n      // this means it supports returning undefined\n      return CustomElement.for(refHost)!.viewModel;\n    default: {\n      const caController = CustomAttribute.for(refHost, refTargetName);\n      if (caController !== void 0) {\n        return caController.viewModel;\n      }\n      const ceController = CustomElement.for(refHost, { name: refTargetName });\n      if (ceController === void 0) {\n        throw new Error(`Attempted to reference \"${refTargetName}\", but it was not found amongst the target's API.`);\n      }\n      return ceController.viewModel;\n    }\n  }\n}\n\n@renderer(InstructionType.setProperty)\n/** @internal */\nexport class SetPropertyRenderer implements IRenderer {\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: IController,\n    instruction: SetPropertyInstruction,\n  ): void {\n    const obj = getTarget(target) as IObservable;\n    if (obj.$observers !== void 0 && obj.$observers[instruction.to] !== void 0) {\n      obj.$observers[instruction.to].setValue(instruction.value, LifecycleFlags.fromBind);\n    } else {\n      obj[instruction.to] = instruction.value;\n    }\n  }\n}\n\n@renderer(InstructionType.hydrateElement)\n/** @internal */\nexport class CustomElementRenderer implements IRenderer {\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: HTMLElement,\n    instruction: HydrateElementInstruction,\n  ): void {\n    /* eslint-disable prefer-const */\n    let def: CustomElementDefinition | null;\n    let Ctor: Constructable<ICustomElementViewModel>;\n    let component: ICustomElementViewModel;\n    let childController: ICustomElementController;\n    const res = instruction.res;\n    const projections = instruction.projections;\n    const ctxContainer = renderingController.container;\n    const container = createElementContainer(\n      /* parentController */renderingController,\n      /* host             */target,\n      /* instruction      */instruction,\n      /* location         */target,\n      /* auSlotsInfo      */projections == null ? void 0 : new AuSlotsInfo(Object.keys(projections)),\n    );\n    switch (typeof res) {\n      case 'string':\n        def = ctxContainer.find(CustomElement, res);\n        if (def == null) {\n          throw new Error(`Element ${res} is not registered in ${(renderingController as Controller)['name']}.`);\n        }\n        break;\n      // constructor based instruction\n      // will be enabled later if needed.\n      // As both AOT + runtime based can use definition for perf\n      // -----------------\n      // case 'function':\n      //   def = CustomElement.getDefinition(res);\n      //   break;\n      default:\n        def = res;\n    }\n    Ctor = def.Type;\n    component = container.invoke(Ctor);\n    container.registerResolver(Ctor, new InstanceProvider<typeof Ctor>(def.key, component));\n    childController = Controller.forCustomElement(\n      /* root                */renderingController.root,\n      /* context ct          */renderingController.container,\n      /* own container       */container,\n      /* viewModel           */component,\n      /* host                */target,\n      /* instructions        */instruction,\n      /* flags               */flags,\n      /* hydrate             */true,\n      /* definition          */def,\n    );\n\n    flags = childController.flags;\n    setRef(target, def.key, childController);\n\n    context.renderChildren(\n      /* flags        */flags,\n      /* instructions */instruction.instructions,\n      /* controller   */renderingController,\n      /* target       */childController,\n    );\n\n    renderingController.addChild(childController);\n    /* eslint-enable prefer-const */\n  }\n}\n\n@renderer(InstructionType.hydrateAttribute)\n/** @internal */\nexport class CustomAttributeRenderer implements IRenderer {\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    /**\n     * The cotroller that is currently invoking this renderer\n     */\n    renderingController: IHydratableController,\n    target: HTMLElement,\n    instruction: HydrateAttributeInstruction,\n  ): void {\n    /* eslint-disable prefer-const */\n    let ctxContainer = renderingController.container;\n    let def: CustomAttributeDefinition | null;\n    switch (typeof instruction.res) {\n      case 'string':\n        def = ctxContainer.find(CustomAttribute, instruction.res);\n        if (def == null) {\n          throw new Error(`Attribute ${instruction.res} is not registered in ${(renderingController as Controller)['name']}.`);\n        }\n        break;\n      // constructor based instruction\n      // will be enabled later if needed.\n      // As both AOT + runtime based can use definition for perf\n      // -----------------\n      // case 'function':\n      //   def = CustomAttribute.getDefinition(instruction.res);\n      //   break;\n      default:\n        def = instruction.res;\n    }\n    const component = invokeAttribute(\n      /* attr definition  */def,\n      /* parentController */renderingController,\n      /* host             */target,\n      /* instruction      */instruction,\n      /* viewFactory      */void 0,\n      /* location         */void 0,\n    );\n    const childController = Controller.forCustomAttribute(\n      /* root       */renderingController.root,\n      /* context ct */renderingController.container,\n      /* viewModel  */component,\n      /* host       */target,\n      /* flags      */flags,\n      /* definition */def,\n    );\n\n    setRef(target, def.key, childController);\n\n    context.renderChildren(\n      /* flags        */flags,\n      /* instructions */instruction.instructions,\n      /* controller   */renderingController,\n      /* target       */childController,\n    );\n\n    renderingController.addChild(childController);\n    /* eslint-enable prefer-const */\n  }\n}\n\n@renderer(InstructionType.hydrateTemplateController)\n/** @internal */\nexport class TemplateControllerRenderer implements IRenderer {\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: HTMLElement,\n    instruction: HydrateTemplateController,\n  ): void {\n    /* eslint-disable prefer-const */\n    let ctxContainer = renderingController.container;\n    let def: CustomAttributeDefinition | null;\n    switch (typeof instruction.res) {\n      case 'string':\n        def = ctxContainer.find(CustomAttribute, instruction.res);\n        if (def == null) {\n          throw new Error(`Attribute ${instruction.res} is not registered in ${(renderingController as Controller)['name']}.`);\n        }\n        break;\n      // constructor based instruction\n      // will be enabled later if needed.\n      // As both AOT + runtime based can use definition for perf\n      // -----------------\n      // case 'function':\n      //   def = CustomAttribute.getDefinition(instruction.res);\n      //   break;\n      default:\n        def = instruction.res;\n    }\n    const viewFactory = getRenderContext(instruction.def, ctxContainer).getViewFactory();\n    const renderLocation = convertToRenderLocation(target);\n    const component = invokeAttribute(\n      /* attr definition  */def,\n      /* parentController */renderingController,\n      /* host             */target,\n      /* instruction      */instruction,\n      /* viewFactory      */viewFactory,\n      /* location         */renderLocation,\n    );\n    const childController = Controller.forCustomAttribute(\n      /* root         */renderingController.root,\n      /* container ct */renderingController.container,\n      /* viewModel    */component,\n      /* host         */target,\n      /* flags        */flags,\n      /* definition   */def,\n    );\n\n    setRef(renderLocation, def.key, childController);\n\n    component.link?.(flags, context, renderingController, childController, target, instruction);\n\n    context.renderChildren(\n      /* flags        */flags,\n      /* instructions */instruction.instructions,\n      /* controller   */renderingController,\n      /* target       */childController,\n    );\n\n    renderingController.addChild(childController);\n    /* eslint-enable prefer-const */\n  }\n}\n\n@renderer(InstructionType.hydrateLetElement)\n/** @internal */\nexport class LetElementRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n    @IObserverLocator private readonly oL: IObserverLocator,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: Node & ChildNode,\n    instruction: HydrateLetElementInstruction,\n  ): void {\n    target.remove();\n    const childInstructions = instruction.instructions;\n    const toBindingContext = instruction.toBindingContext;\n    const container = renderingController.container;\n\n    let childInstruction: LetBindingInstruction;\n    let expr: AnyBindingExpression;\n    let binding: LetBinding;\n    for (let i = 0, ii = childInstructions.length; i < ii; ++i) {\n      childInstruction = childInstructions[i];\n      expr = ensureExpression(this.parser, childInstruction.from, BindingType.IsPropertyCommand);\n      binding = new LetBinding(expr, childInstruction.to, this.oL, container, toBindingContext);\n      renderingController.addBinding(expr.$kind === ExpressionKind.BindingBehavior\n        ? applyBindingBehavior(binding, expr, container)\n        : binding\n      );\n    }\n  }\n}\n\n@renderer(InstructionType.callBinding)\n/** @internal */\nexport class CallBindingRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n    @IObserverLocator private readonly observerLocator: IObserverLocator,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    rendererController: IHydratableController,\n    target: IController,\n    instruction: CallBindingInstruction,\n  ): void {\n    const expr = ensureExpression(this.parser, instruction.from, BindingType.CallCommand);\n    const binding = new CallBinding(expr, getTarget(target), instruction.to, this.observerLocator, rendererController.container);\n    rendererController.addBinding(expr.$kind === ExpressionKind.BindingBehavior\n      ? applyBindingBehavior(binding, expr, rendererController.container)\n      : binding\n    );\n  }\n}\n\n@renderer(InstructionType.refBinding)\n/** @internal */\nexport class RefBindingRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    rendererController: IHydratableController,\n    target: INode,\n    instruction: RefBindingInstruction,\n  ): void {\n    const expr = ensureExpression(this.parser, instruction.from, BindingType.IsRef);\n    const binding = new RefBinding(expr, getRefTarget(target, instruction.to), rendererController.container);\n    rendererController.addBinding(expr.$kind === ExpressionKind.BindingBehavior\n      ? applyBindingBehavior(binding, expr, rendererController.container)\n      : binding\n    );\n  }\n}\n\n@renderer(InstructionType.interpolation)\n/** @internal */\nexport class InterpolationBindingRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n    @IObserverLocator private readonly oL: IObserverLocator,\n    @IPlatform private readonly platform: IPlatform,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: IController,\n    instruction: InterpolationInstruction,\n  ): void {\n    const container = renderingController.container;\n    const expr = ensureExpression(this.parser, instruction.from, BindingType.Interpolation);\n    const binding = new InterpolationBinding(\n      this.oL,\n      expr,\n      getTarget(target),\n      instruction.to,\n      BindingMode.toView,\n      container,\n      this.platform.domWriteQueue,\n    );\n    const partBindings = binding.partBindings;\n    const ii = partBindings.length;\n    let i = 0;\n    let partBinding: InterpolationPartBinding;\n    for (; ii > i; ++i) {\n      partBinding = partBindings[i];\n      if (partBinding.sourceExpression.$kind === ExpressionKind.BindingBehavior) {\n        partBindings[i] = applyBindingBehavior(\n          partBinding,\n          partBinding.sourceExpression as unknown as IsBindingBehavior,\n          container\n        );\n      }\n    }\n    renderingController.addBinding(binding);\n  }\n}\n\n@renderer(InstructionType.propertyBinding)\n/** @internal */\nexport class PropertyBindingRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n    @IObserverLocator private readonly oL: IObserverLocator,\n    @IPlatform private readonly platform: IPlatform,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: IController,\n    instruction: PropertyBindingInstruction,\n  ): void {\n    const expr = ensureExpression(this.parser, instruction.from, BindingType.IsPropertyCommand | instruction.mode);\n    const binding = new PropertyBinding(expr, getTarget(target), instruction.to, instruction.mode, this.oL, renderingController.container, this.platform.domWriteQueue);\n    renderingController.addBinding(expr.$kind === ExpressionKind.BindingBehavior\n      ? applyBindingBehavior(binding, expr, renderingController.container)\n      : binding\n    );\n  }\n}\n\n@renderer(InstructionType.iteratorBinding)\n/** @internal */\nexport class IteratorBindingRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n    @IObserverLocator private readonly oL: IObserverLocator,\n    @IPlatform private readonly p: IPlatform,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: IController,\n    instruction: IteratorBindingInstruction,\n  ): void {\n    const expr = ensureExpression(this.parser, instruction.from, BindingType.ForCommand);\n    const binding = new PropertyBinding(expr, getTarget(target), instruction.to, BindingMode.toView, this.oL, renderingController.container, this.p.domWriteQueue);\n    renderingController.addBinding(binding);\n    // renderingController.addBinding(expr.iterable.$kind === ExpressionKind.BindingBehavior\n    //   ? applyBindingBehavior(binding, expr.iterable, renderingController.container)\n    //   : binding);\n  }\n}\n\nlet behaviorExpressionIndex = 0;\nconst behaviorExpressions: BindingBehaviorExpression[] = [];\n\nexport function applyBindingBehavior<T extends IInterceptableBinding>(\n  binding: T,\n  expression: IsBindingBehavior,\n  locator: IServiceLocator,\n): T {\n  while (expression instanceof BindingBehaviorExpression) {\n    behaviorExpressions[behaviorExpressionIndex++] = expression;\n    expression = expression.expression;\n  }\n  while (behaviorExpressionIndex > 0) {\n    const behaviorExpression = behaviorExpressions[--behaviorExpressionIndex];\n    const behaviorOrFactory = locator.get<BindingBehaviorFactory | BindingBehaviorInstance>(behaviorExpression.behaviorKey);\n    if (behaviorOrFactory instanceof BindingBehaviorFactory) {\n      binding = behaviorOrFactory.construct(binding, behaviorExpression) as T;\n    }\n  }\n  behaviorExpressions.length = 0;\n  return binding;\n}\n\n@renderer(InstructionType.textBinding)\n/** @internal */\nexport class TextBindingRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n    @IObserverLocator private readonly oL: IObserverLocator,\n    @IPlatform private readonly p: IPlatform,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: ChildNode,\n    instruction: TextBindingInstruction,\n  ): void {\n    const container = renderingController.container;\n    const next = target.nextSibling!;\n    const parent = target.parentNode!;\n    const doc = this.p.document;\n    const expr = ensureExpression(this.parser, instruction.from, BindingType.Interpolation);\n    const staticParts = expr.parts;\n    const dynamicParts = expr.expressions;\n\n    const ii = dynamicParts.length;\n    let i = 0;\n    let text = staticParts[0];\n    let binding: ContentBinding;\n    let part: IsBindingBehavior;\n    if (text !== '') {\n      parent.insertBefore(doc.createTextNode(text), next);\n    }\n    for (; ii > i; ++i) {\n      part = dynamicParts[i];\n      binding = new ContentBinding(\n        part,\n        // using a text node instead of comment, as a mean to:\n        // support seamless transition between a html node, or a text\n        // reduce the noise in the template, caused by html comment\n        parent.insertBefore(doc.createTextNode(''), next),\n        container,\n        this.oL,\n        this.p,\n        instruction.strict\n      );\n      renderingController.addBinding(part.$kind === ExpressionKind.BindingBehavior\n        // each of the dynamic expression of an interpolation\n        // will be mapped to a ContentBinding\n        ? applyBindingBehavior(binding, part, container)\n        : binding\n      );\n      // while each of the static part of an interpolation\n      // will just be a text node\n      text = staticParts[i + 1];\n      if (text !== '') {\n        parent.insertBefore(doc.createTextNode(text), next);\n      }\n    }\n    if (target.nodeName === 'AU-M') {\n      target.remove();\n    }\n  }\n}\n\n@renderer(InstructionType.listenerBinding)\n/** @internal */\nexport class ListenerBindingRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n    @IEventDelegator private readonly eventDelegator: IEventDelegator,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: HTMLElement,\n    instruction: ListenerBindingInstruction,\n  ): void {\n    const expr = ensureExpression(this.parser, instruction.from, BindingType.IsEventCommand | (instruction.strategy + BindingType.DelegationStrategyDelta));\n    const binding = new Listener(renderingController.platform, instruction.to, instruction.strategy, expr, target, instruction.preventDefault, this.eventDelegator, renderingController.container);\n    renderingController.addBinding(expr.$kind === ExpressionKind.BindingBehavior\n      ? applyBindingBehavior(binding, expr, renderingController.container)\n      : binding\n    );\n  }\n}\n\n@renderer(InstructionType.setAttribute)\n/** @internal */\nexport class SetAttributeRenderer implements IRenderer {\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: HTMLElement,\n    instruction: SetAttributeInstruction,\n  ): void {\n    target.setAttribute(instruction.to, instruction.value);\n  }\n}\n\n@renderer(InstructionType.setClassAttribute)\nexport class SetClassAttributeRenderer implements IRenderer {\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: HTMLElement,\n    instruction: SetClassAttributeInstruction,\n  ): void {\n    addClasses(target.classList, instruction.value);\n  }\n}\n\n@renderer(InstructionType.setStyleAttribute)\nexport class SetStyleAttributeRenderer implements IRenderer {\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: HTMLElement,\n    instruction: SetStyleAttributeInstruction,\n  ): void {\n    target.style.cssText += instruction.value;\n  }\n}\n\n@renderer(InstructionType.stylePropertyBinding)\n/** @internal */\nexport class StylePropertyBindingRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n    @IObserverLocator private readonly oL: IObserverLocator,\n    @IPlatform private readonly p: IPlatform,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: HTMLElement,\n    instruction: StylePropertyBindingInstruction,\n  ): void {\n    const expr = ensureExpression(this.parser, instruction.from, BindingType.IsPropertyCommand | BindingMode.toView);\n    const binding = new PropertyBinding(expr, target.style, instruction.to, BindingMode.toView, this.oL, renderingController.container, this.p.domWriteQueue);\n    renderingController.addBinding(expr.$kind === ExpressionKind.BindingBehavior\n      ? applyBindingBehavior(binding, expr, renderingController.container)\n      : binding\n    );\n  }\n}\n\n@renderer(InstructionType.attributeBinding)\n/** @internal */\nexport class AttributeBindingRenderer implements IRenderer {\n  public constructor(\n    @IExpressionParser private readonly parser: IExpressionParser,\n    @IObserverLocator private readonly oL: IObserverLocator,\n  ) {}\n\n  public render(\n    flags: LifecycleFlags,\n    context: ICompiledRenderContext,\n    renderingController: IHydratableController,\n    target: HTMLElement,\n    instruction: AttributeBindingInstruction,\n  ): void {\n    const expr = ensureExpression(this.parser, instruction.from, BindingType.IsPropertyCommand | BindingMode.toView);\n    const binding = new AttributeBinding(\n      expr,\n      target,\n      instruction.attr/* targetAttribute */,\n      instruction.to/* targetKey */,\n      BindingMode.toView,\n      this.oL,\n      renderingController.container\n    );\n    renderingController.addBinding(expr.$kind === ExpressionKind.BindingBehavior\n      ? applyBindingBehavior(binding, expr, renderingController.container)\n      : binding\n    );\n  }\n}\n\n// http://jsben.ch/7n5Kt\nfunction addClasses(classList: DOMTokenList, className: string): void {\n  const len = className.length;\n  let start = 0;\n  for (let i = 0; i < len; ++i) {\n    if (className.charCodeAt(i) === 0x20) {\n      if (i !== start) {\n        classList.add(className.slice(start, i));\n      }\n      start = i + 1;\n    } else if (i + 1 === len) {\n      classList.add(className.slice(start));\n    }\n  }\n}\n\nconst elProviderName = 'ElementProvider';\nconst controllerProviderName = 'IController';\nconst instructionProviderName = 'IInstruction';\nconst locationProviderName = 'IRenderLocation';\nconst slotInfoProviderName = 'IAuSlotsInfo';\n\nfunction createElementContainer(\n  renderingController: IController,\n  host: HTMLElement,\n  instruction: HydrateElementInstruction,\n  location?: IRenderLocation,\n  auSlotsInfo?: IAuSlotsInfo,\n): IContainer {\n  const p = renderingController.platform;\n  const container = renderingController.container.createChild();\n\n  // todo:\n  // both node provider and location provider may not be allowed to throw\n  // if there's no value associated, unlike InstanceProvider\n  // reason being some custom element can have `containerless` attribute on them\n  // causing the host to disappear, and replace by a location instead\n  container.registerResolver(p.HTMLElement,\n    container.registerResolver(p.Element,\n      container.registerResolver(p.Node,\n        container.registerResolver(INode, new InstanceProvider<INode>(elProviderName, host))\n      )\n    )\n  );\n  container.registerResolver(IController, new InstanceProvider(controllerProviderName, renderingController));\n  container.registerResolver(IInstruction, new InstanceProvider(instructionProviderName, instruction));\n  container.registerResolver(IRenderLocation, location == null\n    ? noLocationProvider\n    : new InstanceProvider(locationProviderName, location));\n  container.registerResolver(IViewFactory, noViewFactoryProvider);\n  container.registerResolver(IAuSlotsInfo, auSlotsInfo == null\n    ? noAuSlotProvider\n    : new InstanceProvider(slotInfoProviderName, auSlotsInfo)\n  );\n\n  return container;\n}\n\nclass ViewFactoryProvider implements IResolver {\n  private readonly f: IViewFactory | null;\n  public get $isResolver(): true { return true; }\n\n  public constructor(\n    /**\n     * The factory instance that this provider will resolves to,\n     * until explicitly overridden by prepare call\n     */\n    factory: IViewFactory | null\n  ) {\n    this.f = factory;\n  }\n\n  public resolve(): IViewFactory {\n    const f = this.f;\n    if (f === null) {\n      throw new Error('Cannot resolve ViewFactory before the provider was prepared.');\n    }\n    if (typeof f.name !== 'string' || f.name.length === 0) {\n      throw new Error('Cannot resolve ViewFactory without a (valid) name.');\n    }\n    return f;\n  }\n}\n\nfunction invokeAttribute(\n  definition: CustomAttributeDefinition,\n  renderingController: IController,\n  host: HTMLElement,\n  instruction: HydrateAttributeInstruction | HydrateTemplateController,\n  viewFactory?: IViewFactory,\n  location?: IRenderLocation,\n  auSlotsInfo?: IAuSlotsInfo,\n): ICustomAttributeViewModel {\n  const p = renderingController.platform;\n  const container = renderingController.container.createChild();\n  container.registerResolver(p.HTMLElement,\n    container.registerResolver(p.Element,\n      container.registerResolver(p.Node,\n        container.registerResolver(INode, new InstanceProvider<INode>(elProviderName, host))\n      )\n    )\n  );\n  container.registerResolver(IController, new InstanceProvider(controllerProviderName, renderingController));\n  container.registerResolver(IInstruction, new InstanceProvider<IInstruction>(instructionProviderName, instruction));\n  container.registerResolver(IRenderLocation, location == null\n    ? noLocationProvider\n    : new InstanceProvider(locationProviderName, location));\n  container.registerResolver(IViewFactory, viewFactory == null\n    ? noViewFactoryProvider\n    : new ViewFactoryProvider(viewFactory));\n  container.registerResolver(IAuSlotsInfo, auSlotsInfo == null\n    ? noAuSlotProvider\n    : new InstanceProvider(slotInfoProviderName, auSlotsInfo));\n\n  return container.invoke(definition.Type);\n}\n\nconst noLocationProvider = new InstanceProvider<IRenderLocation>(locationProviderName);\nconst noViewFactoryProvider = new ViewFactoryProvider(null);\nconst noAuSlotProvider = new InstanceProvider<IAuSlotsInfo>(slotInfoProviderName, new AuSlotsInfo(emptyArray));\n","import { camelCase, Registration, mergeArrays, Protocol, firstDefined, Metadata } from '@aurelia/kernel';\nimport { BindingMode, BindingType, DelegationStrategy, registerAliases } from '@aurelia/runtime';\nimport { IAttrMapper } from '../attribute-mapper.js';\nimport {\n  AttributeBindingInstruction,\n  PropertyBindingInstruction,\n  CallBindingInstruction,\n  IteratorBindingInstruction,\n  RefBindingInstruction,\n  ListenerBindingInstruction,\n} from '../renderer.js';\n\nimport type {\n  Constructable,\n  IContainer,\n  IResourceKind,\n  ResourceType,\n  ResourceDefinition,\n  PartialResourceDefinition,\n} from '@aurelia/kernel';\nimport type { IInstruction } from '../renderer.js';\nimport type { AnyBindingExpression, ForOfStatement, IsBindingBehavior } from '@aurelia/runtime';\nimport type { AttrSyntax } from './attribute-pattern.js';\nimport type { BindableDefinition } from '../bindable.js';\nimport type { CustomAttributeDefinition } from './custom-attribute.js';\nimport type { CustomElementDefinition } from './custom-element.js';\n\nexport type PartialBindingCommandDefinition = PartialResourceDefinition<{\n  readonly type?: string | null;\n}>;\n\nexport interface ICommandBuildInfo {\n  node: Element;\n  attr: AttrSyntax;\n  expr: AnyBindingExpression;\n  bindable: BindableDefinition | null;\n  def: CustomAttributeDefinition | CustomElementDefinition | null;\n}\n\nexport type BindingCommandInstance<T extends {} = {}> = {\n  bindingType: BindingType;\n  build(info: ICommandBuildInfo): IInstruction;\n} & T;\n\nexport type BindingCommandType<T extends Constructable = Constructable> = ResourceType<T, BindingCommandInstance, PartialBindingCommandDefinition>;\nexport type BindingCommandKind = IResourceKind<BindingCommandType, BindingCommandDefinition> & {\n  isType<T>(value: T): value is (T extends Constructable ? BindingCommandType<T> : never);\n  define<T extends Constructable>(name: string, Type: T): BindingCommandType<T>;\n  define<T extends Constructable>(def: PartialBindingCommandDefinition, Type: T): BindingCommandType<T>;\n  define<T extends Constructable>(nameOrDef: string | PartialBindingCommandDefinition, Type: T): BindingCommandType<T>;\n  getDefinition<T extends Constructable>(Type: T): BindingCommandDefinition<T>;\n  annotate<K extends keyof PartialBindingCommandDefinition>(Type: Constructable, prop: K, value: PartialBindingCommandDefinition[K]): void;\n  getAnnotation<K extends keyof PartialBindingCommandDefinition>(Type: Constructable, prop: K): PartialBindingCommandDefinition[K];\n};\n\nexport type BindingCommandDecorator = <T extends Constructable>(Type: T) => BindingCommandType<T>;\n\nexport function bindingCommand(name: string): BindingCommandDecorator;\nexport function bindingCommand(definition: PartialBindingCommandDefinition): BindingCommandDecorator;\nexport function bindingCommand(nameOrDefinition: string | PartialBindingCommandDefinition): BindingCommandDecorator {\n  return function (target) {\n    return BindingCommand.define(nameOrDefinition, target);\n  };\n}\n\nexport class BindingCommandDefinition<T extends Constructable = Constructable> implements ResourceDefinition<T, BindingCommandInstance> {\n  private constructor(\n    public readonly Type: BindingCommandType<T>,\n    public readonly name: string,\n    public readonly aliases: readonly string[],\n    public readonly key: string,\n    public readonly type: string | null,\n  ) {}\n\n  public static create<T extends Constructable = Constructable>(\n    nameOrDef: string | PartialBindingCommandDefinition,\n    Type: BindingCommandType<T>,\n  ): BindingCommandDefinition<T> {\n\n    let name: string;\n    let def: PartialBindingCommandDefinition;\n    if (typeof nameOrDef === 'string') {\n      name = nameOrDef;\n      def = { name };\n    } else {\n      name = nameOrDef.name;\n      def = nameOrDef;\n    }\n\n    return new BindingCommandDefinition(\n      Type,\n      firstDefined(BindingCommand.getAnnotation(Type, 'name'), name),\n      mergeArrays(BindingCommand.getAnnotation(Type, 'aliases'), def.aliases, Type.aliases),\n      BindingCommand.keyFrom(name),\n      firstDefined(BindingCommand.getAnnotation(Type, 'type'), def.type, Type.type, null),\n    );\n  }\n\n  public register(container: IContainer): void {\n    const { Type, key, aliases } = this;\n    Registration.singleton(key, Type).register(container);\n    Registration.aliasTo(key, Type).register(container);\n    registerAliases(aliases, BindingCommand, key, container);\n  }\n}\n\nexport const BindingCommand: BindingCommandKind = {\n  name: Protocol.resource.keyFor('binding-command'),\n  keyFrom(name: string): string {\n    return `${BindingCommand.name}:${name}`;\n  },\n  isType<T>(value: T): value is (T extends Constructable ? BindingCommandType<T> : never) {\n    return typeof value === 'function' && Metadata.hasOwn(BindingCommand.name, value);\n  },\n  define<T extends Constructable<BindingCommandInstance>>(nameOrDef: string | PartialBindingCommandDefinition, Type: T): T & BindingCommandType<T> {\n    const definition = BindingCommandDefinition.create(nameOrDef, Type as Constructable<BindingCommandInstance>);\n    Metadata.define(BindingCommand.name, definition, definition.Type);\n    Metadata.define(BindingCommand.name, definition, definition);\n    Protocol.resource.appendTo(Type, BindingCommand.name);\n\n    return definition.Type as BindingCommandType<T>;\n  },\n  getDefinition<T extends Constructable>(Type: T): BindingCommandDefinition<T> {\n    const def = Metadata.getOwn(BindingCommand.name, Type);\n    if (def === void 0) {\n      throw new Error(`No definition found for type ${Type.name}`);\n    }\n\n    return def;\n  },\n  annotate<K extends keyof PartialBindingCommandDefinition>(Type: Constructable, prop: K, value: PartialBindingCommandDefinition[K]): void {\n    Metadata.define(Protocol.annotation.keyFor(prop), value, Type);\n  },\n  getAnnotation<K extends keyof PartialBindingCommandDefinition>(Type: Constructable, prop: K): PartialBindingCommandDefinition[K] {\n    return Metadata.getOwn(Protocol.annotation.keyFor(prop), Type);\n  },\n};\n\n@bindingCommand('one-time')\nexport class OneTimeBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.OneTimeCommand = BindingType.OneTimeCommand;\n\n  public static get inject() { return [IAttrMapper]; }\n  public constructor(private readonly m: IAttrMapper) {}\n\n  public build(info: ICommandBuildInfo): PropertyBindingInstruction {\n    let target: string;\n    if (info.bindable == null) {\n      target = this.m.map(info.node, info.attr.target)\n        // if the mapper doesn't know how to map it\n        // use the default behavior, which is camel-casing\n        ?? camelCase(info.attr.target);\n    } else {\n      target = info.bindable.property;\n    }\n    return new PropertyBindingInstruction(info.expr as IsBindingBehavior, target, BindingMode.oneTime);\n  }\n}\n\n@bindingCommand('to-view')\nexport class ToViewBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.ToViewCommand = BindingType.ToViewCommand;\n\n  public static get inject() { return [IAttrMapper]; }\n  public constructor(private readonly m: IAttrMapper) {}\n\n  public build(info: ICommandBuildInfo): PropertyBindingInstruction {\n    let target: string;\n    if (info.bindable == null) {\n      target = this.m.map(info.node, info.attr.target)\n        // if the mapper doesn't know how to map it\n        // use the default behavior, which is camel-casing\n        ?? camelCase(info.attr.target);\n    } else {\n      target = info.bindable.property;\n    }\n    return new PropertyBindingInstruction(info.expr as IsBindingBehavior, target, BindingMode.toView);\n  }\n}\n\n@bindingCommand('from-view')\nexport class FromViewBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.FromViewCommand = BindingType.FromViewCommand;\n\n  public static get inject() { return [IAttrMapper]; }\n  public constructor(private readonly m: IAttrMapper) {}\n\n  public build(info: ICommandBuildInfo): PropertyBindingInstruction {\n    let target: string;\n    if (info.bindable == null) {\n      target = this.m.map(info.node, info.attr.target)\n        // if the mapper doesn't know how to map it\n        // use the default behavior, which is camel-casing\n        ?? camelCase(info.attr.target);\n    } else {\n      target = info.bindable.property;\n    }\n    return new PropertyBindingInstruction(info.expr as IsBindingBehavior, target, BindingMode.fromView);\n  }\n}\n\n@bindingCommand('two-way')\nexport class TwoWayBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.TwoWayCommand = BindingType.TwoWayCommand;\n\n  public static get inject() { return [IAttrMapper]; }\n  public constructor(private readonly m: IAttrMapper) {}\n\n  public build(info: ICommandBuildInfo): PropertyBindingInstruction {\n    let target: string;\n    if (info.bindable == null) {\n      target = this.m.map(info.node, info.attr.target)\n        // if the mapper doesn't know how to map it\n        // use the default behavior, which is camel-casing\n        ?? camelCase(info.attr.target);\n    } else {\n      target = info.bindable.property;\n    }\n    return new PropertyBindingInstruction(info.expr as IsBindingBehavior, target, BindingMode.twoWay);\n  }\n}\n\n@bindingCommand('bind')\nexport class DefaultBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.BindCommand = BindingType.BindCommand;\n\n  public static get inject() { return [IAttrMapper]; }\n  public constructor(private readonly m: IAttrMapper) {}\n\n  public build(info: ICommandBuildInfo): PropertyBindingInstruction {\n    type CA = CustomAttributeDefinition;\n    const attrName = info.attr.target;\n    const bindable = info.bindable;\n    let defaultMode: BindingMode;\n    let mode: BindingMode;\n    let target: string;\n    if (bindable == null) {\n      mode = this.m.isTwoWay(info.node, attrName) ? BindingMode.twoWay : BindingMode.toView;\n      target = this.m.map(info.node, attrName)\n        // if the mapper doesn't know how to map it\n        // use the default behavior, which is camel-casing\n        ?? camelCase(attrName);\n    } else {\n      defaultMode = (info.def as CA).defaultBindingMode;\n      mode = bindable.mode === BindingMode.default || bindable.mode == null\n        ? defaultMode == null || defaultMode === BindingMode.default\n          ? BindingMode.toView\n          : defaultMode\n        : bindable.mode;\n      target = bindable.property;\n    }\n    return new PropertyBindingInstruction(info.expr as IsBindingBehavior, target, mode);\n  }\n}\n\n@bindingCommand('call')\nexport class CallBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.CallCommand = BindingType.CallCommand;\n\n  public build(info: ICommandBuildInfo): IInstruction {\n    const target = info.bindable === null\n      ? camelCase(info.attr.target)\n      : info.bindable.property;\n    return new CallBindingInstruction(info.expr as IsBindingBehavior, target);\n  }\n}\n\n@bindingCommand('for')\nexport class ForBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.ForCommand = BindingType.ForCommand;\n\n  public build(info: ICommandBuildInfo): IInstruction {\n    const target = info.bindable === null\n      ? camelCase(info.attr.target)\n      : info.bindable.property;\n    return new IteratorBindingInstruction(info.expr as ForOfStatement, target);\n  }\n}\n\n@bindingCommand('trigger')\nexport class TriggerBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.TriggerCommand = BindingType.TriggerCommand;\n\n  public build(info: ICommandBuildInfo): IInstruction {\n    return new ListenerBindingInstruction(info.expr as IsBindingBehavior, info.attr.target, true, DelegationStrategy.none);\n  }\n}\n\n@bindingCommand('delegate')\nexport class DelegateBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.DelegateCommand = BindingType.DelegateCommand;\n\n  public build(info: ICommandBuildInfo): IInstruction {\n    return new ListenerBindingInstruction(info.expr as IsBindingBehavior, info.attr.target, false, DelegationStrategy.bubbling);\n  }\n}\n\n@bindingCommand('capture')\nexport class CaptureBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.CaptureCommand = BindingType.CaptureCommand;\n\n  public build(info: ICommandBuildInfo): IInstruction {\n    return new ListenerBindingInstruction(info.expr as IsBindingBehavior, info.attr.target, false, DelegationStrategy.capturing);\n  }\n}\n\n/**\n * Attr binding command. Compile attr with binding symbol with command `attr` to `AttributeBindingInstruction`\n */\n@bindingCommand('attr')\nexport class AttrBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.IsProperty = BindingType.IsProperty | BindingType.IgnoreAttr;\n\n  public build(info: ICommandBuildInfo): IInstruction {\n    return new AttributeBindingInstruction(info.attr.target, info.expr as IsBindingBehavior, info.attr.target);\n  }\n}\n\n/**\n * Style binding command. Compile attr with binding symbol with command `style` to `AttributeBindingInstruction`\n */\n@bindingCommand('style')\nexport class StyleBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.IsProperty = BindingType.IsProperty | BindingType.IgnoreAttr;\n\n  public build(info: ICommandBuildInfo): IInstruction {\n    return new AttributeBindingInstruction('style', info.expr as IsBindingBehavior, info.attr.target);\n  }\n}\n\n/**\n * Class binding command. Compile attr with binding symbol with command `class` to `AttributeBindingInstruction`\n */\n@bindingCommand('class')\nexport class ClassBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.IsProperty = BindingType.IsProperty | BindingType.IgnoreAttr;\n\n  public build(info: ICommandBuildInfo): IInstruction {\n    return new AttributeBindingInstruction('class', info.expr as IsBindingBehavior, info.attr.target);\n  }\n}\n\n/**\n * Binding command to refer different targets (element, custom element/attribute view models, controller) attached to an element\n */\n@bindingCommand('ref')\nexport class RefBindingCommand implements BindingCommandInstance {\n  public readonly bindingType: BindingType.IsProperty | BindingType.IgnoreAttr = BindingType.IsProperty | BindingType.IgnoreAttr;\n\n  public build(info: ICommandBuildInfo): IInstruction {\n    return new RefBindingInstruction(info.expr as IsBindingBehavior, info.attr.target);\n  }\n}\n","import { DI } from '@aurelia/kernel';\nimport { IPlatform } from './platform.js';\n\n/**\n * Utility that creates a `HTMLTemplateElement` out of string markup or an existing DOM node.\n *\n * It is idempotent in the sense that passing in an existing template element will simply return that template element,\n * so it is always safe to pass in a node without causing unnecessary DOM parsing or template creation.\n */\nexport interface ITemplateElementFactory extends TemplateElementFactory {}\nexport const ITemplateElementFactory = DI.createInterface<ITemplateElementFactory>('ITemplateElementFactory', x => x.singleton(TemplateElementFactory));\n\nconst markupCache: Record<string, HTMLTemplateElement | undefined> = {};\n\nexport class TemplateElementFactory {\n  private template: HTMLTemplateElement;\n\n  public constructor(\n    @IPlatform private readonly p: IPlatform,\n  ) {\n    this.template = p.document.createElement('template');\n  }\n\n  public createTemplate(markup: string): HTMLTemplateElement;\n  public createTemplate(node: Node): HTMLTemplateElement;\n  public createTemplate(input: string | Node): HTMLTemplateElement;\n  public createTemplate(input: string | Node): HTMLTemplateElement {\n    if (typeof input === 'string') {\n      let result = markupCache[input];\n      if (result === void 0) {\n        const template = this.template;\n        template.innerHTML = input;\n        const node = template.content.firstElementChild;\n        // if the input is either not wrapped in a template or there is more than one node,\n        // return the whole template that wraps it/them (and create a new one for the next input)\n        if (node == null || node.nodeName !== 'TEMPLATE' || node.nextElementSibling != null) {\n          this.template = this.p.document.createElement('template');\n          result = template;\n        } else {\n          // the node to return is both a template and the only node, so return just the node\n          // and clean up the template for the next input\n          template.content.removeChild(node);\n          result = node as HTMLTemplateElement;\n        }\n\n        markupCache[input] = result;\n      }\n\n      return result.cloneNode(true) as HTMLTemplateElement;\n    }\n    if (input.nodeName !== 'TEMPLATE') {\n      // if we get one node that is not a template, wrap it in one\n      const template = this.p.document.createElement('template');\n      template.content.appendChild(input);\n      return template;\n    }\n    // we got a template element, remove it from the DOM if it's present there and don't\n    // do any other processing\n    input.parentNode?.removeChild(input);\n    return input.cloneNode(true) as HTMLTemplateElement;\n  }\n}\n","import { DI, Resolved } from '@aurelia/kernel';\n\nimport type {\n  Constructable,\n  IContainer,\n  IResolver,\n  Key,\n} from '@aurelia/kernel';\n\n// todo: replace existing resource code with this resolver\n// ===================\n// export const resource = function <T extends Key>(key: T) {\n//   function Resolver(target: Injectable, property?: string | number, descriptor?: PropertyDescriptor | number) {\n//     DI.inject(Resolver)(target, property, descriptor);\n//   }\n//   Resolver.$isResolver = true;\n//   Resolver.resolve = function (handler: IContainer, requestor: IContainer) {\n//     if (/* is root? */requestor.root === requestor) {\n//       return requestor.get(key);\n//     }\n\n//     return requestor.has(key, false)\n//       ? requestor.get(key)\n//       : requestor.root.get(key);\n//   };\n//   return Resolver as IResolver<T> & ((...args: unknown[]) => any);\n// };\n\n/**\n * A resolver builder for resolving all registrations of a key\n * with resource semantic (leaf + root + ignore middle layer container)\n */\nexport const allResources = function <T extends Key>(key: T) {\n  function Resolver(target: Constructable, property?: string | number, descriptor?: PropertyDescriptor | number) {\n    DI.inject(Resolver)(target, property, descriptor);\n  }\n  Resolver.$isResolver = true;\n  Resolver.resolve = function (handler: IContainer, requestor: IContainer) {\n    if (/* is root? */requestor.root === requestor) {\n      return requestor.getAll(key, false);\n    }\n\n    return requestor.has(key, false)\n      ? requestor.getAll(key, false).concat(requestor.root.getAll(key, false))\n      : requestor.root.getAll(key, false);\n  };\n  return Resolver as IResolver<Resolved<T>[]> & ((...args: unknown[]) => any);\n};\n","import { DI, emptyArray, Registration, toArray, ILogger, camelCase, Protocol, ResourceDefinition, ResourceType, Metadata, noop } from '@aurelia/kernel';\nimport { BindingMode, BindingType, Char, IExpressionParser, PrimitiveLiteralExpression } from '@aurelia/runtime';\nimport { IAttrMapper } from './attribute-mapper.js';\nimport { ITemplateElementFactory } from './template-element-factory.js';\nimport {\n  HydrateAttributeInstruction,\n  HydrateElementInstruction,\n  HydrateLetElementInstruction,\n  HydrateTemplateController,\n  InterpolationInstruction,\n  LetBindingInstruction,\n  SetAttributeInstruction,\n  SetClassAttributeInstruction,\n  SetPropertyInstruction,\n  SetStyleAttributeInstruction,\n  TextBindingInstruction,\n  ITemplateCompiler,\n  PropertyBindingInstruction,\n} from './renderer.js';\nimport { IPlatform } from './platform.js';\nimport { Bindable, BindableDefinition } from './bindable.js';\nimport { AttrSyntax, IAttributeParser } from './resources/attribute-pattern.js';\nimport { CustomAttribute } from './resources/custom-attribute.js';\nimport { CustomElement, CustomElementDefinition } from './resources/custom-element.js';\nimport { BindingCommand } from './resources/binding-command.js';\nimport { createLookup } from './utilities-html.js';\nimport { allResources } from './utilities-di.js';\n\nimport type {\n  IContainer,\n  IResolver,\n  Constructable,\n} from '@aurelia/kernel';\nimport type { AnyBindingExpression } from '@aurelia/runtime';\nimport type { CustomAttributeDefinition } from './resources/custom-attribute.js';\nimport type { PartialCustomElementDefinition } from './resources/custom-element.js';\nimport type { IProjections } from './resources/slot-injectables.js';\nimport type { BindingCommandInstance, ICommandBuildInfo } from './resources/binding-command.js';\nimport type { ICompliationInstruction, IInstruction, } from './renderer.js';\n\nexport class TemplateCompiler implements ITemplateCompiler {\n  public static register(container: IContainer): IResolver<ITemplateCompiler> {\n    return Registration.singleton(ITemplateCompiler, this).register(container);\n  }\n\n  public debug: boolean = false;\n  public resolveResources: boolean = true;\n\n  public compile(\n    partialDefinition: PartialCustomElementDefinition,\n    container: IContainer,\n    compilationInstruction: ICompliationInstruction | null,\n  ): CustomElementDefinition {\n    const definition = CustomElementDefinition.getOrCreate(partialDefinition);\n    if (definition.template === null || definition.template === void 0) {\n      return definition;\n    }\n    if (definition.needsCompile === false) {\n      return definition;\n    }\n    compilationInstruction ??= emptyCompilationInstructions;\n\n    const context = new CompilationContext(partialDefinition, container, compilationInstruction, null, null, void 0);\n    const template = typeof definition.template === 'string' || !partialDefinition.enhance\n      ? context.templateFactory.createTemplate(definition.template)\n      : definition.template as HTMLElement;\n    const isTemplateElement = template.nodeName === 'TEMPLATE' && (template as HTMLTemplateElement).content != null;\n    const content = isTemplateElement ? (template as HTMLTemplateElement).content : template;\n    const hooks = container.get(allResources(ITemplateCompilerHooks));\n    const ii = hooks.length;\n    let i = 0;\n    if (ii > 0) {\n      while (ii > i) {\n        hooks[i].compiling?.(template);\n        ++i;\n      }\n    }\n\n    if (template.hasAttribute(localTemplateIdentifier)) {\n      throw new Error('The root cannot be a local template itself.');\n    }\n    this.local(content, context);\n    this.node(content, context);\n\n    return CustomElementDefinition.create({\n      ...partialDefinition,\n      name: partialDefinition.name || CustomElement.generateName(),\n      dependencies: (partialDefinition.dependencies ?? emptyArray).concat(context.deps ?? emptyArray),\n      instructions: context.rows,\n      surrogates: isTemplateElement\n        ? this.surrogate(template, context)\n        : emptyArray,\n      template,\n      hasSlots: context.hasSlot,\n      needsCompile: false,\n    });\n  }\n\n  /** @internal */\n  private surrogate(el: Element, context: CompilationContext): IInstruction[] {\n    const instructions: IInstruction[] = [];\n    const attrs = el.attributes;\n    const exprParser = context.exprParser;\n    let ii = attrs.length;\n    let i = 0;\n    let attr: Attr;\n    let attrName: string;\n    let attrValue: string;\n    let attrSyntax: AttrSyntax;\n    let attrDef: CustomAttributeDefinition | null = null;\n    let attrInstructions: HydrateAttributeInstruction[] | undefined;\n    let attrBindableInstructions: IInstruction[];\n    // eslint-disable-next-line\n    let bindableInfo: BindablesInfo<0> | BindablesInfo<1>;\n    let primaryBindable: BindableDefinition;\n    let bindingCommand: BindingCommandInstance | null = null;\n    let expr: AnyBindingExpression;\n    let isMultiBindings: boolean;\n    let realAttrTarget: string;\n    let realAttrValue: string;\n\n    for (; ii > i; ++i) {\n      attr = attrs[i];\n      attrName = attr.name;\n      attrValue = attr.value;\n      attrSyntax = context.attrParser.parse(attrName, attrValue);\n\n      realAttrTarget = attrSyntax.target;\n      realAttrValue = attrSyntax.rawValue;\n\n      if (invalidSurrogateAttribute[realAttrTarget]) {\n        throw new Error(`Attribute ${attrName} is invalid on surrogate.`);\n      }\n\n      bindingCommand = context.command(attrSyntax);\n      if (bindingCommand !== null && bindingCommand.bindingType & BindingType.IgnoreAttr) {\n        // when the binding command overrides everything\n        // just pass the target as is to the binding command, and treat it as a normal attribute:\n        // active.class=\"...\"\n        // background.style=\"...\"\n        // my-attr.attr=\"...\"\n        expr = exprParser.parse(realAttrValue, bindingCommand.bindingType);\n\n        commandBuildInfo.node = el;\n        commandBuildInfo.attr = attrSyntax;\n        commandBuildInfo.expr = expr;\n        commandBuildInfo.bindable = null;\n        commandBuildInfo.def = null;\n        instructions.push(bindingCommand.build(commandBuildInfo));\n\n        // to next attribute\n        continue;\n      }\n\n      attrDef = context.attr(realAttrTarget);\n      if (attrDef !== null) {\n        if (attrDef.isTemplateController) {\n          throw new Error(`Template controller ${realAttrTarget} is invalid on surrogate.`);\n        }\n        bindableInfo = BindablesInfo.from(attrDef, true);\n        // Custom attributes are always in multiple binding mode,\n        // except when they can't be\n        // When they cannot be:\n        //        * has explicit configuration noMultiBindings: false\n        //        * has binding command, ie: <div my-attr.bind=\"...\">.\n        //          In this scenario, the value of the custom attributes is required to be a valid expression\n        //        * has no colon: ie: <div my-attr=\"abcd\">\n        //          In this scenario, it's simply invalid syntax.\n        //          Consider style attribute rule-value pair: <div style=\"rule: ruleValue\">\n        isMultiBindings = attrDef.noMultiBindings === false\n          && bindingCommand === null\n          && hasInlineBindings(realAttrValue);\n        if (isMultiBindings) {\n          attrBindableInstructions = this.multiBindings(el, realAttrValue, attrDef, context);\n        } else {\n          primaryBindable = bindableInfo.primary;\n          // custom attribute + single value + WITHOUT binding command:\n          // my-attr=\"\"\n          // my-attr=\"${}\"\n          if (bindingCommand === null) {\n            expr = exprParser.parse(realAttrValue, BindingType.Interpolation);\n            attrBindableInstructions = [\n              expr === null\n                ? new SetPropertyInstruction(realAttrValue, primaryBindable.property)\n                : new InterpolationInstruction(expr, primaryBindable.property)\n            ];\n          } else {\n            // custom attribute with binding command:\n            // my-attr.bind=\"...\"\n            // my-attr.two-way=\"...\"\n            expr = exprParser.parse(realAttrValue, bindingCommand.bindingType);\n\n            commandBuildInfo.node = el;\n            commandBuildInfo.attr = attrSyntax;\n            commandBuildInfo.expr = expr;\n            commandBuildInfo.bindable = primaryBindable;\n            commandBuildInfo.def = attrDef;\n            attrBindableInstructions = [bindingCommand.build(commandBuildInfo)];\n          }\n        }\n\n        el.removeAttribute(attrName);\n        --i;\n        --ii;\n        (attrInstructions ??= []).push(new HydrateAttributeInstruction(\n          // todo: def/ def.Type or def.name should be configurable\n          //       example: AOT/runtime can use def.Type, but there are situation\n          //       where instructions need to be serialized, def.name should be used\n          this.resolveResources ? attrDef : attrDef.name,\n          attrDef.aliases != null && attrDef.aliases.includes(realAttrTarget) ? realAttrTarget : void 0,\n          attrBindableInstructions\n        ));\n        continue;\n      }\n\n      if (bindingCommand === null) {\n        expr = exprParser.parse(realAttrValue, BindingType.Interpolation);\n        if (expr != null) {\n          el.removeAttribute(attrName);\n          --i;\n          --ii;\n\n          instructions.push(new InterpolationInstruction(\n            expr,\n            // if not a bindable, then ensure plain attribute are mapped correctly:\n            // e.g: colspan -> colSpan\n            //      innerhtml -> innerHTML\n            //      minlength -> minLength etc...\n            context.attrMapper.map(el, realAttrTarget) ?? camelCase(realAttrTarget)\n          ));\n        } else {\n          switch (attrName) {\n            case 'class':\n              instructions.push(new SetClassAttributeInstruction(realAttrValue));\n              break;\n            case 'style':\n              instructions.push(new SetStyleAttributeInstruction(realAttrValue));\n              break;\n            default:\n              // if not a custom attribute + no binding command + not a bindable + not an interpolation\n              // then it's just a plain attribute\n              instructions.push(new SetAttributeInstruction(realAttrValue, attrName));\n          }\n        }\n      } else {\n        expr = exprParser.parse(realAttrValue, bindingCommand.bindingType);\n\n        commandBuildInfo.node = el;\n        commandBuildInfo.attr = attrSyntax;\n        commandBuildInfo.expr = expr;\n        commandBuildInfo.bindable = null;\n        commandBuildInfo.def = null;\n        instructions.push(bindingCommand.build(commandBuildInfo));\n      }\n    }\n\n    resetCommandBuildInfo();\n\n    if (attrInstructions != null) {\n      return (attrInstructions as IInstruction[]).concat(instructions);\n    }\n\n    return instructions;\n  }\n\n  // overall flow:\n  // each of the method will be responsible for compiling its corresponding node type\n  // and it should return the next node to be compiled\n  /** @internal */\n  private node(node: Node, context: CompilationContext): Node | null {\n    switch (node.nodeType) {\n      case 1:\n        switch (node.nodeName) {\n          case 'LET':\n            return this.declare(node as Element, context);\n          // ------------------------------------\n          // todo: possible optimization:\n          // when two conditions below are met:\n          // 1. there's no attribute on au slot,\n          // 2. there's no projection\n          //\n          // -> flatten the au-slot into children as this is just a static template\n          // ------------------------------------\n          // case 'AU-SLOT':\n          //   return this.auSlot(node as Element, container, context);\n          default:\n            return this.element(node as Element, context);\n        }\n      case 3:\n        return this.text(node as Text, context);\n      case 11: {\n        let current: Node | null = (node as DocumentFragment).firstChild;\n        while (current !== null) {\n          current = this.node(current, context);\n        }\n        break;\n      }\n    }\n    return node.nextSibling;\n  }\n\n  /** @internal */\n  private declare(el: Element, context: CompilationContext): Node | null {\n    const attrs = el.attributes;\n    const ii = attrs.length;\n    const letInstructions: LetBindingInstruction[] = [];\n    const exprParser = context.exprParser;\n    let toBindingContext = false;\n    let i = 0;\n    let attr: Attr;\n    let attrSyntax: AttrSyntax;\n    let attrName: string;\n    let attrValue: string;\n    let bindingCommand: BindingCommandInstance | null;\n    let realAttrTarget: string;\n    let realAttrValue: string;\n    let expr: AnyBindingExpression;\n\n    for (; ii > i; ++i) {\n      attr = attrs[i];\n      attrName = attr.name;\n      attrValue = attr.value;\n      if (attrName === 'to-binding-context') {\n        toBindingContext = true;\n        continue;\n      }\n\n      attrSyntax = context.attrParser.parse(attrName, attrValue);\n      realAttrTarget = attrSyntax.target;\n      realAttrValue = attrSyntax.rawValue;\n\n      bindingCommand = context.command(attrSyntax);\n      if (bindingCommand !== null) {\n        // supporting one time may not be as simple as it appears\n        // as the let expression could compute its value from various expressions,\n        // which means some value could be unavailable by the time it computes.\n        //\n        // Onetime means it will not have appropriate value, but it's also a good thing,\n        // since often one it's just a simple declaration\n        // todo: consider supporting one-time for <let>\n        if (bindingCommand.bindingType === BindingType.ToViewCommand\n          || bindingCommand.bindingType === BindingType.BindCommand\n        ) {\n          letInstructions.push(new LetBindingInstruction(\n            exprParser.parse(realAttrValue, bindingCommand.bindingType),\n            camelCase(realAttrTarget)\n          ));\n          continue;\n        }\n        throw new Error(`Invalid command ${attrSyntax.command} for <let>. Only to-view/bind supported.`);\n      }\n\n      expr = exprParser.parse(realAttrValue, BindingType.Interpolation);\n      if (expr === null) {\n        context.logger.warn(\n          `Property ${realAttrTarget} is declared with literal string ${realAttrValue}. ` +\n          `Did you mean ${realAttrTarget}.bind=\"${realAttrValue}\"?`\n        );\n      }\n\n      letInstructions.push(new LetBindingInstruction(\n        expr === null ? new PrimitiveLiteralExpression(realAttrValue) : expr,\n        camelCase(realAttrTarget)\n      ));\n    }\n    context.rows.push([new HydrateLetElementInstruction(letInstructions, toBindingContext)]);\n    // probably no need to replace\n    // as the let itself can be used as is\n    // though still need to mark el as target to ensure the instruction is matched with a target\n    return this.mark(el).nextSibling;\n  }\n\n  /** @internal */\n  // eslint-disable-next-line\n  private element(el: Element, context: CompilationContext): Node | null {\n    // instructions sort:\n    // 1. hydrate custom element instruction\n    // 2. hydrate custom attribute instructions\n    // 3. rest kept as is (except special cases & to-be-decided)\n    const nextSibling = el.nextSibling;\n    const elName = (el.getAttribute('as-element') ?? el.nodeName).toLowerCase();\n    const elDef = context.el(elName);\n    const exprParser = context.exprParser;\n    const removeAttr = this.debug\n      ? noop\n      : () => {\n        el.removeAttribute(attrName);\n        --i;\n        --ii;\n      };\n    let attrs = el.attributes;\n    let instructions: IInstruction[] | undefined;\n    let ii = attrs.length;\n    let i = 0;\n    let attr: Attr;\n    let attrName: string;\n    let attrValue: string;\n    let attrSyntax: AttrSyntax;\n    let plainAttrInstructions: IInstruction[] | undefined;\n    let elBindableInstructions: IInstruction[] | undefined;\n    let attrDef: CustomAttributeDefinition | null = null;\n    let isMultiBindings = false;\n    let bindable: BindableDefinition;\n    let attrInstructions: HydrateAttributeInstruction[] | undefined;\n    let attrBindableInstructions: IInstruction[];\n    let tcInstructions: HydrateTemplateController[] | undefined;\n    let tcInstruction: HydrateTemplateController | undefined;\n    let expr: AnyBindingExpression;\n    let elementInstruction: HydrateElementInstruction | undefined;\n    let bindingCommand: BindingCommandInstance | null = null;\n    // eslint-disable-next-line\n    let bindablesInfo: BindablesInfo<0> | BindablesInfo<1>;\n    let primaryBindable: BindableDefinition;\n    let realAttrTarget: string;\n    let realAttrValue: string;\n    let processContentResult: boolean | undefined | void = true;\n    let hasContainerless = false;\n\n    if (elName === 'slot') {\n      context.root.hasSlot = true;\n    }\n    if (elDef !== null) {\n      // todo: this is a bit ... powerful\n      // maybe do not allow it to process its own attributes\n      processContentResult = elDef.processContent?.call(elDef.Type, el, context.p);\n      // might have changed during the process\n      attrs = el.attributes;\n      ii = attrs.length;\n    }\n\n    for (; ii > i; ++i) {\n      attr = attrs[i];\n      attrName = attr.name;\n      attrValue = attr.value;\n      switch (attrName) {\n        case 'as-element':\n        case 'containerless':\n          removeAttr();\n          if (!hasContainerless) {\n            hasContainerless = attrName === 'containerless';\n          }\n          continue;\n      }\n      attrSyntax = context.attrParser.parse(attrName, attrValue);\n\n      bindingCommand = context.command(attrSyntax);\n      if (bindingCommand !== null && bindingCommand.bindingType & BindingType.IgnoreAttr) {\n        // when the binding command overrides everything\n        // just pass the target as is to the binding command, and treat it as a normal attribute:\n        // active.class=\"...\"\n        // background.style=\"...\"\n        // my-attr.attr=\"...\"\n        expr = exprParser.parse(attrValue, bindingCommand.bindingType);\n\n        commandBuildInfo.node = el;\n        commandBuildInfo.attr = attrSyntax;\n        commandBuildInfo.expr = expr;\n        commandBuildInfo.bindable = null;\n        commandBuildInfo.def = null;\n        (plainAttrInstructions ??= []).push(bindingCommand.build(commandBuildInfo));\n\n        removeAttr();\n        // to next attribute\n        continue;\n      }\n\n      realAttrTarget = attrSyntax.target;\n      realAttrValue = attrSyntax.rawValue;\n      // if not a ignore attribute binding command\n      // then process with the next possibilities\n      attrDef = context.attr(realAttrTarget);\n      // when encountering an attribute,\n      // custom attribute takes precedence over custom element bindables\n      if (attrDef !== null) {\n        bindablesInfo = BindablesInfo.from(attrDef, true);\n        // Custom attributes are always in multiple binding mode,\n        // except when they can't be\n        // When they cannot be:\n        //        * has explicit configuration noMultiBindings: false\n        //        * has binding command, ie: <div my-attr.bind=\"...\">.\n        //          In this scenario, the value of the custom attributes is required to be a valid expression\n        //        * has no colon: ie: <div my-attr=\"abcd\">\n        //          In this scenario, it's simply invalid syntax.\n        //          Consider style attribute rule-value pair: <div style=\"rule: ruleValue\">\n        isMultiBindings = attrDef.noMultiBindings === false\n          && bindingCommand === null\n          && hasInlineBindings(attrValue);\n        if (isMultiBindings) {\n          attrBindableInstructions = this.multiBindings(el, attrValue, attrDef, context);\n        } else {\n          primaryBindable = bindablesInfo.primary;\n          // custom attribute + single value + WITHOUT binding command:\n          // my-attr=\"\"\n          // my-attr=\"${}\"\n          if (bindingCommand === null) {\n            expr = exprParser.parse(attrValue, BindingType.Interpolation);\n            attrBindableInstructions = [\n              expr === null\n                ? new SetPropertyInstruction(attrValue, primaryBindable.property)\n                : new InterpolationInstruction(expr, primaryBindable.property)\n            ];\n          } else {\n            // custom attribute with binding command:\n            // my-attr.bind=\"...\"\n            // my-attr.two-way=\"...\"\n            expr = exprParser.parse(attrValue, bindingCommand.bindingType);\n\n            commandBuildInfo.node = el;\n            commandBuildInfo.attr = attrSyntax;\n            commandBuildInfo.expr = expr;\n            commandBuildInfo.bindable = primaryBindable;\n            commandBuildInfo.def = attrDef;\n            attrBindableInstructions = [bindingCommand.build(commandBuildInfo)];\n          }\n        }\n\n        removeAttr();\n\n        if (attrDef.isTemplateController) {\n          (tcInstructions ??= []).push(new HydrateTemplateController(\n            voidDefinition,\n            // todo: def/ def.Type or def.name should be configurable\n            //       example: AOT/runtime can use def.Type, but there are situation\n            //       where instructions need to be serialized, def.name should be used\n            this.resolveResources ? attrDef : attrDef.name,\n            void 0,\n            attrBindableInstructions,\n          ));\n        } else {\n          (attrInstructions ??= []).push(new HydrateAttributeInstruction(\n            // todo: def/ def.Type or def.name should be configurable\n            //       example: AOT/runtime can use def.Type, but there are situation\n            //       where instructions need to be serialized, def.name should be used\n            this.resolveResources ? attrDef : attrDef.name,\n            attrDef.aliases != null && attrDef.aliases.includes(realAttrTarget) ? realAttrTarget : void 0,\n            attrBindableInstructions\n          ));\n        }\n        continue;\n      }\n\n      if (bindingCommand === null) {\n        // reaching here means:\n        // + maybe a bindable attribute with interpolation\n        // + maybe a plain attribute with interpolation\n        // + maybe a plain attribute\n        if (elDef !== null) {\n          bindablesInfo = BindablesInfo.from(elDef, false);\n          bindable = bindablesInfo.attrs[realAttrTarget];\n          if (bindable !== void 0) {\n            expr = exprParser.parse(realAttrValue, BindingType.Interpolation);\n            (elBindableInstructions ??= []).push(\n              expr == null\n                ? new SetPropertyInstruction(realAttrValue, bindable.property)\n                : new InterpolationInstruction(expr, bindable.property)\n            );\n\n            removeAttr();\n            continue;\n          }\n        }\n\n        // reaching here means:\n        // + maybe a plain attribute with interpolation\n        // + maybe a plain attribute\n        expr = exprParser.parse(realAttrValue, BindingType.Interpolation);\n        if (expr != null) {\n          // if it's an interpolation, remove the attribute\n          removeAttr();\n\n          (plainAttrInstructions ??= []).push(new InterpolationInstruction(\n            expr,\n            // if not a bindable, then ensure plain attribute are mapped correctly:\n            // e.g: colspan -> colSpan\n            //      innerhtml -> innerHTML\n            //      minlength -> minLength etc...\n            context.attrMapper.map(el, realAttrTarget) ?? camelCase(realAttrTarget)\n          ));\n        }\n        // if not a custom attribute + no binding command + not a bindable + not an interpolation\n        // then it's just a plain attribute, do nothing\n        continue;\n      }\n\n      // reaching here means:\n      // + has binding command\n      // + not an overriding binding command\n      // + not a custom attribute\n      removeAttr();\n\n      if (elDef !== null) {\n        // if the element is a custom element\n        // - prioritize bindables on a custom element before plain attributes\n        bindablesInfo = BindablesInfo.from(elDef, false);\n        bindable = bindablesInfo.attrs[realAttrTarget];\n        if (bindable !== void 0) {\n          // if it looks like: <my-el value.bind>\n          // it means        : <my-el value.bind=\"value\">\n          // this is a shortcut\n          // and reuse attrValue variable\n          attrValue = attrValue.length === 0\n            && (bindingCommand.bindingType & (\n              BindingType.BindCommand\n              | BindingType.OneTimeCommand\n              | BindingType.ToViewCommand\n              | BindingType.TwoWayCommand\n            )) > 0\n              ? camelCase(attrName)\n              : attrValue;\n          expr = exprParser.parse(attrValue, bindingCommand.bindingType);\n\n          commandBuildInfo.node = el;\n          commandBuildInfo.attr = attrSyntax;\n          commandBuildInfo.expr = expr;\n          commandBuildInfo.bindable = bindable;\n          commandBuildInfo.def = elDef;\n          (elBindableInstructions ??= []).push(bindingCommand.build(commandBuildInfo));\n          continue;\n        }\n      }\n\n      // reaching here means:\n      // + a plain attribute\n      // + has binding command\n\n      expr = exprParser.parse(realAttrValue, bindingCommand.bindingType);\n\n      commandBuildInfo.node = el;\n      commandBuildInfo.attr = attrSyntax;\n      commandBuildInfo.expr = expr;\n      commandBuildInfo.bindable = null;\n      commandBuildInfo.def = null;\n      (plainAttrInstructions ??= []).push(bindingCommand.build(commandBuildInfo));\n    }\n\n    resetCommandBuildInfo();\n\n    if (this.shouldReorderAttrs(el) && plainAttrInstructions != null && plainAttrInstructions.length > 1) {\n      this.reorder(el, plainAttrInstructions);\n    }\n\n    if (elDef !== null) {\n      elementInstruction = new HydrateElementInstruction(\n        // todo: def/ def.Type or def.name should be configurable\n        //       example: AOT/runtime can use def.Type, but there are situation\n        //       where instructions need to be serialized, def.name should be used\n        this.resolveResources ? elDef : elDef.name,\n        void 0,\n        (elBindableInstructions ?? emptyArray) as IInstruction[],\n        null,\n        hasContainerless,\n      );\n\n      if (elName === 'au-slot') {\n        const slotName = el.getAttribute('name') || /* name=\"\" is the same with no name */'default';\n        const template = context.h('template');\n        const fallbackContentContext = context.child();\n        let node: Node | null = el.firstChild;\n        while (node !== null) {\n          // a special case:\n          // <au-slot> doesn't have its own template\n          // so anything attempting to project into it is discarded\n          // doing so during compilation via removing the node,\n          // instead of considering it as part of the fallback view\n          if (node.nodeType === 1 && (node as Element).hasAttribute('au-slot')) {\n            el.removeChild(node);\n          } else {\n            template.content.appendChild(node);\n          }\n          node = el.firstChild;\n        }\n\n        this.node(template.content, fallbackContentContext);\n        elementInstruction.auSlot = {\n          name: slotName,\n          fallback: CustomElementDefinition.create({\n            name: CustomElement.generateName(),\n            template,\n            instructions: fallbackContentContext.rows,\n            needsCompile: false,\n          }),\n        };\n        // todo: shouldn't have to eagerly replace everything like this\n        // this is a leftover refactoring work from the old binder\n        el = this.marker(el, context);\n      }\n    }\n\n    if (plainAttrInstructions != null\n      || elementInstruction != null\n      || attrInstructions != null\n    ) {\n      instructions = emptyArray.concat(\n        elementInstruction ?? emptyArray,\n        attrInstructions ?? emptyArray,\n        plainAttrInstructions ?? emptyArray,\n      );\n      this.mark(el);\n    }\n\n    let shouldCompileContent: boolean;\n    if (tcInstructions != null) {\n      ii = tcInstructions.length - 1;\n      i = ii;\n      tcInstruction = tcInstructions[i];\n\n      let template: HTMLTemplateElement;\n      // assumption: el.parentNode is not null\n      // but not always the case: e.g compile/enhance an element without parent with TC on it\n      this.marker(el, context);\n      if (el.nodeName === 'TEMPLATE') {\n        template = el as HTMLTemplateElement;\n      } else {\n        template = context.h('template');\n        template.content.appendChild(el);\n      }\n      const mostInnerTemplate = template;\n      const childContext = context.child(instructions == null ? [] : [instructions]);\n\n      shouldCompileContent = elDef === null || !elDef.containerless && !hasContainerless && processContentResult !== false;\n      // todo: shouldn't have to eagerly replace with a marker like this\n      //       this should be the job of the renderer\n      if (elDef !== null && elDef.containerless) {\n        this.marker(el, context);\n      }\n\n      let child: Node | null;\n      let childEl: Element;\n      let targetSlot: string | null;\n      let projections: IProjections | undefined;\n      let slotTemplateRecord: Record<string, (Element | DocumentFragment)[]> | undefined;\n      let slotTemplates: (Element | DocumentFragment)[];\n      let slotTemplate: Element | DocumentFragment;\n      let marker: HTMLElement;\n      let projectionCompilationContext: CompilationContext;\n      let j = 0, jj = 0;\n      if (shouldCompileContent) {\n        if (elDef !== null) {\n          // for each child element of a custom element\n          // scan for [au-slot], if there's one\n          // then extract the element into a projection definition\n          // this allows support for [au-slot] declared on the same element with anther template controller\n          // e.g:\n          //\n          // can do:\n          //  <my-el>\n          //    <div au-slot if.bind=\"...\"></div>\n          //    <div if.bind=\"...\" au-slot></div>\n          //  </my-el>\n          //\n          // instead of:\n          //  <my-el>\n          //    <template au-slot><div if.bind=\"...\"></div>\n          //  </my-el>\n          child = el.firstChild;\n          while (child !== null) {\n            if (child.nodeType === 1) {\n              // if has [au-slot] then it's a projection\n              childEl = (child as Element);\n              child = child.nextSibling;\n              targetSlot = childEl.getAttribute('au-slot');\n              if (targetSlot !== null) {\n                if (targetSlot === '') {\n                  targetSlot = 'default';\n                }\n                childEl.removeAttribute('au-slot');\n                el.removeChild(childEl);\n                ((slotTemplateRecord ??= {})[targetSlot] ??= []).push(childEl);\n              }\n              // if not a targeted slot then use the common node method\n              // todo: in the future, there maybe more special case for a content of a custom element\n              //       it can be all done here\n            } else {\n              child = child.nextSibling;\n            }\n          }\n\n          if (slotTemplateRecord != null) {\n            projections = {};\n            // aggregate all content targeting the same slot\n            // into a single template\n            // with some special rule around <template> element\n            for (targetSlot in slotTemplateRecord) {\n              template = context.h('template');\n              slotTemplates = slotTemplateRecord[targetSlot];\n              for (j = 0, jj = slotTemplates.length; jj > j; ++j) {\n                slotTemplate = slotTemplates[j];\n                if (slotTemplate.nodeName === 'TEMPLATE') {\n                  // this means user has some thing more than [au-slot] on a template\n                  // consider this intentional, and use it as is\n                  // e.g:\n                  // <my-element>\n                  //   <template au-slot repeat.for=\"i of items\">\n                  // ----vs----\n                  // <my-element>\n                  //   <template au-slot>this is just some static stuff <b>And a b</b></template>\n                  if ((slotTemplate as Element).attributes.length > 0) {\n                    template.content.appendChild(slotTemplate);\n                  } else {\n                    template.content.appendChild((slotTemplate as HTMLTemplateElement).content);\n                  }\n                } else {\n                  template.content.appendChild(slotTemplate);\n                }\n              }\n\n              // after aggregating all the [au-slot] templates into a single one\n              // compile it\n              // technically, the most inner template controller compilation context\n              // is the parent of this compilation context\n              // but for simplicity in compilation, maybe start with a flatter hierarchy\n              // also, it wouldn't have any real uses\n              projectionCompilationContext = context.child();\n              this.node(template.content, projectionCompilationContext);\n              projections[targetSlot] = CustomElementDefinition.create({\n                name: CustomElement.generateName(),\n                template,\n                instructions: projectionCompilationContext.rows,\n                needsCompile: false,\n              });\n            }\n            elementInstruction!.projections = projections;\n          }\n        }\n\n        // important:\n        // ======================\n        // only goes inside a template, if there is a template controller on it\n        // otherwise, leave it alone\n        if (el.nodeName === 'TEMPLATE') {\n          this.node((el as HTMLTemplateElement).content, childContext);\n        } else {\n          child = el.firstChild;\n          while (child !== null) {\n            child = this.node(child, childContext);\n          }\n        }\n      }\n      tcInstruction.def = CustomElementDefinition.create({\n        name: CustomElement.generateName(),\n        template: mostInnerTemplate,\n        instructions: childContext.rows,\n        needsCompile: false,\n      });\n      while (i-- > 0) {\n        // for each of the template controller from [right] to [left]\n        // do create:\n        // (1) a template\n        // (2) add a marker to the template\n        // (3) an instruction\n        // instruction will be corresponded to the marker\n        // =========================\n\n        tcInstruction = tcInstructions[i];\n        template = context.h('template');\n        // appending most inner template is inaccurate, as the most outer one\n        // is not really the parent of the most inner one\n        // but it's only for the purpose of creating a marker,\n        // so it's just an optimization hack\n        marker = context.h('au-m');\n        marker.classList.add('au');\n        template.content.appendChild(marker);\n\n        if (tcInstruction.def !== voidDefinition) {\n          throw new Error(`Invalid definition for processing ${tcInstruction.res}.`);\n        }\n        tcInstruction.def = CustomElementDefinition.create({\n          name: CustomElement.generateName(),\n          template,\n          needsCompile: false,\n          instructions: [[tcInstructions[i + 1]]]\n        });\n      }\n      // the most outer template controller should be\n      // the only instruction for peek instruction of the current context\n      // e.g\n      // <div if.bind=\"yes\" with.bind=\"scope\" repeat.for=\"i of items\" data-id=\"i.id\">\n      // results in:\n      // -----------\n      //\n      //  TC(if-[value=yes])\n      //    | TC(with-[value=scope])\n      //        | TC(repeat-[...])\n      //            | div(data-id-[value=i.id])\n      context.rows.push([tcInstruction]);\n    } else {\n      // if there's no template controller\n      // then the instruction built is appropriate to be assigned as the peek row\n      // and before the children compilation\n      if (instructions != null) {\n        context.rows.push(instructions);\n      }\n\n      shouldCompileContent = elDef === null || !elDef.containerless && !hasContainerless && processContentResult !== false;\n      // todo: shouldn't have to eagerly replace with a marker like this\n      //       this should be the job of the renderer\n      if (elDef !== null && elDef.containerless) {\n        this.marker(el, context);\n      }\n      if (shouldCompileContent && el.childNodes.length > 0) {\n        let child = el.firstChild as Node | null;\n        let childEl: Element;\n        let targetSlot: string | null;\n        let projections: IProjections | null = null;\n        let slotTemplateRecord: Record<string, (Element | DocumentFragment)[]> | undefined;\n        let slotTemplates: (Element | DocumentFragment)[];\n        let slotTemplate: Element | DocumentFragment;\n        let template: HTMLTemplateElement;\n        let projectionCompilationContext: CompilationContext;\n        let j = 0, jj = 0;\n        // for each child element of a custom element\n        // scan for [au-slot], if there's one\n        // then extract the element into a projection definition\n        // this allows support for [au-slot] declared on the same element with anther template controller\n        // e.g:\n        //\n        // can do:\n        //  <my-el>\n        //    <div au-slot if.bind=\"...\"></div>\n        //    <div if.bind=\"...\" au-slot></div>\n        //  </my-el>\n        //\n        // instead of:\n        //  <my-el>\n        //    <template au-slot><div if.bind=\"...\"></div>\n        //  </my-el>\n        while (child !== null) {\n          if (child.nodeType === 1) {\n            // if has [au-slot] then it's a projection\n            childEl = (child as Element);\n            child = child.nextSibling;\n            targetSlot = childEl.getAttribute('au-slot');\n            if (targetSlot !== null) {\n              if (elDef === null) {\n                throw new Error(`Projection with [au-slot=\"${targetSlot}\"] is attempted on a non custom element ${el.nodeName}.`);\n              }\n              if (targetSlot === '') {\n                targetSlot = 'default';\n              }\n              el.removeChild(childEl);\n              childEl.removeAttribute('au-slot');\n              ((slotTemplateRecord ??= {})[targetSlot] ??= []).push(childEl);\n            }\n            // if not a targeted slot then use the common node method\n            // todo: in the future, there maybe more special case for a content of a custom element\n            //       it can be all done here\n          } else {\n            child = child.nextSibling;\n          }\n        }\n\n        if (slotTemplateRecord != null) {\n          projections = {};\n          // aggregate all content targeting the same slot\n          // into a single template\n          // with some special rule around <template> element\n          for (targetSlot in slotTemplateRecord) {\n            template = context.h('template');\n            slotTemplates = slotTemplateRecord[targetSlot];\n            for (j = 0, jj = slotTemplates.length; jj > j; ++j) {\n              slotTemplate = slotTemplates[j];\n              if (slotTemplate.nodeName === 'TEMPLATE') {\n                // this means user has some thing more than [au-slot] on a template\n                // consider this intentional, and use it as is\n                // e.g:\n                // <my-element>\n                //   <template au-slot repeat.for=\"i of items\">\n                // ----vs----\n                // <my-element>\n                //   <template au-slot>this is just some static stuff <b>And a b</b></template>\n                if ((slotTemplate as Element).attributes.length > 0) {\n                  template.content.appendChild(slotTemplate);\n                } else {\n                  template.content.appendChild((slotTemplate as HTMLTemplateElement).content);\n                }\n              } else {\n                template.content.appendChild(slotTemplate);\n              }\n            }\n\n            // after aggregating all the [au-slot] templates into a single one\n            // compile it\n            projectionCompilationContext = context.child();\n            this.node(template.content, projectionCompilationContext);\n            projections[targetSlot] = CustomElementDefinition.create({\n              name: CustomElement.generateName(),\n              template,\n              instructions: projectionCompilationContext.rows,\n              needsCompile: false,\n            });\n          }\n          elementInstruction!.projections = projections;\n        }\n\n        child = el.firstChild;\n        while (child !== null) {\n          child = this.node(child, context);\n        }\n      }\n    }\n\n    return nextSibling;\n  }\n\n  /** @internal */\n  private text(node: Text, context: CompilationContext): Node | null {\n    let text = '';\n    let current: Node | null = node;\n    while (current !== null && current.nodeType === 3) {\n      text += current.textContent!;\n      current = current.nextSibling;\n    }\n    const expr = context.exprParser.parse(text, BindingType.Interpolation);\n    if (expr === null) {\n      return current;\n    }\n\n    const parent = node.parentNode!;\n    // prepare a marker\n    parent.insertBefore(this.mark(context.h('au-m')), node);\n    // and the corresponding instruction\n    context.rows.push([new TextBindingInstruction(expr, !!context.def.isStrictBinding)]);\n\n    // and cleanup all the DOM for rendering text binding\n    node.textContent = '';\n    current = node.nextSibling;\n    while (current !== null && current.nodeType === 3) {\n      parent.removeChild(current);\n      current = node.nextSibling;\n    }\n\n    return node.nextSibling;\n  }\n\n  /** @internal */\n  private multiBindings(\n    node: Element,\n    attrRawValue: string,\n    attrDef: CustomAttributeDefinition,\n    context: CompilationContext\n  ): IInstruction[] {\n    // custom attribute + multiple values:\n    // my-attr=\"prop1: literal1 prop2.bind: ...; prop3: literal3\"\n    // my-attr=\"prop1.bind: ...; prop2.bind: ...\"\n    // my-attr=\"prop1: ${}; prop2.bind: ...; prop3: ${}\"\n    const bindableAttrsInfo = BindablesInfo.from(attrDef, true);\n    const valueLength = attrRawValue.length;\n    const instructions: IInstruction[] = [];\n\n    let attrName: string | undefined = void 0;\n    let attrValue: string | undefined = void 0;\n\n    let start = 0;\n    let ch = 0;\n    let expr: AnyBindingExpression;\n    let attrSyntax: AttrSyntax;\n    let command: BindingCommandInstance | null;\n    let bindable: BindableDefinition;\n\n    for (let i = 0; i < valueLength; ++i) {\n      ch = attrRawValue.charCodeAt(i);\n\n      if (ch === Char.Backslash) {\n        ++i;\n        // Ignore whatever comes next because it's escaped\n      } else if (ch === Char.Colon) {\n        attrName = attrRawValue.slice(start, i);\n\n        // Skip whitespace after colon\n        while (attrRawValue.charCodeAt(++i) <= Char.Space);\n\n        start = i;\n\n        for (; i < valueLength; ++i) {\n          ch = attrRawValue.charCodeAt(i);\n          if (ch === Char.Backslash) {\n            ++i;\n            // Ignore whatever comes next because it's escaped\n          } else if (ch === Char.Semicolon) {\n            attrValue = attrRawValue.slice(start, i);\n            break;\n          }\n        }\n\n        if (attrValue === void 0) {\n          // No semicolon found, so just grab the rest of the value\n          attrValue = attrRawValue.slice(start);\n        }\n\n        attrSyntax = context.attrParser.parse(attrName, attrValue);\n        // ================================================\n        // todo: should it always camel case???\n        // const attrTarget = camelCase(attrSyntax.target);\n        // ================================================\n        command = context.command(attrSyntax);\n        bindable = bindableAttrsInfo.attrs[attrSyntax.target];\n        if (bindable == null) {\n          throw new Error(`Bindable ${attrSyntax.target} not found on ${attrDef.name}.`);\n        }\n        if (command === null) {\n          expr = context.exprParser.parse(attrValue, BindingType.Interpolation);\n          instructions.push(expr === null\n            ? new SetPropertyInstruction(attrValue, bindable.property)\n            : new InterpolationInstruction(expr, bindable.property)\n          );\n        } else {\n          expr = context.exprParser.parse(attrValue, command.bindingType);\n          commandBuildInfo.node = node;\n          commandBuildInfo.attr = attrSyntax;\n          commandBuildInfo.expr = expr;\n          commandBuildInfo.bindable = bindable;\n          commandBuildInfo.def = attrDef;\n          // instructions.push(command.compile(new BindingSymbol(command, bindable, expr, attrValue, attrName)));\n          instructions.push(command.build(commandBuildInfo));\n        }\n\n        // Skip whitespace after semicolon\n        while (i < valueLength && attrRawValue.charCodeAt(++i) <= Char.Space);\n\n        start = i;\n\n        attrName = void 0;\n        attrValue = void 0;\n      }\n    }\n\n    resetCommandBuildInfo();\n\n    return instructions;\n  }\n\n  /** @internal */\n  private local(template: Element | DocumentFragment, context: CompilationContext) {\n    const root: Element | DocumentFragment = template;\n    const localTemplates = toArray(root.querySelectorAll('template[as-custom-element]')) as HTMLTemplateElement[];\n    const numLocalTemplates = localTemplates.length;\n    if (numLocalTemplates === 0) { return; }\n    if (numLocalTemplates === root.childElementCount) {\n      throw new Error('The custom element does not have any content other than local template(s).');\n    }\n    const localTemplateNames: Set<string> = new Set();\n\n    for (const localTemplate of localTemplates) {\n      if (localTemplate.parentNode !== root) {\n        throw new Error('Local templates needs to be defined directly under root.');\n      }\n      const name = processTemplateName(localTemplate, localTemplateNames);\n\n      const LocalTemplateType = class LocalTemplate { };\n      const content = localTemplate.content;\n      const bindableEls = toArray(content.querySelectorAll('bindable'));\n      const bindableInstructions = Bindable.for(LocalTemplateType);\n      const properties = new Set<string>();\n      const attributes = new Set<string>();\n      for (const bindableEl of bindableEls) {\n        if (bindableEl.parentNode !== content) {\n          throw new Error('Bindable properties of local templates needs to be defined directly under root.');\n        }\n        const property = bindableEl.getAttribute(LocalTemplateBindableAttributes.property);\n        if (property === null) { throw new Error(`The attribute 'property' is missing in ${bindableEl.outerHTML}`); }\n        const attribute = bindableEl.getAttribute(LocalTemplateBindableAttributes.attribute);\n        if (attribute !== null\n          && attributes.has(attribute)\n          || properties.has(property)\n        ) {\n          throw new Error(`Bindable property and attribute needs to be unique; found property: ${property}, attribute: ${attribute}`);\n        } else {\n          if (attribute !== null) {\n            attributes.add(attribute);\n          }\n          properties.add(property);\n        }\n        bindableInstructions.add({\n          property,\n          attribute: attribute ?? void 0,\n          mode: getBindingMode(bindableEl),\n        });\n        const ignoredAttributes = bindableEl.getAttributeNames().filter((attrName) => !allowedLocalTemplateBindableAttributes.includes(attrName));\n        if (ignoredAttributes.length > 0) {\n          context.logger.warn(`The attribute(s) ${ignoredAttributes.join(', ')} will be ignored for ${bindableEl.outerHTML}. Only ${allowedLocalTemplateBindableAttributes.join(', ')} are processed.`);\n        }\n\n        content.removeChild(bindableEl);\n      }\n\n      context.addDep(CustomElement.define({ name, template: localTemplate }, LocalTemplateType));\n\n      root.removeChild(localTemplate);\n    }\n  }\n\n  private shouldReorderAttrs(el: Element): boolean {\n    return el.nodeName === 'INPUT' && orderSensitiveInputType[(el as HTMLInputElement).type] === 1;\n  }\n\n  private reorder(el: Element, instructions: (IInstruction)[]) {\n    switch (el.nodeName) {\n      case 'INPUT': {\n        const _instructions = instructions as (PropertyBindingInstruction | InterpolationInstruction)[];\n        // swap the order of checked and model/value attribute,\n        // so that the required observers are prepared for checked-observer\n        let modelOrValueOrMatcherIndex: number | undefined = void 0;\n        let checkedIndex: number | undefined = void 0;\n        let found = 0;\n        let instruction: PropertyBindingInstruction | InterpolationInstruction;\n        for (let i = 0; i < _instructions.length && found < 3; i++) {\n          instruction = _instructions[i];\n          switch (instruction.to) {\n            case 'model':\n            case 'value':\n            case 'matcher':\n              modelOrValueOrMatcherIndex = i;\n              found++;\n              break;\n            case 'checked':\n              checkedIndex = i;\n              found++;\n              break;\n          }\n        }\n        if (checkedIndex !== void 0 && modelOrValueOrMatcherIndex !== void 0 && checkedIndex < modelOrValueOrMatcherIndex) {\n          [_instructions[modelOrValueOrMatcherIndex], _instructions[checkedIndex]] = [_instructions[checkedIndex], _instructions[modelOrValueOrMatcherIndex]];\n        }\n      }\n    }\n  }\n\n  /**\n   * Mark an element as target with a special css class\n   * and return it\n   *\n   * @internal\n   */\n  private mark<T extends Element>(el: T): T {\n    el.classList.add('au');\n    return el;\n  }\n\n  /**\n   * Replace an element with a marker, and return the marker\n   *\n   * @internal\n   */\n  private marker(node: Node, context: CompilationContext): HTMLElement {\n    // todo: assumption made: parentNode won't be null\n    const parent = node.parentNode!;\n    const marker = context.h('au-m');\n    this.mark(parent.insertBefore(marker, node));\n    parent.removeChild(node);\n    return marker;\n  }\n}\n\n// this class is intended to be an implementation encapsulating the information at the root level of a template\n// this works at the time this is created because everything inside a template should be retrieved\n// from the root itself.\n// if anytime in the future, where it's desirable to retrieve information from somewhere other than root\n// then consider dropping this\n// goal: hide the root container, and all the resources finding calls\nclass CompilationContext {\n  public readonly root: CompilationContext;\n  public readonly parent: CompilationContext | null;\n  public readonly def: PartialCustomElementDefinition;\n  public readonly ci: ICompliationInstruction;\n  public readonly templateFactory: ITemplateElementFactory;\n  public readonly logger: ILogger;\n  public readonly attrParser: IAttributeParser;\n  public readonly attrMapper: IAttrMapper;\n  public readonly exprParser: IExpressionParser;\n  public readonly p: IPlatform;\n  // an array representing targets of instructions, built on depth first tree walking compilation\n  public readonly rows: IInstruction[][];\n  public readonly localEls: Set<string>;\n  public hasSlot: boolean = false;\n  public deps: unknown[] | undefined;\n\n  /** @internal */\n  private readonly c: IContainer;\n\n  public constructor(\n    def: PartialCustomElementDefinition,\n    container: IContainer,\n    compilationInstruction: ICompliationInstruction,\n    parent: CompilationContext | null,\n    root: CompilationContext | null,\n    instructions: IInstruction[][] | undefined,\n  ) {\n    const hasParent = parent !== null;\n    this.c = container;\n    this.root = root === null ? this : root;\n    this.def = def;\n    this.ci = compilationInstruction;\n    this.parent = parent;\n    this.templateFactory = hasParent ? parent!.templateFactory : container.get(ITemplateElementFactory);\n    // todo: attr parser should be retrieved based in resource semantic (current leaf + root + ignore parent)\n    this.attrParser = hasParent ? parent!.attrParser : container.get(IAttributeParser);\n    this.exprParser = hasParent ? parent!.exprParser : container.get(IExpressionParser);\n    this.attrMapper = hasParent ? parent!.attrMapper : container.get(IAttrMapper);\n    this.logger = hasParent ? parent!.logger : container.get(ILogger);\n    this.p = hasParent ? parent!.p : container.get(IPlatform);\n    this.localEls = hasParent ? parent!.localEls : new Set();\n    this.rows = instructions ?? [];\n  }\n\n  public addDep(dep: unknown) {\n    (this.root.deps ??= []).push(dep);\n    this.root.c.register(dep);\n  }\n\n  public h<K extends keyof HTMLElementTagNameMap>(name: K): HTMLElementTagNameMap[K];\n  public h<K extends string>(name: string): HTMLElement;\n  public h(name: string): HTMLElement {\n    const el = this.p.document.createElement(name);\n    if (name === 'template') {\n      this.p.document.adoptNode((el as HTMLTemplateElement).content);\n    }\n    return el;\n  }\n\n  /**\n   * Find the custom element definition of a given name\n   */\n  public el(name: string): CustomElementDefinition | null {\n    return this.c.find(CustomElement, name);\n  }\n\n  /**\n   * Find the custom attribute definition of a given name\n   */\n  public attr(name: string): CustomAttributeDefinition | null {\n    return this.c.find(CustomAttribute, name);\n  }\n\n  /**\n   * Create a new child compilation context\n   */\n  public child(instructions?: IInstruction[][]) {\n    return new CompilationContext(this.def, this.c, this.ci, this, this.root, instructions);\n  }\n\n  // todo: ideally binding command shouldn't have to be cached\n  // it can just be a singleton where it' retrieved\n  // the resources semantic should be defined by the resource itself,\n  // rather than baked in the container\n  private readonly commands: Record<string, BindingCommandInstance | null | undefined> = createLookup();\n  /**\n   * Retrieve a binding command resource instance.\n   *\n   * @param name - The parsed `AttrSyntax`\n   *\n   * @returns An instance of the command if it exists, or `null` if it does not exist.\n   */\n  public command(syntax: AttrSyntax): BindingCommandInstance | null {\n    if (this.root !== this) {\n      return this.root.command(syntax);\n    }\n    const name = syntax.command;\n    if (name === null) {\n      return null;\n    }\n    let result = this.commands[name];\n    if (result === void 0) {\n      result = this.c.create(BindingCommand, name) as BindingCommandInstance;\n      if (result === null) {\n        throw new Error(`Unknown binding command: ${name}`);\n      }\n      this.commands[name] = result;\n    }\n    return result;\n  }\n}\n\nfunction hasInlineBindings(rawValue: string): boolean {\n  const len = rawValue.length;\n  let ch = 0;\n  for (let i = 0; i < len; ++i) {\n    ch = rawValue.charCodeAt(i);\n    if (ch === Char.Backslash) {\n      ++i;\n      // Ignore whatever comes next because it's escaped\n    } else if (ch === Char.Colon) {\n      return true;\n    } else if (ch === Char.Dollar && rawValue.charCodeAt(i + 1) === Char.OpenBrace) {\n      return false;\n    }\n  }\n  return false;\n}\n\nfunction resetCommandBuildInfo(): void {\n  commandBuildInfo.node\n    = commandBuildInfo.attr\n    = commandBuildInfo.expr\n    = commandBuildInfo.bindable\n    = commandBuildInfo.def = null!;\n}\n\nconst emptyCompilationInstructions: ICompliationInstruction = { projections: null };\n// eslint-disable-next-line\nconst voidDefinition: CustomElementDefinition = { name: 'unnamed' } as CustomElementDefinition;\nconst commandBuildInfo: ICommandBuildInfo = {\n  node: null!,\n  expr: null!,\n  attr: null!,\n  bindable: null,\n  def: null,\n};\nconst invalidSurrogateAttribute = Object.assign(createLookup<boolean | undefined>(), {\n  'id': true,\n  'name': true,\n  'au-slot': true,\n  'as-element': true,\n});\nconst orderSensitiveInputType: Record<string, number> = {\n  checkbox: 1,\n  radio: 1,\n  // todo: range is also sensitive to order, for min/max\n};\n\nconst bindableAttrsInfoCache = new WeakMap<CustomElementDefinition | CustomAttributeDefinition, BindablesInfo>();\nexport class BindablesInfo<T extends 0 | 1 = 0> {\n  public static from(def: CustomAttributeDefinition, isAttr: true): BindablesInfo<1>;\n  // eslint-disable-next-line\n  public static from(def: CustomElementDefinition, isAttr: false): BindablesInfo<0>;\n  public static from(def: CustomElementDefinition | CustomAttributeDefinition, isAttr: boolean): BindablesInfo<1 | 0> {\n    let info = bindableAttrsInfoCache.get(def);\n    if (info == null) {\n      type CA = CustomAttributeDefinition;\n      const bindables = def.bindables;\n      const attrs = createLookup<BindableDefinition>();\n      const defaultBindingMode: BindingMode = isAttr\n        ? (def as CA).defaultBindingMode === void 0\n          ? BindingMode.default\n          : (def as CA).defaultBindingMode\n        : BindingMode.default;\n      let bindable: BindableDefinition | undefined;\n      let prop: string;\n      let hasPrimary: boolean = false;\n      let primary: BindableDefinition | undefined;\n      let attr: string;\n\n      // from all bindables, pick the first primary bindable\n      // if there is no primary, pick the first bindable\n      // if there's no bindables, create a new primary with property value\n      for (prop in bindables) {\n        bindable = bindables[prop];\n        attr = bindable.attribute;\n        if (bindable.primary === true) {\n          if (hasPrimary) {\n            throw new Error(`Primary already exists on ${def.name}`);\n          }\n          hasPrimary = true;\n          primary = bindable;\n        } else if (!hasPrimary && primary == null) {\n          primary = bindable;\n        }\n\n        attrs[attr] = BindableDefinition.create(prop, bindable);\n      }\n      if (bindable == null && isAttr) {\n        // if no bindables are present, default to \"value\"\n        primary = attrs.value = BindableDefinition.create('value', { mode: defaultBindingMode });\n      }\n\n      bindableAttrsInfoCache.set(def, info = new BindablesInfo(attrs, bindables, primary));\n    }\n    return info;\n  }\n\n  protected constructor(\n    public readonly attrs: Record<string, BindableDefinition>,\n    public readonly bindables: Record<string, BindableDefinition>,\n    public readonly primary: T extends 1 ? BindableDefinition : BindableDefinition | undefined,\n  ) {}\n}\n\nconst enum LocalTemplateBindableAttributes {\n  property = \"property\",\n  attribute = \"attribute\",\n  mode = \"mode\",\n}\nconst allowedLocalTemplateBindableAttributes: readonly string[] = Object.freeze([\n  LocalTemplateBindableAttributes.property,\n  LocalTemplateBindableAttributes.attribute,\n  LocalTemplateBindableAttributes.mode\n]);\nconst localTemplateIdentifier = 'as-custom-element';\n\nfunction processTemplateName(localTemplate: HTMLTemplateElement, localTemplateNames: Set<string>): string {\n  const name = localTemplate.getAttribute(localTemplateIdentifier);\n  if (name === null || name === '') {\n    throw new Error('The value of \"as-custom-element\" attribute cannot be empty for local template');\n  }\n  if (localTemplateNames.has(name)) {\n    throw new Error(`Duplicate definition of the local template named ${name}`);\n  } else {\n    localTemplateNames.add(name);\n    localTemplate.removeAttribute(localTemplateIdentifier);\n  }\n  return name;\n}\n\nfunction getBindingMode(bindable: Element): BindingMode {\n  switch (bindable.getAttribute(LocalTemplateBindableAttributes.mode)) {\n    case 'oneTime':\n      return BindingMode.oneTime;\n    case 'toView':\n      return BindingMode.toView;\n    case 'fromView':\n      return BindingMode.fromView;\n    case 'twoWay':\n      return BindingMode.twoWay;\n    case 'default':\n    default:\n      return BindingMode.default;\n  }\n}\n\n/**\n * An interface describing the hooks a compilation process should invoke.\n *\n * A feature available to the default template compiler.\n */\nexport const ITemplateCompilerHooks = DI.createInterface<ITemplateCompilerHooks>('ITemplateCompilerHooks');\nexport interface ITemplateCompilerHooks {\n  /**\n   * Should be invoked immediately before a template gets compiled\n   */\n  compiling?(template: HTMLElement): void;\n}\n\nconst typeToHooksDefCache = new WeakMap<Constructable, TemplateCompilerHooksDefinition<unknown>>();\nconst compilerHooksResourceName = Protocol.resource.keyFor('compiler-hooks');\nexport const TemplateCompilerHooks = Object.freeze({\n  name: compilerHooksResourceName,\n  /**\n   * @param def - Placeholder for future extensions. Currently always an empty object.\n   */\n  define<K extends ITemplateCompilerHooks, T extends Constructable<K>>(Type: T): T {\n    let def = typeToHooksDefCache.get(Type);\n    if (def === void 0) {\n      typeToHooksDefCache.set(Type, def = new TemplateCompilerHooksDefinition(Type));\n      Metadata.define(compilerHooksResourceName, def, Type);\n      Protocol.resource.appendTo(Type, compilerHooksResourceName);\n    }\n    return Type;\n  }\n});\n\nclass TemplateCompilerHooksDefinition<T> implements ResourceDefinition<Constructable<T>, ITemplateCompilerHooks> {\n  public get name(): string { return ''; }\n\n  public constructor(\n    public readonly Type: ResourceType<Constructable<T>, ITemplateCompilerHooks>,\n  ) {}\n\n  public register(c: IContainer) {\n    c.register(Registration.singleton(ITemplateCompilerHooks, this.Type));\n  }\n}\n\n/**\n * Decorator: Indicates that the decorated class is a template compiler hooks.\n *\n * An instance of this class will be created and appropriate compilation hooks will be invoked\n * at different phases of the default compiler.\n */\n/* eslint-disable */\n// deepscan-disable-next-line\nexport const templateCompilerHooks = (target?: Function) => {\n  return target === void 0 ? decorator : decorator(target);\n  function decorator(t: Function): any {\n    return TemplateCompilerHooks.define(t as Constructable) as unknown as void;\n  };\n}\n/* eslint-enable */\n","import { bindingBehavior, BindingBehaviorInstance, BindingMode, LifecycleFlags } from '@aurelia/runtime';\n\nimport type { Scope } from '@aurelia/runtime';\nimport type { PropertyBinding } from '../binding/property-binding.js';\n\nexport abstract class BindingModeBehavior implements BindingBehaviorInstance {\n  private readonly originalModes: Map<PropertyBinding, BindingMode> = new Map();\n\n  public constructor(\n    private readonly mode: BindingMode,\n  ) {}\n\n  public bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null, binding: PropertyBinding): void {\n    this.originalModes.set(binding, binding.mode);\n    binding.mode = this.mode;\n  }\n\n  public unbind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null, binding: PropertyBinding): void {\n    binding.mode = this.originalModes.get(binding)!;\n    this.originalModes.delete(binding);\n  }\n}\n\nexport class OneTimeBindingBehavior extends BindingModeBehavior {\n  public constructor() {\n    super(BindingMode.oneTime);\n  }\n}\n\nexport class ToViewBindingBehavior extends BindingModeBehavior {\n  public constructor() {\n    super(BindingMode.toView);\n  }\n}\n\nexport class FromViewBindingBehavior extends BindingModeBehavior {\n  public constructor() {\n    super(BindingMode.fromView);\n  }\n}\n\nexport class TwoWayBindingBehavior extends BindingModeBehavior {\n  public constructor() {\n    super(BindingMode.twoWay);\n  }\n}\n\nbindingBehavior('oneTime')(OneTimeBindingBehavior);\nbindingBehavior('toView')(ToViewBindingBehavior);\nbindingBehavior('fromView')(FromViewBindingBehavior);\nbindingBehavior('twoWay')(TwoWayBindingBehavior);\n","import { IPlatform } from '@aurelia/kernel';\nimport { bindingBehavior, BindingInterceptor, LifecycleFlags } from '@aurelia/runtime';\n\nimport type { ITask, QueueTaskOptions, TaskQueue } from '@aurelia/kernel';\nimport type { BindingBehaviorExpression, IInterceptableBinding, IsAssign, Scope } from '@aurelia/runtime';\n\nconst defaultDelay = 200;\n\n//\n// A binding behavior that prevents\n// - (v1 + v2) the view-model from being updated in two-way binding, OR\n// - (v1) the the view from being updated in to-view binding,\n// until a specified interval has passed without any changes\n//\nexport class DebounceBindingBehavior extends BindingInterceptor {\n  private readonly taskQueue: TaskQueue;\n  private readonly opts: QueueTaskOptions = { delay: defaultDelay };\n  private readonly firstArg: IsAssign | null = null;\n  private task: ITask | null = null;\n\n  public constructor(\n    binding: IInterceptableBinding,\n    expr: BindingBehaviorExpression,\n  ) {\n    super(binding, expr);\n    this.taskQueue = binding.locator.get(IPlatform).taskQueue;\n    if (expr.args.length > 0) {\n      this.firstArg = expr.args[0];\n    }\n  }\n\n  public callSource(args: object): unknown {\n    this.queueTask(() => this.binding.callSource!(args));\n    return void 0;\n  }\n\n  public handleChange(newValue: unknown, oldValue: unknown, flags: LifecycleFlags): void {\n    // when source has changed before the latest debounced value from target\n    // then discard that value, and take latest value from source only\n    if (this.task !== null) {\n      this.task.cancel();\n      this.task = null;\n    }\n    this.binding.handleChange!(newValue, oldValue, flags);\n  }\n\n  public updateSource(newValue: unknown, flags: LifecycleFlags): void {\n    this.queueTask(() => this.binding.updateSource!(newValue, flags));\n  }\n\n  private queueTask(callback: () => void): void {\n    // Queue the new one before canceling the old one, to prevent early yield\n    const task = this.task;\n    this.task = this.taskQueue.queueTask(() => {\n      this.task = null;\n      return callback();\n    }, this.opts);\n    task?.cancel();\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.firstArg !== null) {\n      const delay = Number(this.firstArg.evaluate(flags, scope, hostScope, this.locator, null));\n      this.opts.delay = isNaN(delay) ? defaultDelay : delay;\n    }\n    this.binding.$bind(flags, scope, hostScope);\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    this.task?.cancel();\n    this.task = null;\n    this.binding.$unbind(flags);\n  }\n}\n\nbindingBehavior('debounce')(DebounceBindingBehavior);\n","import { bindingBehavior, ISignaler, LifecycleFlags } from '@aurelia/runtime';\nimport type { BindingBehaviorInstance, IBinding, IConnectableBinding, Scope } from '@aurelia/runtime';\n\nexport class SignalBindingBehavior implements BindingBehaviorInstance {\n  private readonly lookup: Map<IBinding, string[]> = new Map();\n\n  public constructor(\n    @ISignaler private readonly signaler: ISignaler,\n  ) {}\n\n  public bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null, binding: IConnectableBinding, ...names: string[]): void {\n    if (!('handleChange' in binding)) {\n      throw new Error(`The signal behavior can only be used with bindings that have a 'handleChange' method`);\n    }\n    if (names.length === 0) {\n      throw new Error(`At least one signal name must be passed to the signal behavior, e.g. \\`expr & signal:'my-signal'\\``);\n    }\n\n    this.lookup.set(binding, names);\n    for (const name of names) {\n      this.signaler.addSignalListener(name, binding);\n    }\n  }\n\n  public unbind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null, binding: IConnectableBinding): void {\n    const names = this.lookup.get(binding)!;\n    this.lookup.delete(binding);\n    for (const name of names) {\n      this.signaler.removeSignalListener(name, binding);\n    }\n  }\n}\n\nbindingBehavior('signal')(SignalBindingBehavior);\n","import { IPlatform } from '@aurelia/kernel';\nimport { bindingBehavior, BindingInterceptor, LifecycleFlags } from '@aurelia/runtime';\n\nimport type { ITask, QueueTaskOptions, TaskQueue } from '@aurelia/kernel';\nimport type { BindingBehaviorExpression, IInterceptableBinding, IsAssign, Scope } from '@aurelia/runtime';\n\nconst defaultDelay = 200;\n\n// A binding behavior that limits\n// - (v1) the rate at which the view-model is updated in two-way bindings, OR\n// - (v1 + v2) the rate at which the view is updated in to-view binding scenarios.\nexport class ThrottleBindingBehavior extends BindingInterceptor {\n  private readonly taskQueue: TaskQueue;\n  private readonly platform: IPlatform;\n  private readonly opts: QueueTaskOptions = { delay: defaultDelay };\n  private readonly firstArg: IsAssign | null = null;\n  private task: ITask | null = null;\n  private lastCall: number = 0;\n  private delay: number = 0;\n\n  public constructor(\n    binding: IInterceptableBinding,\n    expr: BindingBehaviorExpression,\n  ) {\n    super(binding, expr);\n    this.platform = binding.locator.get(IPlatform);\n    this.taskQueue = this.platform.taskQueue;\n    if (expr.args.length > 0) {\n      this.firstArg = expr.args[0];\n    }\n  }\n\n  public callSource(args: object): unknown {\n    this.queueTask(() => this.binding.callSource!(args));\n    return void 0;\n  }\n\n  public handleChange(newValue: unknown, oldValue: unknown, flags: LifecycleFlags): void {\n    // when source has changed before the latest throttled value from target\n    // then discard that value, and take latest value from source only\n    if (this.task !== null) {\n      this.task.cancel();\n      this.task = null;\n      this.lastCall = this.platform.performanceNow();\n    }\n    this.binding.handleChange(newValue, oldValue, flags);\n  }\n\n  public updateSource(newValue: unknown, flags: LifecycleFlags): void {\n    this.queueTask(() => this.binding.updateSource!(newValue, flags));\n  }\n\n  private queueTask(callback: () => void): void {\n    const opts = this.opts;\n    const platform = this.platform;\n    const nextDelay = this.lastCall + opts.delay! - platform.performanceNow();\n\n    if (nextDelay > 0) {\n      // Queue the new one before canceling the old one, to prevent early yield\n      const task = this.task;\n      opts.delay = nextDelay;\n      this.task = this.taskQueue.queueTask(() => {\n        this.lastCall = platform.performanceNow();\n        this.task = null;\n        opts.delay = this.delay;\n        callback();\n      }, opts);\n\n      task?.cancel();\n    } else {\n      this.lastCall = platform.performanceNow();\n      callback();\n    }\n  }\n\n  public $bind(flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void {\n    if (this.firstArg !== null) {\n      const delay = Number(this.firstArg.evaluate(flags, scope, hostScope, this.locator, null));\n      this.opts.delay = this.delay = isNaN(delay) ? defaultDelay : delay;\n    }\n    this.binding.$bind(flags, scope, hostScope);\n  }\n\n  public $unbind(flags: LifecycleFlags): void {\n    this.task?.cancel();\n    this.task = null;\n    super.$unbind(flags);\n  }\n}\n\nbindingBehavior('throttle')(ThrottleBindingBehavior);\n","import { AccessorType } from '@aurelia/runtime';\n\nimport type { IAccessor, LifecycleFlags } from '@aurelia/runtime';\n\n/**\n * Attribute accessor for HTML elements.\n * Note that Aurelia works with properties, so in all case it will try to assign to property instead of attributes.\n * Unless the property falls into a special set, then it will use attribute for it.\n *\n * @see ElementPropertyAccessor\n */\nexport class DataAttributeAccessor implements IAccessor<string | null> {\n  public readonly obj!: HTMLElement;\n  public readonly propertyKey: string = '';\n\n  // ObserverType.Layout is not always true, it depends on the property\n  // but for simplicity, always treat as such\n  public type: AccessorType = AccessorType.Node | AccessorType.Layout;\n\n  public getValue(obj: HTMLElement, key: string): string | null {\n    return obj.getAttribute(key);\n  }\n\n  public setValue(newValue: string | null, flags: LifecycleFlags, obj: HTMLElement, key: string): void {\n    if (newValue == void 0) {\n      obj.removeAttribute(key);\n    } else {\n      obj.setAttribute(key, newValue);\n    }\n  }\n}\n\nexport const attrAccessor = new DataAttributeAccessor();\n","import { LifecycleFlags, bindingBehavior } from '@aurelia/runtime';\nimport { attrAccessor } from '../../observation/data-attribute-accessor.js';\n\nimport type { Scope } from '@aurelia/runtime';\nimport type { PropertyBinding } from '../../binding/property-binding.js';\n\n@bindingBehavior('attr')\nexport class AttrBindingBehavior {\n  public bind(flags: LifecycleFlags, _scope: Scope, _hostScope: Scope | null, binding: PropertyBinding): void {\n    binding.targetObserver = attrAccessor;\n  }\n\n  public unbind(flags: LifecycleFlags, _scope: Scope, _hostScope: Scope | null, binding: PropertyBinding): void {\n    return;\n  }\n}\n","import { LifecycleFlags, bindingBehavior } from '@aurelia/runtime';\nimport { Listener } from '../../binding/listener.js';\n\nimport type { Scope } from '@aurelia/runtime';\n\n/** @internal */\nexport function handleSelfEvent(this: SelfableBinding, event: Event): ReturnType<Listener['callSource']> {\n  const target = event.composedPath()[0];\n\n  if (this.target !== target) {\n    return;\n  }\n\n  return this.selfEventCallSource(event);\n}\n\nexport type SelfableBinding = Listener & {\n  selfEventCallSource: Listener['callSource'];\n};\n\n@bindingBehavior('self')\nexport class SelfBindingBehavior {\n  public bind(flags: LifecycleFlags, _scope: Scope, _hostScope: Scope | null, binding: SelfableBinding): void {\n    if (!binding.callSource || !binding.targetEvent) {\n      throw new Error('Self binding behavior only supports events.');\n    }\n\n    binding.selfEventCallSource = binding.callSource;\n    binding.callSource = handleSelfEvent;\n  }\n\n  public unbind(flags: LifecycleFlags, _scope: Scope, _hostScope: Scope | null, binding: SelfableBinding): void {\n    binding.callSource = binding.selfEventCallSource;\n    binding.selfEventCallSource = null!;\n  }\n}\n","import { AccessorType } from '@aurelia/runtime';\nimport { createLookup } from '../utilities-html.js';\n\nimport type { IAccessor, LifecycleFlags } from '@aurelia/runtime';\n\nconst nsMap: Record<string, AttributeNSAccessor> = createLookup();\n\n/**\n * Attribute accessor in a XML document/element that can be accessed via a namespace.\n * Wraps [`getAttributeNS`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttributeNS).\n */\nexport class AttributeNSAccessor implements IAccessor<string | null> {\n\n  public static forNs(ns: string): AttributeNSAccessor {\n    return nsMap[ns] ??= new AttributeNSAccessor(ns);\n  }\n\n  // ObserverType.Layout is not always true, it depends on the property\n  // but for simplicity, always treat as such\n  public type: AccessorType = AccessorType.Node | AccessorType.Layout;\n\n  public obj?: HTMLElement;\n  public propertyKey?: string;\n\n  public constructor(\n    public readonly namespace: string,\n  ) {\n  }\n\n  public getValue(obj: HTMLElement, propertyKey: string): string | null {\n    return obj.getAttributeNS(this.namespace, propertyKey);\n  }\n\n  public setValue(newValue: string | null, flags: LifecycleFlags, obj: HTMLElement, key: string): void {\n    if (newValue == void 0) {\n      obj.removeAttributeNS(this.namespace, key);\n    } else {\n      obj.setAttributeNS(this.namespace, key, newValue);\n    }\n  }\n}\n","import {\n  CollectionKind,\n  LifecycleFlags,\n  SetterObserver,\n  subscriberCollection,\n  AccessorType,\n  withFlushQueue,\n} from '@aurelia/runtime';\nimport { getCollectionObserver } from './observer-locator.js';\nimport type { INode } from '../dom.js';\nimport type { EventSubscriber } from './event-delegator.js';\nimport type { ValueAttributeObserver } from './value-attribute-observer.js';\nimport type {\n  ICollectionObserver,\n  IndexMap,\n  ISubscriber,\n  ISubscriberCollection,\n  IObserver,\n  IObserverLocator,\n  IFlushable,\n  IWithFlushQueue,\n  FlushQueue,\n} from '@aurelia/runtime';\n\nexport interface IInputElement extends HTMLInputElement {\n  model?: unknown;\n  $observers?: {\n    model?: SetterObserver;\n    value?: ValueAttributeObserver;\n  };\n  matcher?: typeof defaultMatcher;\n}\n\nfunction defaultMatcher(a: unknown, b: unknown): boolean {\n  return a === b;\n}\n\nexport interface CheckedObserver extends\n  ISubscriberCollection { }\n\nexport class CheckedObserver implements IObserver, IFlushable, IWithFlushQueue {\n  public value: unknown = void 0;\n  public oldValue: unknown = void 0;\n\n  public readonly obj: IInputElement;\n\n  public type: AccessorType = AccessorType.Node | AccessorType.Observer | AccessorType.Layout;\n\n  public collectionObserver?: ICollectionObserver<CollectionKind> = void 0;\n  public valueObserver?: ValueAttributeObserver | SetterObserver = void 0;\n  public readonly queue!: FlushQueue;\n\n  private f: LifecycleFlags = LifecycleFlags.none;\n\n  public constructor(\n    obj: INode,\n    // deepscan-disable-next-line\n    _key: PropertyKey,\n    public readonly handler: EventSubscriber,\n    public readonly observerLocator: IObserverLocator,\n  ) {\n    this.obj = obj as IInputElement;\n  }\n\n  public getValue(): unknown {\n    return this.value;\n  }\n\n  public setValue(newValue: unknown, flags: LifecycleFlags): void {\n    const currentValue = this.value;\n    if (newValue === currentValue) {\n      return;\n    }\n    this.value = newValue;\n    this.oldValue = currentValue;\n    this.f = flags;\n    this.observe();\n    this.synchronizeElement();\n    this.queue.add(this);\n  }\n\n  public handleCollectionChange(indexMap: IndexMap, flags: LifecycleFlags): void {\n    this.synchronizeElement();\n  }\n\n  public handleChange(newValue: unknown, previousValue: unknown, flags: LifecycleFlags): void {\n    this.synchronizeElement();\n  }\n\n  public synchronizeElement(): void {\n    const currentValue = this.value;\n    const obj = this.obj;\n    const elementValue = Object.prototype.hasOwnProperty.call(obj, 'model') as boolean ? obj.model : obj.value;\n    const isRadio = obj.type === 'radio';\n    const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n\n    if (isRadio) {\n      obj.checked = !!matcher(currentValue, elementValue);\n    } else if (currentValue === true) {\n      obj.checked = true;\n    } else {\n      let hasMatch = false;\n      if (currentValue instanceof Array) {\n        hasMatch = currentValue.findIndex(item => !!matcher(item, elementValue)) !== -1;\n      } else if (currentValue instanceof Set) {\n        for (const v of currentValue) {\n          if (matcher(v, elementValue)) {\n            hasMatch = true;\n            break;\n          }\n        }\n      } else if (currentValue instanceof Map) {\n        for (const pair of currentValue) {\n          const existingItem = pair[0];\n          const $isChecked = pair[1];\n          // a potential complain, when only `true` is supported\n          // but it's consistent with array\n          if (matcher(existingItem, elementValue) && $isChecked === true) {\n            hasMatch = true;\n            break;\n          }\n        }\n      }\n      obj.checked = hasMatch;\n    }\n  }\n\n  public handleEvent(): void {\n    let currentValue = this.oldValue = this.value;\n    const obj = this.obj;\n    const elementValue = Object.prototype.hasOwnProperty.call(obj, 'model') as boolean ? obj.model : obj.value;\n    const isChecked = obj.checked;\n    const matcher = obj.matcher !== void 0 ? obj.matcher : defaultMatcher;\n\n    if (obj.type === 'checkbox') {\n      if (currentValue instanceof Array) {\n        // Array binding steps on a change event:\n        // 1. find corresponding item INDEX in the Set based on current model/value and matcher\n        // 2. is the checkbox checked?\n        //    2.1. Yes: is the corresponding item in the Array (index === -1)?\n        //        2.1.1 No: push the current model/value to the Array\n        //    2.2. No: is the corresponding item in the Array (index !== -1)?\n        //        2.2.1: Yes: remove the corresponding item\n        // =================================================\n        const index = currentValue.findIndex(item => !!matcher(item, elementValue));\n\n        // if the checkbox is checkde, and there's no matching value in the existing array\n        // add the checkbox model/value to the array\n        if (isChecked && index === -1) {\n          currentValue.push(elementValue);\n        } else if (!isChecked && index !== -1) {\n          // if the checkbox is not checked, and found a matching item in the array\n          // based on the checkbox model/value\n          // remove the existing item\n          currentValue.splice(index, 1);\n        }\n        // when existing currentValue is an array,\n        // do not invoke callback as only the array obj has changed\n        return;\n      } else if (currentValue instanceof Set) {\n        // Set binding steps on a change event:\n        // 1. find corresponding item in the Set based on current model/value and matcher\n        // 2. is the checkbox checked?\n        //    2.1. Yes: is the corresponding item in the Set?\n        //        2.1.1 No: add the current model/value to the Set\n        //    2.2. No: is the corresponding item in the Set?\n        //        2.2.1: Yes: remove the corresponding item\n        // =================================================\n\n        // 1. find corresponding item\n        const unset = {};\n        let existingItem: unknown = unset;\n        for (const value of currentValue) {\n          if (matcher(value, elementValue) === true) {\n            existingItem = value;\n            break;\n          }\n        }\n        // 2.1. Checkbox is checked, is the corresponding item in the Set?\n        //\n        // if checkbox is checked and there's no value in the existing Set\n        // add the checkbox model/value to the Set\n        if (isChecked && existingItem === unset) {\n          // 2.1.1. add the current model/value to the Set\n          currentValue.add(elementValue);\n        } else if (!isChecked && existingItem !== unset) {\n          // 2.2.1 Checkbox is unchecked, corresponding is in the Set\n          //\n          // if checkbox is not checked, and found a matching item in the Set\n          // based on the checkbox model/value\n          // remove the existing item\n          currentValue.delete(existingItem);\n        }\n        // when existing value is a Set,\n        // do not invoke callback as only the Set has been mutated\n        return;\n      } else if (currentValue instanceof Map) {\n        // Map binding steps on a change event\n        // 1. find corresponding item in the Map based on current model/value and matcher\n        // 2. Set the value of the corresponding item in the Map based on checked state of the checkbox\n        // =================================================\n\n        // 1. find the corresponding item\n        let existingItem: unknown;\n        for (const pair of currentValue) {\n          const currItem = pair[0];\n          if (matcher(currItem, elementValue) === true) {\n            existingItem = currItem;\n            break;\n          }\n        }\n\n        // 2. set the value of the corresponding item in the map\n        // if checkbox is checked and there's no value in the existing Map\n        // add the checkbox model/value to the Map as key,\n        // and value will be checked state of the checkbox\n        currentValue.set(existingItem, isChecked);\n        // when existing value is a Map,\n        // do not invoke callback as only the Map has been mutated\n        return;\n      }\n      currentValue = isChecked;\n    } else if (isChecked) {\n      currentValue = elementValue;\n    } else {\n      // if it's a radio and it has been unchecked\n      // do nothing, as the radio that was checked will fire change event and it will be handle there\n      // a radio cannot be unchecked by user\n      return;\n    }\n    this.value = currentValue;\n    this.queue.add(this);\n  }\n\n  public start() {\n    this.handler.subscribe(this.obj, this);\n    this.observe();\n  }\n\n  public stop(): void {\n    this.handler.dispose();\n    this.collectionObserver?.unsubscribe(this);\n    this.collectionObserver = void 0;\n\n    this.valueObserver?.unsubscribe(this);\n  }\n\n  public subscribe(subscriber: ISubscriber): void {\n    if (this.subs.add(subscriber) && this.subs.count === 1) {\n      this.start();\n    }\n  }\n\n  public unsubscribe(subscriber: ISubscriber): void {\n    if (this.subs.remove(subscriber) && this.subs.count === 0) {\n      this.stop();\n    }\n  }\n\n  public flush(): void {\n    oV = this.oldValue;\n    this.oldValue = this.value;\n    this.subs.notify(this.value, oV, this.f);\n  }\n\n  private observe() {\n    const obj = this.obj;\n\n    (this.valueObserver ??= obj.$observers?.model ?? obj.$observers?.value)?.subscribe(this);\n\n    this.collectionObserver?.unsubscribe(this);\n    this.collectionObserver = void 0;\n\n    if (obj.type === 'checkbox') {\n      (this.collectionObserver = getCollectionObserver(this.value, this.observerLocator))?.subscribe(this);\n    }\n  }\n}\n\nsubscriberCollection(CheckedObserver);\nwithFlushQueue(CheckedObserver);\n\n// a reusable variable for `.flush()` methods of observers\n// so that there doesn't need to create an env record for every call\nlet oV: unknown = void 0;\n","import {\n  CollectionKind,\n  LifecycleFlags as LF,\n  subscriberCollection,\n  AccessorType,\n  withFlushQueue,\n  LifecycleFlags,\n} from '@aurelia/runtime';\n\nimport type { INode } from '../dom';\nimport type { EventSubscriber } from './event-delegator';\nimport type {\n  ICollectionObserver,\n  IObserver,\n  IObserverLocator,\n  ISubscriber,\n  ISubscriberCollection,\n  IWithFlushQueue,\n  IFlushable,\n  FlushQueue,\n} from '@aurelia/runtime';\n\nconst hasOwn = Object.prototype.hasOwnProperty;\nconst childObserverOptions = {\n  childList: true,\n  subtree: true,\n  characterData: true\n};\n\nfunction defaultMatcher(a: unknown, b: unknown): boolean {\n  return a === b;\n}\n\nexport interface ISelectElement extends HTMLSelectElement {\n  options: HTMLCollectionOf<IOptionElement> & Pick<HTMLOptionsCollection, 'length' | 'selectedIndex' | 'add' | 'remove'>;\n  matcher?: typeof defaultMatcher;\n}\nexport interface IOptionElement extends HTMLOptionElement {\n  model?: unknown;\n}\n\nexport interface SelectValueObserver extends\n  ISubscriberCollection {}\n\nexport class SelectValueObserver implements IObserver, IFlushable, IWithFlushQueue {\n  public value: unknown = void 0;\n  public oldValue: unknown = void 0;\n\n  public readonly obj: ISelectElement;\n\n  public hasChanges: boolean = false;\n  // ObserverType.Layout is not always true\n  // but for simplicity, always treat as such\n  public type: AccessorType = AccessorType.Node | AccessorType.Observer | AccessorType.Layout;\n\n  public arrayObserver?: ICollectionObserver<CollectionKind.array> = void 0;\n  public nodeObserver?: MutationObserver = void 0;\n  public readonly queue!: FlushQueue;\n\n  private observing: boolean = false;\n\n  public constructor(\n    obj: INode,\n    // deepscan-disable-next-line\n    _key: PropertyKey,\n    public readonly handler: EventSubscriber,\n    public readonly observerLocator: IObserverLocator,\n  ) {\n    this.obj = obj as ISelectElement;\n  }\n\n  public getValue(): unknown {\n    // is it safe to assume the observer has the latest value?\n    // todo: ability to turn on/off cache based on type\n    return this.observing\n      ? this.value\n      : this.obj.multiple\n        ? Array.from(this.obj.options).map(o => o.value)\n        : this.obj.value;\n  }\n\n  public setValue(newValue: unknown, flags: LF): void {\n    this.oldValue = this.value;\n    this.value = newValue;\n    this.hasChanges = newValue !== this.oldValue;\n    this.observeArray(newValue instanceof Array ? newValue : null);\n    if ((flags & LF.noFlush) === 0) {\n      this.flushChanges(flags);\n    }\n  }\n\n  public flushChanges(flags: LF): void {\n    if (this.hasChanges) {\n      this.hasChanges = false;\n      this.syncOptions();\n    }\n  }\n\n  public handleCollectionChange(): void {\n    // always sync \"selected\" property of <options/>\n    // immediately whenever the array notifies its mutation\n    this.syncOptions();\n  }\n\n  public syncOptions(): void {\n    const value = this.value;\n    const obj = this.obj;\n    const isArray = Array.isArray(value);\n    const matcher = obj.matcher ?? defaultMatcher;\n    const options = obj.options;\n    let i = options.length;\n\n    while (i-- > 0) {\n      const option = options[i];\n      const optionValue = hasOwn.call(option, 'model') ? option.model : option.value;\n      if (isArray) {\n        option.selected = (value as unknown[]).findIndex(item => !!matcher(optionValue, item)) !== -1;\n        continue;\n      }\n      option.selected = !!matcher(optionValue, value);\n    }\n  }\n\n  public syncValue(): boolean {\n    // Spec for synchronizing value from `<select/>`  to `SelectObserver`\n    // When synchronizing value to observed <select/> element, do the following steps:\n    // A. If `<select/>` is multiple\n    //    1. Check if current value, called `currentValue` is an array\n    //      a. If not an array, return true to signal value has changed\n    //      b. If is an array:\n    //        i. gather all current selected <option/>, in to array called `values`\n    //        ii. loop through the `currentValue` array and remove items that are nolonger selected based on matcher\n    //        iii. loop through the `values` array and add items that are selected based on matcher\n    //        iv. Return false to signal value hasn't changed\n    // B. If the select is single\n    //    1. Let `value` equal the first selected option, if no option selected, then `value` is `null`\n    //    2. assign `this.currentValue` to `this.oldValue`\n    //    3. assign `value` to `this.currentValue`\n    //    4. return `true` to signal value has changed\n    const obj = this.obj;\n    const options = obj.options;\n    const len = options.length;\n    const currentValue = this.value;\n    let i = 0;\n\n    if (obj.multiple) {\n      // A.\n      if (!(currentValue instanceof Array)) {\n        // A.1.a\n        return true;\n      }\n      // A.1.b\n      // multi select\n      let option: IOptionElement;\n      const matcher = obj.matcher || defaultMatcher;\n      // A.1.b.i\n      const values: unknown[] = [];\n      while (i < len) {\n        option = options[i];\n        if (option.selected) {\n          values.push(hasOwn.call(option, 'model')\n            ? option.model\n            : option.value\n          );\n        }\n        ++i;\n      }\n      // A.1.b.ii\n      i = 0;\n      while (i < currentValue.length) {\n        const a = currentValue[i];\n        // Todo: remove arrow fn\n        if (values.findIndex(b => !!matcher(a, b)) === -1) {\n          currentValue.splice(i, 1);\n        } else {\n          ++i;\n        }\n      }\n      // A.1.b.iii\n      i = 0;\n      while (i < values.length) {\n        const a = values[i];\n        // Todo: remove arrow fn\n        if (currentValue.findIndex(b => !!matcher(a, b)) === -1) {\n          currentValue.push(a);\n        }\n        ++i;\n      }\n      // A.1.b.iv\n      return false;\n    }\n    // B. single select\n    // B.1\n    let value: unknown = null;\n    while (i < len) {\n      const option = options[i];\n      if (option.selected) {\n        value = hasOwn.call(option, 'model')\n          ? option.model\n          : option.value;\n        break;\n      }\n      ++i;\n    }\n    // B.2\n    this.oldValue = this.value;\n    // B.3\n    this.value = value;\n    // B.4\n    return true;\n  }\n\n  private start(): void {\n    (this.nodeObserver = new this.obj.ownerDocument.defaultView!.MutationObserver(this.handleNodeChange.bind(this)))\n      .observe(this.obj, childObserverOptions);\n    this.observeArray(this.value instanceof Array ? this.value : null);\n    this.observing = true;\n  }\n\n  private stop(): void {\n    this.nodeObserver!.disconnect();\n    this.arrayObserver?.unsubscribe(this);\n    this.nodeObserver\n      = this.arrayObserver\n      = void 0;\n    this.observing = false;\n  }\n\n  // todo: observe all kind of collection\n  private observeArray(array: unknown[] | null): void {\n    this.arrayObserver?.unsubscribe(this);\n    this.arrayObserver = void 0;\n    if (array != null) {\n      if (!this.obj.multiple) {\n        throw new Error('Only null or Array instances can be bound to a multi-select.');\n      }\n      (this.arrayObserver = this.observerLocator.getArrayObserver(array)).subscribe(this);\n    }\n  }\n\n  public handleEvent(): void {\n    const shouldNotify = this.syncValue();\n    if (shouldNotify) {\n      this.queue.add(this);\n      // this.subs.notify(this.currentValue, this.oldValue, LF.none);\n    }\n  }\n\n  public handleNodeChange(): void {\n    this.syncOptions();\n    const shouldNotify = this.syncValue();\n    if (shouldNotify) {\n      this.queue.add(this);\n    }\n  }\n\n  public subscribe(subscriber: ISubscriber): void {\n    if (this.subs.add(subscriber) && this.subs.count === 1) {\n      this.handler.subscribe(this.obj, this);\n      this.start();\n    }\n  }\n\n  public unsubscribe(subscriber: ISubscriber): void {\n    if (this.subs.remove(subscriber) && this.subs.count === 0) {\n      this.handler.dispose();\n      this.stop();\n    }\n  }\n\n  public flush(): void {\n    oV = this.oldValue;\n    this.oldValue = this.value;\n    this.subs.notify(this.value, oV, LifecycleFlags.none);\n  }\n}\n\nsubscriberCollection(SelectValueObserver);\nwithFlushQueue(SelectValueObserver);\n\n// a shared variable for `.flush()` methods of observers\n// so that there doesn't need to create an env record for every call\nlet oV: unknown = void 0;\n","import { LifecycleFlags, AccessorType } from '@aurelia/runtime';\nimport { emptyArray, kebabCase } from '@aurelia/kernel';\nimport type { IAccessor } from '@aurelia/runtime';\n\nconst customPropertyPrefix: string = '--';\n\nexport class StyleAttributeAccessor implements IAccessor {\n  public value: unknown = '';\n  public oldValue: unknown = '';\n\n  public styles: Record<string, number> = {};\n  public version: number = 0;\n\n  public hasChanges: boolean = false;\n  public type: AccessorType = AccessorType.Node | AccessorType.Layout;\n\n  public constructor(\n    public readonly obj: HTMLElement,\n  ) {\n  }\n\n  public getValue(): string {\n    return this.obj.style.cssText;\n  }\n\n  public setValue(newValue: unknown, flags: LifecycleFlags): void {\n    this.value = newValue;\n    this.hasChanges = newValue !== this.oldValue;\n    if ((flags & LifecycleFlags.noFlush) === 0) {\n      this.flushChanges(flags);\n    }\n  }\n\n  private getStyleTuplesFromString(currentValue: string): [string, string][] {\n    const styleTuples: [string, string][] = [];\n    const urlRegexTester = /url\\([^)]+$/;\n    let offset = 0;\n    let currentChunk = '';\n    let nextSplit: number;\n    let indexOfColon: number;\n    let attribute: string;\n    let value: string;\n    while (offset < currentValue.length) {\n      nextSplit = currentValue.indexOf(';', offset);\n      if (nextSplit === -1) { nextSplit = currentValue.length; }\n      currentChunk += currentValue.substring(offset, nextSplit);\n      offset = nextSplit + 1;\n\n      // Make sure we never split a url so advance to next\n      if (urlRegexTester.test(currentChunk)) {\n        currentChunk += ';';\n        continue;\n      }\n\n      indexOfColon = currentChunk.indexOf(':');\n      attribute = currentChunk.substring(0, indexOfColon).trim();\n      value = currentChunk.substring(indexOfColon + 1).trim();\n      styleTuples.push([attribute, value]);\n      currentChunk = '';\n    }\n\n    return styleTuples;\n  }\n\n  private getStyleTuplesFromObject(currentValue: Record<string, unknown>): [string, string][] {\n    let value: unknown;\n    const styles: [string, string][] = [];\n    for (const property in currentValue) {\n      value = currentValue[property];\n      if (value == null) {\n        continue;\n      }\n      if (typeof value === 'string') {\n        // Custom properties should not be tampered with\n        if (property.startsWith(customPropertyPrefix)) {\n          styles.push([property, value]);\n          continue;\n        }\n        styles.push([kebabCase(property), value]);\n        continue;\n      }\n\n      styles.push(...this.getStyleTuples(value));\n    }\n\n    return styles;\n  }\n\n  private getStyleTuplesFromArray(currentValue: unknown[]): [string, string][] {\n    const len = currentValue.length;\n    if (len > 0) {\n      const styles: [string, string][] = [];\n      for (let i = 0; i < len; ++i) {\n        styles.push(...this.getStyleTuples(currentValue[i]));\n      }\n      return styles;\n    }\n    return emptyArray;\n  }\n\n  private getStyleTuples(currentValue: unknown): [string, string][] {\n    if (typeof currentValue === 'string') {\n      return this.getStyleTuplesFromString(currentValue);\n    }\n\n    if (currentValue instanceof Array) {\n      return this.getStyleTuplesFromArray(currentValue);\n    }\n\n    if (currentValue instanceof Object) {\n      return this.getStyleTuplesFromObject(currentValue as Record<string, unknown>);\n    }\n\n    return emptyArray;\n  }\n\n  public flushChanges(flags: LifecycleFlags): void {\n    if (this.hasChanges) {\n      this.hasChanges = false;\n      const currentValue = this.value;\n      const styles = this.styles;\n      const styleTuples = this.getStyleTuples(currentValue);\n\n      let style: string;\n      let version = this.version;\n\n      this.oldValue = currentValue;\n\n      let tuple: [string, string];\n      let name: string;\n      let value: string;\n      const len = styleTuples.length;\n      for (let i = 0; i < len; ++i) {\n        tuple = styleTuples[i];\n        name = tuple[0];\n        value = tuple[1];\n        this.setProperty(name, value);\n        styles[name] = version;\n      }\n\n      this.styles = styles;\n      this.version += 1;\n      if (version === 0) {\n        return;\n      }\n\n      version -= 1;\n      for (style in styles) {\n        if (!Object.prototype.hasOwnProperty.call(styles, style) || styles[style] !== version) {\n          continue;\n        }\n        this.obj.style.removeProperty(style);\n      }\n    }\n  }\n\n  public setProperty(style: string, value: string): void {\n    let priority = '';\n\n    if (value != null && typeof value.indexOf === 'function' && value.includes('!important')) {\n      priority = 'important';\n      value = value.replace('!important', '');\n    }\n\n    this.obj.style.setProperty(style, value, priority);\n  }\n\n  public bind(flags: LifecycleFlags): void {\n    this.value = this.oldValue = this.obj.style.cssText;\n  }\n}\n","import { LifecycleFlags, subscriberCollection, AccessorType, withFlushQueue } from '@aurelia/runtime';\n\nimport type { EventSubscriber } from './event-delegator.js';\nimport type { INode } from '../dom.js';\nimport type { IIndexable } from '@aurelia/kernel';\nimport type {\n  ISubscriberCollection,\n  ISubscriber,\n  IObserver,\n  IFlushable,\n  IWithFlushQueue,\n  FlushQueue,\n} from '@aurelia/runtime';\n\nexport interface ValueAttributeObserver extends ISubscriberCollection {}\n/**\n * Observer for non-radio, non-checkbox input.\n */\nexport class ValueAttributeObserver implements IObserver, IWithFlushQueue, IFlushable {\n  public readonly obj: INode & IIndexable;\n  public value: unknown = '';\n  public oldValue: unknown = '';\n\n  public hasChanges: boolean = false;\n  // ObserverType.Layout is not always true, it depends on the element & property combo\n  // but for simplicity, always treat as such\n  public type: AccessorType = AccessorType.Node | AccessorType.Observer | AccessorType.Layout;\n  public readonly queue!: FlushQueue;\n\n  public constructor(\n    obj: INode,\n    public readonly propertyKey: PropertyKey,\n    public readonly handler: EventSubscriber,\n  ) {\n    this.obj = obj as INode & IIndexable;\n  }\n\n  public getValue(): unknown {\n    // is it safe to assume the observer has the latest value?\n    // todo: ability to turn on/off cache based on type\n    return this.value;\n  }\n\n  public setValue(newValue: string | null, flags: LifecycleFlags): void {\n    if (Object.is(newValue, this.value)) {\n      return;\n    }\n    this.oldValue = this.value;\n    this.value = newValue;\n    this.hasChanges = true;\n    if (!this.handler.config.readonly && (flags & LifecycleFlags.noFlush) === 0) {\n      this.flushChanges(flags);\n    }\n  }\n\n  public flushChanges(flags: LifecycleFlags): void {\n    if (this.hasChanges) {\n      this.hasChanges = false;\n      this.obj[this.propertyKey as string] = this.value ?? this.handler.config.default;\n\n      if ((flags & LifecycleFlags.fromBind) === 0) {\n        this.queue.add(this);\n      }\n    }\n  }\n\n  public handleEvent(): void {\n    this.oldValue = this.value;\n    this.value = this.obj[this.propertyKey as string];\n    if (this.oldValue !== this.value) {\n      this.hasChanges = false;\n      this.queue.add(this);\n    }\n  }\n\n  public subscribe(subscriber: ISubscriber): void {\n    if (this.subs.add(subscriber) && this.subs.count === 1) {\n      this.handler.subscribe(this.obj, this);\n      this.value = this.oldValue = this.obj[this.propertyKey as string];\n    }\n  }\n\n  public unsubscribe(subscriber: ISubscriber): void {\n    if (this.subs.remove(subscriber) && this.subs.count === 0) {\n      this.handler.dispose();\n    }\n  }\n\n  public flush(): void {\n    oV = this.oldValue;\n    this.oldValue = this.value;\n    this.subs.notify(this.value, oV, LifecycleFlags.none);\n  }\n}\n\nsubscriberCollection(ValueAttributeObserver);\nwithFlushQueue(ValueAttributeObserver);\n\n// a reusable variable for `.flush()` methods of observers\n// so that there doesn't need to create an env record for every call\nlet oV: unknown = void 0;\n","import { emptyObject, IServiceLocator, Registration } from '@aurelia/kernel';\nimport {\n  AccessorType,\n  IDirtyChecker,\n  INodeObserverLocator,\n  IObserverLocator,\n  PropertyAccessor,\n  SetterObserver,\n} from '@aurelia/runtime';\nimport { IPlatform } from '../platform.js';\nimport { AttributeNSAccessor } from './attribute-ns-accessor.js';\nimport { CheckedObserver } from './checked-observer.js';\nimport { ClassAttributeAccessor } from './class-attribute-accessor.js';\nimport { attrAccessor } from './data-attribute-accessor.js';\nimport { EventSubscriber } from './event-delegator.js';\nimport { SelectValueObserver } from './select-value-observer.js';\nimport { StyleAttributeAccessor } from './style-attribute-accessor.js';\nimport { ISVGAnalyzer } from './svg-analyzer.js';\nimport { ValueAttributeObserver } from './value-attribute-observer.js';\nimport { createLookup, isDataAttribute } from '../utilities-html.js';\n\nimport type { IIndexable, IContainer } from '@aurelia/kernel';\nimport type { IAccessor, IObserver, ICollectionObserver, CollectionKind } from '@aurelia/runtime';\nimport type { INode } from '../dom.js';\n\n// https://infra.spec.whatwg.org/#namespaces\nconst htmlNS = 'http://www.w3.org/1999/xhtml';\nconst mathmlNS = 'http://www.w3.org/1998/Math/MathML';\nconst svgNS = 'http://www.w3.org/2000/svg';\nconst xlinkNS = 'http://www.w3.org/1999/xlink';\nconst xmlNS = 'http://www.w3.org/XML/1998/namespace';\nconst xmlnsNS = 'http://www.w3.org/2000/xmlns/';\n\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\nconst nsAttributes = Object.assign(\n  createLookup<[string, string]>(),\n  {\n    'xlink:actuate': ['actuate', xlinkNS],\n    'xlink:arcrole': ['arcrole', xlinkNS],\n    'xlink:href': ['href', xlinkNS],\n    'xlink:role': ['role', xlinkNS],\n    'xlink:show': ['show', xlinkNS],\n    'xlink:title': ['title', xlinkNS],\n    'xlink:type': ['type', xlinkNS],\n    'xml:lang': ['lang', xmlNS],\n    'xml:space': ['space', xmlNS],\n    'xmlns': ['xmlns', xmlnsNS],\n    'xmlns:xlink': ['xlink', xmlnsNS],\n  },\n);\n\nconst elementPropertyAccessor = new PropertyAccessor();\nelementPropertyAccessor.type = AccessorType.Node | AccessorType.Layout;\n\nexport type IHtmlObserverConstructor =\n  new (\n    el: INode,\n    key: PropertyKey,\n    handler: EventSubscriber,\n    observerLocator: IObserverLocator,\n    locator: IServiceLocator,\n  ) => IObserver;\n\nexport interface INodeObserverConfig extends Partial<NodeObserverConfig> {\n  events: string[];\n}\n\nexport class NodeObserverConfig {\n  /**\n   * The observer constructor to use\n   */\n  public type: IHtmlObserverConstructor;\n  /**\n   * Indicates the list of events can be used to observe a particular property\n   */\n  public readonly events!: string[];\n  /**\n   * Indicates whether this property is readonly, so observer wont attempt to assign value\n   * example: input.files\n   */\n  public readonly readonly?: boolean;\n  /**\n   * A default value to assign to the corresponding property if the incoming value is null/undefined\n   */\n  public readonly default?: unknown;\n\n  public constructor(config: INodeObserverConfig) {\n    this.type = config.type ?? ValueAttributeObserver;\n    this.events = config.events;\n    this.readonly = config.readonly;\n    this.default = config.default;\n  }\n}\n\nexport class NodeObserverLocator implements INodeObserverLocator {\n  protected static readonly inject = [IServiceLocator, IPlatform, IDirtyChecker, ISVGAnalyzer];\n\n  public allowDirtyCheck: boolean = true;\n\n  private readonly events: Record<string, Record<string, NodeObserverConfig>> = createLookup();\n  private readonly globalEvents: Record<string, NodeObserverConfig> = createLookup();\n  private readonly overrides: Record<string, Record<string, true>> = createLookup();\n  private readonly globalOverrides: Record<string, true> = createLookup();\n\n  public constructor(\n    private readonly locator: IServiceLocator,\n    private readonly platform: IPlatform,\n    private readonly dirtyChecker: IDirtyChecker,\n    private readonly svgAnalyzer: ISVGAnalyzer,\n  ) {\n    // todo: atm, platform is required to be resolved too eagerly for the `.handles()` check\n    // also a lot of tests assume default availability of observation\n    // those 2 assumptions make it not the right time to extract the following line into a\n    // default configuration for NodeObserverLocator yet\n    // but in the future, they should be, so apps that don't use check box/select, or implement a different\n    // observer don't have to pay the of the default implementation\n    const inputEvents = ['change', 'input'];\n    const inputEventsConfig: INodeObserverConfig = { events: inputEvents, default: '' };\n    this.useConfig({\n      INPUT: {\n        value: inputEventsConfig,\n        valueAsNumber: { events: inputEvents, default: 0 },\n        checked: { type: CheckedObserver, events: inputEvents } ,\n        files: { events: inputEvents, readonly: true },\n      },\n      SELECT: {\n        value: { type: SelectValueObserver, events: ['change'], default: '' },\n      },\n      TEXTAREA: {\n        value: inputEventsConfig,\n      },\n    });\n\n    const contentEventsConfig: INodeObserverConfig = { events: ['change', 'input', 'blur', 'keyup', 'paste'], default: '' };\n    const scrollEventsConfig: INodeObserverConfig = { events: ['scroll'], default: 0 };\n    this.useConfigGlobal({\n      scrollTop: scrollEventsConfig,\n      scrollLeft: scrollEventsConfig,\n      textContent: contentEventsConfig,\n      innerHTML: contentEventsConfig,\n    });\n\n    this.overrideAccessorGlobal('css', 'style', 'class');\n    this.overrideAccessor({\n      INPUT: ['value', 'checked', 'model'],\n      SELECT: ['value'],\n      TEXTAREA: ['value'],\n    });\n  }\n\n  public static register(container: IContainer) {\n    Registration.aliasTo(INodeObserverLocator, NodeObserverLocator).register(container);\n    Registration.singleton(INodeObserverLocator, NodeObserverLocator).register(container);\n  }\n\n  // deepscan-disable-next-line\n  public handles(obj: unknown, _key: PropertyKey): boolean {\n    return obj instanceof this.platform.Node;\n  }\n\n  public useConfig(config: Record<string, Record<string, INodeObserverConfig>>): void;\n  public useConfig(nodeName: string, key: PropertyKey, events: INodeObserverConfig): void;\n  public useConfig(nodeNameOrConfig: string | Record<string, Record<string, INodeObserverConfig>>, key?: PropertyKey, eventsConfig?: INodeObserverConfig): void {\n    const lookup = this.events;\n    let existingMapping: Record<string, NodeObserverConfig>;\n    if (typeof nodeNameOrConfig === 'string') {\n      existingMapping = lookup[nodeNameOrConfig] ??= createLookup();\n      if (existingMapping[key as string] == null) {\n        existingMapping[key as string] = new NodeObserverConfig(eventsConfig!);\n      } else {\n        throwMappingExisted(nodeNameOrConfig, key!);\n      }\n    } else {\n      for (const nodeName in nodeNameOrConfig) {\n        existingMapping = lookup[nodeName] ??= createLookup();\n        const newMapping = nodeNameOrConfig[nodeName];\n        for (key in newMapping) {\n          if (existingMapping[key] == null) {\n            existingMapping[key] = new NodeObserverConfig(newMapping[key]);\n          } else {\n            throwMappingExisted(nodeName, key);\n          }\n        }\n      }\n    }\n  }\n\n  public useConfigGlobal(config: Record<string, INodeObserverConfig>): void;\n  public useConfigGlobal(key: PropertyKey, events: INodeObserverConfig): void;\n  public useConfigGlobal(configOrKey: PropertyKey | Record<string, INodeObserverConfig>, eventsConfig?: INodeObserverConfig): void {\n    const lookup = this.globalEvents;\n    if (typeof configOrKey === 'object') {\n      for (const key in configOrKey) {\n        if (lookup[key] == null) {\n          lookup[key] = new NodeObserverConfig(configOrKey[key]);\n        } else {\n          throwMappingExisted('*', key);\n        }\n      }\n    } else {\n      if (lookup[configOrKey as string] == null) {\n        lookup[configOrKey as string] = new NodeObserverConfig(eventsConfig!);\n      } else {\n        throwMappingExisted('*', configOrKey);\n      }\n    }\n  }\n\n  // deepscan-disable-nextline\n  public getAccessor(obj: HTMLElement, key: PropertyKey, requestor: IObserverLocator): IAccessor | IObserver {\n    if (key in this.globalOverrides || (key in (this.overrides[obj.tagName] ?? emptyObject))) {\n      return this.getObserver(obj, key, requestor);\n    }\n    switch (key) {\n      // class / style / css attribute will be observed using .getObserver() per overrides\n      //\n      // TODO: there are (many) more situation where we want to default to DataAttributeAccessor,\n      // but for now stick to what vCurrent does\n      case 'src':\n      case 'href':\n      // https://html.spec.whatwg.org/multipage/dom.html#wai-aria\n      case 'role':\n        return attrAccessor;\n      default: {\n        const nsProps = nsAttributes[key as string];\n        if (nsProps !== undefined) {\n          return AttributeNSAccessor.forNs(nsProps[1]);\n        }\n        if (isDataAttribute(obj, key, this.svgAnalyzer)) {\n          return attrAccessor;\n        }\n        return elementPropertyAccessor;\n      }\n    }\n  }\n\n  /**\n   * For a list of specific elements\n   * compose a list of properties, based on different tag name,\n   * indicating that an overser should be returned instead of an accessor in `.getAccessor()`\n   */\n  public overrideAccessor(overrides: Record<string, string[]>): void;\n  public overrideAccessor(tagName: string, key: PropertyKey): void;\n  public overrideAccessor(tagNameOrOverrides: string | Record<string, string[]>, key?: PropertyKey): void {\n    let existingTagOverride: Record<string, true> | undefined;\n    if (typeof tagNameOrOverrides === 'string') {\n      existingTagOverride = this.overrides[tagNameOrOverrides] ??= createLookup();\n      existingTagOverride[key as string] = true;\n    } else {\n      for (const tagName in tagNameOrOverrides) {\n        for (const key of tagNameOrOverrides[tagName]) {\n          existingTagOverride =this.overrides[tagName] ??= createLookup();\n          existingTagOverride[key] = true;\n        }\n      }\n    }\n  }\n\n  /**\n   * For all elements:\n   * compose a list of properties,\n   * to indicate that an overser should be returned instead of an accessor in `.getAccessor()`\n   */\n  public overrideAccessorGlobal(...keys: string[]): void {\n    for (const key of keys) {\n      this.globalOverrides[key] = true;\n    }\n  }\n\n  public getObserver(el: HTMLElement, key: PropertyKey, requestor: IObserverLocator): IAccessor | IObserver {\n    switch (key) {\n      case 'role':\n        return attrAccessor;\n      case 'class':\n        return new ClassAttributeAccessor(el);\n      case 'css':\n      case 'style':\n        return new StyleAttributeAccessor(el);\n    }\n    const eventsConfig: NodeObserverConfig | undefined = this.events[el.tagName]?.[key as string] ?? this.globalEvents[key as string];\n    if (eventsConfig != null) {\n      return new eventsConfig.type(el, key, new EventSubscriber(eventsConfig), requestor, this.locator);\n    }\n\n    const nsProps = nsAttributes[key as string];\n    if (nsProps !== undefined) {\n      return AttributeNSAccessor.forNs(nsProps[1]);\n    }\n    if (isDataAttribute(el, key, this.svgAnalyzer)) {\n      // todo: should observe\n      return attrAccessor;\n    }\n    if (key in el.constructor.prototype) {\n      if (this.allowDirtyCheck) {\n        return this.dirtyChecker.createProperty(el, key as string);\n      }\n      // consider:\n      // - maybe add a adapter API to handle unknown obj/key combo\n      throw new Error(`Unable to observe property ${String(key)}. Register observation mapping with .useConfig().`);\n    } else {\n      // todo: probably still needs to get the property descriptor via getOwnPropertyDescriptor\n      // but let's start with simplest scenario\n      return new SetterObserver(el as HTMLElement & IIndexable, key as string);\n    }\n  }\n}\n\nexport function getCollectionObserver(collection: unknown, observerLocator: IObserverLocator): ICollectionObserver<CollectionKind> | undefined {\n  if (collection instanceof Array) {\n    return observerLocator.getArrayObserver(collection);\n  }\n  if (collection instanceof Map) {\n    return observerLocator.getMapObserver(collection);\n  }\n  if (collection instanceof Set) {\n    return observerLocator.getSetObserver(collection);\n  }\n}\n\nfunction throwMappingExisted(nodeName: string, key: PropertyKey): never {\n  throw new Error(`Mapping for property ${String(key)} of <${nodeName} /> already exists`);\n}\n","import { BindingMode, IObserverLocator, LifecycleFlags, bindingBehavior } from '@aurelia/runtime';\nimport { EventSubscriber } from '../../observation/event-delegator.js';\nimport { NodeObserverConfig } from '../../observation/observer-locator.js';\n\nimport type { Writable } from '@aurelia/kernel';\nimport type { Scope } from '@aurelia/runtime';\nimport type { CheckedObserver } from '../../observation/checked-observer.js';\nimport type { SelectValueObserver } from '../../observation/select-value-observer.js';\nimport type { ValueAttributeObserver } from '../../observation/value-attribute-observer.js';\nimport type { PropertyBinding } from '../../binding/property-binding.js';\n\nexport type UpdateTriggerableObserver = (\n  (ValueAttributeObserver & Required<ValueAttributeObserver>) |\n  (CheckedObserver & Required<CheckedObserver>) |\n  (SelectValueObserver & Required<SelectValueObserver>)\n) & {\n  originalHandler?: EventSubscriber;\n};\n\nexport type UpdateTriggerableBinding = PropertyBinding & {\n  targetObserver: UpdateTriggerableObserver;\n};\n\n@bindingBehavior('updateTrigger')\nexport class UpdateTriggerBindingBehavior {\n\n  public constructor(\n    @IObserverLocator private readonly observerLocator: IObserverLocator\n  ) {}\n\n  public bind(flags: LifecycleFlags, _scope: Scope, _hostScope: Scope | null, binding: UpdateTriggerableBinding, ...events: string[]): void {\n    if (events.length === 0) {\n      throw new Error('The updateTrigger binding behavior requires at least one event name argument: eg <input value.bind=\"firstName & updateTrigger:\\'blur\\'\">');\n    }\n\n    if (binding.mode !== BindingMode.twoWay && binding.mode !== BindingMode.fromView) {\n      throw new Error('The updateTrigger binding behavior can only be applied to two-way/ from-view bindings on input/select elements.');\n    }\n\n    // ensure the binding's target observer has been set.\n    const targetObserver = this.observerLocator.getObserver(binding.target, binding.targetProperty) as UpdateTriggerableObserver;\n    if (!targetObserver.handler) {\n      throw new Error('The updateTrigger binding behavior can only be applied to two-way/ from-view bindings on input/select elements.');\n    }\n\n    binding.targetObserver = targetObserver;\n\n    // stash the original element subscribe function.\n    const originalHandler = targetObserver.handler;\n    targetObserver.originalHandler = originalHandler;\n\n    // replace the element subscribe function with one that uses the correct events.\n    (targetObserver as Writable<typeof targetObserver>).handler = new EventSubscriber(new NodeObserverConfig({\n      default: originalHandler.config.default,\n      events,\n      readonly: originalHandler.config.readonly\n    }));\n  }\n\n  public unbind(flags: LifecycleFlags, _scope: Scope, _hostScope: Scope | null, binding: UpdateTriggerableBinding): void {\n    // restore the state of the binding.\n    binding.targetObserver.handler.dispose();\n    (binding.targetObserver as Writable<typeof binding.targetObserver>).handler = binding.targetObserver.originalHandler!;\n    binding.targetObserver.originalHandler = null!;\n  }\n}\n","import { BindingMode } from '@aurelia/runtime';\nimport { INode } from '../../dom.js';\nimport { IPlatform } from '../../platform.js';\nimport { customAttribute } from '../custom-attribute.js';\nimport { bindable } from '../../bindable.js';\nimport type { ICustomAttributeController, ICustomAttributeViewModel } from '../../templating/controller.js';\n\n/**\n * Focus attribute for element focus binding\n */\n@customAttribute('focus')\nexport class Focus implements ICustomAttributeViewModel {\n\n  public readonly $controller!: ICustomAttributeController<this>;\n\n  @bindable({ mode: BindingMode.twoWay })\n  public value: unknown;\n\n  /**\n   * Indicates whether `apply` should be called when `attached` callback is invoked\n   */\n  private needsApply: boolean = false;\n\n  public constructor(\n    @INode private readonly element: INode<HTMLElement>,\n    @IPlatform private readonly p: IPlatform,\n  ) {}\n\n  public binding(): void {\n    this.valueChanged();\n  }\n\n  /**\n   * Invoked everytime the bound value changes.\n   *\n   * @param newValue - The new value.\n   */\n  public valueChanged(): void {\n    // In theory, we could/should react immediately\n    // but focus state of an element cannot be achieved\n    // while it's disconnected from the document\n    // thus, there neesd to be a check if it's currently connected or not\n    // before applying the value to the element\n    if (this.$controller.isActive) {\n      this.apply();\n    } else {\n      // If the element is not currently connect\n      // toggle the flag to add pending work for later\n      // in attached lifecycle\n      this.needsApply = true;\n    }\n  }\n\n  /**\n   * Invoked when the attribute is attached to the DOM.\n   */\n  public attached(): void {\n    if (this.needsApply) {\n      this.needsApply = false;\n      this.apply();\n    }\n    const el = this.element;\n    el.addEventListener('focus', this);\n    el.addEventListener('blur', this);\n  }\n\n  /**\n   * Invoked when the attribute is afterDetachChildren from the DOM.\n   */\n  public afterDetachChildren(): void {\n    const el = this.element;\n    el.removeEventListener('focus', this);\n    el.removeEventListener('blur', this);\n  }\n\n  /**\n   * EventTarget interface handler for better memory usage\n   */\n  public handleEvent(e: FocusEvent): void {\n    // there are only two event listened to\n    // if the even is focus, it menans the element is focused\n    // only need to switch the value to true\n    if (e.type === 'focus') {\n      this.value = true;\n    } else if (!this.isElFocused) {\n      // else, it's blur event\n      // when a blur event happens, there are two situations\n      // 1. the element itself lost the focus\n      // 2. window lost the focus\n      // To handle both (1) and (2), only need to check if\n      // current active element is still the same element of this focus custom attribute\n      // If it's not, it's a blur event happened on Window because the browser tab lost focus\n      this.value = false;\n    }\n  }\n\n  /**\n   * Focus/blur based on current value\n   */\n  private apply(): void {\n    const el = this.element;\n    const isFocused = this.isElFocused;\n    const shouldFocus = this.value;\n    if (shouldFocus && !isFocused) {\n      el.focus();\n    } else if (!shouldFocus && isFocused) {\n      el.blur();\n    }\n  }\n\n  private get isElFocused(): boolean {\n    return this.element === this.p.document.activeElement;\n  }\n}\n","import { alias } from '@aurelia/runtime';\n\nimport { INode } from '../../dom.js';\nimport { IPlatform } from '../../platform.js';\nimport { customAttribute } from '../custom-attribute.js';\nimport { bindable } from '../../bindable.js';\nimport { IInstruction } from '../../renderer.js';\n\nimport type { ITask } from '@aurelia/runtime';\n\nimport type { ICustomAttributeViewModel } from '../../templating/controller.js';\nimport type { HydrateAttributeInstruction } from '../../renderer.js';\n\n@customAttribute('show')\n@alias('hide')\nexport class Show implements ICustomAttributeViewModel {\n  @bindable public value: unknown;\n\n  private isToggled: boolean;\n  private isActive: boolean = false;\n  private task: ITask | null = null;\n  private readonly base: boolean;\n\n  public constructor(\n    @INode private readonly el: INode<HTMLElement>,\n    @IPlatform private readonly p: IPlatform,\n    @IInstruction instr: HydrateAttributeInstruction,\n  ) {\n    // if this is declared as a 'hide' attribute, then this.base will be false, inverting everything.\n    this.isToggled = this.base = instr.alias !== 'hide';\n  }\n\n  public binding(): void {\n    this.isActive = true;\n    this.update();\n  }\n\n  public detaching() {\n    this.isActive = false;\n    this.task?.cancel();\n    this.task = null;\n  }\n\n  public valueChanged(): void {\n    if (this.isActive && this.task === null) {\n      this.task = this.p.domWriteQueue.queueTask(this.update);\n    }\n  }\n\n  private $val: string = '';\n  private $prio: string = '';\n  private readonly update = (): void => {\n    this.task = null;\n\n    // Only compare at the synchronous moment when we're about to update, because the value might have changed since the update was queued.\n    if (Boolean(this.value) !== this.isToggled) {\n      if (this.isToggled === this.base) {\n        this.isToggled = !this.base;\n        // Note: in v1 we used the 'au-hide' class, but in v2 it's so trivial to conditionally apply classes (e.g. 'hide.class=\"someCondition\"'),\n        // that it's probably better to avoid the CSS inject infra involvement and keep this CA as simple as possible.\n        // Instead, just store and restore the property values (with each mutation, to account for in-between updates), to cover the common cases, until there is convincing feedback to do otherwise.\n        this.$val = this.el.style.getPropertyValue('display');\n        this.$prio = this.el.style.getPropertyPriority('display');\n        this.el.style.setProperty('display', 'none', 'important');\n      } else {\n        this.isToggled = this.base;\n        this.el.style.setProperty('display', this.$val, this.$prio);\n        // If the style attribute is now empty, remove it.\n        if (this.el.getAttribute('style') === '') {\n          this.el.removeAttribute('style');\n        }\n      }\n    }\n  };\n}\n","import { nextId, onResolve } from '@aurelia/kernel';\nimport { LifecycleFlags } from '@aurelia/runtime';\nimport { IRenderLocation, setEffectiveParentNode } from '../../dom.js';\nimport { IPlatform } from '../../platform.js';\nimport { IViewFactory } from '../../templating/view.js';\nimport { templateController } from '../custom-attribute.js';\nimport { bindable } from '../../bindable.js';\nimport type { ControllerVisitor, ICustomAttributeController, ICustomAttributeViewModel, IHydratedController, IHydratedParentController, ISyntheticView } from '../../templating/controller.js';\n\nexport type PortalTarget<T extends Node & ParentNode = Node & ParentNode> = string | T | null | undefined;\ntype ResolvedTarget<T extends Node & ParentNode = Node & ParentNode> = T | null;\n\nexport type PortalLifecycleCallback = (target: PortalTarget, view: ISyntheticView) => void | Promise<void>;\n\n@templateController('portal')\nexport class Portal<T extends Node & ParentNode = Node & ParentNode> implements ICustomAttributeViewModel {\n\n  public readonly $controller!: ICustomAttributeController<this>;\n\n  public readonly id: number = nextId('au$component');\n\n  @bindable({ primary: true })\n  public target: PortalTarget;\n\n  @bindable({ callback: 'targetChanged' })\n  public renderContext: PortalTarget;\n\n  @bindable()\n  public strict: boolean = false;\n\n  @bindable()\n  public deactivating?: PortalLifecycleCallback;\n\n  @bindable()\n  public activating?: PortalLifecycleCallback;\n\n  @bindable()\n  public deactivated?: PortalLifecycleCallback;\n\n  @bindable()\n  public activated?: PortalLifecycleCallback;\n\n  @bindable()\n  public callbackContext: unknown;\n\n  public view: ISyntheticView;\n\n  private currentTarget?: PortalTarget;\n\n  public constructor(\n    @IViewFactory private readonly factory: IViewFactory,\n    @IRenderLocation private readonly originalLoc: IRenderLocation,\n    @IPlatform private readonly p: IPlatform,\n  ) {\n    // to make the shape of this object consistent.\n    // todo: is this necessary\n    this.currentTarget = p.document.createElement('div');\n\n    this.view = this.factory.create();\n    setEffectiveParentNode(this.view.nodes!, originalLoc as unknown as Node);\n  }\n\n  public attaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    if (this.callbackContext == null) {\n      this.callbackContext = this.$controller.scope.bindingContext;\n    }\n    const newTarget = this.currentTarget = this.resolveTarget();\n    this.view.setHost(newTarget);\n\n    return this.$activating(initiator, newTarget, flags);\n  }\n\n  public detaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    return this.$deactivating(initiator, this.currentTarget as T, flags);\n  }\n\n  public targetChanged(): void {\n    const { $controller } = this;\n    if (!$controller.isActive) {\n      return;\n    }\n\n    const oldTarget = this.currentTarget;\n    const newTarget = this.currentTarget = this.resolveTarget();\n\n    if (oldTarget === newTarget) {\n      return;\n    }\n\n    this.view.setHost(newTarget);\n    // TODO(fkleuver): fix and test possible race condition\n    const ret = onResolve(\n      this.$deactivating(null, newTarget, $controller.flags),\n      () => {\n        return this.$activating(null, newTarget, $controller.flags);\n      },\n    );\n    if (ret instanceof Promise) { ret.catch(err => { throw err; }); }\n  }\n\n  private $activating(\n    initiator: IHydratedController | null,\n    target: T,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    const { activating, callbackContext, view } = this;\n\n    view.setHost(target);\n\n    return onResolve(\n      activating?.call(callbackContext, target, view),\n      () => {\n        return this.activate(initiator, target, flags);\n      },\n    );\n  }\n\n  private activate(\n    initiator: IHydratedController | null,\n    target: T,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    const { $controller, view } = this;\n\n    if (initiator === null) {\n      view.nodes.appendTo(target);\n    } else {\n      // TODO(fkleuver): fix and test possible race condition\n      return onResolve(\n        view.activate(initiator ?? view, $controller, flags, $controller.scope),\n        () => {\n          return this.$activated(target);\n        },\n      );\n    }\n\n    return this.$activated(target);\n  }\n\n  private $activated(\n    target: T,\n  ): void | Promise<void> {\n    const { activated, callbackContext, view } = this;\n\n    return activated?.call(callbackContext, target, view);\n  }\n\n  private $deactivating(\n    initiator: IHydratedController | null,\n    target: T,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    const { deactivating, callbackContext, view } = this;\n\n    return onResolve(\n      deactivating?.call(callbackContext, target, view),\n      () => {\n        return this.deactivate(initiator, target, flags);\n      },\n    );\n  }\n\n  private deactivate(\n    initiator: IHydratedController | null,\n    target: T,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    const { $controller, view } = this;\n\n    if (initiator === null) {\n      view.nodes.remove();\n    } else {\n      return onResolve(\n        view.deactivate(initiator, $controller, flags),\n        () => {\n          return this.$deactivated(target);\n        },\n      );\n    }\n\n    return this.$deactivated(target);\n  }\n\n  private $deactivated(\n    target: T,\n  ): void | Promise<void> {\n    const { deactivated, callbackContext, view } = this;\n\n    return deactivated?.call(callbackContext, target, view);\n  }\n\n  private resolveTarget(): T {\n    const p = this.p;\n    // with a $ in front to make it less confusing/error prone\n    const $document = p.document;\n    let target = this.target;\n    let context = this.renderContext;\n\n    if (target === '') {\n      if (this.strict) {\n        throw new Error('Empty querySelector');\n      }\n      return $document.body as unknown as T;\n    }\n\n    if (typeof target === 'string') {\n      let queryContext: ParentNode = $document;\n      if (typeof context === 'string') {\n        context = $document.querySelector(context) as ResolvedTarget;\n      }\n      if (context instanceof p.Node) {\n        queryContext = context;\n      }\n      target = queryContext.querySelector(target) as ResolvedTarget;\n    }\n\n    if (target instanceof p.Node) {\n      return target as T & Node & ParentNode;\n    }\n\n    if (target == null) {\n      if (this.strict) {\n        throw new Error('Portal target not found');\n      }\n      return $document.body as unknown as T;\n    }\n\n    return target as T & Node & ParentNode;\n  }\n\n  public dispose(): void {\n    this.view.dispose();\n    this.view = (void 0)!;\n    this.callbackContext = null;\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    if (this.view?.accept(visitor) === true) {\n      return true;\n    }\n  }\n}\n","import { nextId } from '@aurelia/kernel';\nimport { LifecycleFlags } from '@aurelia/runtime';\nimport { IRenderLocation } from '../../dom.js';\nimport { IViewFactory } from '../../templating/view.js';\nimport { templateController } from '../custom-attribute.js';\nimport type { ISyntheticView, ICustomAttributeController, ICustomAttributeViewModel, IHydratedController, IHydratedParentController, ControllerVisitor } from '../../templating/controller.js';\n\nabstract class FlagsTemplateController implements ICustomAttributeViewModel {\n  public readonly id: number;\n\n  public view: ISyntheticView;\n\n  public readonly $controller!: ICustomAttributeController<this>;\n\n  public constructor(\n    private readonly factory: IViewFactory,\n    location: IRenderLocation,\n    private readonly flags: LifecycleFlags,\n  ) {\n    this.id = nextId('au$component');\n\n    this.view = this.factory.create().setLocation(location);\n  }\n\n  public attaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    const { $controller } = this;\n    return this.view.activate(initiator, $controller, flags | this.flags, $controller.scope, $controller.hostScope);\n  }\n\n  public detaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    return this.view.deactivate(initiator, this.$controller, flags);\n  }\n\n  public dispose(): void {\n    this.view.dispose();\n    this.view = (void 0)!;\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    if (this.view?.accept(visitor) === true) {\n      return true;\n    }\n  }\n}\n\nexport class FrequentMutations extends FlagsTemplateController {\n  /**\n   * @internal\n   */\n  public static inject = [IViewFactory, IRenderLocation];\n  public constructor(factory: IViewFactory, location: IRenderLocation) {\n    super(factory, location, LifecycleFlags.persistentTargetObserverQueue);\n  }\n}\n\nexport class ObserveShallow extends FlagsTemplateController {\n  /**\n   * @internal\n   */\n  public static inject = [IViewFactory, IRenderLocation];\n  public constructor(factory: IViewFactory, location: IRenderLocation) {\n    super(factory, location, LifecycleFlags.observeLeafPropertiesOnly);\n  }\n}\n\ntemplateController('frequent-mutations')(FrequentMutations);\ntemplateController('observe-shallow')(ObserveShallow);\n","import { nextId, onResolve } from '@aurelia/kernel';\nimport { LifecycleFlags } from '@aurelia/runtime';\nimport { IRenderLocation } from '../../dom.js';\nimport { IViewFactory } from '../../templating/view.js';\nimport { templateController } from '../custom-attribute.js';\nimport { bindable } from '../../bindable.js';\nimport { IWorkTracker } from '../../app-root.js';\n\nimport type { ISyntheticView, ICustomAttributeController, ICustomAttributeViewModel, IHydratedController, IHydratedParentController, ControllerVisitor, IHydratableController } from '../../templating/controller.js';\nimport type { ICompiledRenderContext } from '../../templating/render-context.js';\nimport type { Instruction } from '../../renderer.js';\nimport type { INode } from '../../dom.js';\n\n@templateController('if')\nexport class If implements ICustomAttributeViewModel {\n  public readonly id: number = nextId('au$component');\n\n  public elseFactory?: IViewFactory = void 0;\n  public elseView?: ISyntheticView = void 0;\n  public ifView?: ISyntheticView = void 0;\n  public view?: ISyntheticView = void 0;\n\n  public readonly $controller!: ICustomAttributeController<this>; // This is set by the controller after this instance is constructed\n\n  @bindable public value: unknown = false;\n  /**\n   * `false` to always dispose the existing `view` whenever the value of if changes to false\n   */\n  @bindable({\n    set: v => v === '' || !!v && v !== 'false'\n  })\n  public cache: boolean = true;\n  private pending: void | Promise<void> = void 0;\n  private wantsDeactivate: boolean = false;\n  private swapId: number = 0;\n  private ctrl!: ICustomAttributeController<If>;\n\n  public constructor(\n    @IViewFactory private readonly ifFactory: IViewFactory,\n    @IRenderLocation private readonly location: IRenderLocation,\n    @IWorkTracker private readonly work: IWorkTracker,\n  ) {}\n\n  public created(): void {\n    this.ctrl = this.$controller;\n  }\n\n  public attaching(initiator: IHydratedController, parent: IHydratedController, f: LifecycleFlags): void | Promise<void> {\n    let view: ISyntheticView | undefined;\n    const swapId = this.swapId++;\n    /**\n     * returns true when\n     * 1. entering deactivation of the [if] itself\n     * 2. new swap has started since this change\n     */\n    const isCurrent = () => !this.wantsDeactivate && this.swapId === swapId + 1;\n    return onResolve(this.pending, () => {\n      if (!isCurrent()) {\n        return;\n      }\n      this.pending = void 0;\n      if (this.value) {\n        view = (this.view = this.ifView = this.cache && this.ifView != null\n          ? this.ifView\n          : this.ifFactory.create(f)\n        );\n      } else {\n        // truthy -> falsy\n        view = (this.view = this.elseView = this.cache && this.elseView != null\n          ? this.elseView\n          : this.elseFactory?.create(f)\n        );\n      }\n      if (view == null) {\n        return;\n      }\n      // todo: else view should set else location\n      view.setLocation(this.location);\n\n      // Promise return values from user VM hooks are awaited by the initiator\n      this.pending = onResolve(\n        view.activate(initiator, this.ctrl, f, this.ctrl.scope, this.ctrl.hostScope),\n        () => {\n          if (isCurrent()) {\n            this.pending = void 0;\n          }\n        });\n      // old\n      // void (this.view = this.updateView(this.value, f))?.activate(initiator, this.ctrl, f, this.ctrl.scope, this.ctrl.hostScope);\n    });\n  }\n\n  public detaching(initiator: IHydratedController, parent: IHydratedParentController, flags: LifecycleFlags): void | Promise<void> {\n    this.wantsDeactivate = true;\n    return onResolve(this.pending, () => {\n      this.wantsDeactivate = false;\n      this.pending = void 0;\n      // Promise return values from user VM hooks are awaited by the initiator\n      void this.view?.deactivate(initiator, this.ctrl, flags);\n    });\n  }\n\n  public valueChanged(newValue: unknown, oldValue: unknown, f: LifecycleFlags): void | Promise<void> {\n    if (!this.ctrl.isActive) {\n      return;\n    }\n    // change scenarios:\n    // truthy -> truthy (do nothing)\n    // falsy -> falsy (do nothing)\n    // truthy -> falsy (no cache = destroy)\n    // falsy -> truthy (no view = create)\n    newValue = !!newValue;\n    oldValue = !!oldValue;\n    if (newValue === oldValue) {\n      return;\n    }\n    this.work.start();\n    const currView = this.view;\n    const swapId = this.swapId++;\n    /**\n     * returns true when\n     * 1. entering deactivation of the [if] itself\n     * 2. new swap has started since this change\n     */\n    const isCurrent = () => !this.wantsDeactivate && this.swapId === swapId + 1;\n    let view: ISyntheticView | undefined;\n    return onResolve(onResolve(this.pending,\n      () => this.pending = onResolve(\n        currView?.deactivate(currView, this.ctrl, f),\n        () => {\n          if (!isCurrent()) {\n            return;\n          }\n          // falsy -> truthy\n          if (newValue) {\n            view = (this.view = this.ifView = this.cache && this.ifView != null\n              ? this.ifView\n              : this.ifFactory.create(f)\n            );\n          } else {\n            // truthy -> falsy\n            view = (this.view = this.elseView = this.cache && this.elseView != null\n              ? this.elseView\n              : this.elseFactory?.create(f)\n            );\n          }\n          if (view == null) {\n            return;\n          }\n          // todo: location should be based on either the [if]/[else] attribute\n          //       instead of always the if\n          view.setLocation(this.location);\n          return onResolve(\n            view.activate(view, this.ctrl, f, this.ctrl.scope, this.ctrl.hostScope),\n            () => {\n              if (isCurrent()) {\n                this.pending = void 0;\n              }\n            }\n          );\n        }\n      )\n    ), () => this.work.finish());\n  }\n\n  public dispose(): void {\n    this.ifView?.dispose();\n    this.elseView?.dispose();\n    this.ifView\n      = this.elseView\n      = this.view\n      = void 0;\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    if (this.view?.accept(visitor) === true) {\n      return true;\n    }\n  }\n}\n\n@templateController({ name: 'else' })\nexport class Else {\n  public readonly id: number = nextId('au$component');\n\n  public constructor(\n    @IViewFactory private readonly factory: IViewFactory,\n  ) {}\n\n  public link(\n    flags: LifecycleFlags,\n    parentContext: ICompiledRenderContext,\n    controller: IHydratableController,\n    _childController: ICustomAttributeController,\n    _target: INode,\n    _instruction: Instruction,\n  ): void {\n    const children = controller.children!;\n    const ifBehavior: If | ICustomAttributeController = children[children.length - 1] as If | ICustomAttributeController;\n    if (ifBehavior instanceof If) {\n      ifBehavior.elseFactory = this.factory;\n    } else if (ifBehavior.viewModel instanceof If) {\n      ifBehavior.viewModel.elseFactory = this.factory;\n    } else {\n      throw new Error(`Unsupported IfBehavior`); // TODO: create error code\n    }\n  }\n}\n","import { compareNumber, nextId, IDisposable, onResolve } from '@aurelia/kernel';\nimport {\n  applyMutationsToIndices,\n  BindingContext,\n  Collection,\n  CollectionObserver,\n  ForOfStatement,\n  getCollectionObserver,\n  IndexMap,\n  IOverrideContext,\n  LifecycleFlags as LF,\n  Scope,\n  synchronizeIndices,\n} from '@aurelia/runtime';\nimport { IRenderLocation } from '../../dom.js';\nimport { IViewFactory } from '../../templating/view.js';\nimport { templateController } from '../custom-attribute.js';\nimport { IController } from '../../templating/controller.js';\nimport { bindable } from '../../bindable.js';\n\nimport type { PropertyBinding } from '../../binding/property-binding.js';\nimport type { ISyntheticView, ICustomAttributeController, IHydratableController, ICustomAttributeViewModel, IHydratedController, IHydratedParentController, ControllerVisitor } from '../../templating/controller.js';\n\ntype Items<C extends Collection = unknown[]> = C | undefined;\n\nfunction dispose(disposable: IDisposable): void {\n  disposable.dispose();\n}\n\n@templateController('repeat')\nexport class Repeat<C extends Collection = unknown[]> implements ICustomAttributeViewModel {\n  public readonly id: number = nextId('au$component');\n\n  public hasPendingInstanceMutation: boolean = false;\n  public observer?: CollectionObserver = void 0;\n  public views: ISyntheticView[] = [];\n  public key?: string = void 0;\n\n  public forOf!: ForOfStatement;\n  public local!: string;\n\n  public readonly $controller!: ICustomAttributeController<this>; // This is set by the controller after this instance is constructed\n\n  @bindable public items: Items<C>;\n\n  private normalizedItems?: unknown[] = void 0;\n\n  public constructor(\n    @IRenderLocation public location: IRenderLocation,\n    @IController public parent: IHydratableController,\n    @IViewFactory public factory: IViewFactory\n  ) {}\n\n  public binding(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LF,\n  ): void | Promise<void> {\n    this.checkCollectionObserver(flags);\n    const bindings = this.parent.bindings as PropertyBinding[];\n    let binding: PropertyBinding = (void 0)!;\n    for (let i = 0, ii = bindings.length; i < ii; ++i) {\n      binding = bindings[i];\n      if (binding.target === this && binding.targetProperty === 'items') {\n        this.forOf = binding.sourceExpression as ForOfStatement;\n        break;\n      }\n    }\n\n    this.local = this.forOf.declaration.evaluate(flags, this.$controller.scope, null, binding.locator, null) as string;\n  }\n\n  public attaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LF,\n  ): void | Promise<void> {\n    this.normalizeToArray(flags);\n\n    return this.activateAllViews(initiator, flags);\n  }\n\n  public detaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LF,\n  ): void | Promise<void> {\n    this.checkCollectionObserver(flags);\n\n    return this.deactivateAllViews(initiator, flags);\n  }\n\n  // called by SetterObserver\n  public itemsChanged(flags: LF): void {\n    const { $controller } = this;\n    if (!$controller.isActive) {\n      return;\n    }\n    flags |= $controller.flags;\n    this.checkCollectionObserver(flags);\n    this.normalizeToArray(flags);\n\n    const ret = onResolve(\n      this.deactivateAllViews(null, flags),\n      () => {\n        // TODO(fkleuver): add logic to the controller that ensures correct handling of race conditions and add a variety of `if` integration tests\n        return this.activateAllViews(null, flags);\n      },\n    );\n    if (ret instanceof Promise) { ret.catch(err => { throw err; }); }\n  }\n\n  // called by a CollectionObserver\n  public handleCollectionChange(\n    indexMap: IndexMap | undefined,\n    flags: LF,\n  ): void {\n    const { $controller } = this;\n    if (!$controller.isActive) {\n      return;\n    }\n    flags |= $controller.flags;\n    this.normalizeToArray(flags);\n\n    if (indexMap === void 0) {\n      const ret = onResolve(\n        this.deactivateAllViews(null, flags),\n        () => {\n          // TODO(fkleuver): add logic to the controller that ensures correct handling of race conditions and add a variety of `if` integration tests\n          return this.activateAllViews(null, flags);\n        },\n      );\n      if (ret instanceof Promise) { ret.catch(err => { throw err; }); }\n    } else {\n      const oldLength = this.views.length;\n      applyMutationsToIndices(indexMap);\n      // first detach+unbind+(remove from array) the deleted view indices\n      if (indexMap.deletedItems.length > 0) {\n        indexMap.deletedItems.sort(compareNumber);\n        const ret = onResolve(\n          this.deactivateAndRemoveViewsByKey(indexMap, flags),\n          () => {\n            // TODO(fkleuver): add logic to the controller that ensures correct handling of race conditions and add a variety of `if` integration tests\n            return this.createAndActivateAndSortViewsByKey(oldLength, indexMap, flags);\n          },\n        );\n        if (ret instanceof Promise) { ret.catch(err => { throw err; }); }\n      } else {\n        // TODO(fkleuver): add logic to the controller that ensures correct handling of race conditions and add integration tests\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.createAndActivateAndSortViewsByKey(oldLength, indexMap, flags);\n      }\n    }\n  }\n\n  // todo: subscribe to collection from inner expression\n  private checkCollectionObserver(flags: LF): void {\n    const oldObserver = this.observer;\n    if ((flags & LF.fromUnbind)) {\n      if (oldObserver !== void 0) {\n        oldObserver.unsubscribe(this);\n      }\n    } else if (this.$controller.isActive) {\n      const newObserver = this.observer = getCollectionObserver(this.items);\n      if (oldObserver !== newObserver && oldObserver) {\n        oldObserver.unsubscribe(this);\n      }\n      if (newObserver) {\n        newObserver.subscribe(this);\n      }\n    }\n  }\n\n  private normalizeToArray(flags: LF): void {\n    const items: Items<C> = this.items;\n    if (items instanceof Array) {\n      this.normalizedItems = items;\n      return;\n    }\n    const forOf = this.forOf;\n    if (forOf === void 0) {\n      return;\n    }\n    const normalizedItems: unknown[] = [];\n    this.forOf.iterate(flags, items, (arr, index, item) => {\n      normalizedItems[index] = item;\n    });\n    this.normalizedItems = normalizedItems;\n  }\n\n  private activateAllViews(\n    initiator: IHydratedController | null,\n    flags: LF,\n  ): void | Promise<void> {\n    let promises: Promise<void>[] | undefined = void 0;\n    let ret: void | Promise<void>;\n    let view: ISyntheticView;\n    let viewScope: Scope;\n\n    const { $controller, factory, local, location, items } = this;\n    const parentScope = $controller.scope;\n    const hostScope = $controller.hostScope;\n    const newLen = this.forOf.count(flags, items);\n    const views = this.views = Array(newLen);\n\n    this.forOf.iterate(flags, items, (arr, i, item) => {\n      view = views[i] = factory.create(flags).setLocation(location);\n      view.nodes!.unlink();\n      viewScope = Scope.fromParent(parentScope, BindingContext.create(local, item));\n\n      setContextualProperties(viewScope.overrideContext as IRepeatOverrideContext, i, newLen);\n\n      ret = view.activate(initiator ?? view, $controller, flags, viewScope, hostScope);\n      if (ret instanceof Promise) {\n        (promises ?? (promises = [])).push(ret);\n      }\n    });\n\n    if (promises !== void 0) {\n      return (promises as Promise<void>[]).length === 1\n        ? promises[0]\n        : Promise.all(promises) as unknown as Promise<void>;\n    }\n  }\n\n  private deactivateAllViews(\n    initiator: IHydratedController | null,\n    flags: LF,\n  ): void | Promise<void> {\n    let promises: Promise<void>[] | undefined = void 0;\n    let ret: void | Promise<void>;\n    let view: ISyntheticView;\n\n    const { views, $controller } = this;\n\n    for (let i = 0, ii = views.length; i < ii; ++i) {\n      view = views[i];\n      view.release();\n      ret = view.deactivate(initiator ?? view, $controller, flags);\n      if (ret instanceof Promise) {\n        (promises ?? (promises = [])).push(ret);\n      }\n    }\n\n    if (promises !== void 0) {\n      return promises.length === 1\n        ? promises[0]\n        : Promise.all(promises) as unknown as Promise<void>;\n    }\n  }\n\n  private deactivateAndRemoveViewsByKey(\n    indexMap: IndexMap,\n    flags: LF,\n  ): void | Promise<void> {\n    let promises: Promise<void>[] | undefined = void 0;\n    let ret: void | Promise<void>;\n    let view: ISyntheticView;\n\n    const { $controller, views } = this;\n\n    const deleted = indexMap.deletedItems;\n    const deletedLen = deleted.length;\n    let i = 0;\n    for (; i < deletedLen; ++i) {\n      view = views[deleted[i]];\n      view.release();\n      ret = view.deactivate(view, $controller, flags);\n      if (ret instanceof Promise) {\n        (promises ?? (promises = [])).push(ret);\n      }\n    }\n\n    i = 0;\n    let j = 0;\n    for (; i < deletedLen; ++i) {\n      j = deleted[i] - i;\n      views.splice(j, 1);\n    }\n\n    if (promises !== void 0) {\n      return promises.length === 1\n        ? promises[0]\n        : Promise.all(promises) as unknown as Promise<void>;\n    }\n  }\n\n  private createAndActivateAndSortViewsByKey(\n    oldLength: number,\n    indexMap: IndexMap,\n    flags: LF,\n  ): void | Promise<void> {\n    let promises: Promise<void>[] | undefined = void 0;\n    let ret: void | Promise<void>;\n    let view: ISyntheticView;\n    let viewScope: Scope;\n\n    const { $controller, factory, local, normalizedItems, location, views } = this;\n    const mapLen = indexMap.length;\n\n    for (let i = 0; i < mapLen; ++i) {\n      if (indexMap[i] === -2) {\n        view = factory.create(flags);\n        views.splice(i, 0, view);\n      }\n    }\n\n    if (views.length !== mapLen) {\n      // TODO: create error code and use reporter with more informative message\n      throw new Error(`viewsLen=${views.length}, mapLen=${mapLen}`);\n    }\n\n    const parentScope = $controller.scope;\n    const hostScope = $controller.hostScope;\n    const newLen = indexMap.length;\n    synchronizeIndices(views, indexMap);\n\n    // this algorithm retrieves the indices of the longest increasing subsequence of items in the repeater\n    // the items on those indices are not moved; this minimizes the number of DOM operations that need to be performed\n    const seq = longestIncreasingSubsequence(indexMap);\n    const seqLen = seq.length;\n\n    let next: ISyntheticView;\n    let j = seqLen - 1;\n    let i = newLen - 1;\n    for (; i >= 0; --i) {\n      view = views[i];\n      next = views[i + 1];\n\n      view.nodes!.link(next?.nodes ?? location);\n\n      if (indexMap[i] === -2) {\n        viewScope = Scope.fromParent(parentScope, BindingContext.create(local, normalizedItems![i]));\n        setContextualProperties(viewScope.overrideContext as IRepeatOverrideContext, i, newLen);\n        view.setLocation(location);\n\n        ret = view.activate(view, $controller, flags, viewScope, hostScope);\n        if (ret instanceof Promise) {\n          (promises ?? (promises = [])).push(ret);\n        }\n      } else if (j < 0 || seqLen === 1 || i !== seq[j]) {\n        setContextualProperties(view.scope!.overrideContext as IRepeatOverrideContext, i, newLen);\n        view.nodes.insertBefore(view.location!);\n      } else {\n        if (oldLength !== newLen) {\n          setContextualProperties(view.scope!.overrideContext as IRepeatOverrideContext, i, newLen);\n        }\n        --j;\n      }\n    }\n\n    if (promises !== void 0) {\n      return promises.length === 1\n        ? promises[0]\n        : Promise.all(promises) as unknown as Promise<void>;\n    }\n  }\n\n  public dispose(): void {\n    this.views.forEach(dispose);\n    this.views = (void 0)!;\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    const { views } = this;\n\n    if (views !== void 0) {\n      for (let i = 0, ii = views.length; i < ii; ++i) {\n        if (views[i].accept(visitor) === true) {\n          return true;\n        }\n      }\n    }\n  }\n}\n\nlet maxLen = 16;\nlet prevIndices = new Int32Array(maxLen);\nlet tailIndices = new Int32Array(maxLen);\n\n// Based on inferno's lis_algorithm @ https://github.com/infernojs/inferno/blob/master/packages/inferno/src/DOM/patching.ts#L732\n// with some tweaks to make it just a bit faster + account for IndexMap (and some names changes for readability)\n/** @internal */\nexport function longestIncreasingSubsequence(indexMap: IndexMap): Int32Array {\n  const len = indexMap.length;\n\n  if (len > maxLen) {\n    maxLen = len;\n    prevIndices = new Int32Array(len);\n    tailIndices = new Int32Array(len);\n  }\n\n  let cursor = 0;\n  let cur = 0;\n  let prev = 0;\n  let i = 0;\n  let j = 0;\n  let low = 0;\n  let high = 0;\n  let mid = 0;\n\n  for (; i < len; i++) {\n    cur = indexMap[i];\n    if (cur !== -2) {\n      j = prevIndices[cursor];\n\n      prev = indexMap[j];\n      if (prev !== -2 && prev < cur) {\n        tailIndices[i] = j;\n        prevIndices[++cursor] = i;\n        continue;\n      }\n\n      low = 0;\n      high = cursor;\n\n      while (low < high) {\n        mid = (low + high) >> 1;\n        prev = indexMap[prevIndices[mid]];\n        if (prev !== -2 && prev < cur) {\n          low = mid + 1;\n        } else {\n          high = mid;\n        }\n      }\n\n      prev = indexMap[prevIndices[low]];\n      if (cur < prev || prev === -2) {\n        if (low > 0) {\n          tailIndices[i] = prevIndices[low - 1];\n        }\n        prevIndices[low] = i;\n      }\n    }\n  }\n  i = ++cursor;\n  const result = new Int32Array(i);\n  cur = prevIndices[cursor - 1];\n\n  while (cursor-- > 0) {\n    result[cursor] = cur;\n    cur = tailIndices[cur];\n  }\n  while (i-- > 0) prevIndices[i] = 0;\n  return result;\n}\n\ninterface IRepeatOverrideContext extends IOverrideContext {\n  $index: number;\n  $odd: boolean;\n  $even: boolean;\n  $first: boolean;\n  $middle: boolean;\n  $last: boolean;\n  $length: number; // new in v2, there are a few requests, not sure if it should stay\n}\n\nfunction setContextualProperties(oc: IRepeatOverrideContext, index: number, length: number): void {\n  const isFirst = index === 0;\n  const isLast = index === length - 1;\n  const isEven = index % 2 === 0;\n  oc.$index = index;\n  oc.$first = isFirst;\n  oc.$last = isLast;\n  oc.$middle = !isFirst && !isLast;\n  oc.$even = isEven;\n  oc.$odd = !isEven;\n  oc.$length = length;\n}\n","import { nextId } from '@aurelia/kernel';\nimport { LifecycleFlags, Scope } from '@aurelia/runtime';\nimport { IRenderLocation } from '../../dom.js';\nimport { IViewFactory } from '../../templating/view.js';\nimport { templateController } from '../custom-attribute.js';\nimport { bindable } from '../../bindable.js';\nimport type { ISyntheticView, ICustomAttributeController, ICustomAttributeViewModel, IHydratedController, IHydratedParentController, ControllerVisitor } from '../../templating/controller.js';\n\n@templateController('with')\nexport class With implements ICustomAttributeViewModel {\n  public readonly id: number = nextId('au$component');\n\n  public view: ISyntheticView;\n\n  public readonly $controller!: ICustomAttributeController<this>; // This is set by the controller after this instance is constructed\n\n  @bindable public value?: object;\n\n  public constructor(\n    @IViewFactory private readonly factory: IViewFactory,\n    @IRenderLocation private readonly location: IRenderLocation\n  ) {\n    this.id = nextId('au$component');\n\n    this.view = this.factory.create().setLocation(location);\n  }\n\n  public valueChanged(\n    newValue: unknown,\n    oldValue: unknown,\n    flags: LifecycleFlags,\n  ): void {\n    const $controller = this.$controller;\n    const bindings = this.view.bindings;\n    let scope: Scope;\n    let i = 0, ii = 0;\n    if ($controller.isActive && bindings != null) {\n      scope = Scope.fromParent($controller.scope, newValue === void 0 ? {} : newValue as object);\n      for (ii = bindings.length; ii > i; ++i) {\n        bindings[i].$bind(LifecycleFlags.fromBind, scope, $controller.hostScope);\n      }\n    }\n  }\n\n  public attaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    const { $controller, value } = this;\n    const scope = Scope.fromParent($controller.scope, value === void 0 ? {} : value);\n    return this.view.activate(initiator, $controller, flags, scope, $controller.hostScope);\n  }\n\n  public detaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    return this.view.deactivate(initiator, this.$controller, flags);\n  }\n\n  public dispose(): void {\n    this.view.dispose();\n    this.view = (void 0)!;\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    if (this.view?.accept(visitor) === true) {\n      return true;\n    }\n  }\n}\n","import {\n  ILogger,\n  LogLevel,\n  nextId,\n  onResolve,\n  resolveAll,\n  Writable,\n} from '@aurelia/kernel';\nimport {\n  LifecycleFlags,\n  BindingMode,\n  ICollectionObserver,\n  CollectionKind,\n  IObserverLocator,\n  IndexMap,\n  Scope,\n} from '@aurelia/runtime';\nimport { IRenderLocation } from '../../dom.js';\nimport { templateController } from '../custom-attribute.js';\nimport { IViewFactory } from '../../templating/view.js';\nimport { bindable } from '../../bindable.js';\n\nimport type { Controller, ICustomAttributeController, ICustomAttributeViewModel, IHydratedController, IHydratedParentController, IHydratableController, ISyntheticView, ControllerVisitor } from '../../templating/controller.js';\nimport type { ICompiledRenderContext } from '../../templating/render-context.js';\nimport type { INode } from '../../dom.js';\nimport type { Instruction } from '../../renderer.js';\n\n@templateController('switch')\nexport class Switch implements ICustomAttributeViewModel {\n  public readonly id: number = nextId('au$component');\n  public readonly $controller!: ICustomAttributeController<this>; // This is set by the controller after this instance is constructed\n  private view!: ISyntheticView;\n\n  @bindable public value: unknown;\n\n  /** @internal */\n  public readonly cases: Case[] = [];\n  /** @internal */\n  public defaultCase?: Case;\n  private activeCases: Case[] = [];\n  /**\n   * This is kept around here so that changes can be awaited from the tests.\n   * This needs to be removed after the scheduler is ready to handle/queue the floating promises.\n   */\n  public readonly promise: Promise<void> | void = void 0;\n\n  public constructor(\n    @IViewFactory private readonly factory: IViewFactory,\n    @IRenderLocation private readonly location: IRenderLocation,\n  ) { }\n\n  public link(\n    flags: LifecycleFlags,\n    _parentContext: ICompiledRenderContext,\n    _controller: IHydratableController,\n    _childController: ICustomAttributeController,\n    _target: INode,\n    _instruction: Instruction,\n  ): void {\n    this.view = this.factory.create(flags, this.$controller).setLocation(this.location);\n  }\n\n  public attaching(initiator: IHydratedController, parent: IHydratedParentController, flags: LifecycleFlags): void | Promise<void> {\n    const view = this.view;\n    const $controller = this.$controller;\n\n    this.queue(() => view.activate(initiator, $controller, flags, $controller.scope, $controller.hostScope));\n    this.queue(() => this.swap(initiator, flags, this.value));\n    return this.promise;\n  }\n\n  public detaching(initiator: IHydratedController, parent: IHydratedParentController, flags: LifecycleFlags): void | Promise<void> {\n    this.queue(() => {\n      const view = this.view;\n      return view.deactivate(initiator, this.$controller, flags);\n    });\n    return this.promise;\n  }\n\n  public dispose(): void {\n    this.view?.dispose();\n    this.view = (void 0)!;\n  }\n\n  public valueChanged(_newValue: boolean, _oldValue: boolean, flags: LifecycleFlags): void {\n    if (!this.$controller.isActive) { return; }\n    this.queue(() => this.swap(null, flags, this.value));\n  }\n\n  public caseChanged($case: Case, flags: LifecycleFlags): void {\n    this.queue(() => this.handleCaseChange($case, flags));\n  }\n\n  private handleCaseChange($case: Case, flags: LifecycleFlags): void | Promise<void> {\n    const isMatch = $case.isMatch(this.value, flags);\n    const activeCases = this.activeCases;\n    const numActiveCases = activeCases.length;\n\n    // Early termination #1\n    if (!isMatch) {\n      /** The previous match started with this; thus clear. */\n      if (numActiveCases > 0 && activeCases[0].id === $case.id) {\n        return this.clearActiveCases(null, flags);\n      }\n      /**\n       * There are 2 different scenarios here:\n       * 1. $case in activeCases: Indicates by-product of fallthrough. The starting case still satisfies. Return.\n       * 2. $case not in activeCases: It was previously not active, and currently also not a match. Return.\n       */\n      return;\n    }\n\n    // Early termination #2\n    if (numActiveCases > 0 && activeCases[0].id < $case.id) {\n      // Even if this case now a match, the previous case still wins by as that has lower ordinal.\n      return;\n    }\n\n    // compute the new active cases\n    const newActiveCases: Case[] = [];\n    let fallThrough = $case.fallThrough;\n    if (!fallThrough) {\n      newActiveCases.push($case);\n    } else {\n      const cases = this.cases;\n      const idx = cases.indexOf($case);\n      for (let i = idx, ii = cases.length; i < ii && fallThrough; i++) {\n        const c = cases[i];\n        newActiveCases.push(c);\n        fallThrough = c.fallThrough;\n      }\n    }\n\n    return onResolve(\n      this.clearActiveCases(null, flags, newActiveCases),\n      () => {\n        this.activeCases = newActiveCases;\n        return this.activateCases(null, flags);\n      }\n    );\n  }\n\n  private swap(initiator: IHydratedController | null, flags: LifecycleFlags, value: unknown): void | Promise<void> {\n    const newActiveCases: Case[] = [];\n\n    let fallThrough: boolean = false;\n    for (const $case of this.cases) {\n      if (fallThrough || $case.isMatch(value, flags)) {\n        newActiveCases.push($case);\n        fallThrough = $case.fallThrough;\n      }\n      if (newActiveCases.length > 0 && !fallThrough) { break; }\n    }\n    const defaultCase = this.defaultCase;\n    if (newActiveCases.length === 0 && defaultCase !== void 0) {\n      newActiveCases.push(defaultCase);\n    }\n\n    return onResolve(\n      this.activeCases.length > 0\n        ? this.clearActiveCases(initiator, flags, newActiveCases)\n        : void 0!,\n      () => {\n        this.activeCases = newActiveCases;\n        if (newActiveCases.length === 0) { return; }\n        return this.activateCases(initiator, flags);\n      }\n    );\n  }\n\n  private activateCases(initiator: IHydratedController | null, flags: LifecycleFlags): void | Promise<void> {\n    const controller = this.$controller;\n    if (!controller.isActive) { return; }\n\n    const cases = this.activeCases;\n    const length = cases.length;\n    if (length === 0) { return; }\n\n    const scope = controller.scope;\n    const hostScope = controller.hostScope;\n\n    // most common case\n    if (length === 1) {\n      return cases[0].activate(initiator, flags, scope, hostScope);\n    }\n\n    return resolveAll(...cases.map(($case) => $case.activate(initiator, flags, scope, hostScope)));\n  }\n\n  private clearActiveCases(initiator: IHydratedController | null, flags: LifecycleFlags, newActiveCases: Case[] = []): void | Promise<void> {\n    const cases = this.activeCases;\n    const numCases = cases.length;\n\n    if (numCases === 0) { return; }\n\n    if (numCases === 1) {\n      const firstCase = cases[0];\n      if (!newActiveCases.includes(firstCase)) {\n        cases.length = 0;\n        return firstCase.deactivate(initiator, flags);\n      }\n      return;\n    }\n\n    return onResolve(\n      resolveAll(...cases.reduce((acc: (void | Promise<void>)[], $case) => {\n        if (!newActiveCases.includes($case)) {\n          acc.push($case.deactivate(initiator, flags));\n        }\n        return acc;\n      }, [])),\n      () => {\n        cases.length = 0;\n      }\n    );\n  }\n\n  private queue(action: () => void | Promise<void>): void {\n    const previousPromise = this.promise;\n    let promise: void | Promise<void> = void 0;\n    promise = (this as Writable<Switch>).promise = onResolve(\n      onResolve(previousPromise, action),\n      () => {\n        if (this.promise === promise) {\n          (this as Writable<Switch>).promise = void 0;\n        }\n      }\n    );\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    if (this.$controller.accept(visitor) === true) {\n      return true;\n    }\n    if (this.activeCases.some(x => x.accept(visitor))) {\n      return true;\n    }\n  }\n}\n\n@templateController('case')\nexport class Case implements ICustomAttributeViewModel {\n  public readonly id: number = nextId('au$component');\n  public readonly $controller!: ICustomAttributeController<this>; // This is set by the controller after this instance is constructed\n\n  @bindable public value: unknown;\n  @bindable({\n    set: v => {\n      switch (v) {\n        case 'true': return true;\n        case 'false': return false;\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        default: return !!v;\n      }\n    },\n    mode: BindingMode.oneTime\n  })\n  public fallThrough: boolean = false;\n\n  public view: ISyntheticView;\n  private $switch!: Switch;\n  private readonly debug: boolean;\n  private readonly logger: ILogger;\n  private observer: ICollectionObserver<CollectionKind.array> | undefined;\n\n  public constructor(\n    @IViewFactory private readonly factory: IViewFactory,\n    @IObserverLocator private readonly locator: IObserverLocator,\n    @IRenderLocation location: IRenderLocation,\n    @ILogger logger: ILogger,\n  ) {\n    this.debug = logger.config.level <= LogLevel.debug;\n    this.logger = logger.scopeTo(`${this.constructor.name}-#${this.id}`);\n    this.view = this.factory.create().setLocation(location);\n  }\n\n  public link(\n    flags: LifecycleFlags,\n    parentContext: ICompiledRenderContext,\n    controller: IHydratableController,\n    _childController: ICustomAttributeController,\n    _target: INode,\n    _instruction: Instruction,\n  ): void {\n    const switchController: IHydratedParentController = (controller as Controller).parent! as IHydratedParentController;\n    const $switch = switchController?.viewModel;\n    if ($switch instanceof Switch) {\n      this.$switch = $switch;\n      this.linkToSwitch($switch);\n    } else {\n      throw new Error('The parent switch not found; only `*[switch] > *[case|default-case]` relation is supported.');\n    }\n  }\n\n  public detaching(initiator: IHydratedController, parent: IHydratedParentController, flags: LifecycleFlags): void | Promise<void> {\n    return this.deactivate(initiator, flags);\n  }\n\n  public isMatch(value: unknown, flags: LifecycleFlags): boolean {\n    if (this.debug) {\n      this.logger.debug('isMatch()');\n    }\n    const $value = this.value;\n    if (Array.isArray($value)) {\n      if (this.observer === void 0) {\n        this.observer = this.observeCollection(flags, $value);\n      }\n      return $value.includes(value);\n    }\n    return $value === value;\n  }\n\n  public valueChanged(newValue: unknown, _oldValue: unknown, flags: LifecycleFlags): void {\n    if (Array.isArray(newValue)) {\n      this.observer?.unsubscribe(this);\n      this.observer = this.observeCollection(flags, newValue);\n    } else if (this.observer !== void 0) {\n      this.observer.unsubscribe(this);\n    }\n    this.$switch.caseChanged(this, flags);\n  }\n\n  public handleCollectionChange(_indexMap: IndexMap, flags: LifecycleFlags): void {\n    this.$switch.caseChanged(this, flags);\n  }\n\n  public activate(initiator: IHydratedController | null, flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void | Promise<void> {\n    const view = this.view;\n    if (view.isActive) { return; }\n    return view.activate(initiator ?? view, this.$controller, flags, scope, hostScope);\n  }\n\n  public deactivate(initiator: IHydratedController | null, flags: LifecycleFlags): void | Promise<void> {\n    const view = this.view;\n    if (!view.isActive) { return; }\n    return view.deactivate(initiator ?? view, this.$controller, flags);\n  }\n\n  public dispose(): void {\n    this.observer?.unsubscribe(this);\n    this.view?.dispose();\n    this.view = (void 0)!;\n  }\n\n  protected linkToSwitch(auSwitch: Switch): void {\n    auSwitch.cases.push(this);\n  }\n\n  private observeCollection(flags: LifecycleFlags, $value: unknown[]) {\n    const observer = this.locator.getArrayObserver($value);\n    observer.subscribe(this);\n    return observer;\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    if (this.$controller.accept(visitor) === true) {\n      return true;\n    }\n    return this.view?.accept(visitor);\n  }\n}\n\n@templateController('default-case')\nexport class DefaultCase extends Case {\n\n  protected linkToSwitch($switch: Switch): void {\n    if ($switch.defaultCase !== void 0) {\n      throw new Error('Multiple \\'default-case\\'s are not allowed.');\n    }\n    $switch.defaultCase = this;\n  }\n}\n","import { ILogger, nextId, onResolve, resolveAll, Task, TaskStatus } from '@aurelia/kernel';\nimport { BindingMode, LifecycleFlags, Scope } from '@aurelia/runtime';\nimport { bindable } from '../../bindable.js';\nimport { INode, IRenderLocation } from '../../dom.js';\nimport { IPlatform } from '../../platform.js';\nimport { Instruction } from '../../renderer.js';\nimport {\n  Controller,\n  ICustomAttributeController,\n  ICustomAttributeViewModel,\n  IHydratableController,\n  IHydratedController,\n  IHydratedParentController,\n  ISyntheticView\n} from '../../templating/controller.js';\nimport { ICompiledRenderContext } from '../../templating/render-context.js';\nimport { IViewFactory } from '../../templating/view.js';\nimport { templateController } from '../custom-attribute.js';\n\n@templateController('promise')\nexport class PromiseTemplateController implements ICustomAttributeViewModel {\n  public readonly id: number = nextId('au$component');\n  public readonly $controller!: ICustomAttributeController<this>; // This is set by the controller after this instance is constructed\n  private view!: ISyntheticView;\n\n  @bindable public value!: Promise<unknown>;\n\n  public pending?: PendingTemplateController;\n  public fulfilled?: FulfilledTemplateController;\n  public rejected?: RejectedTemplateController;\n\n  private viewScope!: Scope;\n  private preSettledTask: Task<void | Promise<void>> | null = null;\n  private postSettledTask: Task<void | Promise<void>> | null = null;\n  private postSettlePromise!: Promise<void>;\n\n  private readonly logger: ILogger;\n\n  public constructor(\n    @IViewFactory private readonly factory: IViewFactory,\n    @IRenderLocation private readonly location: IRenderLocation,\n    @IPlatform private readonly platform: IPlatform,\n    @ILogger logger: ILogger,\n  ) {\n    this.logger = logger.scopeTo('promise.resolve');\n  }\n\n  public link(\n    flags: LifecycleFlags,\n    _parentContext: ICompiledRenderContext,\n    _controller: IHydratableController,\n    _childController: ICustomAttributeController,\n    _target: INode,\n    _instruction: Instruction,\n  ): void {\n    this.view = this.factory.create(flags, this.$controller).setLocation(this.location);\n  }\n\n  public attaching(initiator: IHydratedController, parent: IHydratedParentController, flags: LifecycleFlags): void | Promise<void> {\n    const view = this.view;\n    const $controller = this.$controller;\n\n    return onResolve(\n      view.activate(initiator, $controller, flags, this.viewScope = Scope.fromParent($controller.scope, {}), $controller.hostScope),\n      () => this.swap(initiator, flags)\n    );\n  }\n\n  public valueChanged(_newValue: boolean, _oldValue: boolean, flags: LifecycleFlags): void {\n    if (!this.$controller.isActive) { return; }\n    this.swap(null, flags);\n  }\n\n  private swap(initiator: IHydratedController | null, flags: LifecycleFlags): void {\n    const value = this.value;\n    if (!(value instanceof Promise)) {\n      this.logger.warn(`The value '${String(value)}' is not a promise. No change will be done.`);\n      return;\n    }\n    const q = this.platform.domWriteQueue;\n    const fulfilled = this.fulfilled;\n    const rejected = this.rejected;\n    const pending = this.pending;\n    const $controller = this.$controller;\n    const s = this.viewScope;\n    const hs = $controller.hostScope;\n\n    let preSettlePromise: Promise<void>;\n    const defaultQueuingOptions = { reusable: false };\n    const $swap = () => {\n      // Note that the whole thing is not wrapped in a q.queueTask intentionally.\n      // Because that would block the app till the actual promise is resolved, which is not the goal anyway.\n      void resolveAll(\n        // At first deactivate the fulfilled and rejected views, as well as activate the pending view.\n        // The order of these 3 should not necessarily be sequential (i.e. order-irrelevant).\n        preSettlePromise = (this.preSettledTask = q.queueTask(() => {\n          return resolveAll(\n            fulfilled?.deactivate(initiator, flags),\n            rejected?.deactivate(initiator, flags),\n            pending?.activate(initiator, flags, s, hs)\n          );\n        }, defaultQueuingOptions)).result,\n        value\n          .then(\n            (data) => {\n              if (this.value !== value) {\n                return;\n              }\n              const fulfill = () => {\n                // Deactivation of pending view and the activation of the fulfilled view should not necessarily be sequential.\n                this.postSettlePromise = (this.postSettledTask = q.queueTask(() => resolveAll(\n                  pending?.deactivate(initiator, flags),\n                  rejected?.deactivate(initiator, flags),\n                  fulfilled?.activate(initiator, flags, s, hs, data),\n                ), defaultQueuingOptions)).result;\n              };\n              if (this.preSettledTask!.status === TaskStatus.running) {\n                void preSettlePromise.then(fulfill);\n              } else {\n                this.preSettledTask!.cancel();\n                fulfill();\n              }\n            },\n            (err) => {\n              if (this.value !== value) {\n                return;\n              }\n              const reject = () => {\n                // Deactivation of pending view and the activation of the rejected view should also not necessarily be sequential.\n                this.postSettlePromise = (this.postSettledTask = q.queueTask(() => resolveAll(\n                  pending?.deactivate(initiator, flags),\n                  fulfilled?.deactivate(initiator, flags),\n                  rejected?.activate(initiator, flags, s, hs, err),\n                ), defaultQueuingOptions)).result;\n              };\n              if (this.preSettledTask!.status === TaskStatus.running) {\n                void preSettlePromise.then(reject);\n              } else {\n                this.preSettledTask!.cancel();\n                reject();\n              }\n            },\n          ));\n    };\n\n    if (this.postSettledTask?.status === TaskStatus.running) {\n      void this.postSettlePromise.then($swap);\n    } else {\n      this.postSettledTask?.cancel();\n      $swap();\n    }\n  }\n\n  public detaching(initiator: IHydratedController, parent: IHydratedParentController, flags: LifecycleFlags): void | Promise<void> {\n    this.preSettledTask?.cancel();\n    this.postSettledTask?.cancel();\n    this.preSettledTask = this.postSettledTask = null;\n    return this.view.deactivate(initiator, this.$controller, flags);\n  }\n\n  public dispose(): void {\n    this.view?.dispose();\n    this.view = (void 0)!;\n  }\n}\n\n@templateController('pending')\nexport class PendingTemplateController implements ICustomAttributeViewModel {\n  public readonly id: number = nextId('au$component');\n  public readonly $controller!: ICustomAttributeController<this>; // This is set by the controller after this instance is constructed\n\n  @bindable({ mode: BindingMode.toView }) public value!: Promise<unknown>;\n\n  public view: ISyntheticView;\n\n  public constructor(\n    @IViewFactory private readonly factory: IViewFactory,\n    @IRenderLocation location: IRenderLocation,\n  ) {\n    this.view = this.factory.create().setLocation(location);\n  }\n\n  public link(\n    flags: LifecycleFlags,\n    parentContext: ICompiledRenderContext,\n    controller: IHydratableController,\n    _childController: ICustomAttributeController,\n    _target: INode,\n    _instruction: Instruction,\n  ): void {\n    getPromiseController(controller).pending = this;\n  }\n\n  public activate(initiator: IHydratedController | null, flags: LifecycleFlags, scope: Scope, hostScope: Scope | null): void | Promise<void> {\n    const view = this.view;\n    if (view.isActive) { return; }\n    return view.activate(view, this.$controller, flags, scope, hostScope);\n  }\n\n  public deactivate(initiator: IHydratedController | null, flags: LifecycleFlags): void | Promise<void> {\n    const view = this.view;\n    if (!view.isActive) { return; }\n    return view.deactivate(view, this.$controller, flags);\n  }\n\n  public detaching(initiator: IHydratedController, parent: IHydratedParentController, flags: LifecycleFlags): void | Promise<void> {\n    return this.deactivate(initiator, flags);\n  }\n\n  public dispose(): void {\n    this.view?.dispose();\n    this.view = (void 0)!;\n  }\n}\n\n@templateController('then')\nexport class FulfilledTemplateController implements ICustomAttributeViewModel {\n  public readonly id: number = nextId('au$component');\n  public readonly $controller!: ICustomAttributeController<this>; // This is set by the controller after this instance is constructed\n\n  @bindable({ mode: BindingMode.toView }) public value!: unknown;\n\n  public view: ISyntheticView;\n\n  public constructor(\n    @IViewFactory private readonly factory: IViewFactory,\n    @IRenderLocation location: IRenderLocation,\n  ) {\n    this.view = this.factory.create().setLocation(location);\n  }\n\n  public link(\n    flags: LifecycleFlags,\n    parentContext: ICompiledRenderContext,\n    controller: IHydratableController,\n    _childController: ICustomAttributeController,\n    _target: INode,\n    _instruction: Instruction,\n  ): void {\n    getPromiseController(controller).fulfilled = this;\n  }\n\n  public activate(initiator: IHydratedController | null, flags: LifecycleFlags, scope: Scope, hostScope: Scope | null, resolvedValue: unknown): void | Promise<void> {\n    this.value = resolvedValue;\n    const view = this.view;\n    if (view.isActive) { return; }\n    return view.activate(view, this.$controller, flags, scope, hostScope);\n  }\n\n  public deactivate(initiator: IHydratedController | null, flags: LifecycleFlags): void | Promise<void> {\n    const view = this.view;\n    if (!view.isActive) { return; }\n    return view.deactivate(view, this.$controller, flags);\n  }\n\n  public detaching(initiator: IHydratedController, parent: IHydratedParentController, flags: LifecycleFlags): void | Promise<void> {\n    return this.deactivate(initiator, flags);\n  }\n\n  public dispose(): void {\n    this.view?.dispose();\n    this.view = (void 0)!;\n  }\n}\n\n@templateController('catch')\nexport class RejectedTemplateController implements ICustomAttributeViewModel {\n  public readonly id: number = nextId('au$component');\n  public readonly $controller!: ICustomAttributeController<this>; // This is set by the controller after this instance is constructed\n\n  @bindable({ mode: BindingMode.toView }) public value!: unknown;\n\n  public view: ISyntheticView;\n\n  public constructor(\n    @IViewFactory private readonly factory: IViewFactory,\n    @IRenderLocation location: IRenderLocation,\n  ) {\n    this.view = this.factory.create().setLocation(location);\n  }\n\n  public link(\n    flags: LifecycleFlags,\n    parentContext: ICompiledRenderContext,\n    controller: IHydratableController,\n    _childController: ICustomAttributeController,\n    _target: INode,\n    _instruction: Instruction,\n  ): void {\n    getPromiseController(controller).rejected = this;\n  }\n\n  public activate(initiator: IHydratedController | null, flags: LifecycleFlags, scope: Scope, hostScope: Scope | null, error: unknown): void | Promise<void> {\n    this.value = error;\n    const view = this.view;\n    if (view.isActive) { return; }\n    return view.activate(view, this.$controller, flags, scope, hostScope);\n  }\n\n  public deactivate(initiator: IHydratedController | null, flags: LifecycleFlags): void | Promise<void> {\n    const view = this.view;\n    if (!view.isActive) { return; }\n    return view.deactivate(view, this.$controller, flags);\n  }\n\n  public detaching(initiator: IHydratedController, parent: IHydratedParentController, flags: LifecycleFlags): void | Promise<void> {\n    return this.deactivate(initiator, flags);\n  }\n\n  public dispose(): void {\n    this.view?.dispose();\n    this.view = (void 0)!;\n  }\n}\n\nfunction getPromiseController(controller: IHydratableController) {\n  const promiseController: IHydratedParentController = (controller as Controller).parent! as IHydratedParentController;\n  const $promise = promiseController?.viewModel;\n  if ($promise instanceof PromiseTemplateController) {\n    return $promise;\n  }\n  throw new Error('The parent promise.resolve not found; only `*[promise.resolve] > *[pending|then|catch]` relation is supported.');\n}\n\n// TODO: activate after the attribute parser and/or interpreter such that for `t`, `then` is not picked up.\n// @attributePattern({ pattern: 'promise.resolve', symbols: '' })\n// export class PromiseAttributePattern {\n//   public 'promise.resolve'(name: string, value: string, _parts: string[]): AttrSyntax {\n//     return new AttrSyntax(name, value, 'promise', 'bind');\n//   }\n// }\n\n// @attributePattern({ pattern: 'then', symbols: '' })\n// export class FulfilledAttributePattern {\n//   public 'then'(name: string, value: string, _parts: string[]): AttrSyntax {\n//     return new AttrSyntax(name, value, 'then', 'from-view');\n//   }\n// }\n\n// @attributePattern({ pattern: 'catch', symbols: '' })\n// export class RejectedAttributePattern {\n//   public 'catch'(name: string, value: string, _parts: string[]): AttrSyntax {\n//     return new AttrSyntax(name, value, 'catch', 'from-view');\n//   }\n// }\n","import { Constructable, IContainer, IRegistry, Key } from '@aurelia/kernel';\nimport {\n  HydrateElementInstruction,\n  isInstruction,\n  SetAttributeInstruction,\n  IInstruction,\n  Instruction,\n  SetPropertyInstruction,\n} from './renderer.js';\nimport { IPlatform } from './platform.js';\nimport { CustomElement, CustomElementDefinition, CustomElementType } from './resources/custom-element.js';\nimport { getRenderContext, IRenderContext } from './templating/render-context.js';\nimport { IViewFactory } from './templating/view.js';\nimport type { ISyntheticView } from './templating/controller.js';\n\nexport function createElement<C extends Constructable = Constructable>(\n  p: IPlatform,\n  tagOrType: string | C,\n  props?: Record<string, string | IInstruction>,\n  children?: ArrayLike<unknown>\n): RenderPlan {\n  if (typeof tagOrType === 'string') {\n    return createElementForTag(p, tagOrType, props, children);\n  } else if (CustomElement.isType(tagOrType)) {\n    return createElementForType(p, tagOrType, props, children);\n  } else {\n    throw new Error(`Invalid tagOrType.`);\n  }\n}\n\n/**\n * RenderPlan. Todo: describe goal of this class\n */\nexport class RenderPlan {\n  private lazyDefinition?: CustomElementDefinition = void 0;\n  private readonly childFor: WeakMap<IContainer, IContainer> = new WeakMap();\n\n  public constructor(\n    private readonly node: Node,\n    private readonly instructions: IInstruction[][],\n    private readonly dependencies: Key[]\n  ) {}\n\n  public get definition(): CustomElementDefinition {\n    if (this.lazyDefinition === void 0) {\n      this.lazyDefinition = CustomElementDefinition.create({\n        name: CustomElement.generateName(),\n        template: this.node,\n        needsCompile: typeof this.node === 'string',\n        instructions: this.instructions,\n        dependencies: this.dependencies,\n      });\n    }\n    return this.lazyDefinition;\n  }\n\n  public getContext(container: IContainer): IRenderContext {\n    const childFor = this.childFor;\n    let childContainer: IContainer | undefined = childFor.get(container);\n    if (childContainer == null) {\n      childFor.set(container, (childContainer = container.createChild()).register(...this.dependencies));\n    }\n    return getRenderContext(this.definition, childContainer);\n  }\n\n  public createView(parentContainer: IContainer): ISyntheticView {\n    return this.getViewFactory(parentContainer).create();\n  }\n\n  public getViewFactory(parentContainer: IContainer): IViewFactory {\n    return this.getContext(parentContainer).getViewFactory();\n  }\n\n  /** @internal */\n  public mergeInto(parent: Node & ParentNode, instructions: IInstruction[][], dependencies: Key[]): void {\n    parent.appendChild(this.node);\n    instructions.push(...this.instructions);\n    dependencies.push(...this.dependencies);\n  }\n}\n\nfunction createElementForTag(p: IPlatform, tagName: string, props?: Record<string, string | IInstruction>, children?: ArrayLike<unknown>): RenderPlan {\n  const instructions: IInstruction[] = [];\n  const allInstructions: IInstruction[][] = [];\n  const dependencies: IRegistry[] = [];\n  const element = p.document.createElement(tagName);\n  let hasInstructions = false;\n\n  if (props) {\n    Object.keys(props)\n      .forEach(to => {\n        const value = props[to];\n\n        if (isInstruction(value)) {\n          hasInstructions = true;\n          instructions.push(value);\n        } else {\n          element.setAttribute(to, value);\n        }\n      });\n  }\n\n  if (hasInstructions) {\n    element.className = 'au';\n    allInstructions.push(instructions);\n  }\n\n  if (children) {\n    addChildren(p, element, children, allInstructions, dependencies);\n  }\n\n  return new RenderPlan(element, allInstructions, dependencies);\n}\n\nfunction createElementForType(\n  p: IPlatform,\n  Type: CustomElementType,\n  props?: Record<string, unknown>,\n  children?: ArrayLike<unknown>,\n): RenderPlan {\n  const definition = CustomElement.getDefinition(Type);\n  const instructions: IInstruction[] = [];\n  const allInstructions = [instructions];\n  const dependencies: Key[] = [];\n  const childInstructions: Instruction[] = [];\n  const bindables = definition.bindables;\n  const element = p.document.createElement(definition.name);\n  element.className = 'au';\n\n  if (!dependencies.includes(Type)) {\n    dependencies.push(Type);\n  }\n\n  instructions.push(new HydrateElementInstruction(definition, void 0, childInstructions, null, false));\n\n  if (props) {\n    Object.keys(props)\n      .forEach(to => {\n        const value = props[to] as Instruction | string;\n\n        if (isInstruction(value)) {\n          childInstructions.push(value);\n        } else {\n          if (bindables[to] === void 0) {\n            childInstructions.push(new SetAttributeInstruction(value, to));\n          } else {\n            childInstructions.push(new SetPropertyInstruction(value, to));\n          }\n        }\n      });\n  }\n\n  if (children) {\n    addChildren(p, element, children, allInstructions, dependencies);\n  }\n\n  return new RenderPlan(element, allInstructions, dependencies);\n}\n\nfunction addChildren<T extends HTMLElement>(\n  p: IPlatform,\n  parent: T,\n  children: ArrayLike<unknown>,\n  allInstructions: IInstruction[][],\n  dependencies: Key[],\n): void {\n  for (let i = 0, ii = children.length; i < ii; ++i) {\n    const current = children[i];\n\n    switch (typeof current) {\n      case 'string':\n        parent.appendChild(p.document.createTextNode(current));\n        break;\n      case 'object':\n        if (current instanceof p.Node) {\n          parent.appendChild(current);\n        } else if ('mergeInto' in (current as RenderPlan)) {\n          (current as RenderPlan).mergeInto(parent, allInstructions, dependencies);\n        }\n    }\n  }\n}\n","import { Constructable, nextId, onResolve } from '@aurelia/kernel';\nimport { BindingMode, LifecycleFlags } from '@aurelia/runtime';\nimport { createElement, RenderPlan } from '../../create-element.js';\nimport { HydrateElementInstruction, IInstruction, Instruction } from '../../renderer.js';\nimport { IPlatform } from '../../platform.js';\nimport { getRenderContext } from '../../templating/render-context.js';\nimport { IViewFactory } from '../../templating/view.js';\nimport { CustomElement, customElement, CustomElementDefinition } from '../custom-element.js';\nimport { bindable } from '../../bindable.js';\nimport { ControllerVisitor, ICustomElementController, ICustomElementViewModel, IHydratedController, IHydratedParentController, IHydrationContext, ISyntheticView } from '../../templating/controller.js';\n\nexport type Subject = string | IViewFactory | ISyntheticView | RenderPlan | Constructable | CustomElementDefinition;\nexport type MaybeSubjectPromise = Subject | Promise<Subject> | undefined;\n\nfunction toLookup(\n  acc: Record<string, IInstruction>,\n  item: IInstruction & { to?: string },\n): Record<string, IInstruction> {\n  const to = item.to;\n  if (to !== void 0 && to !== 'subject' && to !== 'composing') {\n    acc[to] = item as Instruction;\n  }\n\n  return acc;\n}\n\n@customElement({ name: 'au-render', template: null, containerless: true })\nexport class AuRender implements ICustomElementViewModel {\n  public readonly id: number = nextId('au$component');\n\n  @bindable public component?: MaybeSubjectPromise = void 0;\n  @bindable({ mode: BindingMode.fromView }) public composing: boolean = false;\n\n  public view?: ISyntheticView = void 0;\n\n  private readonly properties: Record<string, IInstruction>;\n\n  private lastSubject?: MaybeSubjectPromise = void 0;\n\n  public readonly $controller!: ICustomElementController<this>; // This is set by the controller after this instance is constructed\n\n  public constructor(\n    @IPlatform private readonly p: IPlatform,\n    @IInstruction instruction: HydrateElementInstruction,\n    @IHydrationContext private readonly hdrContext: IHydrationContext,\n  ) {\n    this.properties = instruction.instructions.reduce(toLookup, {});\n  }\n\n  public attaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController | null,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    const { component, view } = this;\n    if (view === void 0 || this.lastSubject !== component) {\n      this.lastSubject = component;\n      this.composing = true;\n\n      return this.compose(void 0, component, initiator, flags);\n    }\n\n    return this.compose(view, component, initiator, flags);\n  }\n\n  public detaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController | null,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    return this.deactivate(this.view, initiator, flags);\n  }\n\n  public componentChanged(\n    newValue: Subject | Promise<Subject>,\n    previousValue: Subject | Promise<Subject>,\n    flags: LifecycleFlags,\n  ): void {\n    const { $controller } = this;\n    if (!$controller.isActive) {\n      return;\n    }\n    if (this.lastSubject === newValue) {\n      return;\n    }\n\n    this.lastSubject = newValue;\n    this.composing = true;\n\n    flags |= $controller.flags;\n    const ret = onResolve(\n      this.deactivate(this.view, null, flags),\n      () => {\n        // TODO(fkleuver): handle & test race condition\n        return this.compose(void 0, newValue, null, flags);\n      },\n    );\n    if (ret instanceof Promise) { ret.catch(err => { throw err; }); }\n  }\n\n  private compose(\n    view: ISyntheticView | undefined | Promise<ISyntheticView | undefined>,\n    subject: MaybeSubjectPromise,\n    initiator: IHydratedController | null,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    return onResolve(\n      view === void 0\n        ? onResolve(subject, resolvedSubject => this.resolveView(resolvedSubject, flags))\n        : view,\n      resolvedView => this.activate(this.view = resolvedView, initiator, flags),\n    );\n  }\n\n  private deactivate(\n    view: ISyntheticView | undefined,\n    initiator: IHydratedController | null,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    return view?.deactivate(initiator ?? view, this.$controller, flags);\n  }\n\n  private activate(\n    view: ISyntheticView | undefined,\n    initiator: IHydratedController | null,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    const { $controller } = this;\n    return onResolve(\n      view?.activate(initiator ?? view, $controller, flags, $controller.scope, $controller.hostScope),\n      () => {\n        this.composing = false;\n      },\n    );\n  }\n\n  private resolveView(subject: Subject | undefined, flags: LifecycleFlags): ISyntheticView | undefined {\n    const view = this.provideViewFor(subject, flags);\n\n    if (view) {\n      view.setLocation(this.$controller.location!);\n      view.lockScope(this.$controller.scope);\n      return view;\n    }\n\n    return void 0;\n  }\n\n  private provideViewFor(comp: Subject | undefined, flags: LifecycleFlags): ISyntheticView | undefined {\n    if (!comp) {\n      return void 0;\n    }\n\n    const ctxContainer = this.hdrContext.controller.container;\n    if (typeof comp === 'object') {\n      if (isController(comp)) { // IController\n        return comp;\n      }\n\n      if ('createView' in comp) { // RenderPlan\n        return comp.createView(ctxContainer);\n      }\n\n      if ('create' in comp) { // IViewFactory\n        return comp.create(flags);\n      }\n\n      if ('template' in comp) { // Raw Template Definition\n        const definition = CustomElementDefinition.getOrCreate(comp);\n        return getRenderContext(definition, ctxContainer).getViewFactory().create(flags);\n      }\n    }\n\n    if (typeof comp === 'string') {\n      const def = ctxContainer.find(CustomElement, comp);\n      if (def == null) {\n        throw new Error(`Unable to find custom element ${comp} for <au-render>.`);\n      }\n      comp = def.Type;\n    }\n\n    // Constructable (Custom Element Constructor)\n    return createElement(\n      this.p,\n      comp,\n      this.properties,\n      this.$controller.host.childNodes,\n    ).createView(ctxContainer);\n  }\n\n  public dispose(): void {\n    this.view?.dispose();\n    this.view = (void 0)!;\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    if (this.view?.accept(visitor) === true) {\n      return true;\n    }\n  }\n}\n\nfunction isController(subject: Exclude<Subject, string>): subject is ISyntheticView {\n  return 'lockScope' in subject;\n}\n","import { Constructable, IContainer, InstanceProvider, ITask, onResolve, transient } from '@aurelia/kernel';\nimport { LifecycleFlags, Scope } from '@aurelia/runtime';\nimport { bindable } from '../../bindable.js';\nimport { convertToRenderLocation, INode, IRenderLocation, isRenderLocation } from '../../dom.js';\nimport { IPlatform } from '../../platform.js';\nimport { HydrateElementInstruction, IInstruction } from '../../renderer.js';\nimport { Controller, IController, ICustomElementController, IHydratedController, ISyntheticView } from '../../templating/controller.js';\nimport { getRenderContext } from '../../templating/render-context.js';\nimport { CustomElement, customElement, CustomElementDefinition } from '../custom-element.js';\n\n// plan:\n// 0. <au-component/> is containerless\n//    this probably won't work, since it prohibits the use of shadow dom + slot naturally\n//    this probably will still allows au-slot\n// 1. create host element corresponding to the composed component view model\n//    if there's no view model def, then creates a div\n//    if there's no view model at all, then creates a div\n//    this probably has issue related to containerless, since it's sometimes desirable\n\n/**\n * An optional interface describing the dialog activate convention.\n */\nexport interface IDynamicComponentActivate<T> {\n  /**\n   * Implement this hook if you want to perform custom logic just before the component is is composed.\n   * The returned value is not used.\n   */\n  activate?(model?: T): unknown | Promise<unknown>;\n}\n\ntype MaybePromise<T> = T | Promise<T>;\ntype ChangeSource = 'view' | 'viewModel' | 'model' | 'scopeBehavior';\n\n// Desired usage:\n// <au-component view.bind=\"Promise<string>\" view-model.bind=\"\" model.bind=\"\" />\n// <au-component view.bind=\"<string>\" model.bind=\"\" />\n//\n\n@customElement('au-compose')\nexport class AuCompose {\n\n  /** @internal */\n  protected static get inject() {\n    return [IContainer, IController, INode, IPlatform, IInstruction, transient(CompositionContextFactory)];\n  }\n\n  /* determine what template used to compose the component */\n  @bindable\n  public view?: string | Promise<string>;\n\n  /* determine the view model instance used to compose the component */\n  @bindable\n  public viewModel?: Constructable | object | Promise<Constructable | object>;\n\n  /* the model used to pass to activate lifecycle of the component */\n  @bindable\n  public model?: unknown;\n\n  @bindable({ set: v => {\n    if (v === 'scoped' || v === 'auto') {\n      return v;\n    }\n    throw new Error('Invalid scope behavior config. Only \"scoped\" or \"auto\" allowed.');\n  }})\n  public scopeBehavior: 'auto' | 'scoped' = 'auto';\n\n  /** @internal */\n  public readonly $controller!: ICustomElementController<AuCompose>;\n\n  /** @internal */\n  private task: ITask | null = null;\n\n  /** @internal */\n  private c: ICompositionController | undefined = void 0;\n  public get composition(): ICompositionController | undefined {\n    return this.c;\n  }\n\n  /** @internal */\n  private readonly loc: IRenderLocation | undefined;\n\n  public constructor(\n    private readonly container: IContainer,\n    private readonly parent: ISyntheticView | ICustomElementController,\n    private readonly host: HTMLElement,\n    private readonly p: IPlatform,\n    // todo: use this to retrieve au-slot instruction\n    //        for later enhancement related to <au-slot/> + compose\n    private readonly instruction: HydrateElementInstruction,\n    private readonly contextFactory: CompositionContextFactory,\n  ) {\n    this.loc = instruction.containerless ? convertToRenderLocation(this.host) : void 0;\n  }\n\n  public attaching(initiator: IHydratedController, parent: IHydratedController, flags: LifecycleFlags): void | Promise<void> {\n    return this.queue(new ChangeInfo(this.view, this.viewModel, this.model, initiator, void 0));\n  }\n\n  public detaching(initiator: IHydratedController): void | Promise<void> {\n    this.task?.cancel();\n    this.task = null;\n    const cmpstn = this.c;\n    if (cmpstn != null) {\n      this.c = void 0;\n      return cmpstn.deactivate(initiator);\n    }\n  }\n\n  /** @internal */\n  protected propertyChanged(name: ChangeSource): void {\n    const task = this.task;\n    this.task = this.p.domWriteQueue.queueTask(() => {\n      return onResolve(this.queue(new ChangeInfo(this.view!, this.viewModel, this.model, void 0, name)), () => {\n        this.task = null;\n      });\n    });\n    task?.cancel();\n  }\n\n  /** @internal */\n  private queue(change: ChangeInfo): void | Promise<void> {\n    const factory = this.contextFactory;\n    const currentComposition = this.c;\n    if (change.src === 'model' && currentComposition != null) {\n      return currentComposition.update(change.model);\n    }\n    // todo: handle consequitive changes that create multiple queues\n    return onResolve(\n      factory.create(change),\n      context => {\n        // Don't compose [stale] view/view model\n        // by always ensuring that the composition context is the latest one\n        if (factory.isCurrent(context)) {\n          return onResolve(this.compose(context), (result) => {\n            // Don't activate [stale] controller\n            // by always ensuring that the composition context is the latest one\n            if (factory.isCurrent(context)) {\n              return onResolve(result.activate(), () => {\n                // Don't conclude the [stale] composition\n                // by always ensuring that the composition context is the latest one\n                if (factory.isCurrent(context)) {\n                  // after activation, if the composition context is still the most recent one\n                  // then the job is done\n                  this.c = result;\n                  return currentComposition?.deactivate(change.initiator);\n                } else {\n                  // the stale controller should be deactivated\n                  return onResolve(\n                    result.controller.deactivate(result.controller, this.$controller, LifecycleFlags.fromUnbind),\n                    // todo: do we need to deactivate?\n                    () => result.controller.dispose()\n                  );\n                }\n              });\n            } else {\n              result.controller.dispose();\n            }\n          });\n        }\n      }\n    );\n  }\n\n  /** @internal */\n  private compose(context: CompositionContext): MaybePromise<ICompositionController> {\n    let comp: IDynamicComponentActivate<unknown>;\n    let compositionHost: HTMLElement | IRenderLocation;\n    let removeCompositionHost: () => void;\n    // todo: when both view model and view are empty\n    //       should it throw or try it best to proceed?\n    //       current: proceed\n    const { view, viewModel, model, initiator } = context.change;\n    const { container, host, $controller, contextFactory, loc } = this;\n    const srcDef = this.getDef(viewModel);\n    const childContainer: IContainer = container.createChild();\n    const parentNode = loc == null ? host.parentNode : loc.parentNode;\n\n    if (srcDef !== null) {\n      if (srcDef.containerless) {\n        throw new Error('Containerless custom element is not supported by <au-compose/>');\n      }\n      if (loc == null) {\n        compositionHost = host;\n        removeCompositionHost = () => {\n          // This is a normal composition, the content template is removed by deactivation process\n          // but the host remains\n        };\n      } else {\n        compositionHost = parentNode!.insertBefore(this.p.document.createElement(srcDef.name), loc);\n        removeCompositionHost = () => {\n          compositionHost.remove();\n        };\n      }\n      comp = this.getVm(childContainer, viewModel, compositionHost);\n    } else {\n      compositionHost = loc == null\n        ? host\n        : loc;\n      comp = this.getVm(childContainer, viewModel, compositionHost);\n    }\n    const compose: () => ICompositionController = () => {\n          // custom element based composition\n      if (srcDef !== null) {\n        const controller = Controller.forCustomElement(\n          null,\n          container,\n          childContainer,\n          comp,\n          compositionHost as HTMLElement,\n          null,\n          LifecycleFlags.none,\n          true,\n          srcDef,\n        );\n\n        return new CompositionController(\n          controller,\n          () => controller.activate(initiator ?? controller, $controller, LifecycleFlags.fromBind),\n          // todo: call deactivate on the component view model\n          (deactachInitiator) => onResolve(\n            controller.deactivate(deactachInitiator ?? controller, $controller, LifecycleFlags.fromUnbind),\n            removeCompositionHost\n          ),\n          // casting is technically incorrect\n          // but it's ignored in the caller anyway\n          (model) => comp.activate?.(model) as MaybePromise<void>,\n          context,\n        );\n      } else {\n        const targetDef = CustomElementDefinition.create({\n          name: CustomElement.generateName(),\n          template: view,\n        });\n        const renderContext = getRenderContext(targetDef, childContainer);\n        const viewFactory = renderContext.getViewFactory();\n        const controller = Controller.forSyntheticView(\n          contextFactory.isFirst(context) ? $controller.root : null,\n          renderContext,\n          viewFactory,\n          LifecycleFlags.fromBind,\n          $controller\n        );\n        const scope = this.scopeBehavior === 'auto'\n          ? Scope.fromParent(this.parent.scope, comp)\n          : Scope.create(comp);\n\n        if (isRenderLocation(compositionHost)) {\n          controller.setLocation(compositionHost);\n        } else {\n          controller.setHost(compositionHost);\n        }\n\n        return new CompositionController(\n          controller,\n          () => controller.activate(initiator ?? controller, $controller, LifecycleFlags.fromBind, scope, null),\n          // todo: call deactivate on the component view model\n          // a difference with composing custom element is that we leave render location/host alone\n          // as they all share the same host/render location\n          (detachInitiator) => controller.deactivate(detachInitiator ?? controller, $controller, LifecycleFlags.fromUnbind),\n          // casting is technically incorrect\n          // but it's ignored in the caller anyway\n          (model) => comp.activate?.(model) as MaybePromise<void>,\n          context,\n        );\n      }\n    };\n    if ('activate' in comp) {\n      // todo: try catch\n      // req:  ensure synchronosity of compositions that dont employ promise\n      return onResolve(comp.activate!(model), () => compose());\n    } else {\n      return compose();\n    }\n  }\n\n  /** @internal */\n  private getVm(container: IContainer, comp: Constructable | object | undefined, host: HTMLElement | IRenderLocation): IDynamicComponentActivate<unknown> {\n    if (comp == null) {\n      return new EmptyComponent();\n    }\n    if (typeof comp === 'object') {\n      return comp;\n    }\n\n    const p = this.p;\n    const isLocation = isRenderLocation(host);\n    const nodeProvider = new InstanceProvider('ElementResolver', isLocation ? null : host as HTMLElement);\n    container.registerResolver(INode, nodeProvider);\n    container.registerResolver(p.Node, nodeProvider);\n    container.registerResolver(p.Element, nodeProvider);\n    container.registerResolver(p.HTMLElement, nodeProvider);\n    container.registerResolver(\n      IRenderLocation,\n      new InstanceProvider('IRenderLocation', isLocation ? host as IRenderLocation : null)\n    );\n\n    const instance = container.invoke(comp);\n    container.registerResolver(comp, new InstanceProvider('au-compose.viewModel', instance));\n\n    return instance;\n  }\n\n  /** @internal */\n  private getDef(component?: object | Constructable) {\n    const Ctor = (typeof component === 'function'\n      ? component\n      : component?.constructor) as Constructable;\n    return CustomElement.isType(Ctor)\n      ? CustomElement.getDefinition(Ctor)\n      : null;\n  }\n}\n\nclass EmptyComponent { }\n\nexport interface ICompositionController {\n  readonly controller: IHydratedController;\n  readonly context: CompositionContext;\n  activate(): void | Promise<void>;\n  // deactivation is done differently, compared to activation\n  // when the `<au-component/>` is deactivated, initiator will be an ancestor controller\n  //\n  // while when the value of the @bindables changes, initiator should be\n  // the controller wrapped in this composition controller\n  deactivate(detachInitator?: IHydratedController): void | Promise<void>;\n  update(model: unknown): void | Promise<void>;\n}\n\nclass CompositionContextFactory {\n  private id = 0;\n\n  public isFirst(context: CompositionContext): boolean {\n    return context.id === 0;\n  }\n\n  public isCurrent(context: CompositionContext): boolean {\n    return context.id === this.id - 1;\n  }\n\n  public create(changes: ChangeInfo): MaybePromise<CompositionContext> {\n    return onResolve(changes.load(), (loaded) => new CompositionContext(this.id++, loaded));\n  }\n}\n\nclass ChangeInfo {\n  public constructor(\n    public readonly view: MaybePromise<string> | undefined,\n    public readonly viewModel: MaybePromise<Constructable | object> | undefined,\n    public readonly model: unknown | undefined,\n    public readonly initiator: IHydratedController | undefined,\n    public readonly src: ChangeSource | undefined,\n  ) { }\n\n  public load(): MaybePromise<LoadedChangeInfo> {\n    if (this.view instanceof Promise || this.viewModel instanceof Promise) {\n      return Promise\n        .all([this.view, this.viewModel])\n        .then(([view, viewModel]) => {\n          return new LoadedChangeInfo(view, viewModel, this.model, this.initiator, this.src);\n        });\n    } else {\n      return new LoadedChangeInfo(this.view, this.viewModel, this.model, this.initiator, this.src);\n    }\n  }\n}\n\nclass LoadedChangeInfo {\n  public constructor(\n    public readonly view: string | undefined,\n    public readonly viewModel: Constructable | object | undefined,\n    public readonly model: unknown | undefined,\n    public readonly initiator: IHydratedController | undefined,\n    public readonly src: ChangeSource | undefined,\n  ) { }\n}\n\nclass CompositionContext {\n  public constructor(\n    public readonly id: number,\n    public readonly change: LoadedChangeInfo,\n  ) { }\n}\n\nclass CompositionController implements ICompositionController {\n  private state: /* stopped */-1 | /* initial */0 | /* started */1 = 0;\n\n  public constructor(\n    public readonly controller: ISyntheticView | ICustomElementController,\n    private readonly start: () => void | Promise<void>,\n    private readonly stop: (detachInitator?: IHydratedController) => void | Promise<void>,\n    public readonly update: (model: unknown) => void | Promise<void>,\n    public readonly context: CompositionContext,\n  ) {\n\n  }\n\n  public activate() {\n    if (this.state !== 0) {\n      throw new Error(`Composition has already been activated/deactivated. Id: ${this.controller.id}`);\n    }\n    this.state = 1;\n    return this.start();\n  }\n\n  public deactivate(detachInitator?: IHydratedController) {\n    switch (this.state) {\n      case 1:\n        this.state = -1;\n        return this.stop(detachInitator);\n      case -1:\n        throw new Error('Composition has already been deactivated.');\n      default:\n        this.state = -1;\n    }\n  }\n}\n","import { IRenderLocation } from '../../dom.js';\nimport { customElement } from '../custom-element.js';\nimport { IInstruction } from '../../renderer.js';\nimport { IHydrationContext } from '../../templating/controller.js';\nimport { getRenderContext } from '../../templating/render-context.js';\n\nimport type { Writable } from '@aurelia/kernel';\nimport type { LifecycleFlags, Scope } from '@aurelia/runtime';\nimport type { ControllerVisitor, ICustomElementController, ICustomElementViewModel, IHydratedController, IHydratedParentController, ISyntheticView } from '../../templating/controller.js';\nimport type { IViewFactory } from '../../templating/view.js';\nimport type { HydrateElementInstruction } from '../../renderer.js';\n\nexport class AuSlot implements ICustomElementViewModel {\n  /** @internal */\n  public static get inject() { return [IRenderLocation, IInstruction, IHydrationContext]; }\n\n  public readonly view: ISyntheticView;\n  public readonly $controller!: ICustomElementController<this>; // This is set by the controller after this instance is constructed\n\n  private hostScope: Scope | null = null;\n  private outerScope: Scope | null = null;\n  private readonly hasProjection: boolean = false;\n\n  public constructor(\n    location: IRenderLocation,\n    instruction: HydrateElementInstruction,\n    private readonly hdrContext: IHydrationContext,\n  ) {\n    let factory: IViewFactory;\n    const slotInfo = instruction.auSlot!;\n    const projection = hdrContext.instruction?.projections?.[slotInfo.name];\n    if (projection == null) {\n      factory = getRenderContext(slotInfo.fallback, hdrContext.controller.container).getViewFactory();\n    } else {\n      factory = getRenderContext(projection, hdrContext.parent!.controller.container).getViewFactory();\n      this.hasProjection = true;\n    }\n    this.view = factory.create().setLocation(location);\n  }\n\n  public binding(\n    _initiator: IHydratedController,\n    _parent: IHydratedParentController,\n    _flags: LifecycleFlags,\n  ): void | Promise<void> {\n    this.hostScope = this.$controller.scope.parentScope!;\n    this.outerScope = this.hasProjection\n      ? this.hdrContext.controller.scope.parentScope\n      : this.hostScope;\n  }\n\n  public attaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    return this.view.activate(initiator, this.$controller, flags, this.outerScope ?? this.hostScope!, this.hostScope);\n  }\n\n  public detaching(\n    initiator: IHydratedController,\n    parent: IHydratedParentController,\n    flags: LifecycleFlags,\n  ): void | Promise<void> {\n    return this.view.deactivate(initiator, this.$controller, flags);\n  }\n\n  public dispose(): void {\n    this.view.dispose();\n    (this as Writable<this>).view = (void 0)!;\n  }\n\n  public accept(visitor: ControllerVisitor): void | true {\n    if (this.view?.accept(visitor) === true) {\n      return true;\n    }\n  }\n}\n\ncustomElement({ name: 'au-slot', template: null, containerless: true })(AuSlot);\n","import { DI } from '@aurelia/kernel';\nimport { valueConverter } from '@aurelia/runtime';\n\nconst SCRIPT_REGEX = /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi;\n\nexport interface ISanitizer {\n  /**\n   * Sanitizes the provided input.\n   *\n   * @param input - The input to be sanitized.\n   */\n  sanitize(input: string): string;\n}\n\nexport const ISanitizer = DI.createInterface<ISanitizer>('ISanitizer', x => x.singleton(class {\n  public sanitize(input: string): string {\n    return input.replace(SCRIPT_REGEX, '');\n  }\n}));\n\n/**\n * Simple html sanitization converter to preserve whitelisted elements and attributes on a bound property containing html.\n */\nexport class SanitizeValueConverter {\n  public constructor(\n    @ISanitizer private readonly sanitizer: ISanitizer,\n  ) {}\n\n  /**\n   * Process the provided markup that flows to the view.\n   *\n   * @param untrustedMarkup - The untrusted markup to be sanitized.\n   */\n  public toView(untrustedMarkup: string): string|null {\n    if (untrustedMarkup == null) {\n      return null;\n    }\n\n    return this.sanitizer.sanitize(untrustedMarkup);\n  }\n}\n\nvalueConverter('sanitize')(SanitizeValueConverter);\n","import { ComposableObjectComponentType, IViewLocator, ViewSelector } from '../../templating/view.js';\nimport { valueConverter } from '@aurelia/runtime';\nimport type { ICustomElementViewModel } from '../../templating/controller.js';\n\nexport class ViewValueConverter {\n  public constructor(\n    @IViewLocator private readonly viewLocator: IViewLocator,\n  ) {}\n\n  public toView<T extends ICustomElementViewModel>(\n    object: T | null | undefined,\n    viewNameOrSelector?: string | ViewSelector\n  ): ComposableObjectComponentType<T> | null {\n    return this.viewLocator.getViewComponentForObject<T>(\n      object,\n      viewNameOrSelector\n    );\n  }\n}\n\nvalueConverter('view')(ViewValueConverter);\n","import { DI, IContainer, IRegistry } from '@aurelia/kernel';\nimport {\n  AtPrefixedTriggerAttributePattern,\n  ColonPrefixedBindAttributePattern,\n  DotSeparatedAttributePattern,\n  RefAttributePattern,\n} from './resources/attribute-pattern.js';\nimport {\n  CallBindingCommand,\n  DefaultBindingCommand,\n  ForBindingCommand,\n  FromViewBindingCommand,\n  OneTimeBindingCommand,\n  ToViewBindingCommand,\n  TwoWayBindingCommand,\n  AttrBindingCommand,\n  CaptureBindingCommand,\n  ClassBindingCommand,\n  DelegateBindingCommand,\n  RefBindingCommand,\n  StyleBindingCommand,\n  TriggerBindingCommand,\n} from './resources/binding-command.js';\nimport { TemplateCompiler } from './template-compiler.js';\nimport {\n  CallBindingRenderer,\n  CustomAttributeRenderer,\n  CustomElementRenderer,\n  InterpolationBindingRenderer,\n  IteratorBindingRenderer,\n  LetElementRenderer,\n  PropertyBindingRenderer,\n  RefBindingRenderer,\n  SetPropertyRenderer,\n  TemplateControllerRenderer,\n  AttributeBindingRenderer,\n  ListenerBindingRenderer,\n  SetAttributeRenderer,\n  StylePropertyBindingRenderer,\n  TextBindingRenderer,\n  SetClassAttributeRenderer,\n  SetStyleAttributeRenderer,\n} from './renderer.js';\nimport {\n  FromViewBindingBehavior,\n  OneTimeBindingBehavior,\n  ToViewBindingBehavior,\n  TwoWayBindingBehavior,\n} from './binding-behaviors/binding-mode.js';\nimport { DebounceBindingBehavior } from './binding-behaviors/debounce.js';\nimport { SignalBindingBehavior } from './binding-behaviors/signals.js';\nimport { ThrottleBindingBehavior } from './binding-behaviors/throttle.js';\nimport { SVGAnalyzer } from './observation/svg-analyzer.js';\nimport { AttrBindingBehavior } from './resources/binding-behaviors/attr.js';\nimport { SelfBindingBehavior } from './resources/binding-behaviors/self.js';\nimport { UpdateTriggerBindingBehavior } from './resources/binding-behaviors/update-trigger.js';\nimport { Focus } from './resources/custom-attributes/focus.js';\nimport { Show } from './resources/custom-attributes/show.js';\nimport { Portal } from './resources/template-controllers/portal.js';\nimport { FrequentMutations, ObserveShallow } from './resources/template-controllers/flags.js';\nimport { Else, If } from './resources/template-controllers/if.js';\nimport { Repeat } from './resources/template-controllers/repeat.js';\nimport { With } from './resources/template-controllers/with.js';\nimport { Switch, Case, DefaultCase } from './resources/template-controllers/switch.js';\nimport {\n  PromiseTemplateController,\n  PendingTemplateController,\n  FulfilledTemplateController,\n  RejectedTemplateController,\n  // TODO: activate after the attribute parser and/or interpreter such that for `t`, `then` is not picked up.\n  // PromiseAttributePattern,\n  // FulfilledAttributePattern,\n  // RejectedAttributePattern,\n} from './resources/template-controllers/promise.js';\nimport { AuRender } from './resources/custom-elements/au-render.js';\nimport { AuCompose } from './resources/custom-elements/au-compose.js';\nimport { AuSlot } from './resources/custom-elements/au-slot.js';\nimport { SanitizeValueConverter } from './resources/value-converters/sanitize.js';\nimport { ViewValueConverter } from './resources/value-converters/view.js';\nimport { NodeObserverLocator } from './observation/observer-locator.js';\n\nexport const DebounceBindingBehaviorRegistration = DebounceBindingBehavior as unknown as IRegistry;\nexport const OneTimeBindingBehaviorRegistration = OneTimeBindingBehavior as unknown as IRegistry;\nexport const ToViewBindingBehaviorRegistration = ToViewBindingBehavior as unknown as IRegistry;\nexport const FromViewBindingBehaviorRegistration = FromViewBindingBehavior as unknown as IRegistry;\nexport const SignalBindingBehaviorRegistration = SignalBindingBehavior as unknown as IRegistry;\nexport const ThrottleBindingBehaviorRegistration = ThrottleBindingBehavior as unknown as IRegistry;\nexport const TwoWayBindingBehaviorRegistration = TwoWayBindingBehavior as unknown as IRegistry;\n\nexport const ITemplateCompilerRegistration = TemplateCompiler as IRegistry;\nexport const INodeObserverLocatorRegistration = NodeObserverLocator as IRegistry;\n\n/**\n * Default HTML-specific (but environment-agnostic) implementations for the following interfaces:\n * - `ITemplateCompiler`\n * - `ITargetAccessorLocator`\n * - `ITargetObserverLocator`\n */\nexport const DefaultComponents = [\n  ITemplateCompilerRegistration,\n  INodeObserverLocatorRegistration,\n];\n\nexport const SVGAnalyzerRegistration = SVGAnalyzer as IRegistry;\n\nexport const AtPrefixedTriggerAttributePatternRegistration = AtPrefixedTriggerAttributePattern as unknown as IRegistry;\nexport const ColonPrefixedBindAttributePatternRegistration = ColonPrefixedBindAttributePattern as unknown as IRegistry;\nexport const RefAttributePatternRegistration = RefAttributePattern as unknown as IRegistry;\nexport const DotSeparatedAttributePatternRegistration = DotSeparatedAttributePattern as unknown as IRegistry;\n\n/**\n * Default binding syntax for the following attribute name patterns:\n * - `ref`\n * - `target.command` (dot-separated)\n */\nexport const DefaultBindingSyntax = [\n  RefAttributePatternRegistration,\n  DotSeparatedAttributePatternRegistration\n];\n\n/**\n * Binding syntax for short-hand attribute name patterns:\n * - `@target` (short-hand for `target.trigger`)\n * - `:target` (short-hand for `target.bind`)\n */\nexport const ShortHandBindingSyntax = [\n  AtPrefixedTriggerAttributePatternRegistration,\n  ColonPrefixedBindAttributePatternRegistration\n];\n\nexport const CallBindingCommandRegistration = CallBindingCommand as unknown as IRegistry;\nexport const DefaultBindingCommandRegistration = DefaultBindingCommand as unknown as IRegistry;\nexport const ForBindingCommandRegistration = ForBindingCommand as unknown as IRegistry;\nexport const FromViewBindingCommandRegistration = FromViewBindingCommand as unknown as IRegistry;\nexport const OneTimeBindingCommandRegistration = OneTimeBindingCommand as unknown as IRegistry;\nexport const ToViewBindingCommandRegistration = ToViewBindingCommand as unknown as IRegistry;\nexport const TwoWayBindingCommandRegistration = TwoWayBindingCommand as unknown as IRegistry;\nexport const RefBindingCommandRegistration = RefBindingCommand as unknown as IRegistry;\nexport const TriggerBindingCommandRegistration = TriggerBindingCommand as unknown as IRegistry;\nexport const DelegateBindingCommandRegistration = DelegateBindingCommand as unknown as IRegistry;\nexport const CaptureBindingCommandRegistration = CaptureBindingCommand as unknown as IRegistry;\nexport const AttrBindingCommandRegistration = AttrBindingCommand as unknown as IRegistry;\nexport const ClassBindingCommandRegistration = ClassBindingCommand as unknown as IRegistry;\nexport const StyleBindingCommandRegistration = StyleBindingCommand as unknown as IRegistry;\n\n/**\n * Default HTML-specific (but environment-agnostic) binding commands:\n * - Property observation: `.bind`, `.one-time`, `.from-view`, `.to-view`, `.two-way`\n * - Function call: `.call`\n * - Collection observation: `.for`\n * - Event listeners: `.trigger`, `.delegate`, `.capture`\n */\nexport const DefaultBindingLanguage = [\n  DefaultBindingCommandRegistration,\n  OneTimeBindingCommandRegistration,\n  FromViewBindingCommandRegistration,\n  ToViewBindingCommandRegistration,\n  TwoWayBindingCommandRegistration,\n  CallBindingCommandRegistration,\n  ForBindingCommandRegistration,\n  RefBindingCommandRegistration,\n  TriggerBindingCommandRegistration,\n  DelegateBindingCommandRegistration,\n  CaptureBindingCommandRegistration,\n  ClassBindingCommandRegistration,\n  StyleBindingCommandRegistration,\n  AttrBindingCommandRegistration,\n];\n\nexport const SanitizeValueConverterRegistration = SanitizeValueConverter as unknown as IRegistry;\nexport const ViewValueConverterRegistration = ViewValueConverter as unknown as IRegistry;\nexport const FrequentMutationsRegistration = FrequentMutations as unknown as IRegistry;\nexport const ObserveShallowRegistration = ObserveShallow as unknown as IRegistry;\nexport const IfRegistration = If as unknown as IRegistry;\nexport const ElseRegistration = Else as unknown as IRegistry;\nexport const RepeatRegistration = Repeat as unknown as IRegistry;\nexport const WithRegistration = With as unknown as IRegistry;\nexport const SwitchRegistration = Switch as unknown as IRegistry;\nexport const CaseRegistration = Case as unknown as IRegistry;\nexport const DefaultCaseRegistration = DefaultCase as unknown as IRegistry;\nexport const PromiseTemplateControllerRegistration = PromiseTemplateController as unknown as IRegistry;\nexport const PendingTemplateControllerRegistration = PendingTemplateController as unknown as IRegistry;\nexport const FulfilledTemplateControllerRegistration = FulfilledTemplateController as unknown as IRegistry;\nexport const RejectedTemplateControllerRegistration = RejectedTemplateController as unknown as IRegistry;\n// TODO: activate after the attribute parser and/or interpreter such that for `t`, `then` is not picked up.\n// export const PromiseAttributePatternRegistration = PromiseAttributePattern as unknown as IRegistry;\n// export const FulfilledAttributePatternRegistration = FulfilledAttributePattern as unknown as IRegistry;\n// export const RejectedAttributePatternRegistration = RejectedAttributePattern as unknown as IRegistry;\nexport const AttrBindingBehaviorRegistration = AttrBindingBehavior as unknown as IRegistry;\nexport const SelfBindingBehaviorRegistration = SelfBindingBehavior as unknown as IRegistry;\nexport const UpdateTriggerBindingBehaviorRegistration = UpdateTriggerBindingBehavior as unknown as IRegistry;\nexport const AuRenderRegistration = AuRender as unknown as IRegistry;\nexport const AuComposeRegistration = AuCompose as unknown as IRegistry;\nexport const PortalRegistration = Portal as unknown as IRegistry;\nexport const FocusRegistration = Focus as unknown as IRegistry;\nexport const ShowRegistration = Show as unknown as IRegistry;\n\n/**\n * Default HTML-specific (but environment-agnostic) resources:\n * - Binding Behaviors: `oneTime`, `toView`, `fromView`, `twoWay`, `signal`, `debounce`, `throttle`, `attr`, `self`, `updateTrigger`\n * - Custom Elements: `au-compose`, `au-slot`\n * - Custom Attributes: `blur`, `focus`, `portal`\n * - Template controllers: `if`/`else`, `repeat`, `with`\n * - Value Converters: `sanitize`\n */\nexport const DefaultResources = [\n  DebounceBindingBehaviorRegistration,\n  OneTimeBindingBehaviorRegistration,\n  ToViewBindingBehaviorRegistration,\n  FromViewBindingBehaviorRegistration,\n  SignalBindingBehaviorRegistration,\n  ThrottleBindingBehaviorRegistration,\n  TwoWayBindingBehaviorRegistration,\n  SanitizeValueConverterRegistration,\n  ViewValueConverterRegistration,\n  FrequentMutationsRegistration,\n  ObserveShallowRegistration,\n  IfRegistration,\n  ElseRegistration,\n  RepeatRegistration,\n  WithRegistration,\n  SwitchRegistration,\n  CaseRegistration,\n  DefaultCaseRegistration,\n  PromiseTemplateControllerRegistration,\n  PendingTemplateControllerRegistration,\n  FulfilledTemplateControllerRegistration,\n  RejectedTemplateControllerRegistration,\n  // TODO: activate after the attribute parser and/or interpreter such that for `t`, `then` is not picked up.\n  // PromiseAttributePatternRegistration,\n  // FulfilledAttributePatternRegistration,\n  // RejectedAttributePatternRegistration,\n  AttrBindingBehaviorRegistration,\n  SelfBindingBehaviorRegistration,\n  UpdateTriggerBindingBehaviorRegistration,\n  AuRenderRegistration,\n  AuComposeRegistration,\n  PortalRegistration,\n  FocusRegistration,\n  ShowRegistration,\n  AuSlot,\n];\n\nexport const CallBindingRendererRegistration = CallBindingRenderer as unknown as IRegistry;\nexport const CustomAttributeRendererRegistration = CustomAttributeRenderer as unknown as IRegistry;\nexport const CustomElementRendererRegistration = CustomElementRenderer as unknown as IRegistry;\nexport const InterpolationBindingRendererRegistration = InterpolationBindingRenderer as unknown as IRegistry;\nexport const IteratorBindingRendererRegistration = IteratorBindingRenderer as unknown as IRegistry;\nexport const LetElementRendererRegistration = LetElementRenderer as unknown as IRegistry;\nexport const PropertyBindingRendererRegistration = PropertyBindingRenderer as unknown as IRegistry;\nexport const RefBindingRendererRegistration = RefBindingRenderer as unknown as IRegistry;\nexport const SetPropertyRendererRegistration = SetPropertyRenderer as unknown as IRegistry;\nexport const TemplateControllerRendererRegistration = TemplateControllerRenderer as unknown as IRegistry;\nexport const ListenerBindingRendererRegistration = ListenerBindingRenderer as unknown as IRegistry;\nexport const AttributeBindingRendererRegistration = AttributeBindingRenderer as unknown as IRegistry;\nexport const SetAttributeRendererRegistration = SetAttributeRenderer as unknown as IRegistry;\nexport const SetClassAttributeRendererRegistration = SetClassAttributeRenderer as unknown as IRegistry;\nexport const SetStyleAttributeRendererRegistration = SetStyleAttributeRenderer as unknown as IRegistry;\nexport const StylePropertyBindingRendererRegistration = StylePropertyBindingRenderer as unknown as IRegistry;\nexport const TextBindingRendererRegistration = TextBindingRenderer as unknown as IRegistry;\n\n/**\n * Default renderers for:\n * - PropertyBinding: `bind`, `one-time`, `to-view`, `from-view`, `two-way`\n * - IteratorBinding: `for`\n * - CallBinding: `call`\n * - RefBinding: `ref`\n * - InterpolationBinding: `${}`\n * - SetProperty\n * - `customElement` hydration\n * - `customAttribute` hydration\n * - `templateController` hydration\n * - `let` element hydration\n * - Listener Bindings: `trigger`, `capture`, `delegate`\n * - SetAttribute\n * - StyleProperty: `style`, `css`\n * - TextBinding: `${}`\n */\nexport const DefaultRenderers = [\n  PropertyBindingRendererRegistration,\n  IteratorBindingRendererRegistration,\n  CallBindingRendererRegistration,\n  RefBindingRendererRegistration,\n  InterpolationBindingRendererRegistration,\n  SetPropertyRendererRegistration,\n  CustomElementRendererRegistration,\n  CustomAttributeRendererRegistration,\n  TemplateControllerRendererRegistration,\n  LetElementRendererRegistration,\n  ListenerBindingRendererRegistration,\n  AttributeBindingRendererRegistration,\n  SetAttributeRendererRegistration,\n  SetClassAttributeRendererRegistration,\n  SetStyleAttributeRendererRegistration,\n  StylePropertyBindingRendererRegistration,\n  TextBindingRendererRegistration,\n];\n\n/**\n * A DI configuration object containing html-specific (but environment-agnostic) registrations:\n * - `RuntimeConfiguration` from `@aurelia/runtime`\n * - `DefaultComponents`\n * - `DefaultResources`\n * - `DefaultRenderers`\n */\nexport const StandardConfiguration = {\n  /**\n   * Apply this configuration to the provided container.\n   */\n  register(container: IContainer): IContainer {\n    return container.register(\n      ...DefaultComponents,\n      ...DefaultResources,\n      ...DefaultBindingSyntax,\n      ...DefaultBindingLanguage,\n      ...DefaultRenderers,\n    );\n  },\n  /**\n   * Create a new container with this configuration applied to it.\n   */\n  createContainer(): IContainer {\n    return this.register(DI.createContainer());\n  }\n};\n","import { DI, IContainer, Registration, InstanceProvider, IDisposable, onResolve } from '@aurelia/kernel';\nimport { BrowserPlatform } from '@aurelia/platform-browser';\nimport { AppRoot, IAppRoot, ISinglePageApp } from './app-root.js';\nimport { IPlatform } from './platform.js';\n\nexport interface IAurelia extends Aurelia {}\nexport const IAurelia = DI.createInterface<IAurelia>('IAurelia');\n\nexport class Aurelia implements IDisposable {\n  private _isRunning: boolean = false;\n  public get isRunning(): boolean { return this._isRunning; }\n  private _isStarting: boolean = false;\n  public get isStarting(): boolean { return this._isStarting; }\n  private _isStopping: boolean = false;\n  public get isStopping(): boolean { return this._isStopping; }\n\n  private _root: IAppRoot | undefined = void 0;\n  public get root(): IAppRoot {\n    if (this._root == null) {\n      if (this.next == null) {\n        throw new Error(`root is not defined`); // TODO: create error code\n      }\n      return this.next;\n    }\n    return this._root;\n  }\n\n  private next: IAppRoot | undefined = void 0;\n\n  private readonly rootProvider: InstanceProvider<IAppRoot>;\n\n  public constructor(\n    public readonly container: IContainer = DI.createContainer(),\n  ) {\n    if (container.has(IAurelia, true)) {\n      throw new Error('An instance of Aurelia is already registered with the container or an ancestor of it.');\n    }\n\n    container.register(Registration.instance(IAurelia, this));\n    container.registerResolver(IAppRoot, this.rootProvider = new InstanceProvider('IAppRoot'));\n  }\n\n  public register(...params: any[]): this {\n    this.container.register(...params);\n    return this;\n  }\n\n  public app(config: ISinglePageApp): Omit<this, 'register' | 'app' | 'enhance'> {\n    this.next = new AppRoot(config, this.initPlatform(config.host), this.container, this.rootProvider, false);\n    return this;\n  }\n\n  public enhance(config: ISinglePageApp): Omit<this, 'register' | 'app' | 'enhance'> {\n    this.next = new AppRoot(config, this.initPlatform(config.host), this.container, this.rootProvider, true);\n    return this;\n  }\n\n  public async waitForIdle(): Promise<void> {\n    const platform = this.root.platform;\n    await platform.domWriteQueue.yield();\n    await platform.domReadQueue.yield();\n    await platform.taskQueue.yield();\n  }\n\n  private initPlatform(host: HTMLElement): IPlatform {\n    let p: IPlatform;\n    if (!this.container.has(IPlatform, false)) {\n      if (host.ownerDocument.defaultView === null) {\n        throw new Error(`Failed to initialize the platform object. The host element's ownerDocument does not have a defaultView`);\n      }\n      p = new BrowserPlatform(host.ownerDocument.defaultView);\n      this.container.register(Registration.instance(IPlatform, p));\n    } else {\n      p = this.container.get(IPlatform);\n    }\n    return p;\n  }\n\n  private startPromise: Promise<void> | void = void 0;\n  public start(root: IAppRoot | undefined = this.next): void | Promise<void> {\n    if (root == null) {\n      throw new Error(`There is no composition root`);\n    }\n\n    if (this.startPromise instanceof Promise) {\n      return this.startPromise;\n    }\n\n    return this.startPromise = onResolve(this.stop(), () => {\n      Reflect.set(root.host, '$aurelia', this);\n      this.rootProvider.prepare(this._root = root);\n      this._isStarting = true;\n\n      return onResolve(root.activate(), () => {\n        this._isRunning = true;\n        this._isStarting = false;\n        this.startPromise = void 0;\n        this.dispatchEvent(root, 'au-started', root.host);\n      });\n    });\n  }\n\n  private stopPromise: Promise<void> | void = void 0;\n  public stop(dispose: boolean = false): void | Promise<void> {\n    if (this.stopPromise instanceof Promise) {\n      return this.stopPromise;\n    }\n\n    if (this._isRunning === true) {\n      const root = this._root!;\n      this._isRunning = false;\n      this._isStopping = true;\n\n      return this.stopPromise = onResolve(root.deactivate(), () => {\n        Reflect.deleteProperty(root.host, '$aurelia');\n        if (dispose) {\n          root.dispose();\n        }\n        this._root = void 0;\n        this.rootProvider.dispose();\n        this._isStopping = false;\n        this.dispatchEvent(root, 'au-stopped', root.host);\n      });\n    }\n  }\n\n  public dispose(): void {\n    if (this._isRunning || this._isStopping) {\n      throw new Error(`The aurelia instance must be fully stopped before it can be disposed`);\n    }\n    this.container.dispose();\n  }\n\n  private dispatchEvent(root: IAppRoot, name: string, target: HTMLElement): void {\n    const ev = new root.platform.window.CustomEvent(name, { detail: this, bubbles: true, cancelable: true });\n    target.dispatchEvent(ev);\n  }\n}\n","import { DI } from '@aurelia/kernel';\n\nimport type { Constructable, IContainer, IDisposable } from '@aurelia/kernel';\nimport type { ICustomElementViewModel } from '../controller.js';\n\n/**\n * The dialog service for composing view & view model into a dialog\n */\nexport const IDialogService = DI.createInterface<IDialogService>('IDialogService');\nexport interface IDialogService {\n  readonly controllers: IDialogController[];\n  /**\n   * Opens a new dialog.\n   *\n   * @param settings - Dialog settings for this dialog instance.\n   * @returns Promise A promise that settles when the dialog is closed.\n   */\n  open(settings?: IDialogSettings): DialogOpenPromise;\n\n  /**\n   * Closes all open dialogs at the time of invocation.\n   *\n   * @returns Promise<DialogController[]> All controllers whose close operation was cancelled.\n   */\n  closeAll(): Promise<IDialogController[]>;\n}\n\n/**\n * The controller asscociated with every dialog view model\n */\nexport const IDialogController = DI.createInterface<IDialogController>('IDialogController');\nexport interface IDialogController {\n  readonly settings: IDialogLoadedSettings;\n  /**\n   * A promise that will be fulfilled once this dialog has been closed\n   */\n  readonly closed: Promise<DialogCloseResult>;\n\n  ok(value?: unknown): Promise<DialogCloseResult<DialogDeactivationStatuses.Ok>>;\n  cancel(value?: unknown): Promise<DialogCloseResult<DialogDeactivationStatuses.Cancel>>;\n  error(value?: unknown): Promise<void>;\n}\n\n/**\n * An interface describing the object responsible for creating the dom structure of a dialog\n */\nexport const IDialogDomRenderer = DI.createInterface<IDialogDomRenderer>('IDialogDomRenderer');\nexport interface IDialogDomRenderer {\n  render(dialogHost: Element, settings: IDialogLoadedSettings): IDialogDom;\n}\n\n/**\n * An interface describing the DOM structure of a dialog\n */\nexport const IDialogDom = DI.createInterface<IDialogDom>('IDialogDom');\nexport interface IDialogDom extends IDisposable {\n  readonly overlay: HTMLElement;\n  readonly contentHost: HTMLElement;\n}\n\n// export type IDialogCancellableOpenResult = IDialogOpenResult | IDialogCancelResult;\n\n/* tslint:disable:max-line-length */\n/**\n * The promised returned from a dialog composition.\n */\nexport interface DialogOpenPromise extends Promise<DialogOpenResult> {\n  /**\n   * Add a callback that will be invoked when a dialog has been closed\n   */\n  whenClosed<TResult1, TResult2>(\n    onfulfilled?: (value: DialogCloseResult) => TResult1 | PromiseLike<TResult1>,\n    onrejected?: (reason: unknown) => TResult2 | PromiseLike<TResult2>\n  ): Promise<TResult1 | TResult2>;\n}\n/* tslint:enable:max-line-length */\n\nexport type DialogActionKey = 'Escape' | 'Enter';\nexport type DialogMouseEventType = 'click' | 'mouseup' | 'mousedown';\n\nexport interface IDialogSettings<\n  TModel = unknown,\n  TVm extends object = object,\n> {\n\n  /**\n   * The view model url, constructor or instance for the dialog.\n   */\n  component?: () => Constructable<TVm> | TVm | Promise<TVm | Constructable<TVm>>;\n\n  /**\n   * The view url or view strategy to override the default view location convention.\n   */\n  template?: string | Element | Promise<string | Element> | (() => string | Element | Promise<string | Element>);\n\n  /**\n   * Data to be passed to the \"activate\" hook on the view model.\n   */\n  model?: TModel;\n\n  /**\n   * The element that will parent the dialog.\n   */\n  host?: Element;\n\n  /**\n   * The container for the dialog creation.\n   * One will be created from the root if not provided.\n   */\n  container?: IContainer;\n\n  /**\n   * When set to \"false\" allows the dialog to be closed with ESC key or clicking outside the dialog.\n   * When set to \"true\" the dialog does not close on ESC key or clicking outside of it.\n   */\n  lock?: boolean;\n\n  /**\n   * Allows for closing the top most dialog via the keyboard.\n   * When set to \"false\" no action will be taken.\n   * If set to \"true\", \"Escape\" or an array containing \"Escape\"\n   * the dialog will be \"cancel\" closed when the ESC key is pressed.\n   * If set to \"Enter\" or and array containing \"Enter\"\n   * the dialog will be \"ok\" closed  when the ENTER key is pressed.\n   * Using the array format allows combining the ESC and ENTER keys.\n   */\n  keyboard?: DialogActionKey[];\n\n  /**\n   * Determines which type of mouse event should be used for closing the dialog\n   *\n   * Default: click\n   */\n  mouseEvent?: DialogMouseEventType;\n\n  /**\n   * When set to \"true\" allows for the dismissal of the dialog by clicking outside of it.\n   */\n  overlayDismiss?: boolean;\n\n  /**\n   * The z-index of the dialog.\n   * In the terms of the DialogRenderer it is applied to the dialog overlay and the dialog container.\n   */\n  startingZIndex?: number;\n\n  /**\n   * When set to true conveys a cancellation as a rejection.\n   */\n  rejectOnCancel?: boolean;\n}\n\nexport type IDialogLoadedSettings<T extends object = object> = Omit<IDialogSettings<T>, 'component' | 'template' | 'keyboard'> & {\n  component?: Constructable<T> | T;\n  template?: string | Element;\n  readonly keyboard: DialogActionKey[];\n};\n\nexport type IDialogGlobalSettings = Pick<\n  IDialogSettings,\n  'lock' | 'startingZIndex' | 'rejectOnCancel'\n>;\nexport const IDialogGlobalSettings = DI.createInterface<IDialogGlobalSettings>('IDialogGlobalSettings');\n\nexport interface DialogError<T> extends Error {\n  wasCancelled: boolean;\n  value?: T;\n}\n\n/**\n * The error thrown when a \"cancel\" occurs and DialogSettings.rejectOnCancel is set to \"true\".\n */\nexport type DialogCancelError<T> = DialogError<T> & { wasCancelled: true };\n\n/**\n * The error thrown when the dialog is closed with the `DialogController.prototype.error` method.\n */\nexport type DialogCloseError<T> = DialogError<T> & { wasCancelled: false };\n\nexport class DialogOpenResult {\n  private constructor(\n    public readonly wasCancelled: boolean,\n    public readonly dialog: IDialogController,\n  ) {}\n\n  public static create(\n    wasCancelled: boolean,\n    dialog: IDialogController,\n  ) {\n    return new DialogOpenResult(wasCancelled, dialog);\n  }\n}\n\nexport class DialogCloseResult<\n  T extends DialogDeactivationStatuses = DialogDeactivationStatuses,\n  TVal = unknown\n> {\n  private constructor(\n    public readonly status: T,\n    public readonly value?: TVal,\n  ) {}\n\n  public static create<T extends DialogDeactivationStatuses, TVal = unknown>(status: T, value?: TVal): DialogCloseResult<T, TVal> {\n    return new DialogCloseResult(status, value);\n  }\n}\n\nexport interface IDialogCustomElementViewModel<T = unknown> extends ICustomElementViewModel, IDialogComponent<T> {\n  readonly $dialog: IDialogController;\n}\n\nexport const enum DialogDeactivationStatuses {\n  Ok = 'ok',\n  Error = 'error',\n  Cancel = 'cancel',\n  /**\n   * If a view model refused to deactivate in canDeactivate,\n   * then this status should be used to reflect that\n   */\n  Abort = 'abort',\n}\n\n/**\n * The result received when a dialog opens.\n */\nexport interface DialogOpenResult {\n  readonly wasCancelled: boolean;\n  /**\n   * The controller for the open dialog.\n   */\n  readonly dialog: IDialogController;\n}\n\n// #region Implementable\n\nexport interface IDialogComponent<T> {\n  canActivate?: IDialogComponentCanActivate<T>['canActivate'];\n  activate?: IDialogComponentActivate<T>['activate'];\n  canDeactivate?: IDialogComponentCanDeactivate['canDeactivate'];\n  deactivate?: IDialogComponentDeactivate['deactivate'];\n}\n/**\n * An optional interface describing the dialog canActivate convention.\n */\nexport interface IDialogComponentCanActivate<T> {\n  /**\n   * Implement this hook if you want to control whether or not the dialog can be open.\n   * To cancel the opening of the dialog return false or a promise that resolves to false.\n   * Any other returned value is coerced to true.\n   */\n  canActivate(model?: T): boolean | Promise<boolean> | PromiseLike<boolean>;\n}\n\n/**\n * An optional interface describing the dialog activate convention.\n */\nexport interface IDialogComponentActivate<T> {\n  /**\n   * Implement this hook if you want to perform custom logic just before the dialog is open.\n   */\n  activate(model?: T): void | Promise<void> | PromiseLike<void>;\n}\n\n/**\n * An optional interface describing the dialog canDeactivate convention.\n */\nexport interface IDialogComponentCanDeactivate {\n  /**\n   * Implement this hook if you want to control whether or not the dialog can be closed.\n   * To cancel the closing of the dialog return false or a promise that resolves to false.\n   * Any other returned value is coerced to true.\n   */\n  canDeactivate(result: DialogCloseResult): boolean | Promise<boolean> | PromiseLike<boolean>;\n}\n\n/**\n * An optional interface describing the dialog deactivate convention.\n */\nexport interface IDialogComponentDeactivate {\n  /**\n   * Implement this hook if you want to perform custom logic when the dialog is being closed.\n   */\n  deactivate(result: DialogCloseResult): void | Promise<void> | PromiseLike<void>;\n}\n\n// #endregion\n","import { Constructable, IContainer, InstanceProvider, onResolve, Registration } from '@aurelia/kernel';\nimport { LifecycleFlags } from '@aurelia/runtime';\nimport { Controller, ICustomElementController } from '../controller.js';\nimport {\n  DialogDeactivationStatuses,\n  IDialogController,\n  IDialogDomRenderer,\n  IDialogDom,\n  DialogOpenResult,\n  DialogCloseResult,\n  DialogCancelError,\n  DialogCloseError,\n} from './dialog-interfaces.js';\nimport { IEventTarget, INode } from '../../dom.js';\n\nimport type {\n  IDialogComponent,\n  IDialogLoadedSettings,\n} from './dialog-interfaces.js';\nimport { IPlatform } from '../../platform.js';\nimport { CustomElement, CustomElementDefinition } from '../../resources/custom-element.js';\n\n/**\n * A controller object for a Dialog instance.\n */\nexport class DialogController implements IDialogController {\n  private readonly p: IPlatform;\n  private readonly ctn: IContainer;\n\n  /** @internal */\n  private cmp!: IDialogComponent<object>;\n\n  /** @internal */\n  private resolve!: (result: DialogCloseResult) => void;\n\n  /** @internal */\n  private reject!: (reason: unknown) => void;\n\n  /**\n   * @internal\n   */\n  private closingPromise: Promise<DialogCloseResult> | undefined;\n\n  /**\n   * The settings used by this controller.\n   */\n  public settings!: IDialogLoadedSettings;\n\n  public readonly closed: Promise<DialogCloseResult>;\n\n  /**\n   * The dom structure created to support the dialog associated with this controller\n   */\n  private dom!: IDialogDom;\n\n  /**\n   * The component controller associated with this dialog controller\n   *\n   * @internal\n   */\n  private controller!: ICustomElementController;\n\n  protected static get inject() { return [IPlatform, IContainer]; }\n\n  public constructor(\n    p: IPlatform,\n    container: IContainer,\n  ) {\n    this.p = p;\n    this.ctn = container;\n    this.closed = new Promise((resolve, reject) => {\n      this.resolve = resolve;\n      this.reject = reject;\n    });\n  }\n\n  /** @internal */\n  public activate(settings: IDialogLoadedSettings): Promise<DialogOpenResult> {\n    const container = this.ctn.createChild();\n    const { model, template, rejectOnCancel } = settings;\n    const hostRenderer: IDialogDomRenderer = container.get(IDialogDomRenderer);\n    const dialogTargetHost = settings.host ?? this.p.document.body;\n    const dom = this.dom = hostRenderer.render(dialogTargetHost, settings);\n    const rootEventTarget = container.has(IEventTarget, true)\n      ? container.get(IEventTarget) as Element\n      : null;\n    const contentHost = dom.contentHost;\n\n    this.settings = settings;\n    // application root host may be a different element with the dialog root host\n    // example:\n    // <body>\n    //   <my-app>\n    //   <au-dialog-container>\n    // when it's different, needs to ensure delegate bindings work\n    if (rootEventTarget == null || !rootEventTarget.contains(dialogTargetHost)) {\n      container.register(Registration.instance(IEventTarget, dialogTargetHost));\n    }\n\n    container.register(\n      Registration.instance(INode, contentHost),\n      Registration.instance(IDialogDom, dom),\n    );\n\n    return new Promise(r => {\n        const cmp = Object.assign(this.cmp = this.getOrCreateVm(container, settings, contentHost), { $dialog: this });\n        r(cmp.canActivate?.(model) ?? true);\n      })\n      .then(canActivate => {\n        if (canActivate !== true) {\n          dom.dispose();\n          if (rejectOnCancel) {\n            throw createDialogCancelError(null, 'Dialog activation rejected');\n          }\n          return DialogOpenResult.create(true, this);\n        }\n\n        const cmp = this.cmp;\n\n        return onResolve(cmp.activate?.(model), () => {\n          const ctrlr = this.controller = Controller.forCustomElement(\n            null,\n            container,\n            container,\n            cmp,\n            contentHost,\n            null,\n            LifecycleFlags.none,\n            true,\n            CustomElementDefinition.create(\n              this.getDefinition(cmp) ?? { name: CustomElement.generateName(), template }\n            )\n          ) as ICustomElementController;\n          return onResolve(ctrlr.activate(ctrlr, null!, LifecycleFlags.fromBind), () => {\n            dom.overlay.addEventListener(settings.mouseEvent ?? 'click', this);\n            return DialogOpenResult.create(false, this);\n          });\n        });\n      }, e => {\n        dom.dispose();\n        throw e;\n      });\n  }\n\n  /** @internal */\n  public deactivate<T extends DialogDeactivationStatuses>(status: T, value?: unknown): Promise<DialogCloseResult<T>> {\n    if (this.closingPromise) {\n      return this.closingPromise as Promise<DialogCloseResult<T>>;\n    }\n\n    let deactivating = true;\n    const { controller, dom, cmp, settings: { mouseEvent, rejectOnCancel }} = this;\n    const dialogResult = DialogCloseResult.create(status as T, value);\n\n    const promise: Promise<DialogCloseResult<T>> = new Promise<DialogCloseResult<T>>(r => {\n      r(onResolve(\n        cmp.canDeactivate?.(dialogResult) ?? true,\n        canDeactivate => {\n          if (canDeactivate !== true) {\n            // we are done, do not block consecutive calls\n            deactivating = false;\n            this.closingPromise = void 0;\n            if (rejectOnCancel) {\n              throw createDialogCancelError(null, 'Dialog cancellation rejected');\n            }\n            return DialogCloseResult.create(DialogDeactivationStatuses.Abort as T);\n          }\n          return onResolve(cmp.deactivate?.(dialogResult),\n            () => onResolve(controller.deactivate(controller, null!, LifecycleFlags.fromUnbind),\n              () => {\n                dom.dispose();\n                dom.overlay.removeEventListener(mouseEvent ?? 'click', this);\n                if (!rejectOnCancel && status !== DialogDeactivationStatuses.Error) {\n                  this.resolve(dialogResult);\n                } else {\n                  this.reject(createDialogCancelError(value, 'Dialog cancelled with a rejection on cancel'));\n                }\n                return dialogResult;\n              }\n            )\n          );\n        }\n      ));\n    }).catch(reason => {\n      this.closingPromise = void 0;\n      throw reason;\n    });\n    // when component canDeactivate is synchronous, and returns something other than true\n    // then the below assignment will override\n    // the assignment inside the callback without the deactivating variable check\n    this.closingPromise = deactivating ? promise : void 0;\n    return promise;\n  }\n\n  /**\n   * Closes the dialog with a successful output.\n   *\n   * @param value - The returned success output.\n   */\n  public ok(value?: unknown): Promise<DialogCloseResult<DialogDeactivationStatuses.Ok>> {\n    return this.deactivate(DialogDeactivationStatuses.Ok, value);\n  }\n\n  /**\n   * Closes the dialog with a cancel output.\n   *\n   * @param value - The returned cancel output.\n   */\n  public cancel(value?: unknown): Promise<DialogCloseResult<DialogDeactivationStatuses.Cancel>> {\n    return this.deactivate(DialogDeactivationStatuses.Cancel, value);\n  }\n\n  /**\n   * Closes the dialog with an error output.\n   *\n   * @param value - A reason for closing with an error.\n   * @returns Promise An empty promise object.\n   */\n  public error(value: unknown): Promise<void> {\n    const closeError = createDialogCloseError(value);\n    return new Promise(r => r(onResolve(\n      this.cmp.deactivate?.(DialogCloseResult.create(DialogDeactivationStatuses.Error, closeError)),\n      () => onResolve(\n        this.controller.deactivate(this.controller, null!, LifecycleFlags.fromUnbind),\n        () => {\n          this.dom.dispose();\n          this.reject(closeError);\n        }\n      )\n    )));\n  }\n\n  /** @internal */\n  public handleEvent(event: MouseEvent): void {\n    if (/* user allows dismiss on overlay click */this.settings.overlayDismiss\n      && /* did not click inside the host element */!this.dom.contentHost.contains(event.target as Element)\n    ) {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.cancel();\n    }\n  }\n\n  private getOrCreateVm(container: IContainer, settings: IDialogLoadedSettings, host: HTMLElement): IDialogComponent<object> {\n    const Component = settings.component;\n    if (Component == null) {\n      return new EmptyComponent();\n    }\n    if (typeof Component === 'object') {\n      return Component;\n    }\n\n    const p = this.p;\n    const ep = new InstanceProvider('ElementResolver', host);\n\n    container.registerResolver(INode, ep);\n    container.registerResolver(p.Node, ep);\n    container.registerResolver(p.Element, ep);\n    container.registerResolver(p.HTMLElement, ep);\n\n    return container.invoke(Component!);\n  }\n\n  private getDefinition(component?: object | Constructable) {\n    const Ctor = (typeof component === 'function'\n      ? component\n      : component?.constructor) as Constructable;\n    return CustomElement.isType(Ctor)\n      ? CustomElement.getDefinition(Ctor)\n      : null;\n  }\n}\n\nclass EmptyComponent {}\n\nfunction createDialogCancelError<T>(output: T | undefined, msg: string): DialogCancelError<T> {\n  const error = new Error(msg) as DialogCancelError<T>;\n  error.wasCancelled = true;\n  error.value = output;\n  return error;\n}\n\nfunction createDialogCloseError<T = unknown>(output: T): DialogCloseError<T> {\n  const error = new Error() as DialogCloseError<T>;\n  error.wasCancelled = false;\n  error.value = output;\n  return error;\n}\n","import { IContainer, onResolve, Registration, resolveAll } from '@aurelia/kernel';\n\nimport {\n  DialogActionKey,\n  DialogCloseResult,\n  DialogDeactivationStatuses,\n  DialogOpenResult,\n  IDialogService,\n  IDialogController,\n  IDialogGlobalSettings,\n  IDialogLoadedSettings,\n} from './dialog-interfaces.js';\nimport { DialogController } from './dialog-controller.js';\n\nimport type {\n  DialogOpenPromise,\n  IDialogSettings,\n} from './dialog-interfaces.js';\nimport { AppTask } from '../../app-task.js';\nimport { IPlatform } from '../../platform.js';\n\n/**\n * A default implementation for the dialog service allowing for the creation of dialogs.\n */\nexport class DialogService implements IDialogService {\n  public get controllers() {\n    return this.dlgs.slice(0);\n  }\n  /**\n   * The current dialog controllers\n   *\n   * @internal\n   */\n  private readonly dlgs: IDialogController[] = [];\n\n  private get top(): IDialogController | null {\n    const dlgs = this.dlgs;\n    return dlgs.length > 0 ? dlgs[dlgs.length - 1] : null;\n  }\n\n  // tslint:disable-next-line:member-ordering\n  protected static get inject() { return [IContainer, IPlatform, IDialogGlobalSettings]; }\n\n  public constructor(\n    private readonly container: IContainer,\n    private readonly p: IPlatform,\n    private readonly defaultSettings: IDialogGlobalSettings,\n  ) {}\n\n  public static register(container: IContainer) {\n    container.register(\n      Registration.singleton(IDialogService, this),\n      AppTask.beforeDeactivate(IDialogService, dialogService => onResolve(\n        dialogService.closeAll(),\n        (openDialogController) => {\n          if (openDialogController.length > 0) {\n            // todo: what to do?\n            throw new Error(`There are still ${openDialogController.length} open dialog(s).`);\n          }\n        }\n      ))\n    );\n  }\n\n  /**\n   * Opens a new dialog.\n   *\n   * @param settings - Dialog settings for this dialog instance.\n   * @returns A promise that settles when the dialog is closed.\n   *\n   * Example usage:\n   * ```ts\n   * dialogService.open({ component: () => MyDialog, template: 'my-template' })\n   * dialogService.open({ component: () => MyDialog, template: document.createElement('my-template') })\n   *\n   * // JSX to hyperscript\n   * dialogService.open({ component: () => MyDialog, template: <my-template /> })\n   *\n   * dialogService.open({ component: () => import('...'), template: () => fetch('my.server/dialog-view.html') })\n   * ```\n   */\n  public open(settings: IDialogSettings): DialogOpenPromise {\n    return asDialogOpenPromise(new Promise<DialogOpenResult>(resolve => {\n      const $settings = DialogSettings.from(this.defaultSettings, settings);\n      const container = $settings.container ?? this.container.createChild();\n\n      resolve(onResolve(\n        $settings.load(),\n        loadedSettings => {\n          const dialogController = container.invoke(DialogController);\n          container.register(Registration.instance(IDialogController, dialogController));\n          container.register(Registration.callback(DialogController, () => {\n            throw new Error('Invalid injection of DialogController. Use IDialogController instead.');\n          }));\n\n          return onResolve(\n            dialogController.activate(loadedSettings),\n            openResult => {\n              if (!openResult.wasCancelled) {\n                if (this.dlgs.push(dialogController) === 1) {\n                  this.p.window.addEventListener('keydown', this);\n                }\n\n                const $removeController = () => this.remove(dialogController);\n                dialogController.closed.then($removeController, $removeController);\n              }\n              return openResult;\n            }\n          );\n        }\n      ));\n    }));\n  }\n\n  /**\n   * Closes all open dialogs at the time of invocation.\n   *\n   * @returns All controllers whose close operation was cancelled.\n   */\n  public closeAll(): Promise<IDialogController[]> {\n    return Promise\n      .all(Array.from(this.dlgs)\n        .map(controller => {\n          if (controller.settings.rejectOnCancel) {\n            // this will throw when calling cancel\n            // so only leave return null as noop\n            return controller.cancel().then(() => null);\n          }\n          return controller.cancel().then(result =>\n            result.status === DialogDeactivationStatuses.Cancel\n              ? null\n              : controller\n          );\n        })\n      )\n      .then(unclosedControllers =>\n        unclosedControllers.filter(unclosed => !!unclosed) as IDialogController[]\n      );\n  }\n\n  /** @internal */\n  private remove(controller: DialogController): void {\n    const dlgs = this.dlgs;\n    const idx = dlgs.indexOf(controller);\n    if (idx > -1) {\n      this.dlgs.splice(idx, 1);\n    }\n    if (dlgs.length === 0) {\n      this.p.window.removeEventListener('keydown', this);\n    }\n  }\n\n  /** @internal */\n  public handleEvent(e: Event): void {\n    const keyEvent = e as KeyboardEvent;\n    const key = getActionKey(keyEvent);\n    if (key == null) {\n      return;\n    }\n    const top = this.top;\n    if (top === null || top.settings.keyboard.length === 0) {\n      return;\n    }\n    const keyboard = top.settings.keyboard;\n    if (key === 'Escape' && keyboard.includes(key)) {\n      void top.cancel();\n    } else if (key === 'Enter' && keyboard.includes(key)) {\n      void top.ok();\n    }\n  }\n}\n\ninterface DialogSettings<T extends object = object> extends IDialogSettings<T> {}\nclass DialogSettings<T extends object = object> implements IDialogSettings<T> {\n\n  public static from(...srcs: Partial<IDialogSettings>[]): DialogSettings {\n    return (Object.assign(new DialogSettings(), ...srcs) as DialogSettings)\n      .validate()\n      .normalize();\n  }\n\n  public load(): IDialogLoadedSettings | Promise<IDialogLoadedSettings> {\n    const loaded = this as IDialogLoadedSettings;\n    const cmp = this.component;\n    const template = this.template;\n    const maybePromise = resolveAll(...[\n      cmp == null\n        ? void 0\n        : onResolve(cmp(), loadedCmp => { loaded.component = loadedCmp; }),\n      typeof template === 'function'\n        ? onResolve(template(), loadedTpl => { loaded.template = loadedTpl; })\n        : void 0\n    ]);\n    return maybePromise instanceof Promise\n      ? maybePromise.then(() => loaded)\n      : loaded;\n  }\n\n  private validate(): this {\n    if (this.component == null && this.template == null) {\n      throw new Error('Invalid Dialog Settings. You must provide \"component\", \"template\" or both.');\n    }\n    return this;\n  }\n\n  private normalize(): DialogSettings {\n    if (this.keyboard == null) {\n      this.keyboard = this.lock ? [] : ['Enter', 'Escape'];\n    }\n    if (typeof this.overlayDismiss !== 'boolean') {\n      this.overlayDismiss = !this.lock;\n    }\n    return this;\n  }\n}\n\nfunction whenClosed<TResult1 = unknown, TResult2 = unknown>(\n  this: Promise<DialogOpenResult>,\n  onfulfilled?: (r: DialogCloseResult) => TResult1 | PromiseLike<TResult1>,\n  onrejected?: (err: unknown) => TResult2 | PromiseLike<TResult2>\n): Promise<TResult1 | TResult2> {\n  return this.then(openResult => openResult.dialog.closed.then(onfulfilled, onrejected), onrejected);\n}\n\nfunction asDialogOpenPromise(promise: Promise<unknown>): DialogOpenPromise {\n  (promise as DialogOpenPromise).whenClosed = whenClosed;\n  return promise as DialogOpenPromise;\n}\n\nfunction getActionKey(e: KeyboardEvent): DialogActionKey | undefined {\n  if ((e.code || e.key) === 'Escape' || e.keyCode === 27) {\n    return 'Escape';\n  }\n  if ((e.code || e.key) === 'Enter' || e.keyCode === 13) {\n    return 'Enter';\n  }\n  return undefined;\n}\n","import { IPlatform } from '../../platform.js';\nimport {\n  IDialogDomRenderer,\n  IDialogDom,\n  IDialogGlobalSettings,\n} from './dialog-interfaces.js';\n\nimport { IContainer, Registration } from '@aurelia/kernel';\n\nexport class DefaultDialogGlobalSettings implements IDialogGlobalSettings {\n\n  public static register(container: IContainer) {\n    Registration.singleton(IDialogGlobalSettings, this).register(container);\n  }\n\n  public lock: boolean = true;\n  public startingZIndex = 1000;\n  public rejectOnCancel = false;\n}\n\nconst baseWrapperCss = 'position:absolute;width:100%;height:100%;top:0;left:0;';\n\nexport class DefaultDialogDomRenderer implements IDialogDomRenderer {\n\n  protected static inject = [IPlatform];\n\n  public constructor(private readonly p: IPlatform) {}\n\n  public static register(container: IContainer) {\n    Registration.singleton(IDialogDomRenderer, this).register(container);\n  }\n\n  private readonly wrapperCss: string = `${baseWrapperCss} display:flex;`;\n  private readonly overlayCss: string = baseWrapperCss;\n  private readonly hostCss: string = 'position:relative;margin:auto;';\n\n  public render(dialogHost: HTMLElement): IDialogDom {\n    const doc = this.p.document;\n    const h = (name: string, css: string) => {\n      const el = doc.createElement(name);\n      el.style.cssText = css;\n      return el;\n    };\n    const wrapper = dialogHost.appendChild(h('au-dialog-container', this.wrapperCss));\n    const overlay = wrapper.appendChild(h('au-dialog-overlay', this.overlayCss));\n    const host = wrapper.appendChild(h('div', this.hostCss));\n    return new DefaultDialogDom(wrapper, overlay, host);\n  }\n}\n\nexport class DefaultDialogDom implements IDialogDom {\n  public constructor(\n    public readonly wrapper: HTMLElement,\n    public readonly overlay: HTMLElement,\n    public readonly contentHost: HTMLElement,\n  ) {\n  }\n\n  public dispose(): void {\n    this.wrapper.remove();\n  }\n}\n","import { IContainer, IRegistry, noop, Registration } from '@aurelia/kernel';\n\nimport { IDialogGlobalSettings } from './dialog-interfaces.js';\nimport { DefaultDialogGlobalSettings, DefaultDialogDomRenderer } from './dialog-default-impl.js';\nimport { AppTask } from '../../app-task.js';\nimport { DialogService } from './dialog-service.js';\n\nexport type DialogConfigurationProvider = (settings: IDialogGlobalSettings) => void | Promise<unknown>;\n\nexport interface DialogConfiguration extends IRegistry {\n  settingsProvider: DialogConfigurationProvider;\n  register(container: IContainer): IContainer;\n  customize(cb: DialogConfigurationProvider, registrations?: IRegistry[]): DialogConfiguration;\n}\n\nfunction createDialogConfiguration(settingsProvider: DialogConfigurationProvider, registrations: IRegistry[]): DialogConfiguration {\n  return {\n    settingsProvider: settingsProvider,\n    register: (ctn: IContainer) => ctn.register(\n      ...registrations,\n      AppTask.beforeCreate(() => settingsProvider(ctn.get(IDialogGlobalSettings)) as void)\n    ),\n    customize(cb: DialogConfigurationProvider, regs?: IRegistry[]) {\n      return createDialogConfiguration(cb, regs ?? registrations);\n    },\n  };\n}\n\n/**\n * A noop configuration for Dialog, should be used as:\n```ts\nDialogConfiguration.customize(settings => {\n  // adjust default value of the settings\n}, [all_implementations_here])\n```\n */\nexport const DialogConfiguration = createDialogConfiguration(() => {\n  throw new Error('Invalid dialog configuration. ' +\n    'Specify the implementations for ' +\n    '<IDialogService>, <IDialogGlobalSettings> and <IDialogDomRenderer>, ' +\n    'or use the DialogDefaultConfiguration export.'\n  );\n}, [class NoopDialogGlobalSettings {\n  public static register(container: IContainer): void {\n    container.register(Registration.singleton(IDialogGlobalSettings, this));\n  }\n}]);\n\nexport const DialogDefaultConfiguration = createDialogConfiguration(noop, [\n  DialogService,\n  DefaultDialogGlobalSettings,\n  DefaultDialogDomRenderer,\n]);\n"],"names":["Metadata","Protocol","getPrototypeChain","firstDefined","kebabCase","BindingMode","noop","oV","subscriberCollection","withFlushQueue","emptyArray","State","DI","all","Registration","DotSeparatedAttributePattern","RefAttributePattern","ColonPrefixedBindAttributePattern","AtPrefixedTriggerAttributePattern","$IPlatform","oneTime","toView","fromView","toViewOrOneTime","connectable","childObserverOptions","ChildrenObserver","mergeArrays","registerAliases","fromDefinitionOrDefault","pascalCase","fromAnnotationOrTypeOrDefault","fromAnnotationOrDefinitionOrTypeOrDefault","Scope","IContainer","ConnectableSwitcher","ProxyObservable","nextId","InstanceProvider","optional","ILogger","AccessScopeExpression","IObserverLocator","IExpressionParser","isObject","ViewModelKind","onResolve","resolveAll","NodeType","DelegationStrategy","InstructionType","BindingBehaviorExpression","BindingBehaviorFactory","OneTimeBindingCommand","camelCase","ToViewBindingCommand","FromViewBindingCommand","TwoWayBindingCommand","DefaultBindingCommand","CallBindingCommand","ForBindingCommand","TriggerBindingCommand","DelegateBindingCommand","CaptureBindingCommand","AttrBindingCommand","StyleBindingCommand","ClassBindingCommand","PrimitiveLiteralExpression","toArray","bindingBehavior","defaultDelay","BindingInterceptor","IPlatform","SignalBindingBehavior","ISignaler","AttrBindingBehavior","SelfBindingBehavior","defaultMatcher","PropertyAccessor","INodeObserverLocator","emptyObject","SetterObserver","IServiceLocator","IDirtyChecker","UpdateTriggerBindingBehavior","Focus","alias","Portal","If","Else","Repeat","applyMutationsToIndices","compareNumber","getCollectionObserver","BindingContext","synchronizeIndices","With","Switch","Case","DefaultCase","PromiseTemplateController","PendingTemplateController","FulfilledTemplateController","RejectedTemplateController","AuRender","AuCompose","transient","EmptyComponent","SanitizeValueConverter","valueConverter","ViewValueConverter","BrowserPlatform","DialogDeactivationStatuses"],"mappings":"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"}