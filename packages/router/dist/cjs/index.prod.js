Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@aurelia/kernel"),e=require("@aurelia/runtime-html"),n=require("@aurelia/route-recognizer");class i{constructor(t,e,n){this.stack=t,this.cb=e,this.done=!1,this.next=null,this.head=null!=n?n:this}static start(t){return new i(0,t,null)}push(){let t=this;do{++t.stack,t=t.next}while(null!==t)}pop(){let t=this;do{0==--t.stack&&t.invoke(),t=t.next}while(null!==t)}invoke(){const t=this.cb;null!==t&&(this.cb=null,t(this),this.done=!0)}continueWith(t){return null===this.next?this.next=new i(this.stack,t,this.head):this.next.continueWith(t)}start(){return this.head.push(),this.head.pop(),this}}function r(t,e){t=t.slice(),e=e.slice();const n=[];for(;t.length>0;){const i=t.shift();if(n.every((t=>t.context.vpa!==i.context.vpa))){const t=e.findIndex((t=>t.context.vpa===i.context.vpa));t>=0?n.push(...e.splice(0,t+1)):n.push(i)}}return n.push(...e),n}function o(t){try{return JSON.stringify(t)}catch(e){return Object.prototype.toString.call(t)}}function s(t){return"string"==typeof t?[t]:t}function a(t){return"object"==typeof t&&null!==t&&!e.isCustomElementViewModel(t)}function c(t){return a(t)&&!0===Object.prototype.hasOwnProperty.call(t,"name")}function l(t){return a(t)&&!0===Object.prototype.hasOwnProperty.call(t,"component")}function h(t){return a(t)&&!0===Object.prototype.hasOwnProperty.call(t,"redirectTo")}function u(t){return a(t)&&!0===Object.prototype.hasOwnProperty.call(t,"component")}function d(t,e,n){throw new Error(`Invalid route config property: "${e}". Expected ${t}, but got ${o(n)}.`)}function p(t,e){if(null==t)throw new Error(`Invalid route config: expected an object or string, but got: ${String(t)}.`);const n=Object.keys(t);for(const i of n){const n=t[i],r=[e,i].join(".");switch(i){case"id":case"viewport":case"redirectTo":"string"!=typeof n&&d("string",r,n);break;case"caseSensitive":"boolean"!=typeof n&&d("boolean",r,n);break;case"data":"object"==typeof n&&null!==n||d("object",r,n);break;case"title":switch(typeof n){case"string":case"function":break;default:d("string or function",r,n)}break;case"path":if(n instanceof Array)for(let t=0;t<n.length;++t)"string"!=typeof n[t]&&d("string",`${r}[${t}]`,n[t]);else"string"!=typeof n&&d("string or Array of strings",r,n);break;case"component":g(n,r);break;case"routes":n instanceof Array||d("Array",r,n);for(const t of n){g(t,`${r}[${n.indexOf(t)}]`)}break;case"transitionPlan":switch(typeof n){case"string":switch(n){case"none":case"replace":case"invoke-lifecycles":break;default:d("string('none'|'replace'|'invoke-lifecycles') or function",r,n)}break;case"function":break;default:d("string('none'|'replace'|'invoke-lifecycles') or function",r,n)}break;default:throw new Error(`Unknown route config property: "${e}.${i}". Please specify known properties only.`)}}}function g(t,n){switch(typeof t){case"function":break;case"object":if(t instanceof Promise)break;if(h(t)){!function(t,e){if(null==t)throw new Error(`Invalid route config: expected an object or string, but got: ${String(t)}.`);const n=Object.keys(t);for(const i of n){const n=t[i],r=[e,i].join(".");switch(i){case"path":case"redirectTo":"string"!=typeof n&&d("string",r,n);break;default:throw new Error(`Unknown redirect config property: "${e}.${i}". Only 'path' and 'redirectTo' should be specified for redirects.`)}}}(t,n);break}if(l(t)){p(t,n);break}e.isCustomElementViewModel(t)||c(t)||d("an object with at least a 'component' property (see Routeable)",n,t);break;case"string":break;default:d("function, object or string (see Routeable)",n,t)}}function f(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(null===t||null===e)return!1;if(Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(let r=0,o=n.length;r<o;++r){const o=n[r];if(o!==i[r])return!1;if(t[o]!==e[o])return!1}return!0}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function v(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}function m(t,e){return function(n,i){e(n,i,t)}}class w{constructor(t,e,n){this.events=t,this.serial=e,this.inner=n,this.disposed=!1}dispose(){if(!this.disposed){this.disposed=!0,this.inner.dispose();const t=this.events.subscriptions;t.splice(t.indexOf(this),1)}}}const x=t.DI.createInterface("IRouterEvents",(t=>t.singleton(y)));let y=class{constructor(t,e){this.ea=t,this.logger=e,this.subscriptionSerial=0,this.subscriptions=[],this.logger=e.scopeTo("RouterEvents")}publish(t){this.logger.trace("publishing %s",t),this.ea.publish(t.name,t)}subscribe(t,e){const n=new w(this,++this.subscriptionSerial,this.ea.subscribe(t,(i=>{this.logger.trace(`handling %s for subscription #${n.serial}`,t),e(i)})));return this.subscriptions.push(n),n}};y=v([m(0,t.IEventAggregator),m(1,t.ILogger)],y);class b{constructor(t,e,n,i){this.id=t,this.url=e,this.trigger=n,this.state=i}get name(){return"au:router:location-change"}toString(){return`LocationChangeEvent(id:${this.id},url:'${this.url}',trigger:'${this.trigger}')`}}class ${constructor(t,e,n,i){this.id=t,this.instructions=e,this.trigger=n,this.managedState=i}get name(){return"au:router:navigation-start"}toString(){return`NavigationStartEvent(id:${this.id},instructions:'${this.instructions}',trigger:'${this.trigger}')`}}class S{constructor(t,e,n){this.id=t,this.instructions=e,this.finalInstructions=n}get name(){return"au:router:navigation-end"}toString(){return`NavigationEndEvent(id:${this.id},instructions:'${this.instructions}',finalInstructions:'${this.finalInstructions}')`}}class C{constructor(t,e,n){this.id=t,this.instructions=e,this.reason=n}get name(){return"au:router:navigation-cancel"}toString(){return`NavigationCancelEvent(id:${this.id},instructions:'${this.instructions}',reason:${String(this.reason)})`}}const k=t.DI.createInterface("IBaseHrefProvider",(t=>t.singleton(R)));class E{constructor(t,e){this.path=t,this.rootedPath=e}}let R=class{constructor(t){this.window=t}getBaseHref(){var t;const e=this.window.document.head.querySelector("base");if(null===e)return null;const n=T(e.href),i=T(null!==(t=e.getAttribute("href"))&&void 0!==t?t:"");return new E(i,n)}};R=v([m(0,e.IWindow)],R);const A=t.DI.createInterface("ILocationManager",(t=>t.singleton(I)));let I=class{constructor(t,e,n,i,r,o){var s;this.logger=t,this.events=e,this.history=n,this.location=i,this.window=r,this.baseHrefProvider=o,this.eventId=0,this.logger=t.root.scopeTo("LocationManager");const a=o.getBaseHref();if(null===a){const t=null!==(s=i.origin)&&void 0!==s?s:"",e=this.baseHref=new E("",T(t));this.logger.warn(`no baseHref provided, defaulting to origin '${e.rootedPath}' (normalized from '${t}')`)}else this.baseHref=a,this.logger.debug(`baseHref set to path: '${a.path}', rootedPath: '${a.rootedPath}'`)}startListening(){this.logger.trace("startListening()"),this.window.addEventListener("popstate",this.onPopState,!1),this.window.addEventListener("hashchange",this.onHashChange,!1)}stopListening(){this.logger.trace("stopListening()"),this.window.removeEventListener("popstate",this.onPopState,!1),this.window.removeEventListener("hashchange",this.onHashChange,!1)}onPopState(t){this.logger.trace("onPopState()"),this.events.publish(new b(++this.eventId,this.getPath(),"popstate",t.state))}onHashChange(t){this.logger.trace("onHashChange()"),this.events.publish(new b(++this.eventId,this.getPath(),"hashchange",null))}pushState(t,e,n){n=this.addBaseHref(n);try{const i=JSON.stringify(t);this.logger.trace(`pushState(state:${i},title:'${e}',url:'${n}')`)}catch(t){this.logger.warn(`pushState(state:NOT_SERIALIZABLE,title:'${e}',url:'${n}')`)}this.history.pushState(t,e,n)}replaceState(t,e,n){n=this.addBaseHref(n);try{const i=JSON.stringify(t);this.logger.trace(`replaceState(state:${i},title:'${e}',url:'${n}')`)}catch(t){this.logger.warn(`replaceState(state:NOT_SERIALIZABLE,title:'${e}',url:'${n}')`)}this.history.replaceState(t,e,n)}getPath(){const{pathname:t,search:e,hash:n}=this.location,i=this.removeBaseHref(`${t}${r=e,r.length>0&&!r.startsWith("?")?`?${r}`:r}${n}`);var r;return this.logger.trace(`getPath() -> '${i}'`),i}currentPathEquals(t){const e=this.getPath()===this.removeBaseHref(t);return this.logger.trace(`currentPathEquals(path:'${t}') -> ${e}`),e}addBaseHref(t){const e=t;let n,i=this.baseHref.rootedPath;return i.endsWith("/")&&(i=i.slice(0,-1)),0===i.length?n=t:(t.startsWith("/")&&(t=t.slice(1)),n=`${i}/${t}`),this.logger.trace(`addBaseHref(path:'${e}') -> '${n}'`),n}removeBaseHref(t){const e=t;return t.startsWith(this.baseHref.path)&&(t=t.slice(this.baseHref.path.length)),t=T(t),this.logger.trace(`removeBaseHref(path:'${e}') -> '${t}'`),t}};function T(t){let e,n,i;return(i=t.indexOf("?"))>=0||(i=t.indexOf("#"))>=0?(e=t.slice(0,i),n=t.slice(i)):(e=t,n=""),e.endsWith("/")?e=e.slice(0,-1):e.endsWith("/index.html")&&(e=e.slice(0,-11)),`${e}${n}`}v([t.bound],I.prototype,"onPopState",null),v([t.bound],I.prototype,"onHashChange",null),I=v([m(0,t.ILogger),m(1,x),m(2,e.IHistory),m(3,e.ILocation),m(4,e.IWindow),m(5,k)],I);class P{constructor(t,e,n,i){this.viewportName=t,this.componentName=e,this.resolution=n,this.append=i}static create(t){return new P(t.viewportName,t.componentName,t.resolution,t.append)}toString(){return`VR(viewport:'${this.viewportName}',component:'${this.componentName}',resolution:'${this.resolution}',append:${this.append})`}}const N=new WeakMap;class L{constructor(e,n,i){this.viewport=e,this.hostController=n,this.ctx=i,this.isActive=!1,this.curCA=null,this.nextCA=null,this.state=8256,this.$resolution="dynamic",this.$plan="replace",this.currNode=null,this.nextNode=null,this.currTransition=null,this.prevTransition=null,this.logger=i.container.get(t.ILogger).scopeTo(`ViewportAgent<${i.friendlyPath}>`),this.logger.trace("constructor()")}get $state(){return function(t){let e=O.get(t);void 0===e&&O.set(t,e=function(t){const e=[];8192==(8192&t)&&e.push("currIsEmpty");4096==(4096&t)&&e.push("currIsActive");2048==(2048&t)&&e.push("currCanUnload");1024==(1024&t)&&e.push("currCanUnloadDone");512==(512&t)&&e.push("currUnload");256==(256&t)&&e.push("currUnloadDone");128==(128&t)&&e.push("currDeactivate");64==(64&t)&&e.push("nextIsEmpty");32==(32&t)&&e.push("nextIsScheduled");16==(16&t)&&e.push("nextCanLoad");8==(8&t)&&e.push("nextCanLoadDone");4==(4&t)&&e.push("nextLoad");2==(2&t)&&e.push("nextLoadDone");1==(1&t)&&e.push("nextActivate");return e.join("|")}(t));return e}(this.state)}get currState(){return 16256&this.state}set currState(t){this.state=127&this.state|t}get nextState(){return 127&this.state}set nextState(t){this.state=16256&this.state|t}static for(t,n){let i=N.get(t);if(void 0===i){const r=e.Controller.getCachedOrThrow(t);N.set(t,i=new L(t,r,n))}return i}activateFromViewport(t,e,n){const r=this.currTransition;switch(null!==r&&V(r),this.isActive=!0,this.nextState){case 64:switch(this.currState){case 8192:return void this.logger.trace("activateFromViewport() - nothing to activate at %s",this);case 4096:return this.logger.trace("activateFromViewport() - activating existing componentAgent at %s",this),this.curCA.activate(t,e,n);default:this.unexpectedState("activateFromViewport 1")}case 2:{if(null===this.currTransition)throw new Error(`Unexpected viewport activation outside of a transition context at ${this}`);if("static"!==this.$resolution)throw new Error(`Unexpected viewport activation at ${this}`);this.logger.trace("activateFromViewport() - running ordinary activate at %s",this);const e=i.start((e=>{this.activate(t,this.currTransition,e)})),n=new Promise((t=>{e.continueWith((()=>{t()}))}));return e.start().done?void 0:n}default:this.unexpectedState("activateFromViewport 2")}}deactivateFromViewport(t,e,n){const r=this.currTransition;switch(null!==r&&V(r),this.isActive=!1,this.currState){case 8192:return void this.logger.trace("deactivateFromViewport() - nothing to deactivate at %s",this);case 4096:return this.logger.trace("deactivateFromViewport() - deactivating existing componentAgent at %s",this),this.curCA.deactivate(t,e,n);case 128:return void this.logger.trace("deactivateFromViewport() - already deactivating at %s",this);default:{if(null===this.currTransition)throw new Error(`Unexpected viewport deactivation outside of a transition context at ${this}`);this.logger.trace("deactivateFromViewport() - running ordinary deactivate at %s",this);const e=i.start((e=>{this.deactivate(t,this.currTransition,e)})),n=new Promise((t=>{e.continueWith((()=>{t()}))}));return e.start().done?void 0:n}}}handles(t){return!!this.isAvailable(t.resolution)&&(t.append&&4096===this.currState?(this.logger.trace("handles(req:%s) -> false (append mode, viewport already has content %s)",t,this.curCA),!1):t.viewportName.length>0&&this.viewport.name!==t.viewportName?(this.logger.trace("handles(req:%s) -> false (names don't match)",t),!1):this.viewport.usedBy.length>0&&!this.viewport.usedBy.split(",").includes(t.componentName)?(this.logger.trace("handles(req:%s) -> false (componentName not included in usedBy)",t),!1):(this.logger.trace("handles(req:%s) -> true",t),!0))}isAvailable(t){return"dynamic"!==t||this.isActive?64===this.nextState||(this.logger.trace("isAvailable(resolution:%s) -> false (update already scheduled for %s)",t,this.nextNode),!1):(this.logger.trace("isAvailable(resolution:%s) -> false (viewport is not active and we're in dynamic resolution resolution)",t),!1)}canUnload(t,e){null===this.currTransition&&(this.currTransition=t),V(t),!0===t.guardsResult&&(e.push(),i.start((e=>{this.logger.trace("canUnload() - invoking on children at %s",this);for(const n of this.currNode.children)n.context.vpa.canUnload(t,e)})).continueWith((e=>{switch(this.currState){case 4096:switch(this.logger.trace("canUnload() - invoking on existing component at %s",this),this.$plan){case"none":return void(this.currState=1024);case"invoke-lifecycles":case"replace":return this.currState=2048,e.push(),void i.start((e=>{this.logger.trace("canUnload() - finished invoking on children, now invoking on own component at %s",this),this.curCA.canUnload(t,this.nextNode,e)})).continueWith((()=>{this.logger.trace("canUnload() - finished at %s",this),this.currState=1024,e.pop()})).start()}case 8192:return void this.logger.trace("canUnload() - nothing to unload at %s",this);default:t.handleError(new Error(`Unexpected state at canUnload of ${this}`))}})).continueWith((()=>{e.pop()})).start())}canLoad(e,n){null===this.currTransition&&(this.currTransition=e),V(e),!0===e.guardsResult&&(n.push(),i.start((t=>{switch(this.nextState){case 32:switch(this.logger.trace("canLoad() - invoking on new component at %s",this),this.nextState=16,this.$plan){case"none":return;case"invoke-lifecycles":return this.curCA.canLoad(e,this.nextNode,t);case"replace":return this.nextCA=this.nextNode.context.createComponentAgent(this.hostController,this.nextNode),this.nextCA.canLoad(e,this.nextNode,t)}case 64:return void this.logger.trace("canLoad() - nothing to load at %s",this);default:this.unexpectedState("canLoad")}})).continueWith((e=>{const n=this.nextNode;switch(this.$plan){case"none":case"invoke-lifecycles":return this.logger.trace("canLoad(next:%s) - plan set to '%s', compiling residue",n,this.$plan),e.push(),void t.onResolve(ot(n),(()=>{e.pop()}));case"replace":switch(this.$resolution){case"dynamic":return void this.logger.trace("canLoad(next:%s) - (resolution: 'dynamic'), delaying residue compilation until activate",n,this.$plan);case"static":return this.logger.trace(`canLoad(next:%s) - (resolution: '${this.$resolution}'), creating nextCA and compiling residue`,n,this.$plan),e.push(),void t.onResolve(ot(n),(()=>{e.pop()}))}}})).continueWith((t=>{switch(this.nextState){case 16:this.logger.trace("canLoad() - finished own component, now invoking on children at %s",this),this.nextState=8;for(const n of this.nextNode.children)n.context.vpa.canLoad(e,t);return;case 64:return;default:this.unexpectedState("canLoad")}})).continueWith((()=>{this.logger.trace("canLoad() - finished at %s",this),n.pop()})).start())}unload(t,e){V(t),U(this,t),e.push(),i.start((e=>{this.logger.trace("unload() - invoking on children at %s",this);for(const n of this.currNode.children)n.context.vpa.unload(t,e)})).continueWith((n=>{switch(this.currState){case 1024:switch(this.logger.trace("unload() - invoking on existing component at %s",this),this.$plan){case"none":return void(this.currState=256);case"invoke-lifecycles":case"replace":return this.currState=512,n.push(),void i.start((e=>{this.logger.trace("unload() - finished invoking on children, now invoking on own component at %s",this),this.curCA.unload(t,this.nextNode,e)})).continueWith((()=>{this.logger.trace("unload() - finished at %s",this),this.currState=256,n.pop()})).start()}case 8192:this.logger.trace("unload() - nothing to unload at %s",this);for(const n of this.currNode.children)n.context.vpa.unload(t,e);return;default:this.unexpectedState("unload")}})).continueWith((()=>{e.pop()})).start()}load(t,e){V(t),U(this,t),e.push(),i.start((e=>{switch(this.nextState){case 8:switch(this.logger.trace("load() - invoking on new component at %s",this),this.nextState=4,this.$plan){case"none":return;case"invoke-lifecycles":return this.curCA.load(t,this.nextNode,e);case"replace":return this.nextCA.load(t,this.nextNode,e)}case 64:return void this.logger.trace("load() - nothing to load at %s",this);default:this.unexpectedState("load")}})).continueWith((e=>{switch(this.nextState){case 4:this.logger.trace("load() - finished own component, now invoking on children at %s",this),this.nextState=2;for(const n of this.nextNode.children)n.context.vpa.load(t,e);return;case 64:return;default:this.unexpectedState("load")}})).continueWith((()=>{this.logger.trace("load() - finished at %s",this),e.pop()})).start()}deactivate(t,e,n){switch(V(e),U(this,e),n.push(),this.currState){case 256:switch(this.logger.trace("deactivate() - invoking on existing component at %s",this),this.currState=128,this.$plan){case"none":case"invoke-lifecycles":return void n.pop();case"replace":{const i=this.hostController,r=this.viewport.stateful?0:32;e.run((()=>this.curCA.deactivate(t,i,r)),(()=>{n.pop()}))}}return;case 8192:return this.logger.trace("deactivate() - nothing to deactivate at %s",this),void n.pop();case 128:return this.logger.trace("deactivate() - already deactivating at %s",this),void n.pop();default:this.unexpectedState("deactivate")}}activate(t,e,n){if(V(e),U(this,e),n.push(),32===this.nextState&&"dynamic"===this.$resolution)return this.logger.trace("activate() - invoking canLoad(), load() and activate() on new component due to resolution 'dynamic' at %s",this),void i.start((t=>{this.canLoad(e,t)})).continueWith((t=>{this.load(e,t)})).continueWith((n=>{this.activate(t,e,n)})).continueWith((()=>{n.pop()})).start();switch(this.nextState){case 2:return this.logger.trace("activate() - invoking on existing component at %s",this),this.nextState=1,void i.start((n=>{switch(this.$plan){case"none":case"invoke-lifecycles":return;case"replace":{const i=this.hostController,r=0;e.run((()=>(n.push(),this.nextCA.activate(t,i,r))),(()=>{n.pop()}))}}})).continueWith((t=>{this.processDynamicChildren(e,t)})).continueWith((()=>{n.pop()})).start();case 64:return this.logger.trace("activate() - nothing to activate at %s",this),void n.pop();default:this.unexpectedState("activate")}}swap(t,e){if(8192===this.currState)return this.logger.trace("swap() - running activate on next instead, because there is nothing to deactivate at %s",this),void this.activate(null,t,e);if(64===this.nextState)return this.logger.trace("swap() - running deactivate on current instead, because there is nothing to activate at %s",this),void this.deactivate(null,t,e);switch(V(t),U(this,t),256===this.currState&&2===this.nextState||this.unexpectedState("swap"),this.currState=128,this.nextState=1,this.$plan){case"none":case"invoke-lifecycles":{this.logger.trace("swap() - skipping this level and swapping children instead at %s",this);const n=r(this.nextNode.children,this.currNode.children);for(const i of n)i.context.vpa.swap(t,e);return}case"replace":{this.logger.trace("swap() - running normally at %s",this);const n=this.hostController,r=this.curCA,o=this.nextCA,s=this.viewport.stateful?0:32,a=0;switch(e.push(),t.options.swapStrategy){case"sequential-add-first":return void i.start((e=>{t.run((()=>(e.push(),o.activate(null,n,a))),(()=>{e.pop()}))})).continueWith((e=>{this.processDynamicChildren(t,e)})).continueWith((()=>{t.run((()=>r.deactivate(null,n,s)),(()=>{e.pop()}))})).start();case"sequential-remove-first":return void i.start((e=>{t.run((()=>(e.push(),r.deactivate(null,n,s))),(()=>{e.pop()}))})).continueWith((e=>{t.run((()=>(e.push(),o.activate(null,n,a))),(()=>{e.pop()}))})).continueWith((e=>{this.processDynamicChildren(t,e)})).continueWith((()=>{e.pop()})).start();case"parallel-remove-first":return t.run((()=>(e.push(),r.deactivate(null,n,s))),(()=>{e.pop()})),void i.start((e=>{t.run((()=>(e.push(),o.activate(null,n,a))),(()=>{e.pop()}))})).continueWith((e=>{this.processDynamicChildren(t,e)})).continueWith((()=>{e.pop()})).start()}}}}processDynamicChildren(e,n){this.logger.trace("processDynamicChildren() - %s",this);const r=this.nextNode;e.run((()=>(n.push(),function(e){const n=e.context,i=n.container.get(t.ILogger).scopeTo("RouteTree");return i.trace(`getDynamicChildren(node:%s)${n.resolved instanceof Promise?" - awaiting promise":""}`,e),t.onResolve(n.resolved,(()=>{const r=e.children.slice();return t.onResolve(t.resolveAll(...e.residue.splice(0).map((t=>st(i,e,t,e.append))),...n.getAvailableViewportAgents("dynamic").map((t=>{const n=xt.create({component:t.viewport.default,viewport:t.viewport.name});return st(i,e,n,e.append)}))),(()=>e.children.filter((t=>!r.includes(t)))))}))}(r))),(t=>{i.start((n=>{for(const i of t)e.run((()=>(n.push(),i.context.vpa.canLoad(e,n))),(()=>{n.pop()}))})).continueWith((n=>{for(const i of t)e.run((()=>(n.push(),i.context.vpa.load(e,n))),(()=>{n.pop()}))})).continueWith((n=>{for(const i of t)e.run((()=>(n.push(),i.context.vpa.activate(null,e,n))),(()=>{n.pop()}))})).continueWith((()=>{n.pop()})).start()}))}scheduleUpdate(t,e){var n,i;switch(this.nextState){case 64:this.nextNode=e,this.nextState=32,this.$resolution=t.resolutionMode;break;default:this.unexpectedState("scheduleUpdate 1")}switch(this.currState){case 8192:case 4096:case 1024:break;default:this.unexpectedState("scheduleUpdate 2")}const r=null!==(i=null===(n=this.curCA)||void 0===n?void 0:n.routeNode)&&void 0!==i?i:null;if(null===r||r.component!==e.component)this.$plan="replace";else{const t=e.context.definition.config.transitionPlan;this.$plan="function"==typeof t?t(r,e):t}this.logger.trace("scheduleUpdate(next:%s) - plan set to '%s'",e,this.$plan)}cancelUpdate(){switch(null!==this.currNode&&this.currNode.children.forEach((function(t){t.context.vpa.cancelUpdate()})),null!==this.nextNode&&this.nextNode.children.forEach((function(t){t.context.vpa.cancelUpdate()})),this.logger.trace("cancelUpdate(nextNode:%s)",this.nextNode),this.currState){case 8192:case 4096:break;case 2048:case 1024:this.currState=4096}switch(this.nextState){case 64:case 32:case 16:case 8:this.nextNode=null,this.nextState=64}}endTransition(){if(null!==this.currNode&&this.currNode.children.forEach((function(t){t.context.vpa.endTransition()})),null!==this.nextNode&&this.nextNode.children.forEach((function(t){t.context.vpa.endTransition()})),null!==this.currTransition){switch(V(this.currTransition),this.nextState){case 64:switch(this.currState){case 128:this.logger.trace("endTransition() - setting currState to State.nextIsEmpty at %s",this),this.currState=8192,this.curCA=null;break;default:this.unexpectedState("endTransition 1")}break;case 1:switch(this.currState){case 8192:case 128:switch(this.$plan){case"none":case"invoke-lifecycles":this.logger.trace("endTransition() - setting currState to State.currIsActive at %s",this),this.currState=4096;break;case"replace":this.logger.trace("endTransition() - setting currState to State.currIsActive and reassigning curCA at %s",this),this.currState=4096,this.curCA=this.nextCA}this.currNode=this.nextNode;break;default:this.unexpectedState("endTransition 2")}break;default:this.unexpectedState("endTransition 3")}this.$plan="replace",this.nextState=64,this.nextNode=null,this.nextCA=null,this.prevTransition=this.currTransition,this.currTransition=null}}toString(){return`VPA(state:${this.$state},plan:'${this.$plan}',resolution:'${this.$resolution}',n:${this.nextNode},c:${this.currNode},viewport:${this.viewport})`}dispose(){var t;this.viewport.stateful?this.logger.trace("dispose() - not disposing stateful viewport at %s",this):(this.logger.trace("dispose() - disposing %s",this),null===(t=this.curCA)||void 0===t||t.dispose())}unexpectedState(t){throw new Error(`Unexpected state at ${t} of ${this}`)}}function U(t,e){if(!0!==e.guardsResult)throw new Error(`Unexpected guardsResult ${e.guardsResult} at ${t}`)}function V(t){if(void 0!==t.error)throw t.error}var M;!function(t){t[t.curr=16256]="curr",t[t.currIsEmpty=8192]="currIsEmpty",t[t.currIsActive=4096]="currIsActive",t[t.currCanUnload=2048]="currCanUnload",t[t.currCanUnloadDone=1024]="currCanUnloadDone",t[t.currUnload=512]="currUnload",t[t.currUnloadDone=256]="currUnloadDone",t[t.currDeactivate=128]="currDeactivate",t[t.next=127]="next",t[t.nextIsEmpty=64]="nextIsEmpty",t[t.nextIsScheduled=32]="nextIsScheduled",t[t.nextCanLoad=16]="nextCanLoad",t[t.nextCanLoadDone=8]="nextCanLoadDone",t[t.nextLoad=4]="nextLoad",t[t.nextLoadDone=2]="nextLoadDone",t[t.nextActivate=1]="nextActivate",t[t.bothAreEmpty=8256]="bothAreEmpty"}(M||(M={}));const O=new Map;const j=["?","#","/","+","(",")",".","@","!","=",",","&","'","~",";"];class H{constructor(t){this.input=t,this.buffers=[],this.bufferIndex=0,this.index=0,this.rest=t}get done(){return 0===this.rest.length}startsWith(...t){const e=this.rest;return t.some((function(t){return e.startsWith(t)}))}consumeOptional(t){return!!this.startsWith(t)&&(this.rest=this.rest.slice(t.length),this.index+=t.length,this.append(t),!0)}consume(t){this.consumeOptional(t)||this.expect(`'${t}'`)}expect(t){throw new Error(`Expected ${t} at index ${this.index} of '${this.input}', but got: '${this.rest}' (rest='${this.rest}')`)}ensureDone(){if(!this.done)throw new Error(`Unexpected '${this.rest}' at index ${this.index} of '${this.input}'`)}advance(){const t=this.rest[0];this.rest=this.rest.slice(1),++this.index,this.append(t)}record(){this.buffers[this.bufferIndex++]=""}playback(){const t=--this.bufferIndex,e=this.buffers,n=e[t];return e[t]="",n}discard(){this.buffers[--this.bufferIndex]=""}append(t){const e=this.bufferIndex,n=this.buffers;for(let i=0;i<e;++i)n[i]+=t}}var D;exports.ExpressionKind=void 0,(D=exports.ExpressionKind||(exports.ExpressionKind={}))[D.Route=0]="Route",D[D.CompositeSegment=1]="CompositeSegment",D[D.ScopedSegment=2]="ScopedSegment",D[D.SegmentGroup=3]="SegmentGroup",D[D.Segment=4]="Segment",D[D.Component=5]="Component",D[D.Action=6]="Action",D[D.Viewport=7]="Viewport",D[D.ParameterList=8]="ParameterList",D[D.Parameter=9]="Parameter";const W=new Map,q=new Map;class z{constructor(t,e,n,i,r,o){this.raw=t,this.isAbsolute=e,this.root=n,this.queryParams=i,this.fragment=r,this.fragmentIsRoute=o}get kind(){return 0}static parse(t,e){const n=e?W:q;let i=n.get(t);return void 0===i&&n.set(t,i=z.$parse(t,e)),i}static $parse(t,e){let n;const i=t.indexOf("#");if(i>=0){const r=t.slice(i+1);n=decodeURIComponent(r),t=e?n:t.slice(0,i)}else e&&(t=""),n=null;let r=null;const o=t.indexOf("?");if(o>=0){const e=t.slice(o+1);t=t.slice(0,o),r=new URLSearchParams(e)}if(""===t)return new z("",!1,Y.EMPTY,Object.freeze(null!=r?r:new URLSearchParams),n,e);const s=new H(t);s.record();const a=s.consumeOptional("/"),c=_.parse(s);s.ensureDone();const l=s.playback();return new z(l,a,c,Object.freeze(null!=r?r:new URLSearchParams),n,e)}toInstructionTree(t){return new bt(t,this.isAbsolute,this.root.toInstructions(t.append,0,0),this.queryParams,this.fragment)}toString(){return this.raw}}class _{constructor(t,e,n){this.raw=t,this.siblings=e,this.append=n}get kind(){return 1}static parse(t){t.record();const e=t.consumeOptional("+"),n=[];do{n.push(F.parse(t))}while(t.consumeOptional("+"));if(!e&&1===n.length)return t.discard(),n[0];const i=t.playback();return new _(i,n,e)}toInstructions(t,e,n){switch(this.siblings.length){case 0:return[];case 1:return this.siblings[0].toInstructions(t,e,n);case 2:return[...this.siblings[0].toInstructions(t,e,0),...this.siblings[1].toInstructions(t,0,n)];default:return[...this.siblings[0].toInstructions(t,e,0),...this.siblings.slice(1,-1).flatMap((function(e){return e.toInstructions(t,0,0)})),...this.siblings[this.siblings.length-1].toInstructions(t,0,n)]}}toString(){return this.raw}}class F{constructor(t,e,n){this.raw=t,this.left=e,this.right=n}get kind(){return 2}static parse(t){t.record();const e=B.parse(t);if(t.consumeOptional("/")){const n=F.parse(t),i=t.playback();return new F(i,e,n)}return t.discard(),e}toInstructions(t,e,n){const i=this.left.toInstructions(t,e,0),r=this.right.toInstructions(!1,0,n);let o=i[i.length-1];for(;o.children.length>0;)o=o.children[o.children.length-1];return o.children.push(...r),i}toString(){return this.raw}}class B{constructor(t,e){this.raw=t,this.expression=e}get kind(){return 3}static parse(t){if(t.record(),t.consumeOptional("(")){const e=_.parse(t);t.consume(")");const n=t.playback();return new B(n,e)}return t.discard(),Y.parse(t)}toInstructions(t,e,n){return this.expression.toInstructions(t,e+1,n+1)}toString(){return this.raw}}class Y{constructor(t,e,n,i,r){this.raw=t,this.component=e,this.action=n,this.viewport=i,this.scoped=r}get kind(){return 4}static get EMPTY(){return new Y("",K.EMPTY,G.EMPTY,J.EMPTY,!0)}static parse(t){t.record();const e=K.parse(t),n=G.parse(t),i=J.parse(t),r=!t.consumeOptional("!"),o=t.playback();return new Y(o,e,n,i,r)}toInstructions(t,e,n){return[xt.create({component:this.component.name,params:this.component.parameterList.toObject(),viewport:this.viewport.name,append:t,open:e,close:n})]}toString(){return this.raw}}class K{constructor(t,e,n){switch(this.raw=t,this.name=e,this.parameterList=n,e.charAt(0)){case":":this.isParameter=!0,this.isStar=!1,this.isDynamic=!0,this.parameterName=e.slice(1);break;case"*":this.isParameter=!1,this.isStar=!0,this.isDynamic=!0,this.parameterName=e.slice(1);break;default:this.isParameter=!1,this.isStar=!1,this.isDynamic=!1,this.parameterName=e}}get kind(){return 5}static get EMPTY(){return new K("","",Q.EMPTY)}static parse(t){if(t.record(),t.record(),!t.done)if(t.startsWith("./"))t.advance();else if(t.startsWith("../"))t.advance(),t.advance();else for(;!t.done&&!t.startsWith(...j);)t.advance();const e=decodeURIComponent(t.playback());0===e.length&&t.expect("component name");const n=Q.parse(t),i=t.playback();return new K(i,e,n)}toString(){return this.raw}}class G{constructor(t,e,n){this.raw=t,this.name=e,this.parameterList=n}get kind(){return 6}static get EMPTY(){return new G("","",Q.EMPTY)}static parse(t){t.record();let e="";if(t.consumeOptional(".")){for(t.record();!t.done&&!t.startsWith(...j);)t.advance();e=decodeURIComponent(t.playback()),0===e.length&&t.expect("method name")}const n=Q.parse(t),i=t.playback();return new G(i,e,n)}toString(){return this.raw}}class J{constructor(t,e){this.raw=t,this.name=e}get kind(){return 7}static get EMPTY(){return new J("","")}static parse(t){t.record();let e="";if(t.consumeOptional("@")){for(t.record();!t.done&&!t.startsWith(...j);)t.advance();e=decodeURIComponent(t.playback()),0===e.length&&t.expect("viewport name")}const n=t.playback();return new J(n,e)}toString(){return this.raw}}class Q{constructor(t,e){this.raw=t,this.expressions=e}get kind(){return 8}static get EMPTY(){return new Q("",[])}static parse(t){t.record();const e=[];if(t.consumeOptional("(")){do{if(e.push(Z.parse(t,e.length)),!t.consumeOptional(","))break}while(!t.done&&!t.startsWith(")"));t.consume(")")}const n=t.playback();return new Q(n,e)}toObject(){const t={};for(const e of this.expressions)t[e.key]=e.value;return t}toString(){return this.raw}}class Z{constructor(t,e,n){this.raw=t,this.key=e,this.value=n}get kind(){return 9}static get EMPTY(){return new Z("","","")}static parse(t,e){for(t.record(),t.record();!t.done&&!t.startsWith(...j);)t.advance();let n,i=decodeURIComponent(t.playback());if(0===i.length&&t.expect("parameter key"),t.consumeOptional("=")){for(t.record();!t.done&&!t.startsWith(...j);)t.advance();n=decodeURIComponent(t.playback()),0===n.length&&t.expect("parameter value")}else n=i,i=e.toString();const r=t.playback();return new Z(r,i,n)}toString(){return this.raw}}const X=Object.freeze({RouteExpression:z,CompositeSegmentExpression:_,ScopedSegmentExpression:F,SegmentGroupExpression:B,SegmentExpression:Y,ComponentExpression:K,ActionExpression:G,ViewportExpression:J,ParameterListExpression:Q,ParameterExpression:Z});let tt=0;class et{constructor(t,e,n,i,r,o,s,a,c,l,h,u,d,p,g,f){this.id=t,this.path=e,this.finalPath=n,this.context=i,this.originalInstruction=r,this.instruction=o,this.params=s,this.queryParams=a,this.fragment=c,this.data=l,this.viewport=h,this.title=u,this.component=d,this.append=p,this.children=g,this.residue=f,this.version=1,this.originalInstruction=o}get root(){return this.tree.root}static create(t){var e,n,i,r,o,s,a,c;return new et(++tt,t.path,t.finalPath,t.context,t.instruction,t.instruction,null!==(e=t.params)&&void 0!==e?e:{},null!==(n=t.queryParams)&&void 0!==n?n:Object.freeze(new URLSearchParams),null!==(i=t.fragment)&&void 0!==i?i:null,null!==(r=t.data)&&void 0!==r?r:{},null!==(o=t.viewport)&&void 0!==o?o:null,null!==(s=t.title)&&void 0!==s?s:null,t.component,t.append,null!==(a=t.children)&&void 0!==a?a:[],null!==(c=t.residue)&&void 0!==c?c:[])}contains(t){var e,n;if(this.context===t.options.context){const i=this.children,r=t.children;for(let t=0,o=i.length;t<o;++t)for(let s=0,a=r.length;s<a&&(t+s<o&&null!==(n=null===(e=i[t+s].instruction)||void 0===e?void 0:e.contains(r[s]))&&void 0!==n&&n);++s)if(s+1===a)return!0}return this.children.some((function(e){return e.contains(t)}))}appendChild(t){this.children.push(t),t.setTree(this.tree)}appendChildren(...t){for(const e of t)this.appendChild(e)}clearChildren(){for(const t of this.children)t.clearChildren(),t.context.vpa.cancelUpdate();this.children.length=0}getTitle(t){const e=[...this.children.map((e=>e.getTitle(t))),this.getTitlePart()].filter((t=>null!==t));return 0===e.length?null:e.join(t)}getTitlePart(){return"function"==typeof this.title?this.title.call(void 0,this):this.title}computeAbsolutePath(){if(this.context.isRoot)return"";const t=this.context.parent.node.computeAbsolutePath(),e=this.instruction.toUrlComponent(!1);return t.length>0?e.length>0?[t,e].join("/"):t:e}setTree(t){this.tree=t;for(const e of this.children)e.setTree(t)}finalizeInstruction(){const t=this.children.map((t=>t.finalizeInstruction())),e=this.instruction.clone();return e.children.splice(0,e.children.length,...t),this.instruction=e}clone(){const t=new et(this.id,this.path,this.finalPath,this.context,this.originalInstruction,this.instruction,{...this.params},{...this.queryParams},this.fragment,{...this.data},this.viewport,this.title,this.component,this.append,this.children.map((t=>t.clone())),[...this.residue]);return t.version=this.version+1,t.context.node===this&&(t.context.node=t),t}toString(){var t,e,n,i,r;const o=[],s=null!==(n=null===(e=null===(t=this.context)||void 0===t?void 0:t.definition.component)||void 0===e?void 0:e.name)&&void 0!==n?n:"";s.length>0&&o.push(`c:'${s}'`);const a=null!==(r=null===(i=this.context)||void 0===i?void 0:i.definition.config.path)&&void 0!==r?r:"";return a.length>0&&o.push(`path:'${a}'`),this.children.length>0&&o.push(`children:[${this.children.map(String).join(",")}]`),this.residue.length>0&&o.push(`residue:${this.residue.map((function(t){return"string"==typeof t?`'${t}'`:String(t)})).join(",")}`),`RN(ctx:'${this.context.friendlyPath}',${o.join(",")})`}}class nt{constructor(t,e,n,i){this.options=t,this.queryParams=e,this.fragment=n,this.root=i}contains(t){return this.root.contains(t)}clone(){const t=new nt(this.options.clone(),{...this.queryParams},this.fragment,this.root.clone());return t.root.setTree(this),t}finalizeInstructions(){return new bt(this.options,!0,this.root.children.map((t=>t.finalizeInstruction())),this.queryParams,this.fragment)}toString(){return this.root.toString()}}function it(e,n,i){const r=i.container.get(t.ILogger).scopeTo("RouteTree"),o=i.root;e.options=n.options,e.queryParams=n.queryParams,e.fragment=n.fragment,n.isAbsolute&&(i=o),i===o&&(e.root.setTree(e),o.node=e.root);return r.trace(`updateRouteTree(rootCtx:%s,rt:%s,vit:%s)${i.resolved instanceof Promise?" - awaiting promise":""}`,o,e,n),t.onResolve(i.resolved,(()=>rt(r,n,i,o.node)))}function rt(e,n,i,r){let o;return e.trace("updateNode(ctx:%s,node:%s)",i,r),r.queryParams=n.queryParams,r.fragment=n.fragment,o=r.context.isRoot?void 0:r.context.vpa.scheduleUpdate(r.tree.options,r),t.onResolve(o,(()=>r.context===i?(r.clearChildren(),t.onResolve(t.resolveAll(...n.children.map((t=>st(e,r,t,r.tree.options.append||t.append)))),(()=>t.resolveAll(...i.getAvailableViewportAgents("dynamic").map((t=>{const n=xt.create({component:t.viewport.default,viewport:t.viewport.name});return st(e,r,n,r.append)})))))):t.resolveAll(...r.children.map((t=>rt(e,n,i,t))))))}function ot(e){const n=e.context,i=n.container.get(t.ILogger).scopeTo("RouteTree");return i.trace(`processResidue(node:%s)${n.resolved instanceof Promise?" - awaiting promise":""}`,e),t.onResolve(n.resolved,(()=>t.resolveAll(...e.residue.splice(0).map((t=>st(i,e,t,e.append))),...n.getAvailableViewportAgents("static").map((t=>{const n=xt.create({component:t.viewport.default,viewport:t.viewport.name});return st(i,e,n,e.append)})))))}function st(n,i,r,o){var s,a;switch(n.trace(`createAndAppendNodes(node:%s,vi:%s,append:${o})`,i,r),r.component.type){case 0:switch(r.component.value){case"..":i.clearChildren(),i=null!==(a=null===(s=i.context.parent)||void 0===s?void 0:s.node)&&void 0!==a?a:i;case".":return t.resolveAll(...r.children.map((t=>st(n,i,t,t.append))));default:{const t=function(t,n,i,r){const o=n.context;let s=0,a=i.component.value,c=i;for(;1===c.children.length&&(c=c.children[0],0===c.component.type);)++s,a=`${a}/${c.component.value}`;const l=o.recognize(a);if(null===l){const s=i.component.value;let a=o.container.find(e.CustomElement,s);switch(n.tree.options.routingMode){case"configured-only":if(null===a){if(""===s)return null;throw new Error(`'${s}' did not match any configured route or registered component name at '${o.friendlyPath}' - did you forget to add '${s}' to the routes list of the route decorator of '${o.component.name}'?`)}throw new Error(`'${s}' did not match any configured route, but it does match a registered component name at '${o.friendlyPath}' - did you forget to add a @route({ path: '${s}' }) decorator to '${s}' or unintentionally set routingMode to 'configured-only'?`);case"configured-first":if(null===a){if(""===s)return null;const t=null===i.viewport||0===i.viewport.length?"default":i.viewport,n=o.getFallbackViewportAgent("dynamic",t);if(null===n)throw new Error(`'${s}' did not match any configured route or registered component name at '${o.friendlyPath}' and no fallback was provided for viewport '${t}' - did you forget to add the component '${s}' to the dependencies of '${o.component.name}' or to register it as a global dependency?`);const r=n.viewport.fallback;if(a=o.container.find(e.CustomElement,r),null===a)throw new Error(`the requested component '${s}' and the fallback '${r}' at viewport '${t}' did not match any configured route or registered component name at '${o.friendlyPath}' - did you forget to add the component '${s}' to the dependencies of '${o.component.name}' or to register it as a global dependency?`)}return ct(t,n,i,r,a)}}const h=null===l.residue?a:a.slice(0,-(l.residue.length+1));i.component.value=h;for(let t=0;t<s;++t)i.children=i.children[0].children;return at(t,n,i,r,l)}(n,i,r,o);if(null===t)return;return lt(n,i,t)}}case 4:case 2:{const t=At.resolve(r.component.value),e=ct(n,i,r,o,t.component);return lt(n,i,e)}}}function at(n,i,r,o,s,a=s.route.endpoint.route){const c=i.context,l=i.tree;return t.onResolve(a.handler,(t=>{if(a.handler=t,null===t.redirectTo){const e=t.viewport,h=t.component,u=c.resolveViewportAgent(P.create({viewportName:e,componentName:h.name,append:o,resolution:l.options.resolutionMode})),d=c.container.get(mt).getRouteContext(u,h,u.hostController.context);return d.node=et.create({path:s.route.endpoint.route.path,finalPath:a.path,context:d,instruction:r,params:{...i.params,...s.route.params},queryParams:l.queryParams,fragment:l.fragment,data:t.data,viewport:e,component:h,append:o,title:t.config.title,residue:null===s.residue?[]:[xt.create(s.residue)]}),d.node.setTree(i.tree),n.trace("createConfiguredNode(vi:%s) -> %s",r,d.node),d.node}const h=z.parse(a.path,!1),u=z.parse(t.redirectTo,!1);let d,p;const g=[];switch(h.root.kind){case 2:case 4:d=h.root;break;default:throw new Error(`Unexpected expression kind ${h.root.kind}`)}switch(u.root.kind){case 2:case 4:p=u.root;break;default:throw new Error(`Unexpected expression kind ${u.root.kind}`)}let f,v,m=!1,w=!1;for(;!m||!w;){if(m)f=null;else if(4===d.kind)f=d,m=!0;else{if(4!==d.left.kind)throw new Error(`Unexpected expression kind ${d.left.kind}`);switch(f=d.left,d.right.kind){case 2:case 4:d=d.right;break;default:throw new Error(`Unexpected expression kind ${d.right.kind}`)}}if(w)v=null;else if(4===p.kind)v=p,w=!0;else{if(4!==p.left.kind)throw new Error(`Unexpected expression kind ${p.left.kind}`);switch(v=p.left,p.right.kind){case 2:case 4:p=p.right;break;default:throw new Error(`Unexpected expression kind ${p.right.kind}`)}}null!==v&&g.push(v.component.isDynamic&&(null==f?void 0:f.component.isDynamic)?s.route.params[f.component.name]:v.raw)}const x=g.filter(Boolean).join("/"),y=c.recognize(x);if(null===y){const t=x,s=c.container.find(e.CustomElement,x);switch(l.options.routingMode){case"configured-only":if(null===s)throw new Error(`'${t}' did not match any configured route or registered component name at '${c.friendlyPath}' - did you forget to add '${t}' to the routes list of the route decorator of '${c.component.name}'?`);throw new Error(`'${t}' did not match any configured route, but it does match a registered component name at '${c.friendlyPath}' - did you forget to add a @route({ path: '${t}' }) decorator to '${t}' or unintentionally set routingMode to 'configured-only'?`);case"configured-first":if(null===s)throw new Error(`'${t}' did not match any configured route or registered component name at '${c.friendlyPath}' - did you forget to add the component '${t}' to the dependencies of '${c.component.name}' or to register it as a global dependency?`);return ct(n,i,r,o,s)}}return at(n,i,r,o,s,y.route.endpoint.route)}))}function ct(t,e,n,i,r){var o;const s=e.context,a=e.tree,c=null!==(o=n.viewport)&&void 0!==o?o:"default",l=s.resolveViewportAgent(P.create({viewportName:c,componentName:r.name,append:i,resolution:a.options.resolutionMode})),h=s.container.get(mt).getRouteContext(l,r,l.hostController.context),u=At.resolve(r);return h.node=et.create({path:r.name,finalPath:r.name,context:h,instruction:n,params:{...s.node.params,...n.params},queryParams:a.queryParams,fragment:a.fragment,data:u.data,viewport:c,component:r,append:i,title:u.config.title,residue:[...n.children]}),h.node.setTree(s.node.tree),t.trace("createDirectNode(vi:%s) -> %s",n,h.node),h.node}function lt(e,n,i){return t.onResolve(i,(t=>(e.trace("appendNode($childNode:%s)",t),n.appendChild(t),t.context.vpa.scheduleUpdate(n.tree.options,t))))}function ht(e){return t.isObject(e)&&!0===Object.prototype.hasOwnProperty.call(e,"au-nav-id")}function ut(t,e){return{...t,"au-nav-id":e}}function dt(t,e){return"function"==typeof e?e(t):e}class pt{constructor(t,e,n,i,r,o,s,a,c,l){this.useUrlFragmentHash=t,this.useHref=e,this.statefulHistoryLength=n,this.routingMode=i,this.swapStrategy=r,this.resolutionMode=o,this.queryParamsStrategy=s,this.fragmentStrategy=a,this.historyStrategy=c,this.sameUrlStrategy=l}static get DEFAULT(){return pt.create({})}static create(t){var e,n,i,r,o,s,a,c,l,h;return new pt(null!==(e=t.useUrlFragmentHash)&&void 0!==e&&e,null===(n=t.useHref)||void 0===n||n,null!==(i=t.statefulHistoryLength)&&void 0!==i?i:0,null!==(r=t.routingMode)&&void 0!==r?r:"configured-first",null!==(o=t.swapStrategy)&&void 0!==o?o:"sequential-remove-first",null!==(s=t.resolutionMode)&&void 0!==s?s:"dynamic",null!==(a=t.queryParamsStrategy)&&void 0!==a?a:"overwrite",null!==(c=t.fragmentStrategy)&&void 0!==c?c:"overwrite",null!==(l=t.historyStrategy)&&void 0!==l?l:"push",null!==(h=t.sameUrlStrategy)&&void 0!==h?h:"ignore")}getQueryParamsStrategy(t){return dt(t,this.queryParamsStrategy)}getFragmentStrategy(t){return dt(t,this.fragmentStrategy)}getHistoryStrategy(t){return dt(t,this.historyStrategy)}getSameUrlStrategy(t){return dt(t,this.sameUrlStrategy)}stringifyProperties(){return[["routingMode","mode"],["swapStrategy","swap"],["resolutionMode","resolution"],["queryParamsStrategy","queryParams"],["fragmentStrategy","fragment"],["historyStrategy","history"],["sameUrlStrategy","sameUrl"]].map((([t,e])=>{const n=this[t];return`${e}:${"function"==typeof n?n:`'${n}'`}`})).join(",")}clone(){return new pt(this.useUrlFragmentHash,this.useHref,this.statefulHistoryLength,this.routingMode,this.swapStrategy,this.resolutionMode,this.queryParamsStrategy,this.fragmentStrategy,this.historyStrategy,this.sameUrlStrategy)}toString(){return`RO(${this.stringifyProperties()})`}}class gt extends pt{constructor(t,e,n,i,r,o,s,a){super(t.useUrlFragmentHash,t.useHref,t.statefulHistoryLength,t.routingMode,t.swapStrategy,t.resolutionMode,t.queryParamsStrategy,t.fragmentStrategy,t.historyStrategy,t.sameUrlStrategy),this.title=e,this.titleSeparator=n,this.append=i,this.context=r,this.queryParams=o,this.fragment=s,this.state=a}static get DEFAULT(){return gt.create({})}static create(t){var e,n,i,r,o,s,a;return new gt(pt.create(t),null!==(e=t.title)&&void 0!==e?e:null,null!==(n=t.titleSeparator)&&void 0!==n?n:" | ",null!==(i=t.append)&&void 0!==i&&i,null!==(r=t.context)&&void 0!==r?r:null,null!==(o=t.queryParams)&&void 0!==o?o:null,null!==(s=t.fragment)&&void 0!==s?s:"",null!==(a=t.state)&&void 0!==a?a:null)}clone(){return new gt(super.clone(),this.title,this.titleSeparator,this.append,this.context,{...this.queryParams},this.fragment,null===this.state?null:{...this.state})}toString(){return`NO(${super.stringifyProperties()})`}}class ft{constructor(t,e,n,i,r,o){this.id=t,this.instructions=e,this.trigger=n,this.options=i,this.prevNavigation=r,this.finalInstructions=o}static create(t){return new ft(t.id,t.instructions,t.trigger,t.options,t.prevNavigation,t.finalInstructions)}toString(){return`N(id:${this.id},instructions:${this.instructions},trigger:'${this.trigger}')`}}class vt{constructor(t,e,n,i,r,o,s,a,c,l,h,u,d,p,g){this.id=t,this.prevInstructions=e,this.instructions=n,this.finalInstructions=i,this.instructionsChanged=r,this.trigger=o,this.options=s,this.managedState=a,this.previousRouteTree=c,this.routeTree=l,this.promise=h,this.resolve=u,this.reject=d,this.guardsResult=p,this.error=g}static create(t){return new vt(t.id,t.prevInstructions,t.instructions,t.finalInstructions,t.instructionsChanged,t.trigger,t.options,t.managedState,t.previousRouteTree,t.routeTree,t.promise,t.resolve,t.reject,t.guardsResult,void 0)}run(t,e){if(!0===this.guardsResult)try{const n=t();n instanceof Promise?n.then(e).catch((t=>{this.handleError(t)})):e(n)}catch(t){this.handleError(t)}}handleError(t){this.reject(this.error=t)}toString(){return`T(id:${this.id},trigger:'${this.trigger}',instructions:${this.instructions},options:${this.options})`}}const mt=t.DI.createInterface("IRouter",(t=>t.singleton(exports.Router)));exports.Router=class{constructor(t,e,n,i,r){this.container=t,this.p=e,this.logger=n,this.events=i,this.locationMgr=r,this._ctx=null,this._routeTree=null,this._currentTr=null,this.options=pt.DEFAULT,this.navigated=!1,this.navigationId=0,this.lastSuccessfulNavigation=null,this.activeNavigation=null,this.instructions=bt.create(""),this.nextTr=null,this.locationChangeSubscription=null,this.vpaLookup=new Map,this.logger=n.root.scopeTo("Router")}get ctx(){let t=this._ctx;if(null===t){if(!this.container.has(Pt,!0))throw new Error("Root RouteContext is not set. Did you forget to register RouteConfiguration, or try to navigate before calling Aurelia.start()?");t=this._ctx=this.container.get(Pt)}return t}get routeTree(){let t=this._routeTree;if(null===t){const e=this.ctx;t=this._routeTree=new nt(gt.create({...this.options}),Object.freeze(new URLSearchParams),null,et.create({path:"",finalPath:"",context:e,instruction:null,component:e.definition.component,append:!1}))}return t}get currentTr(){let t=this._currentTr;return null===t&&(t=this._currentTr=vt.create({id:0,prevInstructions:this.instructions,instructions:this.instructions,finalInstructions:this.instructions,instructionsChanged:!0,trigger:"api",options:gt.DEFAULT,managedState:null,previousRouteTree:this.routeTree.clone(),routeTree:this.routeTree,resolve:null,reject:null,promise:null,guardsResult:!0,error:void 0})),t}set currentTr(t){this._currentTr=t}resolveContext(t){return Nt.resolve(this.ctx,t)}start(t,e){if(this.options=pt.create(t),this.locationMgr.startListening(),this.locationChangeSubscription=this.events.subscribe("au:router:location-change",(t=>{this.p.taskQueue.queueTask((()=>{const e=ht(t.state)?t.state:null,n=gt.create({...this.options,historyStrategy:"replace"}),i=bt.create(t.url,n);this.enqueue(i,t.trigger,e,null)}))})),!this.navigated&&e)return this.load(this.locationMgr.getPath(),{historyStrategy:"replace"})}stop(){var t;this.locationMgr.stopListening(),null===(t=this.locationChangeSubscription)||void 0===t||t.dispose()}load(t,e){const n=this.createViewportInstructions(t,e);return this.logger.trace("load(instructions:%s)",n),this.enqueue(n,"api",null,null)}isActive(t,e){const n=this.resolveContext(e),i=this.createViewportInstructions(t,{context:n});return this.logger.trace("isActive(instructions:%s,ctx:%s)",i,n),this.routeTree.contains(i)}getRouteContext(e,n,i){const r=i.container,o=r.get(t.ILogger).scopeTo("RouteContext"),s=At.resolve(n.Type);let a=this.vpaLookup.get(e);void 0===a&&this.vpaLookup.set(e,a=new WeakMap);let c=a.get(s);if(void 0===c){o.trace("creating new RouteContext for %s",s);const t=r.has(Pt,!0)?r.get(Pt):null;a.set(s,c=new Nt(e,t,n,s,r))}else o.trace("returning existing RouteContext for %s",s),null!==e&&(c.vpa=e);return c}createViewportInstructions(t,e){return"string"==typeof t&&(t=this.locationMgr.removeBaseHref(t)),bt.create(t,this.getNavigationOptions(e))}enqueue(t,e,n,i){const r=this.currentTr;if("api"!==e&&"api"===r.trigger&&r.instructions.equals(t))return this.logger.debug("Ignoring navigation triggered by '%s' because it is the same URL as the previous navigation which was triggered by 'api'.",e),!0;let o,s,a;null===i?a=new Promise((function(t,e){o=t,s=e})):(this.logger.debug("Reusing promise/resolve/reject from the previously failed transition %s",i),a=i.promise,o=i.resolve,s=i.reject);const c=this.nextTr=vt.create({id:++this.navigationId,trigger:e,managedState:n,prevInstructions:r.finalInstructions,finalInstructions:t,instructionsChanged:!r.finalInstructions.equals(t),instructions:t,options:t.options,promise:a,resolve:o,reject:s,previousRouteTree:this.routeTree,routeTree:this._routeTree=this.routeTree.clone(),guardsResult:!0,error:void 0});if(this.logger.debug("Scheduling transition: %s",c),null===this.activeNavigation)try{this.run(c)}catch(t){c.handleError(t)}return c.promise.then((t=>(this.logger.debug("Transition succeeded: %s",c),t))).catch((t=>{throw this.logger.error("Navigation failed: %s",c,t),t}))}run(t){this.currentTr=t,this.nextTr=null;const e=null===this.lastSuccessfulNavigation?null:ft.create({...this.lastSuccessfulNavigation,prevNavigation:null});this.activeNavigation=ft.create({id:t.id,instructions:t.instructions,trigger:t.trigger,options:t.options,prevNavigation:e,finalInstructions:t.finalInstructions});const n=this.resolveContext(t.options.context);return!this.navigated||t.instructions.children.length!==n.node.children.length||t.instructions.children.some(((t,e)=>{var i,r;return!(null!==(r=null===(i=n.node.children[e])||void 0===i?void 0:i.originalInstruction.equals(t))&&void 0!==r&&r)}))||"reload"===t.options.getSameUrlStrategy(this.instructions)?(this.logger.trace("run(tr:%s) - processing route",t),this.events.publish(new $(t.id,t.instructions,t.trigger,t.managedState)),null!==this.nextTr?(this.logger.debug("run(tr:%s) - aborting because a new transition was queued in response to the NavigationStartEvent",t),this.run(this.nextTr)):(this.activeNavigation=ft.create({...this.activeNavigation,finalInstructions:t.finalInstructions}),void t.run((()=>(this.logger.trace("run() - compiling route tree: %s",t.finalInstructions),it(t.routeTree,t.finalInstructions,n))),(()=>{const e=t.previousRouteTree.root.children,n=t.routeTree.root.children,o=r(e,n);i.start((n=>{this.logger.trace(`run() - invoking canUnload on ${e.length} nodes`);for(const i of e)i.context.vpa.canUnload(t,n)})).continueWith((e=>{!0!==t.guardsResult&&(e.push(),this.cancelNavigation(t))})).continueWith((e=>{this.logger.trace(`run() - invoking canLoad on ${n.length} nodes`);for(const i of n)i.context.vpa.canLoad(t,e)})).continueWith((e=>{!0!==t.guardsResult&&(e.push(),this.cancelNavigation(t))})).continueWith((n=>{this.logger.trace(`run() - invoking unload on ${e.length} nodes`);for(const i of e)i.context.vpa.unload(t,n)})).continueWith((e=>{this.logger.trace(`run() - invoking load on ${n.length} nodes`);for(const i of n)i.context.vpa.load(t,e)})).continueWith((e=>{this.logger.trace(`run() - invoking swap on ${o.length} nodes`);for(const n of o)n.context.vpa.swap(t,e)})).continueWith((()=>{this.logger.trace("run() - finalizing transition"),o.forEach((function(t){t.context.vpa.endTransition()})),this.navigated=!0,this.instructions=t.finalInstructions=t.routeTree.finalizeInstructions(),this.events.publish(new S(t.id,t.instructions,this.instructions)),this.lastSuccessfulNavigation=this.activeNavigation,this.activeNavigation=null,this.applyHistoryState(t),t.resolve(!0),this.runNextTransition(t)})).start()})))):(this.logger.trace("run(tr:%s) - NOT processing route",t),this.navigated=!0,this.activeNavigation=null,t.resolve(!1),void this.runNextTransition(t))}applyHistoryState(t){const e=t.finalInstructions.toUrl(this.options.useUrlFragmentHash);switch(t.options.getHistoryStrategy(this.instructions)){case"none":break;case"push":this.locationMgr.pushState(ut(t.options.state,t.id),this.updateTitle(t),e);break;case"replace":this.locationMgr.replaceState(ut(t.options.state,t.id),this.updateTitle(t),e)}}getTitle(t){var e,n;switch(typeof t.options.title){case"function":return null!==(e=t.options.title.call(void 0,t.routeTree.root))&&void 0!==e?e:"";case"string":return t.options.title;default:return null!==(n=t.routeTree.root.getTitle(t.options.titleSeparator))&&void 0!==n?n:""}}updateTitle(t){const e=this.getTitle(t);return e.length>0&&(this.p.document.title=e),this.p.document.title}cancelNavigation(e){this.logger.trace("cancelNavigation(tr:%s)",e);r(e.previousRouteTree.root.children,e.routeTree.root.children).forEach((function(t){t.context.vpa.cancelUpdate()})),this.activeNavigation=null,this.instructions=e.prevInstructions,this._routeTree=e.previousRouteTree,this.events.publish(new C(e.id,e.instructions,`guardsResult is ${e.guardsResult}`)),!1===e.guardsResult?(e.resolve(!1),this.runNextTransition(e)):t.onResolve(this.enqueue(e.guardsResult,"api",e.managedState,e),(()=>{this.logger.trace("cancelNavigation(tr:%s) - finished redirect",e)}))}runNextTransition(t){null!==this.nextTr&&(this.logger.trace("runNextTransition(tr:%s) -> scheduling nextTransition: %s",t,this.nextTr),this.p.taskQueue.queueTask((()=>{const t=this.nextTr;if(null!==t)try{this.run(t)}catch(e){t.handleError(e)}})))}getNavigationOptions(t){return gt.create({...this.options,...t})}},exports.Router=v([m(0,t.IContainer),m(1,e.IPlatform),m(2,t.ILogger),m(3,x),m(4,A)],exports.Router);const wt=t.DI.createInterface("IViewportInstruction");class xt{constructor(t,e,n,i,r,o,s,a){this.context=t,this.append=e,this.open=n,this.close=i,this.component=r,this.viewport=o,this.params=s,this.children=a}static create(t,e){var n,i,r,o,s,a,c,l,h;if(t instanceof xt)return t;if(u(t)){const u=St.create(t.component),d=null!==(i=null===(n=t.children)||void 0===n?void 0:n.map(xt.create))&&void 0!==i?i:[];return new xt(null!==(o=null!==(r=t.context)&&void 0!==r?r:e)&&void 0!==o?o:null,null!==(s=t.append)&&void 0!==s&&s,null!==(a=t.open)&&void 0!==a?a:0,null!==(c=t.close)&&void 0!==c?c:0,u,null!==(l=t.viewport)&&void 0!==l?l:null,null!==(h=t.params)&&void 0!==h?h:null,d)}const d=St.create(t);return new xt(null!=e?e:null,!1,0,0,d,null,null,[])}contains(t){const e=this.children,n=t.children;if(e.length<n.length)return!1;if(!this.component.equals(t.component))return!1;for(let t=0,i=n.length;t<i;++t)if(!e[t].contains(n[t]))return!1;return!0}equals(t){const e=this.children,n=t.children;if(e.length!==n.length)return!1;if(!this.component.equals(t.component)||this.viewport!==t.viewport||!f(this.params,t.params))return!1;for(let t=0,i=e.length;t<i;++t)if(!e[t].equals(n[t]))return!1;return!0}clone(){return new xt(this.context,this.append,this.open,this.close,this.component.clone(),this.viewport,null===this.params?null:{...this.params},[...this.children])}toUrlComponent(e=!0){const n=this.component.toUrlComponent(),i=null===this.params||0===Object.keys(this.params).length?"":`(${function(e){const n=Object.keys(e),i=Array(n.length),r=[],o=[];for(const e of n)t.isArrayIndex(e)?r.push(Number(e)):o.push(e);for(let t=0;t<n.length;++t){const n=r.indexOf(t);if(n>-1)i[t]=e[t],r.splice(n,1);else{const n=o.shift();i[t]=`${n}=${e[n]}`}}return i.join(",")}(this.params)})`,r=0===n.length||null===this.viewport||0===this.viewport.length?"":`@${this.viewport}`,o=`${"(".repeat(this.open)}${n}${i}${r}${")".repeat(this.close)}`,s=e?this.children.map((t=>t.toUrlComponent())).join("+"):"";return o.length>0?s.length>0?[o,s].join("/"):o:s}toString(){return`VPI(${[`c:${this.component}`,null===this.viewport||0===this.viewport.length?"":`viewport:${this.viewport}`,0===this.children.length?"":`children:[${this.children.map(String).join(",")}]`].filter(Boolean).join(",")})`}}const yt=function(){let t=0;const e=new Map;return function(n){let i=e.get(n);return void 0===i&&e.set(n,i=++t),i}}();class bt{constructor(t,e,n,i,r){this.options=t,this.isAbsolute=e,this.children=n,this.queryParams=i,this.fragment=r}static create(t,e){const n=gt.create({...e});if(t instanceof bt)return new bt(n,t.isAbsolute,t.children.map((t=>xt.create(t,n.context))),t.queryParams,t.fragment);if(t instanceof Array)return new bt(n,!1,t.map((t=>xt.create(t,n.context))),Object.freeze(new URLSearchParams),null);if("string"==typeof t){return z.parse(t,n.useUrlFragmentHash).toInstructionTree(n)}return new bt(n,!1,[xt.create(t,n.context)],Object.freeze(new URLSearchParams),null)}equals(t){const e=this.children,n=t.children;if(e.length!==n.length)return!1;for(let t=0,i=e.length;t<i;++t)if(!e[t].equals(n[t]))return!1;return!0}toUrl(t=!1){var e;let n,i;t?(n="",i=`#${this.toPath()}`):(n=this.toPath(),i=null!==(e=this.fragment)&&void 0!==e?e:"");let r=this.queryParams.toString();r=""===r?"":`?${r}`;return`${n}${i}${r}`}toPath(){return this.children.map((t=>t.toUrlComponent())).join("+")}toString(){return`[${this.children.map(String).join(",")}]`}}var $t;!function(t){t[t.string=0]="string",t[t.ViewportInstruction=1]="ViewportInstruction",t[t.CustomElementDefinition=2]="CustomElementDefinition",t[t.Promise=3]="Promise",t[t.IRouteViewModel=4]="IRouteViewModel"}($t||($t={}));class St{constructor(t,e){this.type=t,this.value=e}static create(n){if(n instanceof St)return n;if("string"==typeof n)return new St(0,n);if(t.isObject(n)){if("function"==typeof n){const t=e.CustomElement.getDefinition(n);return new St(2,t)}if(n instanceof Promise)return new St(3,n);if(u(n)){const t=xt.create(n);return new St(1,t)}if(e.isCustomElementViewModel(n))return new St(4,n);if(n instanceof e.CustomElementDefinition)return new St(2,n);if(c(n)){const t=e.CustomElement.define(n),i=e.CustomElement.getDefinition(t);return new St(2,i)}throw new Error(`Invalid component ${o(n)}: must be either a class, a custom element ViewModel, or a (partial) custom element definition`)}d("function/class or object","",n)}equals(t){switch(this.type){case 2:case 4:case 3:case 0:return this.type===t.type&&this.value===t.value;case 1:return this.type===t.type&&this.value.equals(t.value)}}clone(){return new St(this.type,this.value)}toUrlComponent(){switch(this.type){case 2:return this.value.name;case 4:case 3:return`au$obj${yt(this.value)}`;case 1:return this.value.toUrlComponent();case 0:return this.value}}toString(){switch(this.type){case 2:return`CEDef(name:'${this.value.name}')`;case 3:return"Promise";case 4:return`VM(name:'${e.CustomElement.getDefinition(this.value.constructor).name}')`;case 1:return this.value.toString();case 0:return`'${this.value}'`}}}const Ct=t.emptyArray;function kt(t,e){return f(t.params,e.params)?"none":"invoke-lifecycles"}class Et{constructor(t,e,n,i,r,o,s,a,c){this.id=t,this.path=e,this.title=n,this.redirectTo=i,this.caseSensitive=r,this.transitionPlan=o,this.viewport=s,this.data=a,this.routes=c}static create(t,e){var n,i,r,o,s,a,c,l,h,u,g,f,v,m,w,x,y,b,$,S,C,k,E,R;if("string"==typeof t||t instanceof Array){const h=t,u=null!==(n=null==e?void 0:e.redirectTo)&&void 0!==n?n:null,d=null!==(i=null==e?void 0:e.caseSensitive)&&void 0!==i&&i,p=null!==(r=null==e?void 0:e.id)&&void 0!==r?r:h instanceof Array?h[0]:h,g=null!==(o=null==e?void 0:e.title)&&void 0!==o?o:null,f=null!==(s=null==e?void 0:e.transitionPlan)&&void 0!==s?s:kt,v=null!==(a=null==e?void 0:e.viewport)&&void 0!==a?a:null,m=null!==(c=null==e?void 0:e.data)&&void 0!==c?c:{},w=null!==(l=null==e?void 0:e.routes)&&void 0!==l?l:Ct;return new Et(p,h,g,u,d,f,v,m,w)}if("object"==typeof t){const n=t;p(n,"");const i=null!==(u=null!==(h=n.path)&&void 0!==h?h:null==e?void 0:e.path)&&void 0!==u?u:null,r=null!==(f=null!==(g=n.title)&&void 0!==g?g:null==e?void 0:e.title)&&void 0!==f?f:null,o=null!==(m=null!==(v=n.redirectTo)&&void 0!==v?v:null==e?void 0:e.redirectTo)&&void 0!==m?m:null,s=null!==(x=null!==(w=n.caseSensitive)&&void 0!==w?w:null==e?void 0:e.caseSensitive)&&void 0!==x&&x,a=null!==(b=null!==(y=n.id)&&void 0!==y?y:null==e?void 0:e.id)&&void 0!==b?b:i instanceof Array?i[0]:i,c=null!==(S=null!==($=n.transitionPlan)&&void 0!==$?$:null==e?void 0:e.transitionPlan)&&void 0!==S?S:kt,l=null!==(k=null!==(C=n.viewport)&&void 0!==C?C:null==e?void 0:e.viewport)&&void 0!==k?k:null,d={...null==e?void 0:e.data,...n.data},A=[...null!==(E=n.routes)&&void 0!==E?E:Ct,...null!==(R=null==e?void 0:e.routes)&&void 0!==R?R:Ct];return new Et(a,i,r,o,s,c,l,d,A)}d("string, function/class or object","",t)}static configure(e,n){const i=Et.create(e,n);return t.Metadata.define(Rt.name,i,n),n}static getConfig(e){return t.Metadata.hasOwn(Rt.name,e)||Rt.configure({},e),t.Metadata.getOwn(Rt.name,e)}saveTo(e){t.Metadata.define(Rt.name,this,e)}}const Rt={name:t.Protocol.resource.keyFor("route"),isConfigured:e=>t.Metadata.hasOwn(Rt.name,e),configure(e,n){const i=Et.create(e,n);return t.Metadata.define(Rt.name,i,n),n},getConfig:e=>(Rt.isConfigured(e)||Rt.configure({},e),t.Metadata.getOwn(Rt.name,e))};class At{constructor(t,e){var n,i,r,o,a,c;this.config=t,this.component=e,this.hasExplicitPath=null!==t.path,this.caseSensitive=t.caseSensitive,this.path=s(null!==(n=t.path)&&void 0!==n?n:e.name),this.redirectTo=null!==(i=t.redirectTo)&&void 0!==i?i:null,this.viewport=null!==(r=t.viewport)&&void 0!==r?r:"default",this.id="string"==typeof(c=null!==(o=t.id)&&void 0!==o?o:this.path)?c:c[0],this.data=null!==(a=t.data)&&void 0!==a?a:{}}static resolve(e,n){return h(e)?new At(e,null):t.onResolve(this.resolveCustomElementDefinition(e,n),(n=>{const i=l(e)?{...Rt.getConfig(n.Type),...e}:Rt.getConfig(n.Type);if(t.Metadata.hasOwn(Rt.name,n)){let e=t.Metadata.getOwn(Rt.name,n);e.config!==i&&(e=new At(i,n),t.Metadata.define(Rt.name,e,n))}else{const e=new At(i,n);t.Metadata.define(Rt.name,e,n)}return t.Metadata.getOwn(Rt.name,n)}))}static resolveCustomElementDefinition(t,n){if(l(t))return this.resolveCustomElementDefinition(t.component,n);const i=St.create(t);switch(i.type){case 0:{if(void 0===n)throw new Error("When retrieving the RouteDefinition for a component name, a RouteContext (that can resolve it) must be provided");const t=n.container.find(e.CustomElement,i.value);if(null===t)throw new Error(`Could not find a CustomElement named '${i.value}' in the current container scope of ${n}. This means the component is neither registered at Aurelia startup nor via the 'dependencies' decorator or static property.`);return t}case 2:return i.value;case 4:return e.CustomElement.getDefinition(i.value.constructor);case 3:if(void 0===n)throw new Error("RouteContext must be provided when resolving an imported module");return n.resolveLazy(i.value)}}register(t){var e;null===(e=this.component)||void 0===e||e.register(t)}toUrlComponent(){return"not-implemented"}toString(){const t=null===this.config.path?"null":`'${this.config.path}'`;return null!==this.component?`RD(config.path:${t},c.name:'${this.component.name}')`:`RD(config.path:${t},redirectTo:'${this.redirectTo}')`}}const It=new WeakMap;class Tt{constructor(e,n,i,r,o){var s,a,c,l;this.instance=e,this.controller=n,this.definition=i,this.routeNode=r,this.ctx=o,this.logger=o.container.get(t.ILogger).scopeTo(`ComponentAgent<${o.friendlyPath}>`),this.logger.trace("constructor()");const h=n.lifecycleHooks;this.canLoadHooks=(null!==(s=h.canLoad)&&void 0!==s?s:[]).map((t=>t.instance)),this.loadHooks=(null!==(a=h.load)&&void 0!==a?a:[]).map((t=>t.instance)),this.canUnloadHooks=(null!==(c=h.canUnload)&&void 0!==c?c:[]).map((t=>t.instance)),this.unloadHooks=(null!==(l=h.unload)&&void 0!==l?l:[]).map((t=>t.instance)),this.hasCanLoad="canLoad"in e,this.hasLoad="load"in e,this.hasCanUnload="canUnload"in e,this.hasUnload="unload"in e}static for(t,n,i,r){let o=It.get(t);if(void 0===o){const s=r.container,a=At.resolve(t.constructor),c=e.Controller.forCustomElement(s.get(e.IAppRoot),s,s,t,n.host,null);It.set(t,o=new Tt(t,c,a,i,r))}return o}activate(t,e,n){if(null===t)return this.logger.trace("activate() - initial"),this.controller.activate(this.controller,e,n);this.logger.trace("activate()"),this.controller.activate(t,e,n)}deactivate(t,e,n){if(null===t)return this.logger.trace("deactivate() - initial"),this.controller.deactivate(this.controller,e,n);this.logger.trace("deactivate()"),this.controller.deactivate(t,e,n)}dispose(){this.logger.trace("dispose()"),this.controller.dispose()}canUnload(t,e,n){this.logger.trace(`canUnload(next:%s) - invoking ${this.canUnloadHooks.length} hooks`,e),n.push();for(const i of this.canUnloadHooks)t.run((()=>(n.push(),i.canUnload(this.instance,e,this.routeNode))),(e=>{!0===t.guardsResult&&!0!==e&&(t.guardsResult=!1),n.pop()}));this.hasCanUnload&&t.run((()=>(n.push(),this.instance.canUnload(e,this.routeNode))),(e=>{!0===t.guardsResult&&!0!==e&&(t.guardsResult=!1),n.pop()})),n.pop()}canLoad(t,e,n){this.logger.trace(`canLoad(next:%s) - invoking ${this.canLoadHooks.length} hooks`,e),n.push();for(const i of this.canLoadHooks)t.run((()=>(n.push(),i.canLoad(this.instance,e.params,e,this.routeNode))),(e=>{!0===t.guardsResult&&!0!==e&&(t.guardsResult=!1!==e&&bt.create(e)),n.pop()}));this.hasCanLoad&&t.run((()=>(n.push(),this.instance.canLoad(e.params,e,this.routeNode))),(e=>{!0===t.guardsResult&&!0!==e&&(t.guardsResult=!1!==e&&bt.create(e)),n.pop()})),n.pop()}unload(t,e,n){this.logger.trace(`unload(next:%s) - invoking ${this.unloadHooks.length} hooks`,e),n.push();for(const i of this.unloadHooks)t.run((()=>(n.push(),i.unload(this.instance,e,this.routeNode))),(()=>{n.pop()}));this.hasUnload&&t.run((()=>(n.push(),this.instance.unload(e,this.routeNode))),(()=>{n.pop()})),n.pop()}load(t,e,n){this.logger.trace(`load(next:%s) - invoking ${this.loadHooks.length} hooks`,e),n.push();for(const i of this.loadHooks)t.run((()=>(n.push(),i.load(this.instance,e.params,e,this.routeNode))),(()=>{n.pop()}));this.hasLoad&&t.run((()=>(n.push(),this.instance.load(e.params,e,this.routeNode))),(()=>{n.pop()})),n.pop()}toString(){return`CA(ctx:'${this.ctx.friendlyPath}',c:'${this.definition.component.name}')`}}const Pt=t.DI.createInterface("IRouteContext");class Nt{constructor(i,r,o,a,c){var h;this.parent=r,this.component=o,this.definition=a,this.parentContainer=c,this.childViewportAgents=[],this.childRoutes=[],this._resolved=null,this._allResolved=null,this.prevNode=null,this._node=null,this._vpa=null,this._vpa=i,null===r?(this.root=this,this.path=[this],this.friendlyPath=o.name):(this.root=r.root,this.path=[...r.path,this],this.friendlyPath=`${r.friendlyPath}/${o.name}`),this.logger=c.get(t.ILogger).scopeTo(`RouteContext<${this.friendlyPath}>`),this.logger.trace("constructor()"),this.moduleLoader=c.get(t.IModuleLoader);const u=this.container=c.createChild();u.registerResolver(e.IController,this.hostControllerProvider=new t.InstanceProvider,!0);const d=new t.InstanceProvider;u.registerResolver(Pt,d,!0),d.prepare(this),u.register(a),u.register(...o.dependencies),this.recognizer=new n.RouteRecognizer;const p=[],g=[];for(const e of a.config.routes)if(e instanceof Promise){const t=this.addRoute(e);p.push(t),g.push(t)}else{const n=At.resolve(e,this);if(n instanceof Promise){if(!l(e)||null==e.path)throw new Error("Invalid route config. When the component property is a lazy import, the path must be specified. To use lazy loading without specifying the path (e.g. in direct routing), pass the import promise as a direct value to the routes array instead of providing it as the component property on an object literal.");{for(const t of s(e.path))this.$addRoute(t,null!==(h=e.caseSensitive)&&void 0!==h&&h,n);const i=this.childRoutes.length,r=n.then((t=>this.childRoutes[i]=t));this.childRoutes.push(r),g.push(r.then(t.noop))}}else{for(const t of n.path)this.$addRoute(t,n.caseSensitive,n);this.childRoutes.push(n)}}p.length>0&&(this._resolved=Promise.all(p).then((()=>{this._resolved=null}))),g.length>0&&(this._allResolved=Promise.all(g).then((()=>{this._allResolved=null})))}get id(){return this.container.id}get isRoot(){return null===this.parent}get depth(){return this.path.length-1}get resolved(){return this._resolved}get allResolved(){return this._allResolved}get node(){const t=this._node;if(null===t)throw new Error(`Invariant violation: RouteNode should be set immediately after the RouteContext is created. Context: ${this}`);return t}set node(t){(this.prevNode=this._node)!==t&&(this._node=t,this.logger.trace("Node changed from %s to %s",this.prevNode,t))}get vpa(){const t=this._vpa;if(null===t)throw new Error(`RouteContext has no ViewportAgent: ${this}`);return t}set vpa(t){if(null==t)throw new Error(`Cannot set ViewportAgent to ${t} for RouteContext: ${this}`);const e=this._vpa;e!==t&&(this._vpa=t,this.logger.trace("ViewportAgent changed from %s to %s",e,t))}static setRoot(n){const i=n.get(t.ILogger).scopeTo("RouteContext");n.has(e.IAppRoot,!0)||Lt(new Error("The provided container has no registered IAppRoot. RouteContext.setRoot can only be used after Aurelia.app was called, on a container that is within that app's component tree."),i),n.has(Pt,!0)&&Lt(new Error('A root RouteContext is already registered. A possible cause is the RouterConfiguration being registered more than once in the same container tree. If you have a multi-rooted app, make sure you register RouterConfiguration only in the "forked" containers and not in the common root.'),i);const{controller:r}=n.get(e.IAppRoot);void 0===r&&Lt(new Error("The provided IAppRoot does not (yet) have a controller. A possible cause is calling this API manually before Aurelia.start() is called"),i);const o=n.get(mt),s=o.getRouteContext(null,r.context.definition,r.context);n.register(t.Registration.instance(Pt,s)),s.node=o.routeTree.root}static resolve(n,i){const r=n.container,o=r.get(t.ILogger).scopeTo("RouteContext");if(null==i)return o.trace("resolve(context:%s) - returning root RouteContext",i),n;if(i instanceof Nt)return o.trace("resolve(context:%s) - returning provided RouteContext",i),i;if(i instanceof r.get(e.IPlatform).Node)try{const t=e.CustomElement.for(i,{searchParents:!0});return o.trace(`resolve(context:Node(nodeName:'${i.nodeName}'),controller:'${t.context.definition.name}') - resolving RouteContext from controller's RenderContext`),t.container.get(Pt)}catch(t){throw o.error(`Failed to resolve RouteContext from Node(nodeName:'${i.nodeName}')`,t),t}if(e.isCustomElementViewModel(i)){const t=i.$controller;return o.trace(`resolve(context:CustomElementViewModel(name:'${t.context.definition.name}')) - resolving RouteContext from controller's RenderContext`),t.container.get(Pt)}if(e.isCustomElementController(i)){const t=i;return o.trace(`resolve(context:CustomElementController(name:'${t.context.definition.name}')) - resolving RouteContext from controller's RenderContext`),t.container.get(Pt)}Lt(new Error(`Invalid context type: ${Object.prototype.toString.call(i)}`),o)}dispose(){this.container.dispose()}resolveViewportAgent(t){this.logger.trace("resolveViewportAgent(req:%s)",t);const e=this.childViewportAgents.find((e=>e.handles(t)));if(void 0===e)throw new Error(`Failed to resolve ${t} at:\n${this.printTree()}`);return e}getAvailableViewportAgents(t){return this.childViewportAgents.filter((e=>e.isAvailable(t)))}getFallbackViewportAgent(t,e){var n;return null!==(n=this.childViewportAgents.find((n=>n.isAvailable(t)&&n.viewport.name===e&&n.viewport.fallback.length>0)))&&void 0!==n?n:null}createComponentAgent(t,e){this.logger.trace("createComponentAgent(routeNode:%s)",e),this.hostControllerProvider.prepare(t);const n=At.resolve(e.component),i=this.container.get(n.component.key),r=Tt.for(i,t,e,this);return this.hostControllerProvider.dispose(),r}registerViewport(t){const e=L.for(t,this);return this.childViewportAgents.includes(e)?this.logger.trace("registerViewport(agent:%s) -> already registered, so skipping",e):(this.logger.trace("registerViewport(agent:%s) -> adding",e),this.childViewportAgents.push(e)),e}unregisterViewport(t){const e=L.for(t,this);this.childViewportAgents.includes(e)?(this.logger.trace("unregisterViewport(agent:%s) -> unregistering",e),this.childViewportAgents.splice(this.childViewportAgents.indexOf(e),1)):this.logger.trace("unregisterViewport(agent:%s) -> not registered, so skipping",e)}recognize(t){var e;this.logger.trace(`recognize(path:'${t}')`);const n=this.recognizer.recognize(t);if(null===n)return null;let i;return Reflect.has(n.params,"au$residue")?(i=null!==(e=n.params.au$residue)&&void 0!==e?e:null,Reflect.deleteProperty(n.params,"au$residue")):i=null,new Vt(n,i)}addRoute(e){return this.logger.trace(`addRoute(routeable:'${e}')`),t.onResolve(At.resolve(e,this),(t=>{for(const e of t.path)this.$addRoute(e,t.caseSensitive,t);this.childRoutes.push(t)}))}$addRoute(t,e,n){this.recognizer.add({path:t,caseSensitive:e,handler:n}),this.recognizer.add({path:`${t}/*au$residue`,caseSensitive:e,handler:n})}resolveLazy(t){return this.moduleLoader.load(t,(e=>{let n,i;for(const t of e.items)if(t.isConstructable){const e=t.definitions.find(Ut);void 0!==e&&("default"===t.key?n=e:void 0===i&&(i=e))}if(void 0===n){if(void 0===i)throw new Error(`${t} does not appear to be a component or CustomElement recognizable by Aurelia`);return i}return n}))}toString(){const t=this.childViewportAgents.map(String).join(",");return`RC(path:'${this.friendlyPath}',viewports:[${t}])`}printTree(){const t=[];for(let e=0;e<this.path.length;++e)t.push(`${" ".repeat(e)}${this.path[e]}`);return t.join("\n")}}function Lt(t,e){throw e.error(t),t}function Ut(t){return e.CustomElement.isType(t.Type)}class Vt{constructor(t,e){this.route=t,this.residue=e}}exports.ViewportCustomElement=class{constructor(t,e){this.logger=t,this.ctx=e,this.name="default",this.usedBy="",this.default="",this.fallback="",this.noScope=!1,this.noLink=!1,this.noHistory=!1,this.stateful=!1,this.agent=void 0,this.controller=void 0,this.logger=t.scopeTo(`au-viewport<${e.friendlyPath}>`),this.logger.trace("constructor()")}hydrated(t){this.logger.trace("hydrated()"),this.controller=t,this.agent=this.ctx.registerViewport(this)}attaching(t,e,n){return this.logger.trace("attaching()"),this.agent.activateFromViewport(t,this.controller,n)}detaching(t,e,n){return this.logger.trace("detaching()"),this.agent.deactivateFromViewport(t,this.controller,n)}dispose(){this.logger.trace("dispose()"),this.ctx.unregisterViewport(this),this.agent.dispose(),this.agent=void 0}toString(){const t=[];for(const e of Mt){const n=this[e];switch(typeof n){case"string":""!==n&&t.push(`${e}:'${n}'`);break;case"boolean":n&&t.push(`${e}:${n}`);break;default:t.push(`${e}:${String(n)}`)}}return`VP(ctx:'${this.ctx.friendlyPath}',${t.join(",")})`}},v([e.bindable],exports.ViewportCustomElement.prototype,"name",void 0),v([e.bindable],exports.ViewportCustomElement.prototype,"usedBy",void 0),v([e.bindable],exports.ViewportCustomElement.prototype,"default",void 0),v([e.bindable],exports.ViewportCustomElement.prototype,"fallback",void 0),v([e.bindable],exports.ViewportCustomElement.prototype,"noScope",void 0),v([e.bindable],exports.ViewportCustomElement.prototype,"noLink",void 0),v([e.bindable],exports.ViewportCustomElement.prototype,"noHistory",void 0),v([e.bindable],exports.ViewportCustomElement.prototype,"stateful",void 0),exports.ViewportCustomElement=v([e.customElement({name:"au-viewport"}),m(0,t.ILogger),m(1,Pt)],exports.ViewportCustomElement);const Mt=["name","usedBy","default","fallback","noScope","noLink","noHistory","stateful"];exports.LoadCustomAttribute=class{constructor(t,e,n,i,r,o,s){this.target=t,this.el=e,this.router=n,this.events=i,this.delegator=r,this.ctx=o,this.locationMgr=s,this.attribute="href",this.active=!1,this.href=null,this.instructions=null,this.eventListener=null,this.navigationEndListener=null,this.onClick=t=>{null!==this.instructions&&(t.altKey||t.ctrlKey||t.shiftKey||t.metaKey||0!==t.button||(t.preventDefault(),this.router.load(this.instructions,{context:this.ctx})))},this.isEnabled=!e.hasAttribute("external")&&!e.hasAttribute("data-external")}binding(){this.isEnabled&&(this.eventListener=this.delegator.addEventListener(this.target,this.el,"click",this.onClick)),this.valueChanged(),this.navigationEndListener=this.events.subscribe("au:router:navigation-end",(t=>{this.valueChanged(),this.active=null!==this.instructions&&this.router.isActive(this.instructions,this.ctx)}))}attaching(){if(null!==this.ctx.allResolved)return this.ctx.allResolved.then((()=>{this.valueChanged()}))}unbinding(){this.isEnabled&&this.eventListener.dispose(),this.navigationEndListener.dispose()}valueChanged(){const t=this.router.options.useUrlFragmentHash;if(null!=this.route&&null===this.ctx.allResolved){const e=this.ctx.childRoutes.find((t=>t.id===this.route));if(void 0!==e){const n=this.ctx.node.computeAbsolutePath();let i=e.path[0];if("object"==typeof this.params&&null!==this.params){const t=Object.keys(this.params);for(const e of t){const t=this.params[e];null!=t&&String(t).length>0&&(i=i.replace(new RegExp(`[*:]${e}[?]?`),t))}}i=i.replace(/\/[*:][^/]+[?]/g,"").replace(/[*:][^/]+[?]\//g,""),this.href=n?i?`${t?"#":""}${[n,i].join("/")}`:`${t?"#":""}${n}`:`${t?"#":""}${i}`,this.instructions=this.router.createViewportInstructions(`${t?"#":""}${i}`,{context:this.ctx})}else this.instructions=this.router.createViewportInstructions("object"==typeof this.params&&null!==this.params?{component:this.route,params:this.params}:this.route,{context:this.ctx}),this.href=this.instructions.toUrl(this.router.options.useUrlFragmentHash)}else this.instructions=null,this.href=null;const n=e.CustomElement.for(this.el,{optional:!0});if(null!==n)n.viewModel[this.attribute]=this.instructions;else if(null===this.href)this.el.removeAttribute(this.attribute);else{const e=t?this.href:this.locationMgr.addBaseHref(this.href);this.el.setAttribute(this.attribute,e)}}},v([e.bindable({mode:e.BindingMode.toView,primary:!0,callback:"valueChanged"})],exports.LoadCustomAttribute.prototype,"route",void 0),v([e.bindable({mode:e.BindingMode.toView,callback:"valueChanged"})],exports.LoadCustomAttribute.prototype,"params",void 0),v([e.bindable({mode:e.BindingMode.toView})],exports.LoadCustomAttribute.prototype,"attribute",void 0),v([e.bindable({mode:e.BindingMode.fromView})],exports.LoadCustomAttribute.prototype,"active",void 0),exports.LoadCustomAttribute=v([e.customAttribute("load"),m(0,e.IEventTarget),m(1,e.INode),m(2,mt),m(3,x),m(4,e.IEventDelegator),m(5,Pt),m(6,A)],exports.LoadCustomAttribute),exports.HrefCustomAttribute=class{constructor(t,e,n,i,r,o){if(this.target=t,this.el=e,this.router=n,this.delegator=i,this.ctx=r,this.isInitialized=!1,this.onClick=t=>{if(t.altKey||t.ctrlKey||t.shiftKey||t.metaKey||0!==t.button||this.isExternal||!this.isEnabled)return;const e=this.el.getAttribute("href");null!==e&&(t.preventDefault(),this.router.load(e,{context:this.ctx}))},n.options.useHref&&"A"===e.nodeName)switch(e.getAttribute("target")){case null:case o.name:case"_self":this.isEnabled=!0;break;default:this.isEnabled=!1}else this.isEnabled=!1}get isExternal(){return this.el.hasAttribute("external")||this.el.hasAttribute("data-external")}binding(){this.isInitialized||(this.isInitialized=!0,this.isEnabled=this.isEnabled&&null===e.getRef(this.el,e.CustomAttribute.getDefinition(exports.LoadCustomAttribute).key)),this.isEnabled&&this.el.setAttribute("href",this.value),this.eventListener=this.delegator.addEventListener(this.target,this.el,"click",this.onClick)}unbinding(){this.eventListener.dispose()}valueChanged(t){this.el.setAttribute("href",t)}},v([e.bindable({mode:e.BindingMode.toView})],exports.HrefCustomAttribute.prototype,"value",void 0),exports.HrefCustomAttribute=v([e.customAttribute({name:"href",noMultiBindings:!0}),m(0,e.IEventTarget),m(1,e.INode),m(2,mt),m(3,e.IEventDelegator),m(4,Pt),m(5,e.IWindow)],exports.HrefCustomAttribute);const Ot=mt,jt=[Ot],Ht=exports.ViewportCustomElement,Dt=exports.LoadCustomAttribute,Wt=exports.HrefCustomAttribute,qt=[exports.ViewportCustomElement,exports.LoadCustomAttribute,exports.HrefCustomAttribute];function zt(n,i){return n.register(e.AppTask.hydrated(t.IContainer,Nt.setRoot),e.AppTask.afterActivate(mt,(e=>t.isObject(i)?"function"==typeof i?i(e):e.start(i,!0):e.start({},!0))),e.AppTask.afterDeactivate(mt,(t=>{t.stop()})),...jt,...qt)}const _t={register:t=>zt(t),customize:t=>({register:e=>zt(e,t)})};class Ft{constructor(t){this.el=t,this.top=t.scrollTop,this.left=t.scrollLeft}static has(t){return t.scrollTop>0||t.scrollLeft>0}restore(){this.el.scrollTo(this.left,this.top),this.el=null}}function Bt(t){t.restore()}class Yt{constructor(t){this.scrollStates=[],this.save(t.children)}save(t){let e;for(let n=0,i=t.length;n<i;++n)e=t[n],Ft.has(e)&&this.scrollStates.push(new Ft(e)),this.save(e.children)}restore(){this.scrollStates.forEach(Bt),this.scrollStates=null}}const Kt=t.DI.createInterface("IStateManager",(t=>t.singleton(Gt)));class Gt{constructor(){this.cache=new WeakMap}saveState(t){this.cache.set(t.host,new Yt(t.host))}restoreState(t){const e=this.cache.get(t.host);void 0!==e&&(e.restore(),this.cache.delete(t.host))}}exports.AST=X,exports.ActionExpression=G,exports.AuNavId="au-nav-id",exports.ChildRouteConfig=class extends Et{constructor(t,e,n,i,r,o,s,a,c,l){super(t,e,n,i,r,o,s,a,c),this.component=l}},exports.ComponentAgent=Tt,exports.ComponentExpression=K,exports.CompositeSegmentExpression=_,exports.DefaultComponents=jt,exports.DefaultResources=qt,exports.HrefCustomAttributeRegistration=Wt,exports.IBaseHrefProvider=k,exports.ILocationManager=A,exports.IRouteContext=Pt,exports.IRouter=mt,exports.IRouterEvents=x,exports.IStateManager=Kt,exports.IViewportInstruction=wt,exports.LoadCustomAttributeRegistration=Dt,exports.LocationChangeEvent=b,exports.Navigation=ft,exports.NavigationCancelEvent=C,exports.NavigationEndEvent=S,exports.NavigationErrorEvent=class{constructor(t,e,n){this.id=t,this.instructions=e,this.error=n}get name(){return"au:router:navigation-error"}toString(){return`NavigationErrorEvent(id:${this.id},instructions:'${this.instructions}',error:${String(this.error)})`}},exports.NavigationOptions=gt,exports.NavigationStartEvent=$,exports.ParameterExpression=Z,exports.ParameterListExpression=Q,exports.Route=Rt,exports.RouteConfig=Et,exports.RouteContext=Nt,exports.RouteDefinition=At,exports.RouteExpression=z,exports.RouteNode=et,exports.RouteTree=nt,exports.RouterConfiguration=_t,exports.RouterOptions=pt,exports.RouterRegistration=Ot,exports.ScopedSegmentExpression=F,exports.SegmentExpression=Y,exports.SegmentGroupExpression=B,exports.Transition=vt,exports.ViewportAgent=L,exports.ViewportCustomElementRegistration=Ht,exports.ViewportExpression=J,exports.isManagedState=ht,exports.route=function(t){return function(e){return Rt.configure(t,e)}},exports.toManagedState=ut;
