{"version":3,"file":"index.dev.js","sources":["../../src/util.ts","../../src/validation.ts","../../../../node_modules/tslib/tslib.es6.js","../../src/router-events.ts","../../src/location-manager.ts","../../src/viewport-agent.ts","../../src/route-expression.ts","../../src/route-tree.ts","../../src/router.ts","../../src/instructions.ts","../../src/route.ts","../../src/route-definition.ts","../../src/component-agent.ts","../../src/route-context.ts","../../src/resources/viewport.ts","../../src/resources/load.ts","../../src/resources/href.ts","../../src/configuration.ts","../../src/state-manager.ts"],"sourcesContent":["import { RouteNode } from './route-tree.js';\n\nexport type UnwrapPromise<T> = T extends Promise<infer R> ? R : T;\n\nexport class Batch {\n  public done: boolean = false;\n  public readonly head: Batch;\n  private next: Batch | null = null;\n\n  private constructor(\n    private stack: number,\n    private cb: ((b: Batch) => void) | null,\n    head: Batch | null,\n  ) {\n    this.head = head ?? this;\n  }\n\n  public static start(cb: (b: Batch) => void): Batch {\n    return new Batch(0, cb, null);\n  }\n\n  public push(): void {\n    let cur = this as Batch;\n    do {\n      ++cur.stack;\n      cur = cur.next!;\n    } while (cur !== null);\n  }\n\n  public pop(): void {\n    let cur = this as Batch;\n    do {\n      if (--cur.stack === 0) {\n        cur.invoke();\n      }\n      cur = cur.next!;\n    } while (cur !== null);\n  }\n\n  private invoke(): void {\n    const cb = this.cb;\n    if (cb !== null) {\n      this.cb = null;\n      cb(this);\n      this.done = true;\n    }\n  }\n\n  public continueWith(cb: (b: Batch) => void): Batch {\n    if (this.next === null) {\n      return this.next = new Batch(this.stack, cb, this.head);\n    } else {\n      return this.next.continueWith(cb);\n    }\n  }\n\n  public start(): Batch {\n    this.head.push();\n    this.head.pop();\n    return this;\n  }\n}\n\n/**\n * Normalize an array of potential promises, to ensure things stay synchronous when they can.\n *\n * If exactly one value is a promise, then that promise is returned.\n *\n * If more than one value is a promise, a new `Promise.all` is returned.\n *\n * If none of the values is a promise, nothing is returned, to indicate that things can stay synchronous.\n */\nexport function resolveAll(maybePromises: (void | Promise<void>)[]): void | Promise<void> {\n  const promises: Promise<void>[] = [];\n  for (const maybePromise of maybePromises) {\n    if (maybePromise instanceof Promise) {\n      promises.push(maybePromise);\n    }\n  }\n\n  switch (promises.length) {\n    case 0:\n      return;\n    case 1:\n      return promises[0];\n    default:\n      return Promise.all(promises) as unknown as Promise<void>;\n  }\n}\n\nexport type ExposedPromise<T> = Promise<T> & {\n  resolve(value?: T): void;\n  reject(reason?: unknown): void;\n};\n\nexport function createExposedPromise<T>(): ExposedPromise<T> {\n  let $resolve: (value?: T) => void = (void 0)!;\n  let $reject: (reason?: unknown) => void = (void 0)!;\n  const promise = new Promise<void | T>(function (resolve, reject) {\n    $resolve = resolve;\n    $reject = reject;\n  }) as ExposedPromise<T>;\n  promise.resolve = $resolve;\n  promise.reject = $reject;\n  return promise;\n}\n\nexport function mergeDistinct(prev: RouteNode[], next: RouteNode[]): RouteNode[] {\n  prev = prev.slice();\n  next = next.slice();\n  const merged: RouteNode[] = [];\n  while (prev.length > 0) {\n    const p = prev.shift()!;\n    if (merged.every(m => m.context.vpa !== p.context.vpa)) {\n      const i = next.findIndex(n => n.context.vpa === p.context.vpa);\n      if (i >= 0) {\n        merged.push(...next.splice(0, i + 1));\n      } else {\n        merged.push(p);\n      }\n    }\n  }\n  merged.push(...next);\n  return merged;\n}\n\nexport function tryStringify(value: unknown): string {\n  try {\n    return JSON.stringify(value);\n  } catch {\n    return Object.prototype.toString.call(value);\n  }\n}\n\nexport function ensureArrayOfStrings(value: string | string[]): string[] {\n  return typeof value === 'string' ? [value] : value;\n}\n\nexport function ensureString(value: string | string[]): string {\n  return typeof value === 'string' ? value : value[0];\n}\n","import { IIndexable } from '@aurelia/kernel';\nimport { isCustomElementViewModel, PartialCustomElementDefinition } from '@aurelia/runtime-html';\n\nimport { IChildRouteConfig, IRedirectRouteConfig, Routeable } from './route.js';\nimport { IViewportInstruction, RouteableComponent } from './instructions.js';\nimport { tryStringify } from './util.js';\n\nexport function isNotNullishOrTypeOrViewModel(value: RouteableComponent | IChildRouteConfig | null | undefined): value is PartialCustomElementDefinition | IChildRouteConfig {\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    !isCustomElementViewModel(value)\n  );\n}\n\nexport function isPartialCustomElementDefinition(value: RouteableComponent | IChildRouteConfig | null | undefined): value is PartialCustomElementDefinition {\n  // 'name' is the only mandatory property of a CustomElementDefinition.\n  // It overlaps with RouteType and may overlap with CustomElementViewModel, so this ducktype check is only valid when those are ruled out *first*\n  return (\n    isNotNullishOrTypeOrViewModel(value) &&\n    Object.prototype.hasOwnProperty.call(value, 'name') === true\n  );\n}\n\nexport function isPartialChildRouteConfig(value: RouteableComponent | IChildRouteConfig | IRedirectRouteConfig | null | undefined): value is IChildRouteConfig {\n  // 'component' is the only mandatory property of a ChildRouteConfig\n  // It may overlap with RouteType and CustomElementViewModel, so this ducktype check is only valid when those are ruled out *first*\n  return (\n    isNotNullishOrTypeOrViewModel(value) &&\n    Object.prototype.hasOwnProperty.call(value, 'component') === true\n  );\n}\n\nexport function isPartialRedirectRouteConfig(value: RouteableComponent | IChildRouteConfig | IRedirectRouteConfig | null | undefined): value is IRedirectRouteConfig {\n  // 'redirectTo' and 'path' are mandatory properties of a RedirectRouteConfig\n  // It may overlap with RouteType and CustomElementViewModel, so this ducktype check is only valid when those are ruled out *first*\n  return (\n    isNotNullishOrTypeOrViewModel(value) &&\n    Object.prototype.hasOwnProperty.call(value, 'redirectTo') === true\n  );\n}\n\n// Yes, `isPartialChildRouteConfig` and `isPartialViewportInstruction` have identical logic but since that is coincidental,\n// and the two are intended to be used in specific contexts, we keep these as two separate functions for now.\nexport function isPartialViewportInstruction(value: RouteableComponent | IViewportInstruction | null | undefined): value is IViewportInstruction {\n  // 'component' is the only mandatory property of a INavigationInstruction\n  // It may overlap with RouteType and CustomElementViewModel, so this ducktype check is only valid when those are ruled out *first*\n  return (\n    isNotNullishOrTypeOrViewModel(value) &&\n    Object.prototype.hasOwnProperty.call(value, 'component') === true\n  );\n}\n\nexport function expectType(expected: string, prop: string, value: unknown): never {\n  throw new Error(`Invalid route config property: \"${prop}\". Expected ${expected}, but got ${tryStringify(value)}.`);\n}\n\n/**\n * Validate a `IRouteConfig` or `IChildRouteConfig`.\n *\n * The validation of these types is the same, except that `component` is a mandatory property of `IChildRouteConfig`.\n * This property is checked for in `validateComponent`.\n */\nexport function validateRouteConfig(config: Partial<IChildRouteConfig> | null | undefined, parentPath: string): void {\n  if (config === null || config === void 0) {\n    throw new Error(`Invalid route config: expected an object or string, but got: ${String(config)}.`);\n  }\n\n  const keys = Object.keys(config) as (keyof IChildRouteConfig)[];\n  for (const key of keys) {\n    const value = config[key];\n    const path = [parentPath, key].join('.');\n    switch (key) {\n      case 'id':\n      case 'viewport':\n      case 'redirectTo':\n        if (typeof value !== 'string') {\n          expectType('string', path, value);\n        }\n        break;\n      case 'caseSensitive':\n        if (typeof value !== 'boolean') {\n          expectType('boolean', path, value);\n        }\n        break;\n      case 'data':\n        if (typeof value !== 'object' || value === null) {\n          expectType('object', path, value);\n        }\n        break;\n      case 'title':\n        switch (typeof value) {\n          case 'string':\n          case 'function':\n            break;\n          default:\n            expectType('string or function', path, value);\n        }\n        break;\n      case 'path':\n        if (value instanceof Array) {\n          for (let i = 0; i < value.length; ++i) {\n            if (typeof value[i] !== 'string') {\n              expectType('string', `${path}[${i}]`, value[i]);\n            }\n          }\n        } else if (typeof value !== 'string') {\n          expectType('string or Array of strings', path, value);\n        }\n        break;\n      case 'component':\n        validateComponent(value, path);\n        break;\n      case 'routes': {\n        if (!(value instanceof Array)) {\n          expectType('Array', path, value);\n        }\n        for (const route of value) {\n          const childPath = `${path}[${value.indexOf(route as any)}]`; // TODO(fkleuver): remove 'any' (this type got very messy for some reason)\n          validateComponent(route, childPath);\n        }\n        break;\n      }\n      case 'transitionPlan':\n        switch (typeof value) {\n          case 'string':\n            switch (value) {\n              case 'none':\n              case 'replace':\n              case 'invoke-lifecycles':\n                break;\n              default:\n                expectType('string(\\'none\\'|\\'replace\\'|\\'invoke-lifecycles\\') or function', path, value);\n            }\n            break;\n          case 'function':\n            break;\n          default:\n            expectType('string(\\'none\\'|\\'replace\\'|\\'invoke-lifecycles\\') or function', path, value);\n        }\n        break;\n      default:\n        // We don't *have* to throw here, but let's be as strict as possible until someone gives a valid reason for not doing so.\n        throw new Error(`Unknown route config property: \"${parentPath}.${key as string}\". Please specify known properties only.`);\n    }\n  }\n}\n\nexport function validateRedirectRouteConfig(config: Partial<IRedirectRouteConfig> | null | undefined, parentPath: string): void {\n  if (config === null || config === void 0) {\n    throw new Error(`Invalid route config: expected an object or string, but got: ${String(config)}.`);\n  }\n\n  const keys = Object.keys(config) as (keyof IRedirectRouteConfig)[];\n  for (const key of keys) {\n    const value = config[key];\n    const path = [parentPath, key].join('.');\n    switch (key) {\n      case 'path':\n      case 'redirectTo':\n        if (typeof value !== 'string') {\n          expectType('string', path, value);\n        }\n        break;\n      default:\n        // We don't *have* to throw here, but let's be as strict as possible until someone gives a valid reason for not doing so.\n        throw new Error(`Unknown redirect config property: \"${parentPath}.${key as string}\". Only 'path' and 'redirectTo' should be specified for redirects.`);\n    }\n  }\n}\n\nexport function validateComponent(component: Routeable | null | undefined, parentPath: string): void {\n  switch (typeof component) {\n    case 'function':\n      break;\n    case 'object':\n      if (component instanceof Promise) {\n        break;\n      }\n      if (isPartialRedirectRouteConfig(component)) {\n        validateRedirectRouteConfig(component, parentPath);\n        break;\n      }\n      if (isPartialChildRouteConfig(component)) {\n        validateRouteConfig(component, parentPath);\n        break;\n      }\n      if (\n        !isCustomElementViewModel(component) &&\n        !isPartialCustomElementDefinition(component)\n      ) {\n        expectType(`an object with at least a 'component' property (see Routeable)`, parentPath, component);\n      }\n      break;\n    case 'string':\n      break;\n    default:\n      expectType('function, object or string (see Routeable)', parentPath, component);\n  }\n}\n\nexport function shallowEquals<T>(a: T, b: T): boolean {\n  if (a === b) {\n    return true;\n  }\n\n  if (typeof a !== typeof b) {\n    return false;\n  }\n\n  if (a === null || b === null) {\n    return false;\n  }\n\n  if (Object.getPrototypeOf(a) !== Object.getPrototypeOf(b)) {\n    return false;\n  }\n\n  const aKeys = Object.keys(a);\n  const bKeys = Object.keys(b);\n\n  if (aKeys.length !== bKeys.length) {\n    return false;\n  }\n\n  for (let i = 0, ii = aKeys.length; i < ii; ++i) {\n    const key = aKeys[i];\n    if (key !== bKeys[i]) {\n      return false;\n    }\n    if ((a as IIndexable)[key] !== (b as IIndexable)[key]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/* eslint-disable @typescript-eslint/restrict-template-expressions */\nimport { DI, IEventAggregator, IDisposable, ILogger } from '@aurelia/kernel';\n\nimport { ManagedState } from './router.js';\nimport { ViewportInstructionTree } from './instructions.js';\n\nclass Subscription implements IDisposable {\n  private disposed: boolean = false;\n\n  public constructor(\n    private readonly events: IRouterEvents,\n    /**\n     * A unique serial number that makes individual subscribers more easily distinguishable in chronological order.\n     *\n     * Mainly for debugging purposes.\n     */\n    public readonly serial: number,\n    private readonly inner: IDisposable,\n  ) {}\n\n  public dispose(): void {\n    if (!this.disposed) {\n      this.disposed = true;\n\n      this.inner.dispose();\n      const subscriptions = this.events['subscriptions'];\n      subscriptions.splice(subscriptions.indexOf(this), 1);\n    }\n  }\n}\n\nexport const IRouterEvents = DI.createInterface<IRouterEvents>('IRouterEvents', x => x.singleton(RouterEvents));\nexport interface IRouterEvents extends RouterEvents {}\nexport class RouterEvents implements IRouterEvents {\n  private subscriptionSerial: number = 0;\n  private readonly subscriptions: Subscription[] = [];\n\n  public constructor(\n    @IEventAggregator private readonly ea: IEventAggregator,\n    @ILogger private readonly logger: ILogger,\n  ) {\n    this.logger = logger.scopeTo('RouterEvents');\n  }\n\n  public publish(event: RouterEvent): void {\n    this.logger.trace(`publishing %s`, event);\n\n    this.ea.publish(event.name, event);\n  }\n\n  public subscribe<T extends RouterEvent['name']>(event: T, callback: (message: NameToEvent[T]) => void): IDisposable {\n    const subscription = new Subscription(\n      this,\n      ++this.subscriptionSerial,\n      this.ea.subscribe(event, (message: NameToEvent[T]) => {\n        this.logger.trace(`handling %s for subscription #${subscription.serial}`, event);\n        callback(message);\n      })\n    );\n\n    this.subscriptions.push(subscription);\n    return subscription;\n  }\n}\n\nexport class LocationChangeEvent {\n  public get name(): 'au:router:location-change' { return 'au:router:location-change'; }\n\n  public constructor(\n    public readonly id: number,\n    public readonly url: string,\n    public readonly trigger: 'popstate' | 'hashchange',\n    public readonly state: {} | null,\n  ) {}\n\n  public toString(): string {\n    return `LocationChangeEvent(id:${this.id},url:'${this.url}',trigger:'${this.trigger}')`;\n  }\n}\n\nexport class NavigationStartEvent {\n  public get name(): 'au:router:navigation-start' { return 'au:router:navigation-start'; }\n\n  public constructor(\n    public readonly id: number,\n    public readonly instructions: ViewportInstructionTree,\n    public readonly trigger: 'popstate' | 'hashchange' | 'api',\n    public readonly managedState: ManagedState | null,\n  ) {}\n\n  public toString(): string {\n    return `NavigationStartEvent(id:${this.id},instructions:'${this.instructions}',trigger:'${this.trigger}')`;\n  }\n}\n\nexport class NavigationEndEvent {\n  public get name(): 'au:router:navigation-end' { return 'au:router:navigation-end'; }\n\n  public constructor(\n    public readonly id: number,\n    public readonly instructions: ViewportInstructionTree,\n    public readonly finalInstructions: ViewportInstructionTree,\n  ) {}\n\n  public toString(): string {\n    return `NavigationEndEvent(id:${this.id},instructions:'${this.instructions}',finalInstructions:'${this.finalInstructions}')`;\n  }\n}\n\nexport class NavigationCancelEvent {\n  public get name(): 'au:router:navigation-cancel' { return 'au:router:navigation-cancel'; }\n\n  public constructor(\n    public readonly id: number,\n    public readonly instructions: ViewportInstructionTree,\n    public readonly reason: unknown,\n  ) {}\n\n  public toString(): string {\n    return `NavigationCancelEvent(id:${this.id},instructions:'${this.instructions}',reason:${String(this.reason)})`;\n  }\n}\n\nexport class NavigationErrorEvent {\n  public get name(): 'au:router:navigation-error' { return 'au:router:navigation-error'; }\n\n  public constructor(\n    public readonly id: number,\n    public readonly instructions: ViewportInstructionTree,\n    public readonly error: unknown,\n  ) {}\n\n  public toString(): string {\n    return `NavigationErrorEvent(id:${this.id},instructions:'${this.instructions}',error:${String(this.error)})`;\n  }\n}\n\ntype NameToEvent = {\n  [LocationChangeEvent.prototype.name]: LocationChangeEvent;\n  [NavigationStartEvent.prototype.name]: NavigationStartEvent;\n  [NavigationEndEvent.prototype.name]: NavigationEndEvent;\n  [NavigationCancelEvent.prototype.name]: NavigationCancelEvent;\n  [NavigationErrorEvent.prototype.name]: NavigationErrorEvent;\n};\n\nexport type RouterEvent = (\n  LocationChangeEvent |\n  NavigationStartEvent |\n  NavigationEndEvent |\n  NavigationCancelEvent |\n  NavigationErrorEvent\n);\n","import { ILogger, DI, bound } from '@aurelia/kernel';\nimport { IHistory, ILocation, IWindow } from '@aurelia/runtime-html';\n\nimport { IRouterEvents, LocationChangeEvent } from './router-events.js';\n\nexport interface IPopStateEvent extends PopStateEvent {}\nexport interface IHashChangeEvent extends HashChangeEvent {}\n\nexport const IBaseHrefProvider = DI.createInterface<IBaseHrefProvider>('IBaseHrefProvider', x => x.singleton(BrowserBaseHrefProvider));\nexport interface IBaseHrefProvider extends BrowserBaseHrefProvider {}\n\nexport class BaseHref {\n  public constructor(\n    public readonly path: string,\n    public readonly rootedPath: string,\n  ) {}\n}\n\n/**\n * Default browser base href provider.\n *\n * Retrieves the base href based on the `<base>` element from `window.document.head`\n *\n * This is internal API for the moment. The shape of this API (as well as in which package it resides) is also likely temporary.\n */\nexport class BrowserBaseHrefProvider {\n  public constructor(\n    @IWindow private readonly window: IWindow,\n  ) {}\n\n  public getBaseHref(): BaseHref | null {\n    const base = this.window.document.head.querySelector('base');\n    if (base === null) {\n      return null;\n    }\n\n    const rootedPath = normalizePath(base.href);\n    const path = normalizePath(base.getAttribute('href') ?? '');\n    return new BaseHref(path, rootedPath);\n  }\n}\n\nexport const ILocationManager = DI.createInterface<ILocationManager>('ILocationManager', x => x.singleton(BrowserLocationManager));\nexport interface ILocationManager extends BrowserLocationManager {}\n\n/**\n * Default browser location manager.\n *\n * Encapsulates all DOM interactions (`window`, `location` and `history` apis) and exposes them in an environment-agnostic manner.\n *\n * This is internal API for the moment. The shape of this API (as well as in which package it resides) is also likely temporary.\n */\nexport class BrowserLocationManager {\n  private readonly baseHref: BaseHref;\n  private eventId: number = 0;\n\n  public constructor(\n    @ILogger private readonly logger: ILogger,\n    @IRouterEvents private readonly events: IRouterEvents,\n    @IHistory private readonly history: IHistory,\n    @ILocation private readonly location: ILocation,\n    @IWindow private readonly window: IWindow,\n    @IBaseHrefProvider private readonly baseHrefProvider: IBaseHrefProvider,\n  ) {\n    this.logger = logger.root.scopeTo('LocationManager');\n\n    const baseHref = baseHrefProvider.getBaseHref();\n    if (baseHref === null) {\n      const origin = location.origin ?? '';\n      const baseHref = this.baseHref = new BaseHref('', normalizePath(origin));\n      this.logger.warn(`no baseHref provided, defaulting to origin '${baseHref.rootedPath}' (normalized from '${origin}')`);\n    } else {\n      this.baseHref = baseHref;\n      this.logger.debug(`baseHref set to path: '${baseHref.path}', rootedPath: '${baseHref.rootedPath}'`);\n    }\n  }\n\n  public startListening(): void {\n    this.logger.trace(`startListening()`);\n\n    this.window.addEventListener('popstate', this.onPopState, false);\n    this.window.addEventListener('hashchange', this.onHashChange, false);\n  }\n\n  public stopListening(): void {\n    this.logger.trace(`stopListening()`);\n\n    this.window.removeEventListener('popstate', this.onPopState, false);\n    this.window.removeEventListener('hashchange', this.onHashChange, false);\n  }\n\n  @bound\n  private onPopState(event: IPopStateEvent): void {\n    this.logger.trace(`onPopState()`);\n\n    this.events.publish(new LocationChangeEvent(\n      ++this.eventId,\n      this.getPath(),\n      'popstate',\n      event.state,\n    ));\n  }\n\n  @bound\n  private onHashChange(_event: IHashChangeEvent): void {\n    this.logger.trace(`onHashChange()`);\n\n    this.events.publish(new LocationChangeEvent(\n      ++this.eventId,\n      this.getPath(),\n      'hashchange',\n      null,\n    ));\n  }\n\n  public pushState(state: {} | null, title: string, url: string): void {\n    url = this.addBaseHref(url);\n    try {\n      const stateString = JSON.stringify(state);\n      this.logger.trace(`pushState(state:${stateString},title:'${title}',url:'${url}')`);\n    } catch (err) {\n      this.logger.warn(`pushState(state:NOT_SERIALIZABLE,title:'${title}',url:'${url}')`);\n    }\n\n    this.history.pushState(state, title, url);\n  }\n\n  public replaceState(state: {} | null, title: string, url: string): void {\n    url = this.addBaseHref(url);\n    try {\n      const stateString = JSON.stringify(state);\n      this.logger.trace(`replaceState(state:${stateString},title:'${title}',url:'${url}')`);\n    } catch (err) {\n      this.logger.warn(`replaceState(state:NOT_SERIALIZABLE,title:'${title}',url:'${url}')`);\n    }\n\n    this.history.replaceState(state, title, url);\n  }\n\n  public getPath(): string {\n    const { pathname, search, hash } = this.location;\n    const path = this.removeBaseHref(`${pathname}${normalizeQuery(search)}${hash}`);\n\n    this.logger.trace(`getPath() -> '${path}'`);\n\n    return path;\n  }\n\n  public currentPathEquals(path: string): boolean {\n    const equals = this.getPath() === this.removeBaseHref(path);\n\n    this.logger.trace(`currentPathEquals(path:'${path}') -> ${equals}`);\n\n    return equals;\n  }\n\n  public addBaseHref(path: string): string {\n    const initialPath = path;\n    let fullPath: string;\n\n    let base = this.baseHref.rootedPath;\n    if (base.endsWith('/')) {\n      base = base.slice(0, -1);\n    }\n\n    if (base.length === 0) {\n      fullPath = path;\n    } else {\n      if (path.startsWith('/')) {\n        path = path.slice(1);\n      }\n      fullPath = `${base}/${path}`;\n    }\n\n    this.logger.trace(`addBaseHref(path:'${initialPath}') -> '${fullPath}'`);\n\n    return fullPath;\n  }\n\n  public removeBaseHref(path: string): string {\n    const $path = path;\n    if (path.startsWith(this.baseHref.path)) {\n      path = path.slice(this.baseHref.path.length);\n    }\n    path = normalizePath(path);\n\n    this.logger.trace(`removeBaseHref(path:'${$path}') -> '${path}'`);\n\n    return path;\n  }\n}\n\n/**\n * Strip trailing `/index.html` and trailing `/` from the path, if present.\n */\nfunction normalizePath(path: string): string {\n  let start: string;\n  let end: string;\n  let index: number;\n\n  if ((index = path.indexOf('?')) >= 0 || (index = path.indexOf('#')) >= 0) {\n    start = path.slice(0, index);\n    end = path.slice(index);\n  } else {\n    start = path;\n    end = '';\n  }\n\n  if (start.endsWith('/')) {\n    start = start.slice(0, -1);\n  } else if (start.endsWith('/index.html')) {\n    start = start.slice(0, -11 /* '/index.html'.length */);\n  }\n\n  return `${start}${end}`;\n}\n\nfunction normalizeQuery(query: string): string {\n  return query.length > 0 && !query.startsWith('?') ? `?${query}` : query;\n}\n","// No-fallthrough disabled due to large numbers of false positives\n/* eslint-disable no-fallthrough */\n/* eslint-disable @typescript-eslint/restrict-template-expressions */\nimport { ILogger, onResolve } from '@aurelia/kernel';\nimport { IHydratedController, LifecycleFlags, ICustomElementController, Controller } from '@aurelia/runtime-html';\n\nimport { IViewport } from './resources/viewport.js';\nimport { ComponentAgent } from './component-agent.js';\nimport { processResidue, getDynamicChildren, RouteNode } from './route-tree.js';\nimport { IRouteContext } from './route-context.js';\nimport { Transition, ResolutionMode, NavigationOptions } from './router.js';\nimport { TransitionPlan } from './route.js';\nimport { Batch, mergeDistinct } from './util.js';\n\nexport class ViewportRequest {\n  public constructor(\n    public readonly viewportName: string,\n    public readonly componentName: string,\n    public readonly resolution: ResolutionMode,\n    public readonly append: boolean,\n  ) { }\n\n  public static create(input: ViewportRequest): ViewportRequest {\n    return new ViewportRequest(\n      input.viewportName,\n      input.componentName,\n      input.resolution,\n      input.append,\n    );\n  }\n\n  public toString(): string {\n    return `VR(viewport:'${this.viewportName}',component:'${this.componentName}',resolution:'${this.resolution}',append:${this.append})`;\n  }\n}\n\nconst viewportAgentLookup: WeakMap<object, ViewportAgent> = new WeakMap();\n\nexport class ViewportAgent {\n  private readonly logger: ILogger;\n\n  private isActive: boolean = false;\n\n  private curCA: ComponentAgent | null = null;\n  private nextCA: ComponentAgent | null = null;\n\n  private get $state(): string { return $state(this.state); }\n  private state: State = State.bothAreEmpty;\n  private get currState(): CurrState { return this.state & State.curr; }\n  private set currState(state: CurrState) { this.state = (this.state & State.next) | state; }\n  private get nextState(): NextState { return this.state & State.next; }\n  private set nextState(state: NextState) { this.state = (this.state & State.curr) | state; }\n\n  private $resolution: ResolutionMode = 'dynamic';\n  private $plan: TransitionPlan = 'replace';\n  private currNode: RouteNode | null = null;\n  private nextNode: RouteNode | null = null;\n\n  private currTransition: Transition | null = null;\n  private prevTransition: Transition | null = null;\n\n  public constructor(\n    public readonly viewport: IViewport,\n    public readonly hostController: ICustomElementController,\n    public readonly ctx: IRouteContext,\n  ) {\n    this.logger = ctx.container.get(ILogger).scopeTo(`ViewportAgent<${ctx.friendlyPath}>`);\n\n    this.logger.trace(`constructor()`);\n  }\n\n  public static for(viewport: IViewport, ctx: IRouteContext): ViewportAgent {\n    let viewportAgent = viewportAgentLookup.get(viewport);\n    if (viewportAgent === void 0) {\n      const controller = Controller.getCachedOrThrow<IViewport>(viewport);\n      viewportAgentLookup.set(\n        viewport,\n        viewportAgent = new ViewportAgent(viewport, controller, ctx)\n      );\n    }\n\n    return viewportAgent;\n  }\n\n  public activateFromViewport(initiator: IHydratedController, parent: IHydratedController, flags: LifecycleFlags): void | Promise<void> {\n    const tr = this.currTransition;\n    if (tr !== null) { ensureTransitionHasNotErrored(tr); }\n    this.isActive = true;\n\n    switch (this.nextState) {\n      case State.nextIsEmpty:\n        switch (this.currState) {\n          case State.currIsEmpty:\n            this.logger.trace(`activateFromViewport() - nothing to activate at %s`, this);\n            return;\n          case State.currIsActive:\n            this.logger.trace(`activateFromViewport() - activating existing componentAgent at %s`, this);\n            return this.curCA!.activate(initiator, parent, flags);\n          default:\n            this.unexpectedState('activateFromViewport 1');\n        }\n      case State.nextLoadDone: {\n        if (this.currTransition === null) {\n          throw new Error(`Unexpected viewport activation outside of a transition context at ${this}`);\n        }\n        if (this.$resolution !== 'static') {\n          throw new Error(`Unexpected viewport activation at ${this}`);\n        }\n        this.logger.trace(`activateFromViewport() - running ordinary activate at %s`, this);\n        const b = Batch.start(b1 => { this.activate(initiator, this.currTransition!, b1); });\n        const p = new Promise<void>(resolve => { b.continueWith(() => { resolve(); }); });\n        return b.start().done ? void 0 : p;\n      }\n      default:\n        this.unexpectedState('activateFromViewport 2');\n    }\n  }\n\n  public deactivateFromViewport(initiator: IHydratedController, parent: IHydratedController, flags: LifecycleFlags): void | Promise<void> {\n    const tr = this.currTransition;\n    if (tr !== null) { ensureTransitionHasNotErrored(tr); }\n    this.isActive = false;\n\n    switch (this.currState) {\n      case State.currIsEmpty:\n        this.logger.trace(`deactivateFromViewport() - nothing to deactivate at %s`, this);\n        return;\n      case State.currIsActive:\n        this.logger.trace(`deactivateFromViewport() - deactivating existing componentAgent at %s`, this);\n        return this.curCA!.deactivate(initiator, parent, flags);\n      case State.currDeactivate:\n        // This will happen with bottom-up deactivation because the child is already deactivated, the parent\n        // again tries to deactivate the child (that would be this viewport) but the router hasn't finalized the transition yet.\n        // Since this is viewport was already deactivated, and we know the precise circumstance under which that happens, we can safely ignore the call.\n        this.logger.trace(`deactivateFromViewport() - already deactivating at %s`, this);\n        return;\n      default: {\n        if (this.currTransition === null) {\n          throw new Error(`Unexpected viewport deactivation outside of a transition context at ${this}`);\n        }\n        this.logger.trace(`deactivateFromViewport() - running ordinary deactivate at %s`, this);\n        const b = Batch.start(b1 => { this.deactivate(initiator, this.currTransition!, b1); });\n        const p = new Promise<void>(resolve => { b.continueWith(() => { resolve(); }); });\n        return b.start().done ? void 0 : p;\n      }\n    }\n  }\n\n  public handles(req: ViewportRequest): boolean {\n    if (!this.isAvailable(req.resolution)) {\n      return false;\n    }\n\n    if (req.append && this.currState === State.currIsActive) {\n      this.logger.trace(`handles(req:%s) -> false (append mode, viewport already has content %s)`, req, this.curCA);\n      return false;\n    }\n\n    if (req.viewportName.length > 0 && this.viewport.name !== req.viewportName) {\n      this.logger.trace(`handles(req:%s) -> false (names don't match)`, req);\n      return false;\n    }\n\n    if (this.viewport.usedBy.length > 0 && !this.viewport.usedBy.split(',').includes(req.componentName)) {\n      this.logger.trace(`handles(req:%s) -> false (componentName not included in usedBy)`, req);\n      return false;\n    }\n\n    this.logger.trace(`handles(req:%s) -> true`, req);\n    return true;\n  }\n\n  public isAvailable(resolution: ResolutionMode): boolean {\n    if (resolution === 'dynamic' && !this.isActive) {\n      this.logger.trace(`isAvailable(resolution:%s) -> false (viewport is not active and we're in dynamic resolution resolution)`, resolution);\n      return false;\n    }\n\n    if (this.nextState !== State.nextIsEmpty) {\n      this.logger.trace(`isAvailable(resolution:%s) -> false (update already scheduled for %s)`, resolution, this.nextNode);\n      return false;\n    }\n\n    return true;\n  }\n\n  public canUnload(tr: Transition, b: Batch): void {\n    if (this.currTransition === null) { this.currTransition = tr; }\n    ensureTransitionHasNotErrored(tr);\n    if (tr.guardsResult !== true) { return; }\n\n    b.push();\n\n    // run canUnload bottom-up\n    Batch.start(b1 => {\n      this.logger.trace(`canUnload() - invoking on children at %s`, this);\n      for (const node of this.currNode!.children) {\n        node.context.vpa.canUnload(tr, b1);\n      }\n    }).continueWith(b1 => {\n      switch (this.currState) {\n        case State.currIsActive:\n          this.logger.trace(`canUnload() - invoking on existing component at %s`, this);\n          switch (this.$plan) {\n            case 'none':\n              this.currState = State.currCanUnloadDone;\n              return;\n            case 'invoke-lifecycles':\n            case 'replace':\n              this.currState = State.currCanUnload;\n              b1.push();\n              Batch.start(b2 => {\n                this.logger.trace(`canUnload() - finished invoking on children, now invoking on own component at %s`, this);\n                this.curCA!.canUnload(tr, this.nextNode, b2);\n              }).continueWith(() => {\n                this.logger.trace(`canUnload() - finished at %s`, this);\n                this.currState = State.currCanUnloadDone;\n                b1.pop();\n              }).start();\n              return;\n          }\n        case State.currIsEmpty:\n          this.logger.trace(`canUnload() - nothing to unload at %s`, this);\n          return;\n        default:\n          tr.handleError(new Error(`Unexpected state at canUnload of ${this}`));\n      }\n    }).continueWith(() => {\n      b.pop();\n    }).start();\n  }\n\n  public canLoad(tr: Transition, b: Batch): void {\n    if (this.currTransition === null) { this.currTransition = tr; }\n    ensureTransitionHasNotErrored(tr);\n    if (tr.guardsResult !== true) { return; }\n\n    b.push();\n\n    // run canLoad top-down\n    Batch.start(b1 => {\n      switch (this.nextState) {\n        case State.nextIsScheduled:\n          this.logger.trace(`canLoad() - invoking on new component at %s`, this);\n          this.nextState = State.nextCanLoad;\n          switch (this.$plan) {\n            case 'none':\n              return;\n            case 'invoke-lifecycles':\n              return this.curCA!.canLoad(tr, this.nextNode!, b1);\n            case 'replace':\n              this.nextCA = this.nextNode!.context.createComponentAgent(this.hostController, this.nextNode!);\n              return this.nextCA.canLoad(tr, this.nextNode!, b1);\n          }\n        case State.nextIsEmpty:\n          this.logger.trace(`canLoad() - nothing to load at %s`, this);\n          return;\n        default:\n          this.unexpectedState('canLoad');\n      }\n    }).continueWith(b1 => {\n      const next = this.nextNode!;\n      switch (this.$plan) {\n        case 'none':\n        case 'invoke-lifecycles':\n          this.logger.trace(`canLoad(next:%s) - plan set to '%s', compiling residue`, next, this.$plan);\n\n          // These plans can only occur if there is already a current component active in this viewport,\n          // and it is the same component as `next`.\n          // This means the RouteContext of `next` was created during a previous transition and might contain\n          // already-active children. If that is the case, we want to eagerly call the router hooks on them during the\n          // first pass of activation, instead of lazily in a later pass after `processResidue`.\n          // By calling `compileResidue` here on the current context, we're ensuring that such nodes are created and\n          // their target viewports have the appropriate updates scheduled.\n          b1.push();\n          void onResolve(processResidue(next), () => {\n            b1.pop();\n          });\n          return;\n        case 'replace':\n          // In the case of 'replace', always process this node and its subtree as if it's a new one\n          switch (this.$resolution) {\n            case 'dynamic':\n              // Residue compilation will happen at `ViewportAgent#processResidue`\n              this.logger.trace(`canLoad(next:%s) - (resolution: 'dynamic'), delaying residue compilation until activate`, next, this.$plan);\n              return;\n            case 'static':\n              this.logger.trace(`canLoad(next:%s) - (resolution: '${this.$resolution}'), creating nextCA and compiling residue`, next, this.$plan);\n              b1.push();\n              void onResolve(processResidue(next), () => {\n                b1.pop();\n              });\n              return;\n          }\n      }\n    }).continueWith(b1 => {\n      switch (this.nextState) {\n        case State.nextCanLoad:\n          this.logger.trace(`canLoad() - finished own component, now invoking on children at %s`, this);\n          this.nextState = State.nextCanLoadDone;\n          for (const node of this.nextNode!.children) {\n            node.context.vpa.canLoad(tr, b1);\n          }\n          return;\n        case State.nextIsEmpty:\n          return;\n        default:\n          this.unexpectedState('canLoad');\n      }\n    }).continueWith(() => {\n      this.logger.trace(`canLoad() - finished at %s`, this);\n      b.pop();\n    }).start();\n  }\n\n  public unload(tr: Transition, b: Batch): void {\n    ensureTransitionHasNotErrored(tr);\n    ensureGuardsResultIsTrue(this, tr);\n\n    b.push();\n\n    // run unload bottom-up\n    Batch.start(b1 => {\n      this.logger.trace(`unload() - invoking on children at %s`, this);\n      for (const node of this.currNode!.children) {\n        node.context.vpa.unload(tr, b1);\n      }\n    }).continueWith(b1 => {\n      switch (this.currState) {\n        case State.currCanUnloadDone:\n          this.logger.trace(`unload() - invoking on existing component at %s`, this);\n          switch (this.$plan) {\n            case 'none':\n              this.currState = State.currUnloadDone;\n              return;\n            case 'invoke-lifecycles':\n            case 'replace':\n              this.currState = State.currUnload;\n              b1.push();\n              Batch.start(b2 => {\n                this.logger.trace(`unload() - finished invoking on children, now invoking on own component at %s`, this);\n                this.curCA!.unload(tr, this.nextNode, b2);\n              }).continueWith(() => {\n                this.logger.trace(`unload() - finished at %s`, this);\n                this.currState = State.currUnloadDone;\n                b1.pop();\n              }).start();\n              return;\n          }\n        case State.currIsEmpty:\n          this.logger.trace(`unload() - nothing to unload at %s`, this);\n          for (const node of this.currNode!.children) {\n            node.context.vpa.unload(tr, b);\n          }\n          return;\n        default:\n          this.unexpectedState('unload');\n      }\n    }).continueWith(() => {\n      b.pop();\n    }).start();\n  }\n\n  public load(tr: Transition, b: Batch): void {\n    ensureTransitionHasNotErrored(tr);\n    ensureGuardsResultIsTrue(this, tr);\n\n    b.push();\n\n    // run load top-down\n    Batch.start(b1 => {\n      switch (this.nextState) {\n        case State.nextCanLoadDone: {\n          this.logger.trace(`load() - invoking on new component at %s`, this);\n          this.nextState = State.nextLoad;\n          switch (this.$plan) {\n            case 'none':\n              return;\n            case 'invoke-lifecycles':\n              return this.curCA!.load(tr, this.nextNode!, b1);\n            case 'replace':\n              return this.nextCA!.load(tr, this.nextNode!, b1);\n          }\n        }\n        case State.nextIsEmpty:\n          this.logger.trace(`load() - nothing to load at %s`, this);\n          return;\n        default:\n          this.unexpectedState('load');\n      }\n    }).continueWith(b1 => {\n      switch (this.nextState) {\n        case State.nextLoad:\n          this.logger.trace(`load() - finished own component, now invoking on children at %s`, this);\n          this.nextState = State.nextLoadDone;\n          for (const node of this.nextNode!.children) {\n            node.context.vpa.load(tr, b1);\n          }\n          return;\n        case State.nextIsEmpty:\n          return;\n        default:\n          this.unexpectedState('load');\n      }\n    }).continueWith(() => {\n      this.logger.trace(`load() - finished at %s`, this);\n      b.pop();\n    }).start();\n  }\n\n  public deactivate(initiator: IHydratedController | null, tr: Transition, b: Batch): void {\n    ensureTransitionHasNotErrored(tr);\n    ensureGuardsResultIsTrue(this, tr);\n\n    b.push();\n\n    switch (this.currState) {\n      case State.currUnloadDone:\n        this.logger.trace(`deactivate() - invoking on existing component at %s`, this);\n        this.currState = State.currDeactivate;\n        switch (this.$plan) {\n          case 'none':\n          case 'invoke-lifecycles':\n            b.pop();\n            return;\n          case 'replace': {\n            const controller = this.hostController;\n            const deactivateFlags = this.viewport.stateful ? LifecycleFlags.none : LifecycleFlags.dispose;\n            tr.run(() => {\n              return this.curCA!.deactivate(initiator, controller, deactivateFlags);\n            }, () => {\n              b.pop();\n            });\n          }\n        }\n        return;\n      case State.currIsEmpty:\n        this.logger.trace(`deactivate() - nothing to deactivate at %s`, this);\n        b.pop();\n        return;\n      case State.currDeactivate:\n        this.logger.trace(`deactivate() - already deactivating at %s`, this);\n        b.pop();\n        return;\n      default:\n        this.unexpectedState('deactivate');\n    }\n  }\n\n  public activate(initiator: IHydratedController | null, tr: Transition, b: Batch): void {\n    ensureTransitionHasNotErrored(tr);\n    ensureGuardsResultIsTrue(this, tr);\n\n    b.push();\n\n    if (\n      this.nextState === State.nextIsScheduled &&\n      this.$resolution === 'dynamic'\n    ) {\n      this.logger.trace(`activate() - invoking canLoad(), load() and activate() on new component due to resolution 'dynamic' at %s`, this);\n      // This is the default v2 mode \"lazy loading\" situation\n      Batch.start(b1 => {\n        this.canLoad(tr, b1);\n      }).continueWith(b1 => {\n        this.load(tr, b1);\n      }).continueWith(b1 => {\n        this.activate(initiator, tr, b1);\n      }).continueWith(() => {\n        b.pop();\n      }).start();\n      return;\n    }\n\n    switch (this.nextState) {\n      case State.nextLoadDone:\n        this.logger.trace(`activate() - invoking on existing component at %s`, this);\n        this.nextState = State.nextActivate;\n        // run activate top-down\n        Batch.start(b1 => {\n          switch (this.$plan) {\n            case 'none':\n            case 'invoke-lifecycles':\n              return;\n            case 'replace': {\n              const controller = this.hostController;\n              const activateFlags = LifecycleFlags.none;\n              tr.run(() => {\n                b1.push();\n                return this.nextCA!.activate(initiator, controller, activateFlags);\n              }, () => {\n                b1.pop();\n              });\n            }\n          }\n        }).continueWith(b1 => {\n          this.processDynamicChildren(tr, b1);\n        }).continueWith(() => {\n          b.pop();\n        }).start();\n        return;\n      case State.nextIsEmpty:\n        this.logger.trace(`activate() - nothing to activate at %s`, this);\n        b.pop();\n        return;\n      default:\n        this.unexpectedState('activate');\n    }\n  }\n\n  public swap(tr: Transition, b: Batch): void {\n    if (this.currState === State.currIsEmpty) {\n      this.logger.trace(`swap() - running activate on next instead, because there is nothing to deactivate at %s`, this);\n      this.activate(null, tr, b);\n      return;\n    }\n    if (this.nextState === State.nextIsEmpty) {\n      this.logger.trace(`swap() - running deactivate on current instead, because there is nothing to activate at %s`, this);\n      this.deactivate(null, tr, b);\n      return;\n    }\n\n    ensureTransitionHasNotErrored(tr);\n    ensureGuardsResultIsTrue(this, tr);\n\n    if (!(\n      this.currState === State.currUnloadDone &&\n      this.nextState === State.nextLoadDone\n    )) {\n      this.unexpectedState('swap');\n    }\n\n    this.currState = State.currDeactivate;\n    this.nextState = State.nextActivate;\n\n    switch (this.$plan) {\n      case 'none':\n      case 'invoke-lifecycles': {\n        this.logger.trace(`swap() - skipping this level and swapping children instead at %s`, this);\n        const nodes = mergeDistinct(this.nextNode!.children, this.currNode!.children);\n        for (const node of nodes) {\n          node.context.vpa.swap(tr, b);\n        }\n        return;\n      }\n      case 'replace': {\n        this.logger.trace(`swap() - running normally at %s`, this);\n        const controller = this.hostController;\n        const curCA = this.curCA!;\n        const nextCA = this.nextCA!;\n        const deactivateFlags = this.viewport.stateful ? LifecycleFlags.none : LifecycleFlags.dispose;\n        const activateFlags = LifecycleFlags.none;\n        b.push();\n        switch (tr.options.swapStrategy) {\n          case 'sequential-add-first':\n            Batch.start(b1 => {\n              tr.run(() => {\n                b1.push();\n                return nextCA.activate(null, controller, activateFlags);\n              }, () => {\n                b1.pop();\n              });\n            }).continueWith(b1 => {\n              this.processDynamicChildren(tr, b1);\n            }).continueWith(() => {\n              tr.run(() => {\n                return curCA.deactivate(null, controller, deactivateFlags);\n              }, () => {\n                b.pop();\n              });\n            }).start();\n            return;\n          case 'sequential-remove-first':\n            Batch.start(b1 => {\n              tr.run(() => {\n                b1.push();\n                return curCA.deactivate(null, controller, deactivateFlags);\n              }, () => {\n                b1.pop();\n              });\n            }).continueWith(b1 => {\n              tr.run(() => {\n                b1.push();\n                return nextCA.activate(null, controller, activateFlags);\n              }, () => {\n                b1.pop();\n              });\n            }).continueWith(b1 => {\n              this.processDynamicChildren(tr, b1);\n            }).continueWith(() => {\n              b.pop();\n            }).start();\n            return;\n          case 'parallel-remove-first':\n            tr.run(() => {\n              b.push();\n              return curCA.deactivate(null, controller, deactivateFlags);\n            }, () => {\n              b.pop();\n            });\n            Batch.start(b1 => {\n              tr.run(() => {\n                b1.push();\n                return nextCA.activate(null, controller, activateFlags);\n              }, () => {\n                b1.pop();\n              });\n            }).continueWith(b1 => {\n              this.processDynamicChildren(tr, b1);\n            }).continueWith(() => {\n              b.pop();\n            }).start();\n            return;\n        }\n      }\n    }\n  }\n\n  private processDynamicChildren(tr: Transition, b: Batch): void {\n    this.logger.trace(`processDynamicChildren() - %s`, this);\n    const next = this.nextNode!;\n\n    tr.run(() => {\n      b.push();\n      return getDynamicChildren(next);\n    }, newChildren => {\n      Batch.start(b1 => {\n        for (const node of newChildren) {\n          tr.run(() => {\n            b1.push();\n            return node.context.vpa.canLoad(tr, b1);\n          }, () => {\n            b1.pop();\n          });\n        }\n      }).continueWith(b1 => {\n        for (const node of newChildren) {\n          tr.run(() => {\n            b1.push();\n            return node.context.vpa.load(tr, b1);\n          }, () => {\n            b1.pop();\n          });\n        }\n      }).continueWith(b1 => {\n        for (const node of newChildren) {\n          tr.run(() => {\n            b1.push();\n            return node.context.vpa.activate(null, tr, b1);\n          }, () => {\n            b1.pop();\n          });\n        }\n      }).continueWith(() => {\n        b.pop();\n      }).start();\n    });\n  }\n\n  public scheduleUpdate(options: NavigationOptions, next: RouteNode): void | Promise<void> {\n    switch (this.nextState) {\n      case State.nextIsEmpty:\n        this.nextNode = next;\n        this.nextState = State.nextIsScheduled;\n        this.$resolution = options.resolutionMode;\n        break;\n      default:\n        this.unexpectedState('scheduleUpdate 1');\n    }\n\n    switch (this.currState) {\n      case State.currIsEmpty:\n      case State.currIsActive:\n      case State.currCanUnloadDone:\n        break;\n      default:\n        this.unexpectedState('scheduleUpdate 2');\n    }\n\n    const cur = this.curCA?.routeNode ?? null;\n    if (cur === null || cur.component !== next.component) {\n      // Component changed (or is cleared), so set to 'replace'\n      this.$plan = 'replace';\n    } else {\n      // Component is the same, so determine plan based on config and/or convention\n      const plan = next.context.definition.config.transitionPlan;\n      if (typeof plan === 'function') {\n        this.$plan = plan(cur, next);\n      } else {\n        this.$plan = plan;\n      }\n    }\n\n    this.logger.trace(`scheduleUpdate(next:%s) - plan set to '%s'`, next, this.$plan);\n  }\n\n  public cancelUpdate(): void {\n    if (this.currNode !== null) {\n      this.currNode.children.forEach(function (node) {\n        node.context.vpa.cancelUpdate();\n      });\n    }\n    if (this.nextNode !== null) {\n      this.nextNode.children.forEach(function (node) {\n        node.context.vpa.cancelUpdate();\n      });\n    }\n\n    this.logger.trace(`cancelUpdate(nextNode:%s)`, this.nextNode);\n\n    switch (this.currState) {\n      case State.currIsEmpty:\n      case State.currIsActive:\n        break;\n      case State.currCanUnload:\n      case State.currCanUnloadDone:\n        this.currState = State.currIsActive;\n        break;\n      case State.currUnload:\n      case State.currDeactivate:\n        // TODO: should schedule an 'undo' action\n        break;\n    }\n\n    switch (this.nextState) {\n      case State.nextIsEmpty:\n      case State.nextIsScheduled:\n      case State.nextCanLoad:\n      case State.nextCanLoadDone:\n        this.nextNode = null;\n        this.nextState = State.nextIsEmpty;\n        break;\n      case State.nextLoad:\n      case State.nextActivate:\n        // TODO: should schedule an 'undo' action\n        break;\n    }\n  }\n\n  public endTransition(): void {\n    if (this.currNode !== null) {\n      this.currNode.children.forEach(function (node) {\n        node.context.vpa.endTransition();\n      });\n    }\n    if (this.nextNode !== null) {\n      this.nextNode.children.forEach(function (node) {\n        node.context.vpa.endTransition();\n      });\n    }\n\n    if (this.currTransition !== null) {\n      ensureTransitionHasNotErrored(this.currTransition);\n      switch (this.nextState) {\n        case State.nextIsEmpty:\n          switch (this.currState) {\n            case State.currDeactivate:\n              this.logger.trace(`endTransition() - setting currState to State.nextIsEmpty at %s`, this);\n\n              this.currState = State.currIsEmpty;\n              this.curCA = null;\n              break;\n            default:\n              this.unexpectedState('endTransition 1');\n          }\n          break;\n        case State.nextActivate:\n          switch (this.currState) {\n            case State.currIsEmpty:\n            case State.currDeactivate:\n              switch (this.$plan) {\n                case 'none':\n                case 'invoke-lifecycles':\n                  this.logger.trace(`endTransition() - setting currState to State.currIsActive at %s`, this);\n\n                  this.currState = State.currIsActive;\n                  break;\n                case 'replace':\n                  this.logger.trace(`endTransition() - setting currState to State.currIsActive and reassigning curCA at %s`, this);\n\n                  this.currState = State.currIsActive;\n                  this.curCA = this.nextCA;\n                  break;\n              }\n              this.currNode = this.nextNode!;\n              break;\n            default:\n              this.unexpectedState('endTransition 2');\n          }\n          break;\n        default:\n          this.unexpectedState('endTransition 3');\n      }\n\n      this.$plan = 'replace';\n      this.nextState = State.nextIsEmpty;\n      this.nextNode = null;\n      this.nextCA = null;\n      this.prevTransition = this.currTransition;\n      this.currTransition = null;\n    }\n  }\n\n  public toString(): string {\n    return `VPA(state:${this.$state},plan:'${this.$plan}',resolution:'${this.$resolution}',n:${this.nextNode},c:${this.currNode},viewport:${this.viewport})`;\n  }\n\n  public dispose(): void {\n    if (this.viewport.stateful /* TODO: incorporate statefulHistoryLength / router opts as well */) {\n      this.logger.trace(`dispose() - not disposing stateful viewport at %s`, this);\n    } else {\n      this.logger.trace(`dispose() - disposing %s`, this);\n      this.curCA?.dispose();\n    }\n  }\n\n  private unexpectedState(label: string): never {\n    throw new Error(`Unexpected state at ${label} of ${this}`);\n  }\n}\n\nfunction ensureGuardsResultIsTrue(vpa: ViewportAgent, tr: Transition): void {\n  if (tr.guardsResult !== true) {\n    throw new Error(`Unexpected guardsResult ${tr.guardsResult} at ${vpa}`);\n  }\n}\n\nfunction ensureTransitionHasNotErrored(tr: Transition): void {\n  if (tr.error !== void 0) {\n    throw tr.error;\n  }\n}\n\nconst enum State {\n  curr              = 0b1111111_0000000,\n  currIsEmpty       = 0b1000000_0000000,\n  currIsActive      = 0b0100000_0000000,\n  currCanUnload     = 0b0010000_0000000,\n  currCanUnloadDone = 0b0001000_0000000,\n  currUnload        = 0b0000100_0000000,\n  currUnloadDone    = 0b0000010_0000000,\n  currDeactivate    = 0b0000001_0000000,\n  next              = 0b0000000_1111111,\n  nextIsEmpty       = 0b0000000_1000000,\n  nextIsScheduled   = 0b0000000_0100000,\n  nextCanLoad       = 0b0000000_0010000,\n  nextCanLoadDone   = 0b0000000_0001000,\n  nextLoad          = 0b0000000_0000100,\n  nextLoadDone      = 0b0000000_0000010,\n  nextActivate      = 0b0000000_0000001,\n  bothAreEmpty      = 0b1000000_1000000,\n}\n\ntype CurrState = (\n  State.currIsEmpty |\n  State.currIsActive |\n  State.currCanUnload |\n  State.currCanUnloadDone |\n  State.currUnload |\n  State.currUnloadDone |\n  State.currDeactivate\n);\n\ntype NextState = (\n  State.nextIsEmpty |\n  State.nextIsScheduled |\n  State.nextCanLoad |\n  State.nextCanLoadDone |\n  State.nextLoad |\n  State.nextLoadDone |\n  State.nextActivate\n);\n\n// Stringifying uses arrays and does not have a negligible cost, so cache the results to not let trace logging\n// in and of its own slow things down too much.\nconst $stateCache = new Map<State, string>();\nfunction $state(state: State): string {\n  let str = $stateCache.get(state);\n  if (str === void 0) {\n    $stateCache.set(state, str = stringifyState(state));\n  }\n  return str;\n}\nfunction stringifyState(state: State): string {\n  const flags: string[] = [];\n\n  if ((state & State.currIsEmpty) === State.currIsEmpty) {\n    flags.push('currIsEmpty');\n  }\n  if ((state & State.currIsActive) === State.currIsActive) {\n    flags.push('currIsActive');\n  }\n  if ((state & State.currCanUnload) === State.currCanUnload) {\n    flags.push('currCanUnload');\n  }\n  if ((state & State.currCanUnloadDone) === State.currCanUnloadDone) {\n    flags.push('currCanUnloadDone');\n  }\n  if ((state & State.currUnload) === State.currUnload) {\n    flags.push('currUnload');\n  }\n  if ((state & State.currUnloadDone) === State.currUnloadDone) {\n    flags.push('currUnloadDone');\n  }\n  if ((state & State.currDeactivate) === State.currDeactivate) {\n    flags.push('currDeactivate');\n  }\n  if ((state & State.nextIsEmpty) === State.nextIsEmpty) {\n    flags.push('nextIsEmpty');\n  }\n  if ((state & State.nextIsScheduled) === State.nextIsScheduled) {\n    flags.push('nextIsScheduled');\n  }\n  if ((state & State.nextCanLoad) === State.nextCanLoad) {\n    flags.push('nextCanLoad');\n  }\n  if ((state & State.nextCanLoadDone) === State.nextCanLoadDone) {\n    flags.push('nextCanLoadDone');\n  }\n  if ((state & State.nextLoad) === State.nextLoad) {\n    flags.push('nextLoad');\n  }\n  if ((state & State.nextLoadDone) === State.nextLoadDone) {\n    flags.push('nextLoadDone');\n  }\n  if ((state & State.nextActivate) === State.nextActivate) {\n    flags.push('nextActivate');\n  }\n\n  return flags.join('|');\n}\n","// The commented-out terminal symbols below are for reference / potential future need (should there be use cases to loosen up the syntax)\n// These symbols are basically the minimum necessary terminals.\n// const viewportTerminal = ['?', '#', '/', '+', ')', '!'];\n// const actionTerminal = [...componentTerminal, '@', '('];\n// const componentTerminal = [...actionTerminal, '.'];\n// const paramTerminal = ['=', ',', ')'];\n\nimport { ViewportInstructionTree, ViewportInstruction, Params } from './instructions.js';\nimport { NavigationOptions } from './router.js';\n\n// These are the currently used terminal symbols.\n// We're deliberately having every \"special\" (including the not-in-use '&', ''', '~', ';') as a terminal symbol,\n// so as to make the syntax maximally restrictive for consistency and to minimize the risk of us having to introduce breaking changes in the future.\nconst terminal = ['?', '#', '/', '+', '(', ')', '.', '@', '!', '=', ',', '&', '\\'', '~', ';'] as const;\n\nclass ParserState {\n  public get done() {\n    return this.rest.length === 0;\n  }\n\n  private rest: string;\n  private readonly buffers: string[] = [];\n  private bufferIndex: number = 0;\n  private index: number = 0;\n\n  public constructor(\n    private readonly input: string,\n  ) {\n    this.rest = input;\n  }\n\n  public startsWith(...values: readonly string[]): boolean {\n    const rest = this.rest;\n    return values.some(function (value) {\n      return rest.startsWith(value);\n    });\n  }\n\n  public consumeOptional(str: string): boolean {\n    if (this.startsWith(str)) {\n      this.rest = this.rest.slice(str.length);\n      this.index += str.length;\n      this.append(str);\n      return true;\n    }\n    return false;\n  }\n\n  public consume(str: string): void {\n    if (!this.consumeOptional(str)) {\n      this.expect(`'${str}'`);\n    }\n  }\n\n  public expect(msg: string): void {\n    throw new Error(`Expected ${msg} at index ${this.index} of '${this.input}', but got: '${this.rest}' (rest='${this.rest}')`);\n  }\n\n  public ensureDone(): void {\n    if (!this.done) {\n      throw new Error(`Unexpected '${this.rest}' at index ${this.index} of '${this.input}'`);\n    }\n  }\n\n  public advance(): void {\n    const char = this.rest[0];\n    this.rest = this.rest.slice(1);\n    ++this.index;\n    this.append(char);\n  }\n\n  public record(): void {\n    this.buffers[this.bufferIndex++] = '';\n  }\n\n  public playback(): string {\n    const bufferIndex = --this.bufferIndex;\n    const buffers = this.buffers;\n    const buffer = buffers[bufferIndex];\n    buffers[bufferIndex] = '';\n    return buffer;\n  }\n\n  public discard(): void {\n    this.buffers[--this.bufferIndex] = '';\n  }\n\n  private append(str: string): void {\n    const bufferIndex = this.bufferIndex;\n    const buffers = this.buffers;\n    for (let i = 0; i < bufferIndex; ++i) {\n      buffers[i] += str;\n    }\n  }\n}\n\nexport const enum ExpressionKind {\n  Route,\n  CompositeSegment,\n  ScopedSegment,\n  SegmentGroup,\n  Segment,\n  Component,\n  Action,\n  Viewport,\n  ParameterList,\n  Parameter,\n}\n\nconst fragmentRouteExpressionCache = new Map<string, RouteExpression>();\nconst routeExpressionCache = new Map<string, RouteExpression>();\n\nexport type RouteExpressionOrHigher = CompositeSegmentExpressionOrHigher | RouteExpression;\nexport class RouteExpression {\n  public get kind(): ExpressionKind.Route { return ExpressionKind.Route; }\n\n  public constructor(\n    public readonly raw: string,\n    public readonly isAbsolute: boolean,\n    public readonly root: CompositeSegmentExpressionOrHigher,\n    public readonly queryParams: Readonly<URLSearchParams>,\n    public readonly fragment: string | null,\n    public readonly fragmentIsRoute: boolean,\n  ) {}\n\n  public static parse(path: string, fragmentIsRoute: boolean): RouteExpression {\n    const cache = fragmentIsRoute ? fragmentRouteExpressionCache : routeExpressionCache;\n    let result = cache.get(path);\n    if (result === void 0) {\n      cache.set(path, result = RouteExpression.$parse(path, fragmentIsRoute));\n    }\n    return result;\n  }\n\n  private static $parse(path: string, fragmentIsRoute: boolean): RouteExpression {\n    // First strip off the fragment (and if fragment should be used as route, set it as the path)\n    let fragment: string | null;\n    const fragmentStart = path.indexOf('#');\n    if (fragmentStart >= 0) {\n      const rawFragment = path.slice(fragmentStart + 1);\n      fragment = decodeURIComponent(rawFragment);\n      if (fragmentIsRoute) {\n        path = fragment;\n      } else {\n        path = path.slice(0, fragmentStart);\n      }\n    } else {\n      if (fragmentIsRoute) {\n        path = '';\n      }\n      fragment = null;\n    }\n\n    // Strip off and parse the query string using built-in URLSearchParams.\n    let queryParams: URLSearchParams | null = null;\n    const queryStart = path.indexOf('?');\n    if (queryStart >= 0) {\n      const queryString = path.slice(queryStart + 1);\n      path = path.slice(0, queryStart);\n      queryParams = new URLSearchParams(queryString);\n    }\n    if (path === '') {\n      return new RouteExpression(\n        '',\n        false,\n        SegmentExpression.EMPTY,\n        Object.freeze(queryParams ?? new URLSearchParams()),\n        fragment,\n        fragmentIsRoute,\n      );\n    }\n\n    /*\n     * Now parse the actual route\n     *\n     * Notes:\n     * A NT-Name as per DOM level 2: https://www.w3.org/TR/1998/REC-xml-19980210#NT-Name\n     *  [4]  NameChar ::= Letter | Digit | '.' | '-' | '_' | ':' | CombiningChar | Extender\n     *  [5]  Name     ::= (Letter | '_' | ':') (NameChar)*\n     *\n     * As per https://url.spec.whatwg.org/#url-code-points - URL code points (from the ASCII range) are:\n     * a-zA-Z0-9!$&'()*+,-./:;=?@_~\n     * The other valid option is a % followed by two ASCII hex digits\n     * Anything else is invalid.\n     */\n    const state = new ParserState(path);\n    state.record();\n    const isAbsolute = state.consumeOptional('/');\n\n    const root = CompositeSegmentExpression.parse(state);\n    state.ensureDone();\n\n    const raw = state.playback();\n    return new RouteExpression(raw, isAbsolute, root, Object.freeze(queryParams ?? new URLSearchParams()), fragment, fragmentIsRoute);\n  }\n\n  public toInstructionTree(options: NavigationOptions): ViewportInstructionTree {\n    return new ViewportInstructionTree(\n      options,\n      this.isAbsolute,\n      this.root.toInstructions(options.append, 0, 0),\n      this.queryParams,\n      this.fragment,\n    );\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\nexport type CompositeSegmentExpressionOrHigher = ScopedSegmentExpressionOrHigher | CompositeSegmentExpression;\nexport type CompositeSegmentExpressionOrLower = RouteExpression | CompositeSegmentExpression;\n/**\n * A single 'traditional' (slash-separated) segment consisting of one or more sibling segments.\n *\n * ### Variations:\n *\n * 1: `a+b`\n * - siblings: [`a`, `b`]\n * - append: `false`\n *\n * 2: `+a`\n * - siblings: [`a`]\n * - append: `true`\n *\n * 3: `+a+a`\n * - siblings: [`a`, `b`]\n * - append: `true`\n *\n * Where\n * - a = `CompositeSegmentExpressionOrHigher` (`SegmentExpression | SegmentGroupExpression | ScopedSegmentExpression | CompositeSegmentExpression`)\n * - b = `CompositeSegmentExpressionOrHigher` (`SegmentExpression | SegmentGroupExpression | ScopedSegmentExpression | CompositeSegmentExpression`)\n */\nexport class CompositeSegmentExpression {\n  public get kind(): ExpressionKind.CompositeSegment { return ExpressionKind.CompositeSegment; }\n\n  public constructor(\n    public readonly raw: string,\n    public readonly siblings: readonly ScopedSegmentExpressionOrHigher[],\n    public readonly append: boolean,\n  ) {}\n\n  public static parse(state: ParserState): CompositeSegmentExpressionOrHigher {\n    state.record();\n\n    // If a segment starts with '+', e.g. '/+a' / '/+a@vp' / '/a/+b' / '/+a+b' etc, then its siblings\n    // are considered to be \"append\"\n    const append = state.consumeOptional('+');\n    const siblings = [];\n    do {\n      siblings.push(ScopedSegmentExpression.parse(state));\n    } while (state.consumeOptional('+'));\n\n    if (!append && siblings.length === 1) {\n      state.discard();\n      return siblings[0];\n    }\n\n    const raw = state.playback();\n    return new CompositeSegmentExpression(raw, siblings, append);\n  }\n\n  public toInstructions(append: boolean, open: number, close: number): ViewportInstruction[] {\n    switch (this.siblings.length) {\n      case 0:\n        return [];\n      case 1:\n        return this.siblings[0].toInstructions(append, open, close);\n      case 2:\n        return [\n          ...this.siblings[0].toInstructions(append, open, 0),\n          ...this.siblings[1].toInstructions(append, 0, close),\n        ];\n      default:\n        return [\n          ...this.siblings[0].toInstructions(append, open, 0),\n          ...this.siblings.slice(1, -1).flatMap(function (x) {\n            return x.toInstructions(append, 0, 0);\n          }),\n          ...this.siblings[this.siblings.length - 1].toInstructions(append, 0, close),\n        ];\n    }\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\nexport type ScopedSegmentExpressionOrHigher = SegmentGroupExpressionOrHigher | ScopedSegmentExpression;\nexport type ScopedSegmentExpressionOrLower = CompositeSegmentExpressionOrLower | ScopedSegmentExpression;\n/**\n * The (single) left-hand side and the (one or more) right-hand side of a slash-separated segment.\n *\n * Variations:\n *\n * 1: `a/b`\n * - left: `a`\n * - right: `b`\n *\n * Where\n * - a = `SegmentGroupExpressionOrHigher` (`SegmentExpression | SegmentGroupExpression`)\n * - b = `ScopedSegmentExpressionOrHigher` (`SegmentExpression | SegmentGroupExpression | ScopedSegmentExpression`)\n */\nexport class ScopedSegmentExpression {\n  public get kind(): ExpressionKind.ScopedSegment { return ExpressionKind.ScopedSegment; }\n\n  public constructor(\n    public readonly raw: string,\n    public readonly left: SegmentGroupExpressionOrHigher,\n    public readonly right: ScopedSegmentExpressionOrHigher,\n  ) {}\n\n  public static parse(state: ParserState): ScopedSegmentExpressionOrHigher {\n    state.record();\n\n    const left = SegmentGroupExpression.parse(state);\n\n    if (state.consumeOptional('/')) {\n      const right = ScopedSegmentExpression.parse(state);\n\n      const raw = state.playback();\n      return new ScopedSegmentExpression(raw, left, right);\n    }\n\n    state.discard();\n    return left;\n  }\n\n  public toInstructions(append: boolean, open: number, close: number): ViewportInstruction[] {\n    const leftInstructions = this.left.toInstructions(append, open, 0);\n    const rightInstructions = this.right.toInstructions(false, 0, close);\n    let cur = leftInstructions[leftInstructions.length - 1];\n    while (cur.children.length > 0) {\n      cur = cur.children[cur.children.length - 1];\n    }\n    cur.children.push(...rightInstructions);\n    return leftInstructions;\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\nexport type SegmentGroupExpressionOrHigher = SegmentExpression | SegmentGroupExpression;\nexport type SegmentGroupExpressionOrLower = ScopedSegmentExpressionOrLower | SegmentGroupExpression;\n/**\n * Any kind of segment wrapped in parentheses, increasing its precedence.\n * Specifically, the parentheses are needed to deeply specify scoped siblings.\n * The precedence is intentionally similar to the familiar mathematical `/` and `+` operators.\n *\n * For example, consider this viewport structure:\n * - viewport-a\n * - - viewport-a1\n * - - viewport-a2\n * - viewport-b\n * - - viewport-b1\n *\n * This can only be deeply specified by using the grouping operator: `a/(a1+a2)+b/b1`\n *\n * Because `a/a1+a2+b/b1` would be interpreted differently:\n * - viewport-a\n * - - viewport-a1\n * - viewport-a2\n * - viewport-b\n * - - viewport-b1\n *\n * ### Variations:\n *\n * 1: `(a)`\n * - expression: `a`\n *\n * Where\n * - a = `CompositeSegmentExpressionOrHigher` (`SegmentExpression | SegmentGroupExpression | ScopedSegmentExpression | CompositeSegmentExpression`)\n */\nexport class SegmentGroupExpression {\n  public get kind(): ExpressionKind.SegmentGroup { return ExpressionKind.SegmentGroup; }\n\n  public constructor(\n    public readonly raw: string,\n    public readonly expression: CompositeSegmentExpressionOrHigher,\n  ) {}\n\n  public static parse(state: ParserState): SegmentGroupExpressionOrHigher {\n    state.record();\n\n    if (state.consumeOptional('(')) {\n      const expression = CompositeSegmentExpression.parse(state);\n      state.consume(')');\n\n      const raw = state.playback();\n      return new SegmentGroupExpression(raw, expression);\n    }\n\n    state.discard();\n    return SegmentExpression.parse(state);\n  }\n\n  public toInstructions(append: boolean, open: number, close: number): ViewportInstruction[] {\n    return this.expression.toInstructions(append, open + 1, close + 1);\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\n/**\n * A (non-composite) segment specifying a single component and (optional) viewport / action.\n */\nexport class SegmentExpression {\n  public get kind(): ExpressionKind.Segment { return ExpressionKind.Segment; }\n\n  public static get EMPTY(): SegmentExpression { return new SegmentExpression('', ComponentExpression.EMPTY, ActionExpression.EMPTY, ViewportExpression.EMPTY, true); }\n\n  public constructor(\n    public readonly raw: string,\n    public readonly component: ComponentExpression,\n    public readonly action: ActionExpression,\n    public readonly viewport: ViewportExpression,\n    public readonly scoped: boolean,\n  ) {}\n\n  public static parse(state: ParserState): SegmentExpression {\n    state.record();\n\n    const component = ComponentExpression.parse(state);\n    const action = ActionExpression.parse(state);\n    const viewport = ViewportExpression.parse(state);\n    const scoped = !state.consumeOptional('!');\n\n    const raw = state.playback();\n    return new SegmentExpression(raw, component, action, viewport, scoped);\n  }\n\n  public toInstructions(append: boolean, open: number, close: number): ViewportInstruction[] {\n    return [\n      ViewportInstruction.create({\n        component: this.component.name,\n        params: this.component.parameterList.toObject(),\n        viewport: this.viewport.name,\n        append,\n        open,\n        close,\n      }),\n    ];\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\nexport class ComponentExpression {\n  public get kind(): ExpressionKind.Component { return ExpressionKind.Component; }\n\n  public static get EMPTY(): ComponentExpression { return new ComponentExpression('', '', ParameterListExpression.EMPTY); }\n\n  /**\n   * A single segment matching parameter, e.g. `:foo` (will match `a` but not `a/b`)\n   */\n  public readonly isParameter: boolean;\n  /**\n   * A multi-segment matching parameter, e.g. `*foo` (will match `a` as well as `a/b`)\n   */\n  public readonly isStar: boolean;\n  /**\n   * Whether this is either a parameter or a star segment.\n   */\n  public readonly isDynamic: boolean;\n  /**\n   * If this is a dynamic segment (parameter or star), this is the name of the parameter (the name without the `:` or `*`)\n   */\n  public readonly parameterName: string;\n\n  public constructor(\n    public readonly raw: string,\n    public readonly name: string,\n    public readonly parameterList: ParameterListExpression,\n  ) {\n    switch (name.charAt(0)) {\n      case ':':\n        this.isParameter = true;\n        this.isStar = false;\n        this.isDynamic = true;\n        this.parameterName = name.slice(1);\n        break;\n      case '*':\n        this.isParameter = false;\n        this.isStar = true;\n        this.isDynamic = true;\n        this.parameterName = name.slice(1);\n        break;\n      default:\n        this.isParameter = false;\n        this.isStar = false;\n        this.isDynamic = false;\n        this.parameterName = name;\n        break;\n    }\n  }\n\n  public static parse(state: ParserState): ComponentExpression {\n    state.record();\n    state.record();\n    if (!state.done) {\n      if (state.startsWith('./')) {\n        state.advance();\n      } else if (state.startsWith('../')) {\n        state.advance();\n        state.advance();\n      } else {\n        while (!state.done && !state.startsWith(...terminal)) {\n          state.advance();\n        }\n      }\n    }\n\n    const name = decodeURIComponent(state.playback());\n    if (name.length === 0) {\n      state.expect('component name');\n    }\n    const parameterList = ParameterListExpression.parse(state);\n\n    const raw = state.playback();\n    return new ComponentExpression(raw, name, parameterList);\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\nexport class ActionExpression {\n  public get kind(): ExpressionKind.Action { return ExpressionKind.Action; }\n\n  public static get EMPTY(): ActionExpression { return new ActionExpression('', '', ParameterListExpression.EMPTY); }\n\n  public constructor(\n    public readonly raw: string,\n    public readonly name: string,\n    public readonly parameterList: ParameterListExpression,\n  ) {}\n\n  public static parse(state: ParserState): ActionExpression {\n    state.record();\n    let name = '';\n\n    if (state.consumeOptional('.')) {\n      state.record();\n      while (!state.done && !state.startsWith(...terminal)) {\n        state.advance();\n      }\n\n      name = decodeURIComponent(state.playback());\n      if (name.length === 0) {\n        state.expect('method name');\n      }\n    }\n\n    const parameterList = ParameterListExpression.parse(state);\n\n    const raw = state.playback();\n    return new ActionExpression(raw, name, parameterList);\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\nexport class ViewportExpression {\n  public get kind(): ExpressionKind.Viewport { return ExpressionKind.Viewport; }\n\n  public static get EMPTY(): ViewportExpression { return new ViewportExpression('', ''); }\n\n  public constructor(\n    public readonly raw: string,\n    public readonly name: string,\n  ) {}\n\n  public static parse(state: ParserState): ViewportExpression {\n    state.record();\n    let name = '';\n\n    if (state.consumeOptional('@')) {\n      state.record();\n      while (!state.done && !state.startsWith(...terminal)) {\n        state.advance();\n      }\n\n      name = decodeURIComponent(state.playback());\n      if (name.length === 0) {\n        state.expect('viewport name');\n      }\n    }\n\n    const raw = state.playback();\n    return new ViewportExpression(raw, name);\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\nexport class ParameterListExpression {\n  public get kind(): ExpressionKind.ParameterList { return ExpressionKind.ParameterList; }\n\n  public static get EMPTY(): ParameterListExpression { return new ParameterListExpression('', []); }\n\n  public constructor(\n    public readonly raw: string,\n    public readonly expressions: readonly ParameterExpression[],\n  ) {}\n\n  public static parse(state: ParserState): ParameterListExpression {\n    state.record();\n    const expressions = [];\n    if (state.consumeOptional('(')) {\n      do {\n        expressions.push(ParameterExpression.parse(state, expressions.length));\n        if (!state.consumeOptional(',')) {\n          break;\n        }\n      } while (!state.done && !state.startsWith(')'));\n      state.consume(')');\n    }\n\n    const raw = state.playback();\n    return new ParameterListExpression(raw, expressions);\n  }\n\n  public toObject(): Params {\n    const params: Params = {};\n    for (const expr of this.expressions) {\n      params[expr.key] = expr.value;\n    }\n    return params;\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\nexport class ParameterExpression {\n  public get kind(): ExpressionKind.Parameter { return ExpressionKind.Parameter; }\n\n  public static get EMPTY(): ParameterExpression { return new ParameterExpression('', '', ''); }\n\n  public constructor(\n    public readonly raw: string,\n    public readonly key: string,\n    public readonly value: string,\n  ) {}\n\n  public static parse(state: ParserState, index: number): ParameterExpression {\n    state.record();\n    state.record();\n    while (!state.done && !state.startsWith(...terminal)) {\n      state.advance();\n    }\n\n    let key = decodeURIComponent(state.playback());\n    if (key.length === 0) {\n      state.expect('parameter key');\n    }\n    let value;\n    if (state.consumeOptional('=')) {\n      state.record();\n      while (!state.done && !state.startsWith(...terminal)) {\n        state.advance();\n      }\n\n      value = decodeURIComponent(state.playback());\n      if (value.length === 0) {\n        state.expect('parameter value');\n      }\n    } else {\n      value = key;\n      key = index.toString();\n    }\n\n    const raw = state.playback();\n    return new ParameterExpression(raw, key, value);\n  }\n\n  public toString(): string {\n    return this.raw;\n  }\n}\n\nexport const AST = Object.freeze({\n  RouteExpression,\n  CompositeSegmentExpression,\n  ScopedSegmentExpression,\n  SegmentGroupExpression,\n  SegmentExpression,\n  ComponentExpression,\n  ActionExpression,\n  ViewportExpression,\n  ParameterListExpression,\n  ParameterExpression,\n});\n","/* eslint-disable @typescript-eslint/restrict-template-expressions */\nimport { ILogger, resolveAll, onResolve, Writable } from '@aurelia/kernel';\nimport { CustomElementDefinition, CustomElement } from '@aurelia/runtime-html';\n\nimport { IRouteContext, $RecognizedRoute } from './route-context.js';\nimport { IRouter, NavigationOptions } from './router.js';\nimport { ViewportInstructionTree, ViewportInstruction, NavigationInstructionType, Params, ITypedNavigationInstruction_ResolvedComponent, ITypedNavigationInstruction_string } from './instructions.js';\nimport { RouteDefinition } from './route-definition.js';\nimport { ViewportRequest } from './viewport-agent.js';\nimport { ExpressionKind, RouteExpression, ScopedSegmentExpression, SegmentExpression } from './route-expression.js';\nimport { ConfigurableRoute } from '@aurelia/route-recognizer';\n\nexport interface IRouteNode {\n  path: string;\n  finalPath: string;\n  context: IRouteContext;\n  /** Can only be `null` for the composition root */\n  instruction: ViewportInstruction<ITypedNavigationInstruction_ResolvedComponent> | null;\n  params?: Params;\n  queryParams?: Readonly<URLSearchParams>;\n  fragment?: string | null;\n  data?: Params;\n  viewport?: string | null;\n  title?: string | ((node: RouteNode) => string | null) | null;\n  component: CustomElementDefinition;\n  append: boolean;\n  children?: RouteNode[];\n  residue?: ViewportInstruction[];\n}\n\nlet nodeId: number = 0;\n\nexport class RouteNode implements IRouteNode {\n  /** @internal */\n  public tree!: RouteTree;\n  /** @internal */\n  public version: number = 1;\n\n  public get root(): RouteNode {\n    return this.tree.root;\n  }\n\n  private constructor(\n    /** @internal */\n    public id: number,\n    /**\n     * The original configured path pattern that was matched, or the component name if it was resolved via direct routing.\n     */\n    public path: string,\n    /**\n     * If one or more redirects have occurred, then this is the final path match, in all other cases this is identical to `path`\n     */\n    public finalPath: string,\n    /**\n     * The `RouteContext` associated with this route.\n     *\n     * Child route components will be created by this context.\n     *\n     * Viewports that live underneath the component associated with this route, will be registered to this context.\n     */\n    public readonly context: IRouteContext,\n    /** @internal */\n    public readonly originalInstruction: ViewportInstruction<ITypedNavigationInstruction_ResolvedComponent> | null,\n    /** Can only be `null` for the composition root */\n    public readonly instruction: ViewportInstruction<ITypedNavigationInstruction_ResolvedComponent> | null,\n    public params: Params,\n    public queryParams: Readonly<URLSearchParams>,\n    public fragment: string | null,\n    public data: Params,\n    /**\n     * The viewport is always `null` for the root `RouteNode`.\n     *\n     * NOTE: It might make sense to have a `null` viewport mean other things as well (such as, don't load this component)\n     * but that is currently not a deliberately implemented feature and we might want to explicitly validate against it\n     * if we decide not to implement that.\n     */\n    public viewport: string | null,\n    public title: string | ((node: RouteNode) => string | null) | null,\n    public component: CustomElementDefinition,\n    public append: boolean,\n    public readonly children: RouteNode[],\n    /**\n     * Not-yet-resolved viewport instructions.\n     *\n     * Instructions need an `IRouteContext` to be resolved into complete `RouteNode`s.\n     *\n     * Resolved instructions are removed from this array, such that a `RouteNode` can be considered\n     * \"fully resolved\" when it has `residue.length === 0` and `children.length >= 0`\n     */\n    public readonly residue: ViewportInstruction[],\n  ) {\n    this.originalInstruction = instruction;\n  }\n\n  public static create(input: IRouteNode): RouteNode {\n    return new RouteNode(\n      /*          id */++nodeId,\n      /*        path */input.path,\n      /*   finalPath */input.finalPath,\n      /*     context */input.context,\n      /* originalIns */input.instruction,\n      /* instruction */input.instruction,\n      /*      params */input.params ?? {},\n      /* queryParams */input.queryParams ?? Object.freeze(new URLSearchParams()),\n      /*    fragment */input.fragment ?? null,\n      /*        data */input.data ?? {},\n      /*    viewport */input.viewport ?? null,\n      /*       title */input.title ?? null,\n      /*   component */input.component,\n      /*      append */input.append,\n      /*    children */input.children ?? [],\n      /*     residue */input.residue ?? [],\n    );\n  }\n\n  public contains(instructions: ViewportInstructionTree): boolean {\n    if (this.context === instructions.options.context) {\n      const nodeChildren = this.children;\n      const instructionChildren = instructions.children;\n      for (let i = 0, ii = nodeChildren.length; i < ii; ++i) {\n        for (let j = 0, jj = instructionChildren.length; j < jj; ++j) {\n          if (i + j < ii && (nodeChildren[i + j].instruction?.contains(instructionChildren[j]) ?? false)) {\n            if (j + 1 === jj) {\n              return true;\n            }\n          } else {\n            break;\n          }\n        }\n      }\n    }\n\n    return this.children.some(function (x) {\n      return x.contains(instructions);\n    });\n  }\n\n  public appendChild(child: RouteNode): void {\n    this.children.push(child);\n    child.setTree(this.tree);\n  }\n\n  public appendChildren(...children: readonly RouteNode[]): void {\n    for (const child of children) {\n      this.appendChild(child);\n    }\n  }\n\n  public clearChildren(): void {\n    for (const c of this.children) {\n      c.clearChildren();\n      c.context.vpa.cancelUpdate();\n    }\n    this.children.length = 0;\n  }\n\n  public getTitle(separator: string): string | null {\n    const titleParts = [\n      ...this.children.map(x => x.getTitle(separator)),\n      this.getTitlePart(),\n    ].filter(x => x !== null);\n    if (titleParts.length === 0) {\n      return null;\n    }\n    return titleParts.join(separator);\n  }\n\n  public getTitlePart(): string | null {\n    if (typeof this.title === 'function') {\n      return this.title.call(void 0, this);\n    }\n    return this.title;\n  }\n\n  public computeAbsolutePath(): string {\n    if (this.context.isRoot) {\n      return '';\n    }\n    const parentPath = this.context.parent!.node.computeAbsolutePath();\n    const thisPath = this.instruction!.toUrlComponent(false);\n    if (parentPath.length > 0) {\n      if (thisPath.length > 0) {\n        return [parentPath, thisPath].join('/');\n      }\n      return parentPath;\n    }\n    return thisPath;\n  }\n\n  /** @internal */\n  public setTree(tree: RouteTree): void {\n    this.tree = tree;\n    for (const child of this.children) {\n      child.setTree(tree);\n    }\n  }\n\n  /** @internal */\n  public finalizeInstruction(): ViewportInstruction {\n    const children = this.children.map(x => x.finalizeInstruction());\n    const instruction = this.instruction!.clone();\n    instruction.children.splice(0, instruction.children.length, ...children);\n    return (this as Writable<this>).instruction = instruction;\n  }\n\n  /** @internal */\n  public clone(): RouteNode {\n    const clone = new RouteNode(\n      this.id,\n      this.path,\n      this.finalPath,\n      this.context,\n      this.originalInstruction,\n      this.instruction,\n      { ...this.params },\n      { ...this.queryParams },\n      this.fragment,\n      { ...this.data },\n      this.viewport,\n      this.title,\n      this.component,\n      this.append,\n      this.children.map(x => x.clone()),\n      [...this.residue],\n    );\n    clone.version = this.version + 1;\n    if (clone.context.node === this) {\n      clone.context.node = clone;\n    }\n    return clone;\n  }\n\n  public toString(): string {\n    const props: string[] = [];\n\n    const component = this.context?.definition.component?.name ?? '';\n    if (component.length > 0) {\n      props.push(`c:'${component}'`);\n    }\n\n    const path = this.context?.definition.config.path ?? '';\n    if (path.length > 0) {\n      props.push(`path:'${path}'`);\n    }\n\n    if (this.children.length > 0) {\n      props.push(`children:[${this.children.map(String).join(',')}]`);\n    }\n\n    if (this.residue.length > 0) {\n      props.push(`residue:${this.residue.map(function (r) {\n        if (typeof r === 'string') {\n          return `'${r}'`;\n        }\n        return String(r);\n      }).join(',')}`);\n    }\n\n    return `RN(ctx:'${this.context.friendlyPath}',${props.join(',')})`;\n  }\n}\n\nexport class RouteTree {\n  public constructor(\n    public readonly options: NavigationOptions,\n    public readonly queryParams: Readonly<URLSearchParams>,\n    public readonly fragment: string | null,\n    public root: RouteNode,\n  ) { }\n\n  public contains(instructions: ViewportInstructionTree): boolean {\n    return this.root.contains(instructions);\n  }\n\n  public clone(): RouteTree {\n    const clone = new RouteTree(\n      this.options.clone(),\n      { ...this.queryParams },\n      this.fragment,\n      this.root.clone(),\n    );\n    clone.root.setTree(this);\n    return clone;\n  }\n\n  public finalizeInstructions(): ViewportInstructionTree {\n    return new ViewportInstructionTree(\n      this.options,\n      true,\n      this.root.children.map(x => x.finalizeInstruction()),\n      this.queryParams,\n      this.fragment,\n    );\n  }\n\n  public toString(): string {\n    return this.root.toString();\n  }\n}\n\n/**\n * Returns a stateful `RouteTree` based on the provided context and transition.\n *\n * This expression will always start from the root context and build a new complete tree, up until (and including)\n * the context that was passed-in.\n *\n * If there are any additional child navigations to be resolved lazily, those will be added to the leaf\n * `RouteNode`s `residue` property which is then resolved by the router after the leaf node is loaded.\n *\n * This means that a `RouteTree` can (and often will) be built incrementally during the loading process.\n */\nexport function updateRouteTree(\n  rt: RouteTree,\n  vit: ViewportInstructionTree,\n  ctx: IRouteContext,\n): Promise<void> | void {\n  const log = ctx.container.get(ILogger).scopeTo('RouteTree');\n\n  // The root of the routing tree is always the CompositionRoot of the Aurelia app.\n  // From a routing perspective it's simply a \"marker\": it does not need to be loaded,\n  // nor put in a viewport, have its hooks invoked, or any of that. The router does not touch it,\n  // other than by reading (deps, optional route config, owned viewports) from it.\n  const rootCtx = ctx.root;\n\n  (rt as Writable<RouteTree>).options = vit.options;\n  (rt as Writable<RouteTree>).queryParams = vit.queryParams;\n  (rt as Writable<RouteTree>).fragment = vit.fragment;\n\n  if (vit.isAbsolute) {\n    ctx = rootCtx;\n  }\n  if (ctx === rootCtx) {\n    rt.root.setTree(rt);\n    rootCtx.node = rt.root;\n  }\n\n  const suffix = ctx.resolved instanceof Promise ? ' - awaiting promise' : '';\n  log.trace(`updateRouteTree(rootCtx:%s,rt:%s,vit:%s)${suffix}`, rootCtx, rt, vit);\n  return onResolve(ctx.resolved, () => {\n    return updateNode(log, vit, ctx, rootCtx.node);\n  });\n}\n\nfunction updateNode(\n  log: ILogger,\n  vit: ViewportInstructionTree,\n  ctx: IRouteContext,\n  node: RouteNode,\n): Promise<void> | void {\n  log.trace(`updateNode(ctx:%s,node:%s)`, ctx, node);\n\n  node.queryParams = vit.queryParams;\n  node.fragment = vit.fragment;\n\n  let maybePromise: void | Promise<void>;\n  if (!node.context.isRoot) {\n    // TODO(fkleuver): store `options` on every individual instruction instead of just on the tree, or split it up etc? this needs a bit of cleaning up\n    maybePromise = node.context.vpa.scheduleUpdate(node.tree.options, node);\n  } else {\n    maybePromise = void 0;\n  }\n\n  return onResolve(maybePromise, () => {\n    if (node.context === ctx) {\n      // Do an in-place update (remove children and re-add them by compiling the instructions into nodes)\n      node.clearChildren();\n      return onResolve(resolveAll(...vit.children.map(vi => {\n        return createAndAppendNodes(log, node, vi, node.tree.options.append || vi.append);\n      })), () => {\n        return resolveAll(...ctx.getAvailableViewportAgents('dynamic').map(vpa => {\n          const defaultInstruction = ViewportInstruction.create({\n            component: vpa.viewport.default,\n            viewport: vpa.viewport.name,\n          });\n          return createAndAppendNodes(log, node, defaultInstruction, node.append);\n        }));\n      });\n    }\n\n    // Drill down until we're at the node whose context matches the provided navigation context\n    return resolveAll(...node.children.map(child => {\n      return updateNode(log, vit, ctx, child);\n    }));\n  });\n}\n\nexport function processResidue(node: RouteNode): Promise<void> | void {\n  const ctx = node.context;\n  const log = ctx.container.get(ILogger).scopeTo('RouteTree');\n\n  const suffix = ctx.resolved instanceof Promise ? ' - awaiting promise' : '';\n  log.trace(`processResidue(node:%s)${suffix}`, node);\n  return onResolve(ctx.resolved, () => {\n    return resolveAll(\n      ...node.residue.splice(0).map(vi => {\n        return createAndAppendNodes(log, node, vi, node.append);\n      }),\n      ...ctx.getAvailableViewportAgents('static').map(vpa => {\n        const defaultInstruction = ViewportInstruction.create({\n          component: vpa.viewport.default,\n          viewport: vpa.viewport.name,\n        });\n        return createAndAppendNodes(log, node, defaultInstruction, node.append);\n      }),\n    );\n  });\n}\n\nexport function getDynamicChildren(node: RouteNode): Promise<readonly RouteNode[]> | readonly RouteNode[] {\n  const ctx = node.context;\n  const log = ctx.container.get(ILogger).scopeTo('RouteTree');\n\n  const suffix = ctx.resolved instanceof Promise ? ' - awaiting promise' : '';\n  log.trace(`getDynamicChildren(node:%s)${suffix}`, node);\n  return onResolve(ctx.resolved, () => {\n    const existingChildren = node.children.slice();\n    return onResolve(\n      resolveAll(\n        ...node.residue.splice(0).map(vi => {\n          return createAndAppendNodes(log, node, vi, node.append);\n        }),\n        ...ctx.getAvailableViewportAgents('dynamic').map(vpa => {\n          const defaultInstruction = ViewportInstruction.create({\n            component: vpa.viewport.default,\n            viewport: vpa.viewport.name,\n          });\n          return createAndAppendNodes(log, node, defaultInstruction, node.append);\n        }),\n      ),\n      () => {\n        return node.children.filter(x => !existingChildren.includes(x));\n      },\n    );\n  });\n}\n\nexport function createAndAppendNodes(\n  log: ILogger,\n  node: RouteNode,\n  vi: ViewportInstruction,\n  append: boolean,\n): void | Promise<void> {\n  log.trace(`createAndAppendNodes(node:%s,vi:%s,append:${append})`, node, vi);\n\n  switch (vi.component.type) {\n    case NavigationInstructionType.string: {\n      switch (vi.component.value) {\n        case '..':\n          // Allow going \"too far up\" just like directory command `cd..`, simply clamp it to the root\n          node.clearChildren();\n          node = node.context.parent?.node ?? node;\n          // falls through\n        case '.':\n          return resolveAll(...vi.children.map(childVI => {\n            return createAndAppendNodes(log, node, childVI, childVI.append);\n          }));\n        default: {\n          const childNode = createNode(log, node, vi as ViewportInstruction<ITypedNavigationInstruction_string>, append);\n          if (childNode === null) {\n            return;\n          }\n          return appendNode(log, node, childNode);\n        }\n      }\n    }\n    case NavigationInstructionType.IRouteViewModel:\n    case NavigationInstructionType.CustomElementDefinition: {\n      const routeDef = RouteDefinition.resolve(vi.component.value);\n      const childNode = createDirectNode(log, node, vi as ViewportInstruction<ITypedNavigationInstruction_ResolvedComponent>, append, routeDef.component!);\n      return appendNode(log, node, childNode);\n    }\n  }\n}\n\nfunction createNode(\n  log: ILogger,\n  node: RouteNode,\n  vi: ViewportInstruction<ITypedNavigationInstruction_string>,\n  append: boolean,\n): RouteNode | Promise<RouteNode> | null {\n  const ctx = node.context;\n  let collapse: number = 0;\n  let path = vi.component.value;\n  let cur = vi as ViewportInstruction;\n  while (cur.children.length === 1) {\n    cur = cur.children[0];\n    if (cur.component.type === NavigationInstructionType.string) {\n      ++collapse;\n      path = `${path}/${cur.component.value}`;\n    } else {\n      break;\n    }\n  }\n\n  const rr = ctx.recognize(path);\n  if (rr === null) {\n    const name = vi.component.value;\n    let ced: CustomElementDefinition | null = ctx.container.find(CustomElement, name);\n    switch (node.tree.options.routingMode) {\n      case 'configured-only':\n        if (ced === null) {\n          if (name === '') {\n            // TODO: maybe throw here instead? Do we want to force the empty route to always be configured?\n            return null;\n          }\n          throw new Error(`'${name}' did not match any configured route or registered component name at '${ctx.friendlyPath}' - did you forget to add '${name}' to the routes list of the route decorator of '${ctx.component.name}'?`);\n        }\n        throw new Error(`'${name}' did not match any configured route, but it does match a registered component name at '${ctx.friendlyPath}' - did you forget to add a @route({ path: '${name}' }) decorator to '${name}' or unintentionally set routingMode to 'configured-only'?`);\n      case 'configured-first':\n        if (ced === null) {\n          if (name === '') {\n            return null;\n          }\n          const vpName = vi.viewport === null || vi.viewport.length === 0 ? 'default' : vi.viewport;\n          const fallbackVPA = ctx.getFallbackViewportAgent('dynamic', vpName);\n          if (fallbackVPA === null) {\n            throw new Error(`'${name}' did not match any configured route or registered component name at '${ctx.friendlyPath}' and no fallback was provided for viewport '${vpName}' - did you forget to add the component '${name}' to the dependencies of '${ctx.component.name}' or to register it as a global dependency?`);\n          }\n          const fallback = fallbackVPA.viewport.fallback;\n          ced = ctx.container.find(CustomElement, fallback);\n          if (ced === null) {\n            throw new Error(`the requested component '${name}' and the fallback '${fallback}' at viewport '${vpName}' did not match any configured route or registered component name at '${ctx.friendlyPath}' - did you forget to add the component '${name}' to the dependencies of '${ctx.component.name}' or to register it as a global dependency?`);\n          }\n        }\n        return createDirectNode(log, node, vi, append, ced);\n    }\n  }\n\n  // If it's a multi-segment match, collapse the viewport instructions to correct the tree structure.\n  const finalPath = rr.residue === null ? path : path.slice(0, -(rr.residue.length + 1));\n  (vi.component as Writable<ITypedNavigationInstruction_string>).value = finalPath;\n  for (let i = 0; i < collapse; ++i) {\n    (vi as Writable<ViewportInstruction>).children = vi.children[0].children;\n  }\n  return createConfiguredNode(log, node, vi, append, rr);\n}\n\nfunction createConfiguredNode(\n  log: ILogger,\n  node: RouteNode,\n  vi: ViewportInstruction<ITypedNavigationInstruction_ResolvedComponent>,\n  append: boolean,\n  rr: $RecognizedRoute,\n  route: ConfigurableRoute<RouteDefinition | Promise<RouteDefinition>> = rr.route.endpoint.route,\n): RouteNode | Promise<RouteNode> {\n  const ctx = node.context;\n  const rt = node.tree;\n  return onResolve(route.handler, $handler => {\n    route.handler = $handler;\n\n    if ($handler.redirectTo === null) {\n      const vpName = $handler.viewport;\n      const ced = $handler.component!;\n\n      const vpa = ctx.resolveViewportAgent(ViewportRequest.create({\n        viewportName: vpName,\n        componentName: ced.name,\n        append,\n        resolution: rt.options.resolutionMode,\n      }));\n\n      const router = ctx.container.get(IRouter);\n      const childCtx = router.getRouteContext(vpa, ced, vpa.hostController.context);\n\n      childCtx.node = RouteNode.create({\n        path: rr.route.endpoint.route.path,\n        finalPath: route.path,\n        context: childCtx,\n        instruction: vi,\n        params: {\n          ...node.params,\n          ...rr.route.params\n        },\n        queryParams: rt.queryParams, // TODO: queryParamsStrategy\n        fragment: rt.fragment, // TODO: fragmentStrategy\n        data: $handler.data,\n        viewport: vpName,\n        component: ced,\n        append,\n        title: $handler.config.title,\n        residue: rr.residue === null ? [] : [ViewportInstruction.create(rr.residue)],\n      });\n      childCtx.node.setTree(node.tree);\n\n      log.trace(`createConfiguredNode(vi:%s) -> %s`, vi, childCtx.node);\n\n      return childCtx.node;\n    }\n\n    // Migrate parameters to the redirect\n    const origPath = RouteExpression.parse(route.path, false);\n    const redirPath = RouteExpression.parse($handler.redirectTo, false);\n    let origCur: ScopedSegmentExpression | SegmentExpression;\n    let redirCur: ScopedSegmentExpression | SegmentExpression;\n    const newSegs: string[] = [];\n    switch (origPath.root.kind) {\n      case ExpressionKind.ScopedSegment:\n      case ExpressionKind.Segment:\n        origCur = origPath.root;\n        break;\n      default:\n        throw new Error(`Unexpected expression kind ${origPath.root.kind}`);\n    }\n    switch (redirPath.root.kind) {\n      case ExpressionKind.ScopedSegment:\n      case ExpressionKind.Segment:\n        redirCur = redirPath.root;\n        break;\n      default:\n        throw new Error(`Unexpected expression kind ${redirPath.root.kind}`);\n    }\n\n    let origSeg: SegmentExpression | null;\n    let redirSeg: SegmentExpression | null;\n    let origDone: boolean = false;\n    let redirDone: boolean = false;\n    while (!(origDone && redirDone)) {\n      if (origDone) {\n        origSeg = null;\n      } else if (origCur.kind === ExpressionKind.Segment) {\n        origSeg = origCur;\n        origDone = true;\n      } else if (origCur.left.kind === ExpressionKind.Segment) {\n        origSeg = origCur.left;\n        switch (origCur.right.kind) {\n          case ExpressionKind.ScopedSegment:\n          case ExpressionKind.Segment:\n            origCur = origCur.right;\n            break;\n          default:\n            throw new Error(`Unexpected expression kind ${origCur.right.kind}`);\n        }\n      } else {\n        throw new Error(`Unexpected expression kind ${origCur.left.kind}`);\n      }\n      if (redirDone) {\n        redirSeg = null;\n      } else if (redirCur.kind === ExpressionKind.Segment) {\n        redirSeg = redirCur;\n        redirDone = true;\n      } else if (redirCur.left.kind === ExpressionKind.Segment) {\n        redirSeg = redirCur.left;\n        switch (redirCur.right.kind) {\n          case ExpressionKind.ScopedSegment:\n          case ExpressionKind.Segment:\n            redirCur = redirCur.right;\n            break;\n          default:\n            throw new Error(`Unexpected expression kind ${redirCur.right.kind}`);\n        }\n      } else {\n        throw new Error(`Unexpected expression kind ${redirCur.left.kind}`);\n      }\n\n      if (redirSeg !== null) {\n        if (redirSeg.component.isDynamic && origSeg?.component.isDynamic) {\n          newSegs.push(rr.route.params[origSeg.component.name] as string);\n        } else {\n          newSegs.push(redirSeg.raw);\n        }\n      }\n    }\n\n    const newPath = newSegs.filter(Boolean).join('/');\n\n    const redirRR = ctx.recognize(newPath);\n    if (redirRR === null) {\n      const name = newPath;\n      const ced: CustomElementDefinition | null = ctx.container.find(CustomElement, newPath);\n      switch (rt.options.routingMode) {\n        case 'configured-only':\n          if (ced === null) {\n            throw new Error(`'${name}' did not match any configured route or registered component name at '${ctx.friendlyPath}' - did you forget to add '${name}' to the routes list of the route decorator of '${ctx.component.name}'?`);\n          }\n          throw new Error(`'${name}' did not match any configured route, but it does match a registered component name at '${ctx.friendlyPath}' - did you forget to add a @route({ path: '${name}' }) decorator to '${name}' or unintentionally set routingMode to 'configured-only'?`);\n        case 'configured-first':\n          if (ced === null) {\n            throw new Error(`'${name}' did not match any configured route or registered component name at '${ctx.friendlyPath}' - did you forget to add the component '${name}' to the dependencies of '${ctx.component.name}' or to register it as a global dependency?`);\n          }\n          return createDirectNode(log, node, vi, append, ced);\n      }\n    }\n\n    return createConfiguredNode(log, node, vi, append, rr, redirRR.route.endpoint.route);\n  });\n}\n\nfunction createDirectNode(\n  log: ILogger,\n  node: RouteNode,\n  vi: ViewportInstruction<ITypedNavigationInstruction_ResolvedComponent>,\n  append: boolean,\n  ced: CustomElementDefinition,\n): RouteNode {\n  const ctx = node.context;\n  const rt = node.tree;\n  const vpName = vi.viewport ?? 'default';\n\n  const vpa = ctx.resolveViewportAgent(ViewportRequest.create({\n    viewportName: vpName,\n    componentName: ced.name,\n    append,\n    resolution: rt.options.resolutionMode,\n  }));\n\n  const router = ctx.container.get(IRouter);\n  const childCtx = router.getRouteContext(vpa, ced, vpa.hostController.context);\n\n  // TODO(fkleuver): process redirects in direct routing (?)\n  const rd = RouteDefinition.resolve(ced);\n\n  // TODO: add ActionExpression state representation to RouteNode\n  childCtx.node = RouteNode.create({\n    path: ced.name,\n    finalPath: ced.name,\n    context: childCtx,\n    instruction: vi,\n    params: {\n      ...ctx.node.params,\n      ...vi.params,\n    },\n    queryParams: rt.queryParams, // TODO: queryParamsStrategy\n    fragment: rt.fragment, // TODO: fragmentStrategy\n    data: rd.data,\n    viewport: vpName,\n    component: ced,\n    append,\n    title: rd.config.title,\n    residue: [...vi.children], // Children must be cloned, because residue will be mutated by the compiler\n  });\n  childCtx.node.setTree(ctx.node.tree);\n\n  log.trace(`createDirectNode(vi:%s) -> %s`, vi, childCtx.node);\n\n  return childCtx.node;\n}\n\nfunction appendNode(\n  log: ILogger,\n  node: RouteNode,\n  childNode: RouteNode | Promise<RouteNode>,\n): void | Promise<void> {\n  return onResolve(childNode, $childNode => {\n    log.trace(`appendNode($childNode:%s)`, $childNode);\n    node.appendChild($childNode);\n    return $childNode.context.vpa.scheduleUpdate(node.tree.options, $childNode);\n  });\n}\n","/* eslint-disable @typescript-eslint/restrict-template-expressions */\nimport { IContainer, ILogger, isObject, DI, IDisposable, onResolve } from '@aurelia/kernel';\nimport { CustomElementDefinition, ICompiledRenderContext, IPlatform, PartialCustomElementDefinition } from '@aurelia/runtime-html';\n\nimport { IRouteContext, RouteContext } from './route-context.js';\nimport { IRouterEvents, NavigationStartEvent, NavigationEndEvent, NavigationCancelEvent } from './router-events.js';\nimport { ILocationManager } from './location-manager.js';\nimport { RouteType } from './route.js';\nimport { IRouteViewModel } from './component-agent.js';\nimport { RouteTree, RouteNode, updateRouteTree } from './route-tree.js';\nimport { IViewportInstruction, NavigationInstruction, RouteContextLike, ViewportInstructionTree, Params } from './instructions.js';\nimport { Batch, mergeDistinct, UnwrapPromise } from './util.js';\nimport { RouteDefinition } from './route-definition.js';\nimport { ViewportAgent } from './viewport-agent.js';\n\nexport const AuNavId = 'au-nav-id' as const;\nexport type AuNavId = typeof AuNavId;\n\nexport type ManagedState = {\n  [k: string]: unknown;\n  [AuNavId]: number;\n};\n\nexport function isManagedState(state: {} | null): state is ManagedState {\n  return isObject(state) && Object.prototype.hasOwnProperty.call(state, AuNavId) === true;\n}\nexport function toManagedState(state: {} | null, navId: number): ManagedState {\n  return { ...state, [AuNavId]: navId };\n}\n\nexport type RoutingMode = 'configured-only' | 'configured-first';\nexport type SwapStrategy = 'sequential-add-first' | 'sequential-remove-first' | 'parallel-remove-first';\nexport type ResolutionMode = 'static' | 'dynamic';\nexport type QueryParamsStrategy = 'overwrite' | 'preserve' | 'merge';\nexport type FragmentStrategy = 'overwrite' | 'preserve';\nexport type HistoryStrategy = 'none' | 'replace' | 'push';\nexport type SameUrlStrategy = 'ignore' | 'reload';\nexport type ValueOrFunc<T extends string> = T | ((instructions: ViewportInstructionTree) => T);\nfunction valueOrFuncToValue<T extends string>(instructions: ViewportInstructionTree, valueOrFunc: ValueOrFunc<T>): T {\n  if (typeof valueOrFunc === 'function') {\n    return valueOrFunc(instructions);\n  }\n  return valueOrFunc;\n}\n\nexport interface IRouterOptions extends Partial<RouterOptions> { }\nexport class RouterOptions {\n  public static get DEFAULT(): RouterOptions { return RouterOptions.create({}); }\n\n  protected constructor(\n    public readonly useUrlFragmentHash: boolean,\n    public readonly useHref: boolean,\n    public readonly statefulHistoryLength: number,\n    /**\n     * The operating mode of the router that determines how components are resolved based on a url.\n     *\n     * - `configured-only`: only match the url against configured routes.\n     * - `configured-first`: first tries to resolve by configured routes, then by component name from available dependencies. (default)\n     *\n     * Default: `configured-first`\n     */\n    public readonly routingMode: RoutingMode,\n    public readonly swapStrategy: SwapStrategy,\n    public readonly resolutionMode: ResolutionMode,\n    /**\n     * The strategy to use for determining the query parameters when both the previous and the new url has a query string.\n     *\n     * - `overwrite`: uses the query params of the new url. (default)\n     * - `preserve`: uses the query params of the previous url.\n     * - `merge`: uses the query params of both the previous and the new url. When a param name exists in both, the value from the new url is used.\n     * - A function that returns one of the 3 above values based on the navigation.\n     *\n     * Default: `overwrite`\n     */\n    public readonly queryParamsStrategy: ValueOrFunc<QueryParamsStrategy>,\n    /**\n     * The strategy to use for determining the fragment (value that comes after `#`) when both the previous and the new url have one.\n     *\n     * - `overwrite`: uses the fragment of the new url. (default)\n     * - `preserve`: uses the fragment of the previous url.\n     * - A function that returns one of the 2 above values based on the navigation.\n     *\n     * Default: `overwrite`\n     */\n    public readonly fragmentStrategy: ValueOrFunc<FragmentStrategy>,\n    /**\n     * The strategy to use for interacting with the browser's `history` object (if applicable).\n     *\n     * - `none`: do not interact with the `history` object at all.\n     * - `replace`: replace the current state in history\n     * - `push`: push a new state onto the history (default)\n     * - A function that returns one of the 3 above values based on the navigation.\n     *\n     * Default: `push`\n     */\n    public readonly historyStrategy: ValueOrFunc<HistoryStrategy>,\n    /**\n     * The strategy to use for when navigating to the same URL.\n     *\n     * - `ignore`: do nothing (default).\n     * - `reload`: reload the current URL, effectively performing a refresh.\n     * - A function that returns one of the 2 above values based on the navigation.\n     *\n     * Default: `ignore`\n     */\n    public readonly sameUrlStrategy: ValueOrFunc<SameUrlStrategy>,\n  ) { }\n\n  public static create(input: IRouterOptions): RouterOptions {\n    return new RouterOptions(\n      input.useUrlFragmentHash ?? false,\n      input.useHref ?? true,\n      input.statefulHistoryLength ?? 0,\n      input.routingMode ?? 'configured-first',\n      input.swapStrategy ?? 'sequential-remove-first',\n      input.resolutionMode ?? 'dynamic',\n      input.queryParamsStrategy ?? 'overwrite',\n      input.fragmentStrategy ?? 'overwrite',\n      input.historyStrategy ?? 'push',\n      input.sameUrlStrategy ?? 'ignore',\n    );\n  }\n  /** @internal */\n  public getQueryParamsStrategy(instructions: ViewportInstructionTree): QueryParamsStrategy {\n    return valueOrFuncToValue(instructions, this.queryParamsStrategy);\n  }\n  /** @internal */\n  public getFragmentStrategy(instructions: ViewportInstructionTree): FragmentStrategy {\n    return valueOrFuncToValue(instructions, this.fragmentStrategy);\n  }\n  /** @internal */\n  public getHistoryStrategy(instructions: ViewportInstructionTree): HistoryStrategy {\n    return valueOrFuncToValue(instructions, this.historyStrategy);\n  }\n  /** @internal */\n  public getSameUrlStrategy(instructions: ViewportInstructionTree): SameUrlStrategy {\n    return valueOrFuncToValue(instructions, this.sameUrlStrategy);\n  }\n\n  protected stringifyProperties(): string {\n    return ([\n      ['routingMode', 'mode'],\n      ['swapStrategy', 'swap'],\n      ['resolutionMode', 'resolution'],\n      ['queryParamsStrategy', 'queryParams'],\n      ['fragmentStrategy', 'fragment'],\n      ['historyStrategy', 'history'],\n      ['sameUrlStrategy', 'sameUrl'],\n    ] as const).map(([key, name]) => {\n      const value = this[key];\n      return `${name}:${typeof value === 'function' ? value : `'${value}'`}`;\n    }).join(',');\n  }\n\n  public clone(): RouterOptions {\n    return new RouterOptions(\n      this.useUrlFragmentHash,\n      this.useHref,\n      this.statefulHistoryLength,\n      this.routingMode,\n      this.swapStrategy,\n      this.resolutionMode,\n      this.queryParamsStrategy,\n      this.fragmentStrategy,\n      this.historyStrategy,\n      this.sameUrlStrategy,\n    );\n  }\n\n  public toString(): string {\n    return `RO(${this.stringifyProperties()})`;\n  }\n}\n\nexport interface INavigationOptions extends Partial<NavigationOptions> { }\nexport class NavigationOptions extends RouterOptions {\n  public static get DEFAULT(): NavigationOptions { return NavigationOptions.create({}); }\n\n  private constructor(\n    routerOptions: RouterOptions,\n    public readonly title: string | ((node: RouteNode) => string | null) | null,\n    public readonly titleSeparator: string,\n    public readonly append: boolean,\n    /**\n     * Specify a context to use for relative navigation.\n     *\n     * - `null` (or empty): navigate relative to the root (absolute navigation)\n     * - `IRouteContext`: navigate relative to specifically this RouteContext (advanced users).\n     * - `HTMLElement`: navigate relative to the routeable component (page) that directly or indirectly contains this element.\n     * - `ICustomElementViewModel` (the `this` object when working from inside a view model): navigate relative to this component (if it was loaded as a route), or the routeable component (page) directly or indirectly containing it.\n     * - `ICustomElementController`: same as `ICustomElementViewModel`, but using the controller object instead of the view model object (advanced users).\n     */\n    public readonly context: RouteContextLike | null,\n    /**\n     * Specify an object to be serialized to a query string, and then set to the query string of the new URL.\n     */\n    public readonly queryParams: Params | null,\n    /**\n     * Specify the hash fragment for the new URL.\n     */\n    public readonly fragment: string,\n    /**\n     * Specify any kind of state to be stored together with the history entry for this navigation.\n     */\n    public readonly state: Params | null,\n  ) {\n    super(\n      routerOptions.useUrlFragmentHash,\n      routerOptions.useHref,\n      routerOptions.statefulHistoryLength,\n      routerOptions.routingMode,\n      routerOptions.swapStrategy,\n      routerOptions.resolutionMode,\n      routerOptions.queryParamsStrategy,\n      routerOptions.fragmentStrategy,\n      routerOptions.historyStrategy,\n      routerOptions.sameUrlStrategy,\n    );\n  }\n\n  public static create(input: INavigationOptions): NavigationOptions {\n    return new NavigationOptions(\n      RouterOptions.create(input),\n      input.title ?? null,\n      input.titleSeparator ?? ' | ',\n      input.append ?? false,\n      input.context ?? null,\n      input.queryParams ?? null,\n      input.fragment ?? '',\n      input.state ?? null,\n    );\n  }\n\n  public clone(): NavigationOptions {\n    return new NavigationOptions(\n      super.clone(),\n      this.title,\n      this.titleSeparator,\n      this.append,\n      this.context,\n      { ...this.queryParams },\n      this.fragment,\n      this.state === null ? null : { ...this.state },\n    );\n  }\n\n  public toString(): string {\n    return `NO(${super.stringifyProperties()})`;\n  }\n}\n\nexport class Navigation {\n  private constructor(\n    public readonly id: number,\n    public readonly instructions: ViewportInstructionTree,\n    public readonly trigger: 'popstate' | 'hashchange' | 'api',\n    public readonly options: NavigationOptions,\n    public readonly prevNavigation: Navigation | null,\n    // Set on next navigation, this is the route after all redirects etc have been processed.\n    public finalInstructions: ViewportInstructionTree | undefined,\n  ) { }\n\n  public static create(input: Navigation): Navigation {\n    return new Navigation(\n      input.id,\n      input.instructions,\n      input.trigger,\n      input.options,\n      input.prevNavigation,\n      input.finalInstructions,\n    );\n  }\n\n  public toString(): string {\n    return `N(id:${this.id},instructions:${this.instructions},trigger:'${this.trigger}')`;\n  }\n}\nexport class Transition {\n  private constructor(\n    public readonly id: number,\n    public readonly prevInstructions: ViewportInstructionTree,\n    public readonly instructions: ViewportInstructionTree,\n    public finalInstructions: ViewportInstructionTree,\n    public readonly instructionsChanged: boolean,\n    public readonly trigger: 'popstate' | 'hashchange' | 'api',\n    public readonly options: NavigationOptions,\n    public readonly managedState: ManagedState | null,\n    public readonly previousRouteTree: RouteTree,\n    public routeTree: RouteTree,\n    public readonly promise: Promise<boolean> | null,\n    public readonly resolve: ((success: boolean) => void) | null,\n    public readonly reject: ((err: unknown) => void) | null,\n    public guardsResult: boolean | ViewportInstructionTree,\n    public error: unknown,\n  ) { }\n\n  public static create(input: Omit<Transition, 'abortIfNeeded' | 'run' | 'handleError'>): Transition {\n    return new Transition(\n      input.id,\n      input.prevInstructions,\n      input.instructions,\n      input.finalInstructions,\n      input.instructionsChanged,\n      input.trigger,\n      input.options,\n      input.managedState,\n      input.previousRouteTree,\n      input.routeTree,\n      input.promise,\n      input.resolve,\n      input.reject,\n      input.guardsResult,\n      void 0,\n    );\n  }\n\n  public run<T>(cb: () => T, next: (value: UnwrapPromise<T>) => void): void {\n    if (this.guardsResult !== true) {\n      return;\n    }\n    try {\n      const ret = cb();\n      if (ret instanceof Promise) {\n        ret.then(next).catch(err => {\n          this.handleError(err);\n        });\n      } else {\n        next(ret as UnwrapPromise<T>);\n      }\n    } catch (err) {\n      this.handleError(err);\n    }\n  }\n\n  public handleError(err: unknown): void {\n    this.reject!(this.error = err);\n  }\n\n  public toString(): string {\n    return `T(id:${this.id},trigger:'${this.trigger}',instructions:${this.instructions},options:${this.options})`;\n  }\n}\n\ntype RouteDefinitionLookup = WeakMap<RouteDefinition, IRouteContext>;\ntype ViewportAgentLookup = Map<ViewportAgent | null, RouteDefinitionLookup>;\n\nexport interface IRouter extends Router { }\nexport const IRouter = DI.createInterface<IRouter>('IRouter', x => x.singleton(Router));\nexport class Router {\n  private _ctx: RouteContext | null = null;\n  private get ctx(): RouteContext {\n    let ctx = this._ctx;\n    if (ctx === null) {\n      if (!this.container.has(IRouteContext, true)) {\n        throw new Error(`Root RouteContext is not set. Did you forget to register RouteConfiguration, or try to navigate before calling Aurelia.start()?`);\n      }\n      ctx = this._ctx = this.container.get(IRouteContext);\n    }\n    return ctx;\n  }\n\n  private _routeTree: RouteTree | null = null;\n  public get routeTree(): RouteTree {\n    let routeTree = this._routeTree;\n    if (routeTree === null) {\n      // Lazy instantiation for only the very first (synthetic) tree.\n      // Doing it here instead of in the constructor to delay it until we have the context.\n      const ctx = this.ctx;\n      routeTree = this._routeTree = new RouteTree(\n        NavigationOptions.create({ ...this.options }),\n        Object.freeze(new URLSearchParams()),\n        null,\n        RouteNode.create({\n          path: '',\n          finalPath: '',\n          context: ctx,\n          instruction: null,\n          component: ctx.definition.component!,\n          append: false,\n        }),\n      );\n    }\n    return routeTree;\n  }\n\n  private _currentTr: Transition | null = null;\n  private get currentTr(): Transition {\n    let currentTr = this._currentTr;\n    if (currentTr === null) {\n      currentTr = this._currentTr = Transition.create({\n        id: 0,\n        prevInstructions: this.instructions,\n        instructions: this.instructions,\n        finalInstructions: this.instructions,\n        instructionsChanged: true,\n        trigger: 'api',\n        options: NavigationOptions.DEFAULT,\n        managedState: null,\n        previousRouteTree: this.routeTree.clone(),\n        routeTree: this.routeTree,\n        resolve: null,\n        reject: null,\n        promise: null,\n        guardsResult: true,\n        error: void 0,\n      });\n    }\n    return currentTr;\n  }\n  private set currentTr(value: Transition) {\n    this._currentTr = value;\n  }\n\n  public options: RouterOptions = RouterOptions.DEFAULT;\n\n  private navigated: boolean = false;\n  private navigationId: number = 0;\n\n  private lastSuccessfulNavigation: Navigation | null = null;\n  private activeNavigation: Navigation | null = null;\n\n  private instructions: ViewportInstructionTree = ViewportInstructionTree.create('');\n\n  private nextTr: Transition | null = null;\n  private locationChangeSubscription: IDisposable | null = null;\n\n  public constructor(\n    @IContainer private readonly container: IContainer,\n    @IPlatform private readonly p: IPlatform,\n    @ILogger private readonly logger: ILogger,\n    @IRouterEvents private readonly events: IRouterEvents,\n    @ILocationManager private readonly locationMgr: ILocationManager,\n  ) {\n    this.logger = logger.root.scopeTo('Router');\n  }\n\n  /**\n   * Get the closest RouteContext relative to the provided component, controller or node.\n   *\n   * @param context - The object from which to resolve the closest RouteContext.\n   *\n   * @returns when the value is:\n   * - `null`: the root\n   * - `IRouteContext`: the provided value (no-op)\n   * - `HTMLElement`: the context of the routeable component (page) that directly or indirectly contains this element.\n   * - `ICustomElementViewModel` (the `this` object when working from inside a view model): the context of this component (if it was loaded as a route), or the routeable component (page) directly or indirectly containing it.\n   * - `ICustomElementController`: same as `ICustomElementViewModel`, but using the controller object instead of the view model object (advanced users).\n   */\n  public resolveContext(context: RouteContextLike | null): IRouteContext {\n    return RouteContext.resolve(this.ctx, context);\n  }\n\n  public start(routerOptions: IRouterOptions, performInitialNavigation: boolean): void | Promise<boolean> {\n    this.options = RouterOptions.create(routerOptions);\n\n    this.locationMgr.startListening();\n    this.locationChangeSubscription = this.events.subscribe('au:router:location-change', e => {\n      // TODO(fkleuver): add a throttle config.\n      // At the time of writing, chromium throttles popstate events at a maximum of ~100 per second.\n      // While macroTasks run up to 250 times per second, it is extremely unlikely that more than ~100 per second of these will run due to the double queueing.\n      // However, this throttle limit could theoretically be hit by e.g. integration tests that don't mock Location/History.\n      this.p.taskQueue.queueTask(() => {\n        // Don't try to restore state that might not have anything to do with the Aurelia app\n        const state = isManagedState(e.state) ? e.state : null;\n        const options = NavigationOptions.create({\n          ...this.options,\n          historyStrategy: 'replace',\n        });\n        const instructions = ViewportInstructionTree.create(e.url, options);\n        // The promise will be stored in the transition. However, unlike `load()`, `start()` does not return this promise in any way.\n        // The router merely guarantees that it will be awaited (or canceled) before the next transition, so a race condition is impossible either way.\n        // However, it is possible to get floating promises lingering during non-awaited unit tests, which could have unpredictable side-effects.\n        // So we do want to solve this at some point.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.enqueue(instructions, e.trigger, state, null);\n      });\n    });\n\n    if (!this.navigated && performInitialNavigation) {\n      return this.load(this.locationMgr.getPath(), { historyStrategy: 'replace' });\n    }\n  }\n\n  public stop(): void {\n    this.locationMgr.stopListening();\n    this.locationChangeSubscription?.dispose();\n  }\n\n  /**\n   * Loads the provided path.\n   *\n   * Examples:\n   *\n   * ```ts\n   * // Use direct routing syntax to load 'product-detail' with parameter id=37, as a child of the current component, in the next available sibling viewport.\n   * router.load('+product-detail(id=37)');\n   * // Load the route 'product-detail', as a child of the current component, with child route '37'.\n   * router.load('product-detail/37', { context: this });\n   * ```\n   */\n  public load(path: string, options?: INavigationOptions): Promise<boolean>;\n  /**\n   * Loads the provided paths as siblings.\n   *\n   * Examples:\n   *\n   * ```ts\n   * router.load(['book-detail(20)', 'author-detail(11)']);\n   * router.load(['category/50/product/20', 'widget/30'], { routingMode: 'configured-only' });\n   * router.load(['category/50/product/20', 'widget(id=30)]);\n   * ```\n   */\n  public load(paths: readonly string[], options?: INavigationOptions): Promise<boolean>;\n  /**\n   * Loads the provided component type. Must be a custom element.\n   *\n   * Examples:\n   *\n   * ```ts\n   * router.load(ProductList);\n   * router.load(CustomElement.define({ name: 'greeter', template: 'Hello!' }));\n   * ```\n   */\n  public load(componentType: RouteType, options?: INavigationOptions): Promise<boolean>;\n  /**\n   * Loads the provided component types. Must be custom elements.\n   *\n   * Examples:\n   *\n   * ```ts\n   * router.load([MemberList, OrganizationList]);\n   * ```\n   */\n  public load(componentTypes: readonly RouteType[], options?: INavigationOptions): Promise<boolean>;\n  /**\n   * Loads the provided component definition. May or may not be pre-compiled.\n   *\n   * Examples:\n   *\n   * ```ts\n   * router.load({ name: 'greeter', template: 'Hello!' });\n   * ```\n   */\n  public load(componentDefinition: PartialCustomElementDefinition, options?: INavigationOptions): Promise<boolean>;\n  /**\n   * Loads the provided component instance.\n   *\n   * Examples:\n   *\n   * ```ts\n   * // Given an already defined custom element named Greeter\n   * const greeter = new Greeter();\n   * Controller.forCustomElement(greeter, this.lifecycle, null, this.context);\n   * router.load(greeter);\n   * ```\n   */\n  public load(componentInstance: IRouteViewModel, options?: INavigationOptions): Promise<boolean>;\n  /**\n   * Loads the provided ViewportInstruction, with component specified in any of the ways as described\n   * in the other method overloads, and optional additional properties.\n   *\n   * Examples:\n   *\n   * ```ts\n   * router.load({ component: 'product-detail', parameters: { id: 37 } })\n   * router.load({ component: ProductDetail, parameters: { id: 37 } })\n   * router.load({ component: 'category(id=50)', children: ['product(id=20)'] })\n   * router.load({ component: 'category(id=50)', children: [{ component: 'product', parameters: { id: 20 } }] })\n   * router.load({\n   *   component: CustomElement.define({\n   *     name: 'greeter',\n   *     template: 'Hello, ${name}!'\n   *   }, class {\n   *     load(instruction) {\n   *       this.name = instruction.parameters.name;\n   *     }\n   *   }),\n   *   parameters: { name: 'John' }\n   * })\n   * ```\n   */\n  public load(viewportInstruction: IViewportInstruction, options?: INavigationOptions): boolean | Promise<boolean>;\n  public load(instructionOrInstructions: NavigationInstruction | readonly NavigationInstruction[], options?: INavigationOptions): boolean | Promise<boolean>;\n  public load(instructionOrInstructions: NavigationInstruction | readonly NavigationInstruction[], options?: INavigationOptions): boolean | Promise<boolean> {\n    const instructions = this.createViewportInstructions(instructionOrInstructions, options);\n\n    this.logger.trace('load(instructions:%s)', instructions);\n\n    return this.enqueue(instructions, 'api', null, null);\n  }\n\n  public isActive(instructionOrInstructions: NavigationInstruction | readonly NavigationInstruction[], context: RouteContextLike): boolean {\n    const ctx = this.resolveContext(context);\n    const instructions = this.createViewportInstructions(instructionOrInstructions, { context: ctx });\n\n    this.logger.trace('isActive(instructions:%s,ctx:%s)', instructions, ctx);\n\n    // TODO: incorporate potential context offset by `../` etc in the instructions\n    return this.routeTree.contains(instructions);\n  }\n\n  private readonly vpaLookup: ViewportAgentLookup = new Map();\n  /**\n   * Retrieve the RouteContext, which contains statically configured routes combined with the customElement metadata associated with a type.\n   *\n   * The customElement metadata is lazily associated with a type via the RouteContext the first time `getOrCreate` is called.\n   *\n   * This API is also used for direct routing even when there is no configuration at all.\n   *\n   * @param viewportAgent - The ViewportAgent hosting the component associated with this RouteContext. If the RouteContext for the component+viewport combination already exists, the ViewportAgent will be updated in case it changed.\n   * @param component - The custom element definition.\n   * @param renderContext - The `controller.context` of the component hosting the viewport that the route will be loaded into.\n   *\n   */\n  public getRouteContext(\n    viewportAgent: ViewportAgent | null,\n    component: CustomElementDefinition,\n    renderContext: ICompiledRenderContext,\n  ): IRouteContext {\n    const container = renderContext.container;\n    const logger = container.get(ILogger).scopeTo('RouteContext');\n\n    const routeDefinition = RouteDefinition.resolve(component.Type);\n    let routeDefinitionLookup = this.vpaLookup.get(viewportAgent);\n    if (routeDefinitionLookup === void 0) {\n      this.vpaLookup.set(viewportAgent, routeDefinitionLookup = new WeakMap());\n    }\n\n    let routeContext = routeDefinitionLookup.get(routeDefinition);\n    if (routeContext === void 0) {\n      logger.trace(`creating new RouteContext for %s`, routeDefinition);\n\n      const parent = container.has(IRouteContext, true) ? container.get(IRouteContext) : null;\n\n      routeDefinitionLookup.set(\n        routeDefinition,\n        routeContext = new RouteContext(\n          viewportAgent,\n          parent,\n          component,\n          routeDefinition,\n          container,\n        ),\n      );\n    } else {\n      logger.trace(`returning existing RouteContext for %s`, routeDefinition);\n\n      if (viewportAgent !== null) {\n        routeContext.vpa = viewportAgent;\n      }\n    }\n\n    return routeContext;\n  }\n\n  public createViewportInstructions(instructionOrInstructions: NavigationInstruction | readonly NavigationInstruction[], options?: INavigationOptions): ViewportInstructionTree {\n    if (typeof instructionOrInstructions === 'string') {\n      instructionOrInstructions = this.locationMgr.removeBaseHref(instructionOrInstructions);\n    }\n    return ViewportInstructionTree.create(instructionOrInstructions, this.getNavigationOptions(options));\n  }\n\n  /**\n   * Enqueue an instruction tree to be processed as soon as possible.\n   *\n   * Will wait for any existing in-flight transition to finish, otherwise starts immediately.\n   *\n   * @param instructions - The instruction tree that determines the transition\n   * @param trigger - `'popstate'` or `'hashchange'` if initiated by a browser event, or `'api'` for manually initiated transitions via the `load` api.\n   * @param state - The state to restore, if any.\n   * @param failedTr - If this is a redirect / fallback from a failed transition, the previous transition is passed forward to ensure the orinal promise resolves with the latest result.\n   */\n  private enqueue(\n    instructions: ViewportInstructionTree,\n    trigger: 'popstate' | 'hashchange' | 'api',\n    state: ManagedState | null,\n    failedTr: Transition | null,\n  ): boolean | Promise<boolean> {\n    const lastTr = this.currentTr;\n\n    if (trigger !== 'api' && lastTr.trigger === 'api' && lastTr.instructions.equals(instructions)) {\n      // User-triggered navigation that results in `replaceState` with the same URL. The API call already triggered the navigation; event is ignored.\n      this.logger.debug(`Ignoring navigation triggered by '%s' because it is the same URL as the previous navigation which was triggered by 'api'.`, trigger);\n      return true;\n    }\n\n    let resolve: Exclude<Transition['resolve'], null> = (void 0)!; // Need this initializer because TS doesn't know the promise executor will run synchronously\n    let reject: Exclude<Transition['reject'], null> = (void 0)!;\n    let promise: Exclude<Transition['promise'], null>;\n\n    if (failedTr === null) {\n      promise = new Promise(function ($resolve, $reject) { resolve = $resolve; reject = $reject; });\n    } else {\n      // Ensure that `await router.load` only resolves when the transition truly finished, so chain forward on top of\n      // any previously failed transition that caused a recovering backwards navigation.\n      this.logger.debug(`Reusing promise/resolve/reject from the previously failed transition %s`, failedTr);\n      promise = failedTr.promise!;\n      resolve = failedTr.resolve!;\n      reject = failedTr.reject!;\n    }\n\n    // This is an intentional overwrite: if a new transition is scheduled while the currently scheduled transition hasn't even started yet,\n    // then the currently scheduled transition is effectively canceled/ignored.\n    // This is consistent with the runtime's controller behavior, where if you rapidly call async activate -> deactivate -> activate (for example), then the deactivate is canceled.\n    const nextTr = this.nextTr = Transition.create({\n      id: ++this.navigationId,\n      trigger,\n      managedState: state,\n      prevInstructions: lastTr.finalInstructions,\n      finalInstructions: instructions,\n      instructionsChanged: !lastTr.finalInstructions.equals(instructions),\n      instructions,\n      options: instructions.options,\n      promise,\n      resolve,\n      reject,\n      previousRouteTree: this.routeTree,\n      routeTree: this._routeTree = this.routeTree.clone(),\n      guardsResult: true,\n      error: void 0,\n    });\n\n    this.logger.debug(`Scheduling transition: %s`, nextTr);\n\n    if (this.activeNavigation === null) {\n      // Catch any errors that might be thrown by `run` and reject the original promise which is awaited down below\n      try {\n        this.run(nextTr);\n      } catch (err) {\n        nextTr.handleError(err);\n      }\n    }\n\n    return nextTr.promise!.then(ret => {\n      this.logger.debug(`Transition succeeded: %s`, nextTr);\n      return ret;\n    }).catch(err => {\n      this.logger.error(`Navigation failed: %s`, nextTr, err);\n      throw err;\n    });\n  }\n\n  private run(tr: Transition): void {\n    this.currentTr = tr;\n    this.nextTr = null;\n\n    // Clone it because the prevNavigation could have observers and stuff on it, and it's meant to be a standalone snapshot from here on.\n    const prevNavigation = this.lastSuccessfulNavigation === null ? null : Navigation.create({\n      ...this.lastSuccessfulNavigation,\n      // There could be arbitrary state stored on a navigation, so to prevent memory leaks we only keep one `prevNavigation` around\n      prevNavigation: null,\n    });\n\n    this.activeNavigation = Navigation.create({\n      id: tr.id,\n      instructions: tr.instructions,\n      trigger: tr.trigger,\n      options: tr.options,\n      prevNavigation,\n      finalInstructions: tr.finalInstructions,\n    });\n\n    const navigationContext = this.resolveContext(tr.options.context);\n    const routeChanged = (\n      !this.navigated ||\n      tr.instructions.children.length !== navigationContext.node.children.length ||\n      tr.instructions.children.some((x, i) => !(navigationContext.node.children[i]?.originalInstruction!.equals(x) ?? false))\n    );\n    const shouldProcessRoute = routeChanged || tr.options.getSameUrlStrategy(this.instructions) === 'reload';\n\n    if (!shouldProcessRoute) {\n      this.logger.trace(`run(tr:%s) - NOT processing route`, tr);\n\n      this.navigated = true;\n      this.activeNavigation = null;\n\n      tr.resolve!(false);\n\n      this.runNextTransition(tr);\n      return;\n    }\n\n    this.logger.trace(`run(tr:%s) - processing route`, tr);\n\n    this.events.publish(new NavigationStartEvent(tr.id, tr.instructions, tr.trigger, tr.managedState));\n\n    // If user triggered a new transition in response to the NavigationStartEvent\n    // (in which case `this.nextTransition` will NOT be null), we short-circuit here and go straight to processing the next one.\n    if (this.nextTr !== null) {\n      this.logger.debug(`run(tr:%s) - aborting because a new transition was queued in response to the NavigationStartEvent`, tr);\n      return this.run(this.nextTr);\n    }\n\n    this.activeNavigation = Navigation.create({\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n      ...this.activeNavigation!,\n      // After redirects are applied, this could be a different route\n      finalInstructions: tr.finalInstructions,\n    });\n\n    // TODO: run global guards\n    //\n    //\n    // ---\n\n    tr.run(() => {\n      this.logger.trace(`run() - compiling route tree: %s`, tr.finalInstructions);\n      return updateRouteTree(tr.routeTree, tr.finalInstructions, navigationContext);\n    }, () => {\n      const prev = tr.previousRouteTree.root.children;\n      const next = tr.routeTree.root.children;\n      const all = mergeDistinct(prev, next);\n\n      Batch.start(b => {\n        this.logger.trace(`run() - invoking canUnload on ${prev.length} nodes`);\n        for (const node of prev) {\n          node.context.vpa.canUnload(tr, b);\n        }\n      }).continueWith(b => {\n        if (tr.guardsResult !== true) {\n          b.push(); // prevent the next step in the batch from running\n          this.cancelNavigation(tr);\n        }\n      }).continueWith(b => {\n        this.logger.trace(`run() - invoking canLoad on ${next.length} nodes`);\n        for (const node of next) {\n          node.context.vpa.canLoad(tr, b);\n        }\n      }).continueWith(b => {\n        if (tr.guardsResult !== true) {\n          b.push();\n          this.cancelNavigation(tr);\n        }\n      }).continueWith(b => {\n        this.logger.trace(`run() - invoking unload on ${prev.length} nodes`);\n        for (const node of prev) {\n          node.context.vpa.unload(tr, b);\n        }\n      }).continueWith(b => {\n        this.logger.trace(`run() - invoking load on ${next.length} nodes`);\n        for (const node of next) {\n          node.context.vpa.load(tr, b);\n        }\n      }).continueWith(b => {\n        this.logger.trace(`run() - invoking swap on ${all.length} nodes`);\n        for (const node of all) {\n          node.context.vpa.swap(tr, b);\n        }\n      }).continueWith(() => {\n        this.logger.trace(`run() - finalizing transition`);\n        // order doesn't matter for this operation\n        all.forEach(function (node) {\n          node.context.vpa.endTransition();\n        });\n        this.navigated = true;\n\n        this.instructions = tr.finalInstructions = tr.routeTree.finalizeInstructions();\n        this.events.publish(new NavigationEndEvent(tr.id, tr.instructions, this.instructions));\n\n        this.lastSuccessfulNavigation = this.activeNavigation;\n        this.activeNavigation = null;\n        this.applyHistoryState(tr);\n        tr.resolve!(true);\n\n        this.runNextTransition(tr);\n      }).start();\n    });\n  }\n\n  private applyHistoryState(tr: Transition): void {\n    const newUrl = tr.finalInstructions.toUrl(this.options.useUrlFragmentHash);\n    switch (tr.options.getHistoryStrategy(this.instructions)) {\n      case 'none':\n        // do nothing\n        break;\n      case 'push':\n        this.locationMgr.pushState(toManagedState(tr.options.state, tr.id), this.updateTitle(tr), newUrl);\n        break;\n      case 'replace':\n        this.locationMgr.replaceState(toManagedState(tr.options.state, tr.id), this.updateTitle(tr), newUrl);\n        break;\n    }\n  }\n\n  private getTitle(tr: Transition): string {\n    switch (typeof tr.options.title) {\n      case 'function':\n        return tr.options.title.call(void 0, tr.routeTree.root) ?? '';\n      case 'string':\n        return tr.options.title;\n      default:\n        return tr.routeTree.root.getTitle(tr.options.titleSeparator) ?? '';\n    }\n  }\n\n  private updateTitle(tr: Transition): string {\n    const title = this.getTitle(tr);\n    if (title.length > 0) {\n      this.p.document.title = title;\n    }\n    return this.p.document.title;\n  }\n\n  private cancelNavigation(tr: Transition): void {\n    this.logger.trace(`cancelNavigation(tr:%s)`, tr);\n\n    const prev = tr.previousRouteTree.root.children;\n    const next = tr.routeTree.root.children;\n    const all = mergeDistinct(prev, next);\n    // order doesn't matter for this operation\n    all.forEach(function (node) {\n      node.context.vpa.cancelUpdate();\n    });\n\n    this.activeNavigation = null;\n    this.instructions = tr.prevInstructions;\n    this._routeTree = tr.previousRouteTree;\n    this.events.publish(new NavigationCancelEvent(tr.id, tr.instructions, `guardsResult is ${tr.guardsResult}`));\n\n    if (tr.guardsResult === false) {\n      tr.resolve!(false);\n\n      // In case a new navigation was requested in the meantime, immediately start processing it\n      this.runNextTransition(tr);\n    } else {\n      void onResolve(this.enqueue(tr.guardsResult as ViewportInstructionTree, 'api', tr.managedState, tr), () => {\n        this.logger.trace(`cancelNavigation(tr:%s) - finished redirect`, tr);\n      });\n    }\n  }\n\n  private runNextTransition(tr: Transition): void {\n    if (this.nextTr !== null) {\n      this.logger.trace(`runNextTransition(tr:%s) -> scheduling nextTransition: %s`, tr, this.nextTr);\n      this.p.taskQueue.queueTask(\n        () => {\n          // nextTransition is allowed to change up until the point when it's actually time to process it,\n          // so we need to check it for null again when the scheduled task runs.\n          const nextTr = this.nextTr;\n          if (nextTr !== null) {\n            try {\n              this.run(nextTr);\n            } catch (err) {\n              nextTr.handleError(err);\n            }\n          }\n        },\n      );\n    }\n  }\n\n  private getNavigationOptions(options?: INavigationOptions): NavigationOptions {\n    return NavigationOptions.create({ ...this.options, ...options });\n  }\n}\n","/* eslint-disable @typescript-eslint/restrict-template-expressions */\nimport { DI, isObject, Constructable, IModule, isArrayIndex } from '@aurelia/kernel';\nimport { ICustomElementViewModel, ICustomElementController, PartialCustomElementDefinition, isCustomElementViewModel, CustomElement, CustomElementDefinition } from '@aurelia/runtime-html';\n\nimport { IRouteViewModel } from './component-agent.js';\nimport { RouteType } from './route.js';\nimport { IRouteContext } from './route-context.js';\nimport { expectType, isPartialCustomElementDefinition, isPartialViewportInstruction, shallowEquals } from './validation.js';\nimport { INavigationOptions, NavigationOptions } from './router.js';\nimport { RouteExpression } from './route-expression.js';\nimport { tryStringify } from './util.js';\n\nexport type RouteContextLike = IRouteContext | ICustomElementViewModel | ICustomElementController | HTMLElement;\n\n/**\n * Either a `RouteableComponent`, a string (name) that can be resolved to one or a ViewportInstruction:\n * - `string`: a string representing the component name. Must be resolveable via DI from the context of the component relative to which the navigation occurs (specified in the `dependencies` array, `<import>`ed in the view, declared as an inline template, or registered globally)\n * - `IViewportInstruction`: a viewport instruction object.\n * - `RouteableComponent`: see `RouteableComponent`.\n *\n * NOTE: differs from `Routeable` only in having `IViewportIntruction` instead of `IChildRouteConfig`\n * (which in turn are quite similar, but do have a few minor but important differences that make them non-interchangeable)\n */\nexport type NavigationInstruction = string | IViewportInstruction | RouteableComponent;\n\n/**\n * A component type, instance of definition that can be navigated to:\n * - `RouteType`: a custom element class with optional static properties that specify routing-specific attributes.\n * - `Promise<IModule>`: a lazy loaded module, e.g. the return value of a dynamic import expression pointing to a file with a routeable component as the default export or the first named export.\n * - `PartialCustomElementDefinition`: either a complete `CustomElementDefinition` or a partial definition (e.g. an object literal with at least the `name` property)\n * - `IRouteViewModel`: an existing component instance.\n */\nexport type RouteableComponent = RouteType | Promise<IModule> | PartialCustomElementDefinition | IRouteViewModel;\n\nexport type Params = { [key: string]: string | undefined };\n\nexport const IViewportInstruction = DI.createInterface<IViewportInstruction>('IViewportInstruction');\nexport interface IViewportInstruction {\n  readonly context?: RouteContextLike | null;\n  readonly append?: boolean;\n  readonly open?: number;\n  readonly close?: number;\n  /**\n   * The component to load.\n   *\n   * - `string`: a string representing the component name. Must be resolveable via DI from the context of the component relative to which the navigation occurs (specified in the `dependencies` array, `<import>`ed in the view, declared as an inline template, or registered globally)\n   * - `RouteType`: a custom element class with optional static properties that specify routing-specific attributes.\n   * - `PartialCustomElementDefinition`: either a complete `CustomElementDefinition` or a partial definition (e.g. an object literal with at least the `name` property)\n   * - `IRouteViewModel`: an existing component instance.\n   */\n  readonly component: string | RouteableComponent;\n  /**\n   * The name of the viewport this component should be loaded into.\n   */\n  readonly viewport?: string | null;\n  /**\n   * The parameters to pass into the component.\n   */\n  readonly params?: Params | null;\n  /**\n   * The child routes to load underneath the context of this instruction's component.\n   */\n  readonly children?: readonly NavigationInstruction[];\n}\n\nexport class ViewportInstruction<TComponent extends ITypedNavigationInstruction_T = ITypedNavigationInstruction_Component> implements IViewportInstruction {\n  private constructor(\n    public readonly context: RouteContextLike | null,\n    public append: boolean,\n    public open: number,\n    public close: number,\n    public readonly component: TComponent,\n    public readonly viewport: string | null,\n    public readonly params: Params | null,\n    public readonly children: ViewportInstruction[],\n  ) {}\n\n  public static create(instruction: NavigationInstruction, context?: RouteContextLike | null): ViewportInstruction {\n    if (instruction instanceof ViewportInstruction) {\n      return instruction;\n    }\n\n    if (isPartialViewportInstruction(instruction)) {\n      const component = TypedNavigationInstruction.create(instruction.component);\n      const children = instruction.children?.map(ViewportInstruction.create) ?? [];\n\n      return new ViewportInstruction(\n        instruction.context ?? context ?? null,\n        instruction.append ?? false,\n        instruction.open ?? 0,\n        instruction.close ?? 0,\n        component,\n        instruction.viewport ?? null,\n        instruction.params ?? null,\n        children,\n      );\n    }\n\n    const typedInstruction = TypedNavigationInstruction.create(instruction);\n    return new ViewportInstruction(context ?? null, false, 0, 0, typedInstruction, null, null, []);\n  }\n\n  public contains(other: ViewportInstruction): boolean {\n    const thisChildren = this.children;\n    const otherChildren = other.children;\n    if (thisChildren.length < otherChildren.length) {\n      return false;\n    }\n\n    // TODO(fkleuver): incorporate viewports when null / '' descrepancies are fixed,\n    // as well as params when inheritance is fully fixed\n    if (!this.component.equals(other.component)) {\n      return false;\n    }\n\n    for (let i = 0, ii = otherChildren.length; i < ii; ++i) {\n      if (!thisChildren[i].contains(otherChildren[i])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public equals(other: ViewportInstruction): boolean {\n    const thisChildren = this.children;\n    const otherChildren = other.children;\n    if (thisChildren.length !== otherChildren.length) {\n      return false;\n    }\n\n    if (\n      // TODO(fkleuver): decide if we really need to include `context` in this comparison\n      !this.component.equals(other.component) ||\n      this.viewport !== other.viewport ||\n      !shallowEquals(this.params, other.params)\n    ) {\n      return false;\n    }\n\n    for (let i = 0, ii = thisChildren.length; i < ii; ++i) {\n      if (!thisChildren[i].equals(otherChildren[i])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public clone(): this {\n    return new ViewportInstruction(\n      this.context,\n      this.append,\n      this.open,\n      this.close,\n      this.component.clone(),\n      this.viewport,\n      this.params === null ? null : { ...this.params },\n      [...this.children],\n    ) as this;\n  }\n\n  public toUrlComponent(recursive: boolean = true): string {\n    // TODO(fkleuver): use the context to determine create full tree\n    const component = this.component.toUrlComponent();\n    const params = this.params === null || Object.keys(this.params).length === 0 ? '' : `(${stringifyParams(this.params)})`;\n    const viewport = component.length === 0 || this.viewport === null || this.viewport.length === 0 ? '' : `@${this.viewport}`;\n    const thisPart = `${'('.repeat(this.open)}${component}${params}${viewport}${')'.repeat(this.close)}`;\n    const childPart = recursive ? this.children.map(x => x.toUrlComponent()).join('+') : '';\n    if (thisPart.length > 0) {\n      if (childPart.length > 0) {\n        return [thisPart, childPart].join('/');\n      }\n      return thisPart;\n    }\n    return childPart;\n  }\n\n  public toString(): string {\n    const component = `c:${this.component}`;\n    const viewport = this.viewport === null || this.viewport.length === 0 ? '' : `viewport:${this.viewport}`;\n    const children = this.children.length === 0 ? '' : `children:[${this.children.map(String).join(',')}]`;\n    const props = [component, viewport, children].filter(Boolean).join(',');\n    return `VPI(${props})`;\n  }\n}\n\nfunction stringifyParams(params: Params): string {\n  const keys = Object.keys(params);\n  const values = Array<string>(keys.length);\n  const indexKeys: number[] = [];\n  const namedKeys: string[] = [];\n  for (const key of keys) {\n    if (isArrayIndex(key)) {\n      indexKeys.push(Number(key));\n    } else {\n      namedKeys.push(key);\n    }\n  }\n\n  for (let i = 0; i < keys.length; ++i) {\n    const indexKeyIdx = indexKeys.indexOf(i);\n    if (indexKeyIdx > -1) {\n      values[i] = params[i] as string;\n      indexKeys.splice(indexKeyIdx, 1);\n    } else {\n      const namedKey = namedKeys.shift()!;\n      values[i] = `${namedKey}=${params[namedKey]}`;\n    }\n  }\n  return values.join(',');\n}\n\nexport interface IRedirectInstruction {\n  readonly path: string;\n  readonly redirectTo: string;\n}\n\nexport class RedirectInstruction implements IRedirectInstruction {\n  private constructor(\n    public readonly path: string,\n    public readonly redirectTo: string,\n  ) {}\n\n  public static create(instruction: IRedirectInstruction): RedirectInstruction {\n    if (instruction instanceof RedirectInstruction) {\n      return instruction;\n    }\n\n    return new RedirectInstruction(instruction.path, instruction.redirectTo);\n  }\n\n  public equals(other: RedirectInstruction): boolean {\n    return this.path === other.path && this.redirectTo === other.redirectTo;\n  }\n\n  public toUrlComponent(): string {\n    return this.path;\n  }\n\n  public toString(): string {\n    return `RI(path:'${this.path}',redirectTo:'${this.redirectTo}')`;\n  }\n}\n\n/**\n * Associate the object with an id so it can be stored in history as a serialized url segment.\n *\n * WARNING: As the implementation is right now, this is a memory leak disaster.\n * This is really a placeholder implementation at the moment and should NOT be used / advertised for production until a leak-free solution is made.\n */\nconst getObjectId = (function () {\n  let lastId = 0;\n  const objectIdMap = new Map<object, number>();\n\n  return function (obj: object): number {\n    let id = objectIdMap.get(obj);\n    if (id === void 0) {\n      objectIdMap.set(obj, id = ++lastId);\n    }\n    return id;\n  };\n})();\n\nexport class ViewportInstructionTree {\n  public constructor(\n    public readonly options: NavigationOptions,\n    public readonly isAbsolute: boolean,\n    public readonly children: ViewportInstruction[],\n    public readonly queryParams: Readonly<URLSearchParams>,\n    public readonly fragment: string | null,\n  ) {}\n\n  public static create(instructionOrInstructions: NavigationInstruction | NavigationInstruction[], options?: INavigationOptions): ViewportInstructionTree {\n    const $options = NavigationOptions.create({ ...options });\n\n    if (instructionOrInstructions instanceof ViewportInstructionTree) {\n      return new ViewportInstructionTree(\n        $options,\n        instructionOrInstructions.isAbsolute,\n        instructionOrInstructions.children.map(x => ViewportInstruction.create(x, $options.context)),\n        instructionOrInstructions.queryParams,\n        instructionOrInstructions.fragment,\n      );\n    }\n\n    if (instructionOrInstructions instanceof Array) {\n      return new ViewportInstructionTree(\n        $options,\n        false,\n        instructionOrInstructions.map(x => ViewportInstruction.create(x, $options.context)),\n        Object.freeze(new URLSearchParams()),\n        null,\n      );\n    }\n\n    if (typeof instructionOrInstructions === 'string') {\n      const expr = RouteExpression.parse(instructionOrInstructions, $options.useUrlFragmentHash);\n      return expr.toInstructionTree($options);\n    }\n\n    return new ViewportInstructionTree(\n      $options,\n      false,\n      [ViewportInstruction.create(instructionOrInstructions, $options.context)],\n      Object.freeze(new URLSearchParams()),\n      null,\n    );\n  }\n\n  public equals(other: ViewportInstructionTree): boolean {\n    const thisChildren = this.children;\n    const otherChildren = other.children;\n    if (thisChildren.length !== otherChildren.length) {\n      return false;\n    }\n\n    for (let i = 0, ii = thisChildren.length; i < ii; ++i) {\n      if (!thisChildren[i].equals(otherChildren[i])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public toUrl(useUrlFragmentHash: boolean = false): string {\n    let pathname: string;\n    let hash: string;\n    if (useUrlFragmentHash) {\n      pathname = '';\n      hash = `#${this.toPath()}`;\n    } else {\n      pathname = this.toPath();\n      hash = this.fragment ?? '';\n    }\n\n    let search = this.queryParams.toString();\n    search = search === '' ? '' : `?${search}`;\n\n    const url = `${pathname}${hash}${search}`;\n    return url;\n  }\n\n  public toPath(): string {\n    const path = this.children.map(x => x.toUrlComponent()).join('+');\n    return path;\n  }\n\n  public toString(): string {\n    return `[${this.children.map(String).join(',')}]`;\n  }\n}\n\nexport const enum NavigationInstructionType {\n  string,\n  ViewportInstruction,\n  CustomElementDefinition,\n  Promise,\n  IRouteViewModel,\n}\nexport interface ITypedNavigationInstruction<\n  TInstruction extends NavigationInstruction,\n  TType extends NavigationInstructionType\n> {\n  readonly type: TType;\n  readonly value: TInstruction;\n  equals(other: ITypedNavigationInstruction_T): boolean;\n  toUrlComponent(): string;\n  clone(): this;\n}\nexport interface ITypedNavigationInstruction_string extends ITypedNavigationInstruction<string, NavigationInstructionType.string> {}\nexport interface ITypedNavigationInstruction_ViewportInstruction extends ITypedNavigationInstruction<ViewportInstruction, NavigationInstructionType.ViewportInstruction> {}\nexport interface ITypedNavigationInstruction_CustomElementDefinition extends ITypedNavigationInstruction<CustomElementDefinition, NavigationInstructionType.CustomElementDefinition> {}\nexport interface ITypedNavigationInstruction_Promise extends ITypedNavigationInstruction<Promise<IModule>, NavigationInstructionType.Promise> {}\nexport interface ITypedNavigationInstruction_IRouteViewModel extends ITypedNavigationInstruction<IRouteViewModel, NavigationInstructionType.IRouteViewModel> {}\n\nexport type ITypedNavigationInstruction_T = (\n  ITypedNavigationInstruction_Component |\n  ITypedNavigationInstruction_ViewportInstruction\n);\n\nexport type ITypedNavigationInstruction_Component = (\n  ITypedNavigationInstruction_ResolvedComponent |\n  ITypedNavigationInstruction_Promise\n);\n\nexport type ITypedNavigationInstruction_ResolvedComponent = (\n  ITypedNavigationInstruction_string |\n  ITypedNavigationInstruction_CustomElementDefinition |\n  ITypedNavigationInstruction_IRouteViewModel\n);\n\nexport class TypedNavigationInstruction<TInstruction extends NavigationInstruction, TType extends NavigationInstructionType> implements ITypedNavigationInstruction<TInstruction, TType> {\n  private constructor(\n    public readonly type: TType,\n    public readonly value: TInstruction,\n  ) {}\n\n  public static create(instruction: string): ITypedNavigationInstruction_string;\n  public static create(instruction: IViewportInstruction): ITypedNavigationInstruction_ViewportInstruction;\n  public static create(instruction: RouteType | PartialCustomElementDefinition): ITypedNavigationInstruction_CustomElementDefinition;\n  public static create(instruction: Promise<IModule>): ITypedNavigationInstruction_Promise;\n  public static create(instruction: IRouteViewModel): ITypedNavigationInstruction_IRouteViewModel;\n  public static create(instruction: Exclude<NavigationInstruction, IViewportInstruction>): Exclude<ITypedNavigationInstruction_T, ITypedNavigationInstruction_ViewportInstruction>;\n  public static create(instruction: NavigationInstruction): ITypedNavigationInstruction_T;\n  public static create(instruction: NavigationInstruction): ITypedNavigationInstruction_T {\n    if (instruction instanceof TypedNavigationInstruction) {\n      return instruction;\n    }\n\n    if (typeof instruction === 'string') {\n      return new TypedNavigationInstruction(NavigationInstructionType.string, instruction);\n    } else if (!isObject(instruction)) {\n      // Typings prevent this from happening, but guard it anyway due to `as any` and the sorts being a thing in userland code and tests.\n      expectType('function/class or object', '', instruction);\n    } else if (typeof instruction === 'function') {\n      // This is the class itself\n      // CustomElement.getDefinition will throw if the type is not a custom element\n      const definition = CustomElement.getDefinition(instruction);\n      return new TypedNavigationInstruction(NavigationInstructionType.CustomElementDefinition, definition);\n    } else if (instruction instanceof Promise) {\n      return new TypedNavigationInstruction(NavigationInstructionType.Promise, instruction);\n    } else if (isPartialViewportInstruction(instruction)) {\n      const viewportInstruction = ViewportInstruction.create(instruction);\n      return new TypedNavigationInstruction(NavigationInstructionType.ViewportInstruction, viewportInstruction);\n    } else if (isCustomElementViewModel(instruction)) {\n      return new TypedNavigationInstruction(NavigationInstructionType.IRouteViewModel, instruction);\n    } else if (instruction instanceof CustomElementDefinition) {\n      // We might have gotten a complete definition. In that case use it as-is.\n      return new TypedNavigationInstruction(NavigationInstructionType.CustomElementDefinition, instruction);\n    } else if (isPartialCustomElementDefinition(instruction)) {\n      // If we just got a partial definition, define a new anonymous class\n      const Type = CustomElement.define(instruction);\n      const definition = CustomElement.getDefinition(Type);\n      return new TypedNavigationInstruction(NavigationInstructionType.CustomElementDefinition, definition);\n    } else {\n      throw new Error(`Invalid component ${tryStringify(instruction)}: must be either a class, a custom element ViewModel, or a (partial) custom element definition`);\n    }\n  }\n\n  public equals(this: ITypedNavigationInstruction_T, other: ITypedNavigationInstruction_T): boolean {\n    switch (this.type) {\n      case NavigationInstructionType.CustomElementDefinition:\n      case NavigationInstructionType.IRouteViewModel:\n      case NavigationInstructionType.Promise:\n      case NavigationInstructionType.string:\n        return this.type === other.type && this.value === other.value;\n      case NavigationInstructionType.ViewportInstruction:\n        return this.type === other.type && this.value.equals(other.value);\n    }\n  }\n\n  public clone(): this {\n    return new TypedNavigationInstruction(\n      this.type,\n      this.value\n    ) as this;\n  }\n\n  public toUrlComponent(this: ITypedNavigationInstruction_T): string {\n    switch (this.type) {\n      case NavigationInstructionType.CustomElementDefinition:\n        return this.value.name;\n      case NavigationInstructionType.IRouteViewModel:\n      case NavigationInstructionType.Promise:\n        return `au$obj${getObjectId(this.value)}`;\n      case NavigationInstructionType.ViewportInstruction:\n        return this.value.toUrlComponent();\n      case NavigationInstructionType.string:\n        return this.value;\n    }\n  }\n\n  public toString(this: ITypedNavigationInstruction_T): string {\n    switch (this.type) {\n      case NavigationInstructionType.CustomElementDefinition:\n        return `CEDef(name:'${this.value.name}')`;\n      case NavigationInstructionType.Promise:\n        return `Promise`;\n      case NavigationInstructionType.IRouteViewModel:\n        return `VM(name:'${CustomElement.getDefinition(this.value.constructor as Constructable).name}')`;\n      case NavigationInstructionType.ViewportInstruction:\n        return this.value.toString();\n      case NavigationInstructionType.string:\n        return `'${this.value}'`;\n    }\n  }\n}\n","import { Constructable, emptyArray, Metadata, Protocol, ResourceType } from '@aurelia/kernel';\n\nimport { validateRouteConfig, expectType, shallowEquals } from './validation.js';\nimport { RouteableComponent, Params } from './instructions.js';\nimport { RouteNode } from './route-tree.js';\n\nconst noRoutes = emptyArray as RouteConfig['routes'];\n\n/**\n * Either a `RouteableComponent` or a name/config that can be resolved to a one:\n * - `string`: a string representing the component name. Must be resolveable via DI from the context of the component relative to which the navigation occurs (specified in the `dependencies` array, `<import>`ed in the view, declared as an inline template, or registered globally)\n * - `IChildRouteConfig`: a standalone child route config object.\n * - `Routeable`: see `Routeable`.\n *\n * NOTE: differs from `NavigationInstruction` only in having `IChildRouteConfig` instead of `IViewportIntruction`\n * (which in turn are quite similar, but do have a few minor but important differences that make them non-interchangeable)\n * as well as `IRedirectRouteConfig`\n */\nexport type Routeable = string | IChildRouteConfig | IRedirectRouteConfig | RouteableComponent;\n\nexport interface IRouteConfig extends Partial<Omit<RouteConfig, 'saveTo'>> { }\nexport interface IChildRouteConfig extends IRouteConfig, Pick<ChildRouteConfig, 'component'> { }\nexport interface IRedirectRouteConfig extends Pick<IRouteConfig, 'caseSensitive'>, Pick<RouteConfig, 'redirectTo' | 'path'> { }\n\nexport type TransitionPlan = 'none' | 'replace' | 'invoke-lifecycles';\nexport type TransitionPlanOrFunc = TransitionPlan | ((current: RouteNode, next: RouteNode) => TransitionPlan);\nexport function defaultReentryBehavior(current: RouteNode, next: RouteNode): TransitionPlan {\n  if (!shallowEquals(current.params, next.params)) {\n    return 'invoke-lifecycles';\n  }\n\n  return 'none';\n}\n\nexport class RouteConfig {\n  protected constructor(\n    /**\n     * The id for this route, which can be used in the view for generating hrefs.\n     *\n     * (TODO: decide on, and provide more details about, whether this can be specified without specifying path, and what happens in different combinations of situations)\n     */\n    public readonly id: string | null,\n    /**\n     * The path to match against the url.\n     *\n     * If left blank, the path will be derived from the component's static `path` property (if it exists), or otherwise the component name will be used (if direct routing is enabled).\n     */\n    public readonly path: string | string[] | null,\n    /**\n     * The title to use for this route when matched.\n     *\n     * If left blank, this route will not contribute to the generated title.\n     */\n    public readonly title: string | ((node: RouteNode) => string | null) | null,\n    /**\n     * The path to which to redirect when the url matches the path in this config.\n     *\n     * If the path begins with a slash (`/`), the redirect path is considered absolute, otherwise it is considered relative to the parent path.\n     */\n    public readonly redirectTo: string | null,\n    /**\n     * Whether the `path` should be case sensitive.\n     */\n    public readonly caseSensitive: boolean,\n    /**\n     * How to behave when this component scheduled to be loaded again in the same viewport:\n     *\n     * - `replace`: completely removes the current component and creates a new one, behaving as if the component changed.\n     * - `invoke-lifecycles`: calls `canUnload`, `canLoad`, `unload` and `load` (default if only the parameters have changed)\n     * - `none`: does nothing (default if nothing has changed for the viewport)\n     *\n     * By default, calls the router lifecycle hooks only if the parameters have changed, otherwise does nothing.\n     */\n    public readonly transitionPlan: TransitionPlanOrFunc,\n    /**\n     * The name of the viewport this component should be loaded into.\n     *\n     * (TODO: decide on, and provide more details about, whether this can be specified without specifying path, and what happens in different combinations of situations)\n     */\n    public readonly viewport: string | null,\n    /**\n     * Any custom data that should be accessible to matched components or hooks.\n     */\n    public readonly data: Params,\n    /**\n     * The child routes that can be navigated to from this route. See `Routeable` for more information.\n     */\n    public readonly routes: readonly Routeable[],\n  ) { }\n\n  public static create(configOrPath: IRouteConfig | string | string[], Type: RouteType | null): RouteConfig {\n    if (typeof configOrPath === 'string' || configOrPath instanceof Array) {\n      const path = configOrPath;\n\n      const redirectTo = Type?.redirectTo ?? null;\n      const caseSensitive = Type?.caseSensitive ?? false;\n      const id = Type?.id ?? (path instanceof Array ? path[0] : path);\n      const title = Type?.title ?? null;\n      const reentryBehavior = Type?.transitionPlan ?? defaultReentryBehavior;\n      const viewport = Type?.viewport ?? null;\n      const data = Type?.data ?? {};\n      const children = Type?.routes ?? noRoutes;\n\n      return new RouteConfig(\n        id,\n        path,\n        title,\n        redirectTo,\n        caseSensitive,\n        reentryBehavior,\n        viewport,\n        data,\n        children,\n      );\n    } else if (typeof configOrPath === 'object') {\n      const config = configOrPath;\n      validateRouteConfig(config, '');\n\n      const path = config.path ?? Type?.path ?? null;\n      const title = config.title ?? Type?.title ?? null;\n      const redirectTo = config.redirectTo ?? Type?.redirectTo ?? null;\n      const caseSensitive = config.caseSensitive ?? Type?.caseSensitive ?? false;\n      const id = config.id ?? Type?.id ?? (path instanceof Array ? path[0] : path);\n      const reentryBehavior = config.transitionPlan ?? Type?.transitionPlan ?? defaultReentryBehavior;\n      const viewport = config.viewport ?? Type?.viewport ?? null;\n      const data = {\n        ...Type?.data,\n        ...config.data,\n      };\n      const children = [\n        ...(config.routes ?? noRoutes),\n        ...(Type?.routes ?? noRoutes),\n      ];\n      return new RouteConfig(\n        id,\n        path,\n        title,\n        redirectTo,\n        caseSensitive,\n        reentryBehavior,\n        viewport,\n        data,\n        children,\n      );\n    } else {\n      expectType('string, function/class or object', '', configOrPath);\n    }\n  }\n\n  public static configure<T extends RouteType>(configOrPath: IRouteConfig | string, Type: T): T {\n    const config = RouteConfig.create(configOrPath, Type);\n    Metadata.define(Route.name, config, Type);\n\n    return Type;\n  }\n\n  public static getConfig(Type: RouteType): RouteConfig {\n    if (!Metadata.hasOwn(Route.name, Type)) {\n      // In the case of a type, this means there was no @route decorator on the class.\n      // However there might still be static properties, and this API provides a unified way of accessing those.\n      Route.configure({}, Type);\n    }\n\n    return Metadata.getOwn(Route.name, Type) as RouteConfig;\n  }\n\n  public saveTo(Type: RouteType): void {\n    Metadata.define(Route.name, this, Type);\n  }\n}\n\nexport class ChildRouteConfig extends RouteConfig {\n  private constructor(\n    id: string | null,\n    path: string | string[] | null,\n    title: string | null,\n    redirectTo: string | null,\n    caseSensitive: boolean,\n    reentryBehavior: TransitionPlanOrFunc,\n    viewport: string | null,\n    data: Params,\n    routes: readonly Routeable[],\n    /**\n     * The component to load when this route is matched.\n     */\n    public readonly component: Routeable,\n  ) {\n    super(\n      id,\n      path,\n      title,\n      redirectTo,\n      caseSensitive,\n      reentryBehavior,\n      viewport,\n      data,\n      routes,\n    );\n  }\n}\n\nexport class RedirectRouteConfig {\n  private constructor(\n    public readonly path: string | string[],\n    public readonly redirectTo: string,\n    public readonly caseSensitive: boolean,\n  ) {}\n}\n\nexport const Route = {\n  name: Protocol.resource.keyFor('route'),\n  /**\n   * Returns `true` if the specified type has any static route configuration (either via static properties or a &#64;route decorator)\n   */\n  isConfigured(Type: RouteType): boolean {\n    return Metadata.hasOwn(Route.name, Type);\n  },\n  /**\n   * Apply the specified configuration to the specified type, overwriting any existing configuration.\n   */\n  configure<T extends RouteType>(configOrPath: IRouteConfig | string | string[], Type: T): T {\n    const config = RouteConfig.create(configOrPath, Type);\n    Metadata.define(Route.name, config, Type);\n\n    return Type;\n  },\n  /**\n   * Get the `RouteConfig` associated with the specified type, creating a new one if it does not yet exist.\n   */\n  getConfig(Type: RouteType): RouteConfig {\n    if (!Route.isConfigured(Type)) {\n      // This means there was no @route decorator on the class.\n      // However there might still be static properties, and this API provides a unified way of accessing those.\n      Route.configure({}, Type);\n    }\n\n    return Metadata.getOwn(Route.name, Type) as RouteConfig;\n  },\n};\n\nexport type RouteType<T extends Constructable = Constructable> = ResourceType<T, InstanceType<T>, IRouteConfig>;\nexport type RouteDecorator = <T extends Constructable>(Type: T) => T;\n\n/**\n * Associate a static route configuration with this type.\n *\n * @param config - The route config\n */\nexport function route(config: IRouteConfig): RouteDecorator;\n/**\n * Associate a static route configuration with this type.\n *\n * @param path - The path to match against.\n *\n * (TODO: improve the formatting, better examples, etc)\n *\n * ```\n * &#64;route('home')\n * export class Home {}\n * ```\n *\n * ```\n * &#64;route(':id')\n * export class ProductDetail {}\n * ```\n */\nexport function route(path: string | string[]): RouteDecorator;\nexport function route(configOrPath: IRouteConfig | string | string[]): RouteDecorator {\n  return function (target) {\n    return Route.configure(configOrPath, target);\n  };\n}\n","import { IContainer, IModule, Metadata, onResolve } from '@aurelia/kernel';\nimport { CustomElementDefinition, CustomElement } from '@aurelia/runtime-html';\n\nimport { TypedNavigationInstruction, NavigationInstructionType, Params } from './instructions.js';\nimport { RouteConfig, IChildRouteConfig, Routeable, RouteType, Route, IRedirectRouteConfig } from './route.js';\nimport { IRouteContext } from './route-context.js';\nimport { isPartialChildRouteConfig, isPartialRedirectRouteConfig } from './validation.js';\nimport { ensureArrayOfStrings, ensureString } from './util.js';\n\nexport class RouteDefinition {\n  public readonly hasExplicitPath: boolean;\n  public readonly caseSensitive: boolean;\n  public readonly path: string[];\n  public readonly redirectTo: string | null;\n  public readonly viewport: string;\n  public readonly id: string;\n  public readonly data: Params;\n\n  public constructor(\n    public readonly config: Omit<RouteConfig, 'saveTo'>,\n    public readonly component: CustomElementDefinition | null,\n  ) {\n    this.hasExplicitPath = config.path !== null;\n    this.caseSensitive = config.caseSensitive;\n    this.path = ensureArrayOfStrings(config.path ?? component!.name);\n    this.redirectTo = config.redirectTo ?? null;\n    this.viewport = config.viewport ?? 'default';\n    this.id = ensureString(config.id ?? this.path);\n    this.data = config.data ?? {};\n  }\n\n  public static resolve(routeable: Promise<IModule>, context: IRouteContext): RouteDefinition | Promise<RouteDefinition>;\n  public static resolve(routeable: string | IChildRouteConfig, context: IRouteContext): RouteDefinition;\n  public static resolve(routeable: string | IChildRouteConfig | Promise<IModule>): never;\n  public static resolve(routeable: Exclude<Routeable, Promise<IModule> | string | IChildRouteConfig>): RouteDefinition;\n  public static resolve(routeable: Routeable, context: IRouteContext): RouteDefinition | Promise<RouteDefinition>;\n  public static resolve(routeable: Routeable, context?: IRouteContext): RouteDefinition | Promise<RouteDefinition> {\n    if (isPartialRedirectRouteConfig(routeable)) {\n      return new RouteDefinition(routeable as RouteConfig, null);\n    }\n\n    // Check if this component already has a `RouteDefinition` associated with it, where the `config` matches the `RouteConfig` that is currently associated with the type.\n    // If a type is re-configured via `Route.configure`, that effectively invalidates any existing `RouteDefinition` and we re-create and associate it.\n    // Note: RouteConfig is associated with Type, but RouteDefinition is associated with CustomElementDefinition.\n    return onResolve(this.resolveCustomElementDefinition(routeable, context), def => {\n      const config = isPartialChildRouteConfig(routeable)\n        ? {\n          ...Route.getConfig(def.Type),\n          ...routeable\n        }\n        : Route.getConfig(def.Type);\n\n      if (!Metadata.hasOwn(Route.name, def)) {\n        const routeDefinition = new RouteDefinition(config, def);\n        Metadata.define(Route.name, routeDefinition, def);\n      } else {\n        let routeDefinition = Metadata.getOwn(Route.name, def) as RouteDefinition;\n        if (routeDefinition.config !== config) {\n          routeDefinition = new RouteDefinition(config, def);\n          Metadata.define(Route.name, routeDefinition, def);\n        }\n      }\n\n      return Metadata.getOwn(Route.name, def) as RouteDefinition;\n    });\n  }\n\n  public static resolveCustomElementDefinition(\n    routeable: Exclude<Routeable, IRedirectRouteConfig>,\n    context?: IRouteContext,\n  ): CustomElementDefinition | Promise<CustomElementDefinition> {\n    if (isPartialChildRouteConfig(routeable)) {\n      return this.resolveCustomElementDefinition(routeable.component, context);\n    }\n\n    const typedInstruction = TypedNavigationInstruction.create(routeable);\n    switch (typedInstruction.type) {\n      case NavigationInstructionType.string: {\n        if (context === void 0) {\n          throw new Error(`When retrieving the RouteDefinition for a component name, a RouteContext (that can resolve it) must be provided`);\n        }\n        const component = context.container.find(CustomElement, typedInstruction.value);\n        if (component === null) {\n          // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n          throw new Error(`Could not find a CustomElement named '${typedInstruction.value}' in the current container scope of ${context}. This means the component is neither registered at Aurelia startup nor via the 'dependencies' decorator or static property.`);\n        }\n        return component as CustomElementDefinition;\n      }\n      case NavigationInstructionType.CustomElementDefinition:\n        return typedInstruction.value;\n      case NavigationInstructionType.IRouteViewModel:\n        // Get the class from the constructor property. There might be static properties on it.\n        return CustomElement.getDefinition(typedInstruction.value.constructor as RouteType);\n      case NavigationInstructionType.Promise:\n        if (context === void 0) {\n          throw new Error(`RouteContext must be provided when resolving an imported module`);\n        }\n        return context.resolveLazy(typedInstruction.value);\n    }\n  }\n\n  public register(container: IContainer): void {\n    this.component?.register(container);\n  }\n\n  public toUrlComponent(): string {\n    return 'not-implemented'; // TODO\n  }\n\n  public toString(): string {\n    const path = this.config.path === null ? 'null' : `'${this.config.path}'`;\n    if (this.component !== null) {\n      return `RD(config.path:${path},c.name:'${this.component.name}')`;\n    } else {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      return `RD(config.path:${path},redirectTo:'${this.redirectTo}')`;\n    }\n  }\n}\n","import { ICustomElementController, Controller, IHydratedController, LifecycleFlags, ICustomElementViewModel, IAppRoot, ILifecycleHooks, LifecycleHooksLookup } from '@aurelia/runtime-html';\nimport { Constructable, ILogger } from '@aurelia/kernel';\n\nimport { RouteDefinition } from './route-definition.js';\nimport { RouteNode } from './route-tree.js';\nimport { IRouteContext } from './route-context.js';\nimport { Params, NavigationInstruction, ViewportInstructionTree } from './instructions.js';\nimport { Transition } from './router.js';\nimport { Batch } from './util.js';\n\nexport interface IRouteViewModel extends ICustomElementViewModel {\n  canLoad?(params: Params, next: RouteNode, current: RouteNode | null): boolean | NavigationInstruction | NavigationInstruction[] | Promise<boolean | NavigationInstruction | NavigationInstruction[]>;\n  load?(params: Params, next: RouteNode, current: RouteNode | null): void | Promise<void>;\n  canUnload?(next: RouteNode | null, current: RouteNode): boolean | Promise<boolean>;\n  unload?(next: RouteNode | null, current: RouteNode): void | Promise<void>;\n}\n\nconst componentAgentLookup: WeakMap<object, ComponentAgent> = new WeakMap();\n\nexport class ComponentAgent<T extends IRouteViewModel = IRouteViewModel> {\n  private readonly logger: ILogger;\n\n  public readonly canLoadHooks: readonly ILifecycleHooks<IRouteViewModel, 'canLoad'>[];\n  public readonly loadHooks: readonly ILifecycleHooks<IRouteViewModel, 'load'>[];\n  public readonly canUnloadHooks: readonly ILifecycleHooks<IRouteViewModel, 'canUnload'>[];\n  public readonly unloadHooks: readonly ILifecycleHooks<IRouteViewModel, 'unload'>[];\n  private readonly hasCanLoad: boolean;\n  private readonly hasLoad: boolean;\n  private readonly hasCanUnload: boolean;\n  private readonly hasUnload: boolean;\n\n  public constructor(\n    public readonly instance: T,\n    public readonly controller: ICustomElementController<T>,\n    public readonly definition: RouteDefinition,\n    public readonly routeNode: RouteNode,\n    public readonly ctx: IRouteContext,\n  ) {\n    this.logger = ctx.container.get(ILogger).scopeTo(`ComponentAgent<${ctx.friendlyPath}>`);\n\n    this.logger.trace(`constructor()`);\n\n    const lifecycleHooks = controller.lifecycleHooks as LifecycleHooksLookup<IRouteViewModel>;\n    this.canLoadHooks = (lifecycleHooks.canLoad ?? []).map(x => x.instance);\n    this.loadHooks = (lifecycleHooks.load ?? []).map(x => x.instance);\n    this.canUnloadHooks = (lifecycleHooks.canUnload ?? []).map(x => x.instance);\n    this.unloadHooks = (lifecycleHooks.unload ?? []).map(x => x.instance);\n    this.hasCanLoad = 'canLoad' in instance;\n    this.hasLoad = 'load' in instance;\n    this.hasCanUnload = 'canUnload' in instance;\n    this.hasUnload = 'unload' in instance;\n  }\n\n  public static for<T extends IRouteViewModel>(\n    componentInstance: T,\n    hostController: ICustomElementController,\n    routeNode: RouteNode,\n    ctx: IRouteContext,\n  ): ComponentAgent<T> {\n    let componentAgent = componentAgentLookup.get(componentInstance);\n    if (componentAgent === void 0) {\n      const container = ctx.container;\n      const definition = RouteDefinition.resolve(componentInstance.constructor as Constructable);\n      const controller = Controller.forCustomElement(container.get(IAppRoot), container, container, componentInstance, hostController.host, null);\n\n      componentAgentLookup.set(\n        componentInstance,\n        componentAgent = new ComponentAgent(componentInstance, controller, definition, routeNode, ctx)\n      );\n    }\n\n    return componentAgent as ComponentAgent<T>;\n  }\n\n  public activate(initiator: IHydratedController | null, parent: IHydratedController, flags: LifecycleFlags): void | Promise<void> {\n    if (initiator === null) {\n      this.logger.trace(`activate() - initial`);\n      return this.controller.activate(this.controller, parent, flags);\n    }\n\n    this.logger.trace(`activate()`);\n    // Promise return values from user VM hooks are awaited by the initiator\n    void this.controller.activate(initiator, parent, flags);\n  }\n\n  public deactivate(initiator: IHydratedController | null, parent: IHydratedController, flags: LifecycleFlags): void | Promise<void> {\n    if (initiator === null) {\n      this.logger.trace(`deactivate() - initial`);\n      return this.controller.deactivate(this.controller, parent, flags);\n    }\n\n    this.logger.trace(`deactivate()`);\n    // Promise return values from user VM hooks are awaited by the initiator\n    void this.controller.deactivate(initiator, parent, flags);\n  }\n\n  public dispose(): void {\n    this.logger.trace(`dispose()`);\n\n    this.controller.dispose();\n  }\n\n  public canUnload(tr: Transition, next: RouteNode | null, b: Batch): void {\n    this.logger.trace(`canUnload(next:%s) - invoking ${this.canUnloadHooks.length} hooks`, next);\n    b.push();\n    for (const hook of this.canUnloadHooks) {\n      tr.run(() => {\n        b.push();\n        return hook.canUnload(this.instance, next, this.routeNode);\n      }, ret => {\n        if (tr.guardsResult === true && ret !== true) {\n          tr.guardsResult = false;\n        }\n        b.pop();\n      });\n    }\n    if (this.hasCanUnload) {\n      tr.run(() => {\n        b.push();\n        return this.instance.canUnload!(next, this.routeNode);\n      }, ret => {\n        if (tr.guardsResult === true && ret !== true) {\n          tr.guardsResult = false;\n        }\n        b.pop();\n      });\n    }\n    b.pop();\n  }\n\n  public canLoad(tr: Transition, next: RouteNode, b: Batch): void {\n    this.logger.trace(`canLoad(next:%s) - invoking ${this.canLoadHooks.length} hooks`, next);\n    b.push();\n    for (const hook of this.canLoadHooks) {\n      tr.run(() => {\n        b.push();\n        return hook.canLoad(this.instance, next.params, next, this.routeNode);\n      }, ret => {\n        if (tr.guardsResult === true && ret !== true) {\n          tr.guardsResult = ret === false ? false : ViewportInstructionTree.create(ret);\n        }\n        b.pop();\n      });\n    }\n    if (this.hasCanLoad) {\n      tr.run(() => {\n        b.push();\n        return this.instance.canLoad!(next.params, next, this.routeNode);\n      }, ret => {\n        if (tr.guardsResult === true && ret !== true) {\n          tr.guardsResult = ret === false ? false : ViewportInstructionTree.create(ret);\n        }\n        b.pop();\n      });\n    }\n    b.pop();\n  }\n\n  public unload(tr: Transition, next: RouteNode | null, b: Batch): void {\n    this.logger.trace(`unload(next:%s) - invoking ${this.unloadHooks.length} hooks`, next);\n    b.push();\n    for (const hook of this.unloadHooks) {\n      tr.run(() => {\n        b.push();\n        return hook.unload(this.instance, next, this.routeNode);\n      }, () => {\n        b.pop();\n      });\n    }\n    if (this.hasUnload) {\n      tr.run(() => {\n        b.push();\n        return this.instance.unload!(next, this.routeNode);\n      }, () => {\n        b.pop();\n      });\n    }\n    b.pop();\n  }\n\n  public load(tr: Transition, next: RouteNode, b: Batch): void {\n    this.logger.trace(`load(next:%s) - invoking ${this.loadHooks.length} hooks`, next);\n    b.push();\n    for (const hook of this.loadHooks) {\n      tr.run(() => {\n        b.push();\n        return hook.load(this.instance, next.params, next, this.routeNode);\n      }, () => {\n        b.pop();\n      });\n    }\n    if (this.hasLoad) {\n      tr.run(() => {\n        b.push();\n        return this.instance.load!(next.params, next, this.routeNode);\n      }, () => {\n        b.pop();\n      });\n    }\n    b.pop();\n  }\n\n  public toString(): string {\n    return `CA(ctx:'${this.ctx.friendlyPath}',c:'${this.definition.component!.name}')`;\n  }\n}\n","/* eslint-disable @typescript-eslint/restrict-template-expressions */\nimport { IContainer, ResourceDefinition, DI, InstanceProvider, Registration, ILogger, IModuleLoader, IModule, onResolve, noop } from '@aurelia/kernel';\nimport { CustomElementDefinition, CustomElement, ICustomElementController, IController, isCustomElementViewModel, isCustomElementController, IAppRoot, IPlatform } from '@aurelia/runtime-html';\nimport { RouteRecognizer, RecognizedRoute } from '@aurelia/route-recognizer';\n\nimport { RouteDefinition } from './route-definition.js';\nimport { ViewportAgent, ViewportRequest } from './viewport-agent.js';\nimport { ComponentAgent, IRouteViewModel } from './component-agent.js';\nimport { RouteNode } from './route-tree.js';\nimport { IRouter, ResolutionMode } from './router.js';\nimport { IViewport } from './resources/viewport.js';\nimport { Routeable } from './route.js';\nimport { isPartialChildRouteConfig } from './validation.js';\nimport { ensureArrayOfStrings } from './util.js';\n\nexport interface IRouteContext extends RouteContext {}\nexport const IRouteContext = DI.createInterface<IRouteContext>('IRouteContext');\n\nconst RESIDUE = 'au$residue' as const;\n\n/**\n * Holds the information of a component in the context of a specific container. May or may not have statically configured routes.\n *\n * The `RouteContext` is cached using a 3-part composite key consisting of the CustomElementDefinition, the RouteDefinition and the RenderContext.\n *\n * This means there can be more than one `RouteContext` per component type if either:\n * - The `RouteDefinition` for a type is overridden manually via `Route.define`\n * - Different components (with different `RenderContext`s) reference the same component via a child route config\n */\nexport class RouteContext {\n  public get id(): number {\n    return this.container.id;\n  }\n\n  private readonly childViewportAgents: ViewportAgent[] = [];\n  public readonly root: IRouteContext;\n  public get isRoot(): boolean {\n    return this.parent === null;\n  }\n\n  /**\n   * The path from the root RouteContext up to this one.\n   */\n  public readonly path: readonly IRouteContext[];\n  public get depth(): number {\n    return this.path.length - 1;\n  }\n  /**\n   * The stringified path from the root RouteContext up to this one, consisting of the component names they're associated with, separated by slashes.\n   *\n   * Mainly for debugging/introspection purposes.\n   */\n  public readonly friendlyPath: string;\n\n  /**\n   * The (fully resolved) configured child routes of this context's `RouteDefinition`\n   */\n  public readonly childRoutes: (RouteDefinition | Promise<RouteDefinition>)[] = [];\n\n  private _resolved: Promise<void> | null = null;\n  /** @internal */\n  public get resolved(): Promise<void> | null {\n    return this._resolved;\n  }\n\n  private _allResolved: Promise<void> | null = null;\n  /** @internal */\n  public get allResolved(): Promise<void> | null {\n    return this._allResolved;\n  }\n\n  private prevNode: RouteNode | null = null;\n  private _node: RouteNode | null = null;\n  public get node(): RouteNode {\n    const node = this._node;\n    if (node === null) {\n      throw new Error(`Invariant violation: RouteNode should be set immediately after the RouteContext is created. Context: ${this}`);\n    }\n    return node;\n  }\n  public set node(value: RouteNode) {\n    const prev = this.prevNode = this._node;\n    if (prev !== value) {\n      this._node = value;\n      this.logger.trace(`Node changed from %s to %s`, this.prevNode, value);\n    }\n  }\n\n  private _vpa: ViewportAgent | null = null;\n  /**\n   * The viewport hosting the component associated with this RouteContext.\n   * The root RouteContext has no ViewportAgent and will throw when attempting to access this property.\n   */\n  public get vpa(): ViewportAgent {\n    const vpa = this._vpa;\n    if (vpa === null) {\n      throw new Error(`RouteContext has no ViewportAgent: ${this}`);\n    }\n    return vpa;\n  }\n  public set vpa(value: ViewportAgent) {\n    if (value === null || value === void 0) {\n      throw new Error(`Cannot set ViewportAgent to ${value} for RouteContext: ${this}`);\n    }\n    const prev = this._vpa;\n    if (prev !== value) {\n      this._vpa = value;\n      this.logger.trace(`ViewportAgent changed from %s to %s`, prev, value);\n    }\n  }\n  public readonly container: IContainer;\n\n  private readonly moduleLoader: IModuleLoader;\n  private readonly logger: ILogger;\n  private readonly hostControllerProvider: InstanceProvider<ICustomElementController>;\n  private readonly recognizer: RouteRecognizer<RouteDefinition | Promise<RouteDefinition>>;\n\n  public constructor(\n    viewportAgent: ViewportAgent | null,\n    public readonly parent: IRouteContext | null,\n    public readonly component: CustomElementDefinition,\n    public readonly definition: RouteDefinition,\n    public readonly parentContainer: IContainer,\n  ) {\n    this._vpa = viewportAgent;\n    if (parent === null) {\n      this.root = this;\n      this.path = [this];\n      this.friendlyPath = component.name;\n    } else {\n      this.root = parent.root;\n      this.path = [...parent.path, this];\n      this.friendlyPath = `${parent.friendlyPath}/${component.name}`;\n    }\n    this.logger = parentContainer.get(ILogger).scopeTo(`RouteContext<${this.friendlyPath}>`);\n    this.logger.trace('constructor()');\n\n    this.moduleLoader = parentContainer.get(IModuleLoader);\n\n    const container = this.container = parentContainer.createChild();\n\n    container.registerResolver(\n      IController,\n      this.hostControllerProvider = new InstanceProvider(),\n      true,\n    );\n\n    // We don't need to store it here but we use an InstanceProvider so that it can be disposed indirectly via the container.\n    const contextProvider = new InstanceProvider();\n    container.registerResolver(\n      IRouteContext,\n      contextProvider,\n      true,\n    );\n    contextProvider.prepare(this);\n\n    container.register(definition);\n    container.register(...component.dependencies);\n\n    this.recognizer = new RouteRecognizer();\n\n    const promises: Promise<void>[] = [];\n    const allPromises: Promise<void>[] = [];\n    for (const child of definition.config.routes) {\n      if (child instanceof Promise) {\n        const p = this.addRoute(child);\n        promises.push(p);\n        allPromises.push(p);\n      } else {\n        const routeDef = RouteDefinition.resolve(child, this);\n        if (routeDef instanceof Promise) {\n          if (isPartialChildRouteConfig(child) && child.path != null) {\n            for (const path of ensureArrayOfStrings(child.path)) {\n              this.$addRoute(path, child.caseSensitive ?? false, routeDef);\n            }\n            const idx = this.childRoutes.length;\n            const p = routeDef.then(resolvedRouteDef => {\n              return this.childRoutes[idx] = resolvedRouteDef;\n            });\n            this.childRoutes.push(p);\n            allPromises.push(p.then(noop));\n          } else {\n            throw new Error(`Invalid route config. When the component property is a lazy import, the path must be specified. To use lazy loading without specifying the path (e.g. in direct routing), pass the import promise as a direct value to the routes array instead of providing it as the component property on an object literal.`);\n          }\n        } else {\n          for (const path of routeDef.path) {\n            this.$addRoute(path, routeDef.caseSensitive, routeDef);\n          }\n          this.childRoutes.push(routeDef);\n        }\n      }\n    }\n\n    if (promises.length > 0) {\n      this._resolved = Promise.all(promises).then(() => {\n        this._resolved = null;\n      });\n    }\n    if (allPromises.length > 0) {\n      this._allResolved = Promise.all(allPromises).then(() => {\n        this._allResolved = null;\n      });\n    }\n  }\n\n  /**\n   * Create a new `RouteContext` and register it in the provided container.\n   *\n   * Uses the `RenderContext` of the registered `IAppRoot` as the root context.\n   *\n   * @param container - The container from which to resolve the `IAppRoot` and in which to register the `RouteContext`\n   */\n  public static setRoot(container: IContainer): void {\n    const logger = container.get(ILogger).scopeTo('RouteContext');\n\n    if (!container.has(IAppRoot, true)) {\n      logAndThrow(new Error(`The provided container has no registered IAppRoot. RouteContext.setRoot can only be used after Aurelia.app was called, on a container that is within that app's component tree.`), logger);\n    }\n\n    if (container.has(IRouteContext, true)) {\n      logAndThrow(new Error(`A root RouteContext is already registered. A possible cause is the RouterConfiguration being registered more than once in the same container tree. If you have a multi-rooted app, make sure you register RouterConfiguration only in the \"forked\" containers and not in the common root.`), logger);\n    }\n\n    const { controller } = container.get(IAppRoot);\n    if (controller === void 0) {\n      logAndThrow(new Error(`The provided IAppRoot does not (yet) have a controller. A possible cause is calling this API manually before Aurelia.start() is called`), logger);\n    }\n\n    const router = container.get(IRouter);\n    const routeContext = router.getRouteContext(null, controller.context.definition, controller.context);\n    container.register(Registration.instance(IRouteContext, routeContext));\n    routeContext.node = router.routeTree.root;\n  }\n\n  public static resolve(root: IRouteContext, context: unknown): IRouteContext {\n    const rootContainer = root.container;\n    const logger = rootContainer.get(ILogger).scopeTo('RouteContext');\n\n    if (context === null || context === void 0) {\n      logger.trace(`resolve(context:%s) - returning root RouteContext`, context);\n      return root;\n    }\n\n    if (isRouteContext(context)) {\n      logger.trace(`resolve(context:%s) - returning provided RouteContext`, context);\n      return context;\n    }\n\n    if (context instanceof rootContainer.get(IPlatform).Node) {\n      try {\n        // CustomElement.for can theoretically throw in (as of yet) unknown situations.\n        // If that happens, we want to know about the situation and *not* just fall back to the root context, as that might make\n        // some already convoluted issues impossible to troubleshoot.\n        // That's why we catch, log and re-throw instead of just letting the error bubble up.\n        // This also gives us a set point in the future to potentially handle supported scenarios where this could occur.\n        const controller = CustomElement.for(context, { searchParents: true });\n        logger.trace(`resolve(context:Node(nodeName:'${context.nodeName}'),controller:'${controller.context.definition.name}') - resolving RouteContext from controller's RenderContext`);\n        return controller.container.get(IRouteContext);\n      } catch (err) {\n        logger.error(`Failed to resolve RouteContext from Node(nodeName:'${context.nodeName}')`, err);\n        throw err;\n      }\n    }\n\n    if (isCustomElementViewModel(context)) {\n      const controller = context.$controller!;\n      logger.trace(`resolve(context:CustomElementViewModel(name:'${controller.context.definition.name}')) - resolving RouteContext from controller's RenderContext`);\n      return controller.container.get(IRouteContext);\n    }\n\n    if (isCustomElementController(context)) {\n      const controller = context;\n      logger.trace(`resolve(context:CustomElementController(name:'${controller.context.definition.name}')) - resolving RouteContext from controller's RenderContext`);\n      return controller.container.get(IRouteContext);\n    }\n\n    logAndThrow(new Error(`Invalid context type: ${Object.prototype.toString.call(context)}`), logger);\n  }\n\n  public dispose(): void {\n    this.container.dispose();\n  }\n  // #endregion\n\n  public resolveViewportAgent(req: ViewportRequest): ViewportAgent {\n    this.logger.trace(`resolveViewportAgent(req:%s)`, req);\n\n    const agent = this.childViewportAgents.find(x => { return x.handles(req); });\n\n    if (agent === void 0) {\n      throw new Error(`Failed to resolve ${req} at:\\n${this.printTree()}`);\n    }\n\n    return agent;\n  }\n\n  public getAvailableViewportAgents(resolution: ResolutionMode): readonly ViewportAgent[] {\n    return this.childViewportAgents.filter(x => x.isAvailable(resolution));\n  }\n\n  public getFallbackViewportAgent(resolution: ResolutionMode, name: string): ViewportAgent | null {\n    return this.childViewportAgents.find(x => x.isAvailable(resolution) && x.viewport.name === name && x.viewport.fallback.length > 0) ?? null;\n  }\n\n  /**\n   * Create a component based on the provided viewportInstruction.\n   *\n   * @param hostController - The `ICustomElementController` whose component (typically `au-viewport`) will host this component.\n   * @param routeNode - The routeNode that describes the component + state.\n   */\n  public createComponentAgent(hostController: ICustomElementController, routeNode: RouteNode): ComponentAgent {\n    this.logger.trace(`createComponentAgent(routeNode:%s)`, routeNode);\n\n    this.hostControllerProvider.prepare(hostController);\n    const routeDefinition = RouteDefinition.resolve(routeNode.component);\n    const componentInstance = this.container.get<IRouteViewModel>(routeDefinition.component!.key);\n    const componentAgent = ComponentAgent.for(componentInstance, hostController, routeNode, this);\n\n    this.hostControllerProvider.dispose();\n\n    return componentAgent;\n  }\n\n  public registerViewport(viewport: IViewport): ViewportAgent {\n    const agent = ViewportAgent.for(viewport, this);\n    if (this.childViewportAgents.includes(agent)) {\n      this.logger.trace(`registerViewport(agent:%s) -> already registered, so skipping`, agent);\n    } else {\n      this.logger.trace(`registerViewport(agent:%s) -> adding`, agent);\n      this.childViewportAgents.push(agent);\n    }\n\n    return agent;\n  }\n\n  public unregisterViewport(viewport: IViewport): void {\n    const agent = ViewportAgent.for(viewport, this);\n    if (this.childViewportAgents.includes(agent)) {\n      this.logger.trace(`unregisterViewport(agent:%s) -> unregistering`, agent);\n      this.childViewportAgents.splice(this.childViewportAgents.indexOf(agent), 1);\n    } else {\n      this.logger.trace(`unregisterViewport(agent:%s) -> not registered, so skipping`, agent);\n    }\n  }\n\n  public recognize(path: string): $RecognizedRoute | null {\n    this.logger.trace(`recognize(path:'${path}')`);\n    const result = this.recognizer.recognize(path);\n    if (result === null) {\n      return null;\n    }\n\n    let residue: string | null;\n    if (Reflect.has(result.params, RESIDUE)) {\n      residue = result.params[RESIDUE] ?? null;\n      Reflect.deleteProperty(result.params, RESIDUE);\n    } else {\n      residue = null;\n    }\n\n    return new $RecognizedRoute(result, residue);\n  }\n\n  public addRoute(routeable: Promise<IModule>): Promise<void>\n  public addRoute(routeable: Exclude<Routeable, Promise<IModule>>): void | Promise<void>\n  public addRoute(routeable: Routeable): void | Promise<void> {\n    this.logger.trace(`addRoute(routeable:'${routeable}')`);\n    return onResolve(RouteDefinition.resolve(routeable, this), routeDef => {\n      for (const path of routeDef.path) {\n        this.$addRoute(path, routeDef.caseSensitive, routeDef);\n      }\n      this.childRoutes.push(routeDef);\n    });\n  }\n\n  private $addRoute(path: string, caseSensitive: boolean, handler: RouteDefinition | Promise<RouteDefinition>): void {\n    this.recognizer.add({\n      path,\n      caseSensitive,\n      handler,\n    });\n    this.recognizer.add({\n      path: `${path}/*${RESIDUE}`,\n      caseSensitive,\n      handler,\n    });\n  }\n\n  public resolveLazy(promise: Promise<IModule>): Promise<CustomElementDefinition> | CustomElementDefinition {\n    return this.moduleLoader.load(promise, m => {\n      let defaultExport: CustomElementDefinition | undefined = void 0;\n      let firstNonDefaultExport: CustomElementDefinition | undefined = void 0;\n      for (const item of m.items) {\n        if (item.isConstructable) {\n          const def = item.definitions.find(isCustomElementDefinition);\n          if (def !== void 0) {\n            if (item.key === 'default') {\n              defaultExport = def;\n            } else if (firstNonDefaultExport === void 0) {\n              firstNonDefaultExport = def;\n            }\n          }\n        }\n      }\n\n      if (defaultExport === void 0) {\n        if (firstNonDefaultExport === void 0) {\n          // TODO: make error more accurate and add potential causes/solutions\n          throw new Error(`${promise} does not appear to be a component or CustomElement recognizable by Aurelia`);\n        }\n        return firstNonDefaultExport;\n      }\n      return defaultExport;\n    });\n  }\n\n  public toString(): string {\n    const vpAgents = this.childViewportAgents;\n    const viewports = vpAgents.map(String).join(',');\n    return `RC(path:'${this.friendlyPath}',viewports:[${viewports}])`;\n  }\n\n  private printTree(): string {\n    const tree: string[] = [];\n    for (let i = 0; i < this.path.length; ++i) {\n      tree.push(`${' '.repeat(i)}${this.path[i]}`);\n    }\n    return tree.join('\\n');\n  }\n}\n\nfunction isRouteContext(value: unknown): value is IRouteContext {\n  return value instanceof RouteContext;\n}\n\nfunction logAndThrow(err: Error, logger: ILogger): never {\n  logger.error(err);\n  throw err;\n}\n\nfunction isCustomElementDefinition(value: ResourceDefinition): value is CustomElementDefinition {\n  return CustomElement.isType(value.Type);\n}\n\nexport class $RecognizedRoute {\n  public constructor(\n    public readonly route: RecognizedRoute<RouteDefinition | Promise<RouteDefinition>>,\n    public readonly residue: string | null,\n  ) {}\n}\n","import { ILogger } from '@aurelia/kernel';\nimport { bindable, customElement, ICustomElementViewModel, IHydratedController, LifecycleFlags, ICustomElementController, ICompiledCustomElementController } from '@aurelia/runtime-html';\n\nimport { ViewportAgent } from '../viewport-agent.js';\nimport { IRouteContext } from '../route-context.js';\n\nexport interface IViewport {\n  readonly name: string;\n  readonly usedBy: string;\n  readonly default: string;\n  readonly fallback: string;\n  readonly noScope: boolean;\n  readonly noLink: boolean;\n  readonly noHistory: boolean;\n  readonly stateful: boolean;\n}\n\n@customElement({ name: 'au-viewport' })\nexport class ViewportCustomElement implements ICustomElementViewModel, IViewport {\n  @bindable public name: string = 'default';\n  @bindable public usedBy: string = '';\n  @bindable public default: string = '';\n  @bindable public fallback: string = '';\n  @bindable public noScope: boolean = false;\n  @bindable public noLink: boolean = false;\n  @bindable public noHistory: boolean = false;\n  @bindable public stateful: boolean = false;\n\n  private agent: ViewportAgent = (void 0)!;\n  private controller: ICustomElementController = (void 0)!;\n\n  public constructor(\n    @ILogger private readonly logger: ILogger,\n    @IRouteContext private readonly ctx: IRouteContext,\n  ) {\n    this.logger = logger.scopeTo(`au-viewport<${ctx.friendlyPath}>`);\n\n    this.logger.trace('constructor()');\n  }\n\n  public hydrated(controller: ICompiledCustomElementController): void {\n    this.logger.trace('hydrated()');\n\n    this.controller = controller as ICustomElementController;\n    this.agent = this.ctx.registerViewport(this);\n  }\n\n  public attaching(initiator: IHydratedController, parent: IHydratedController, flags: LifecycleFlags): void | Promise<void> {\n    this.logger.trace('attaching()');\n\n    return this.agent.activateFromViewport(initiator, this.controller, flags);\n  }\n\n  public detaching(initiator: IHydratedController, parent: IHydratedController, flags: LifecycleFlags): void | Promise<void> {\n    this.logger.trace('detaching()');\n\n    return this.agent.deactivateFromViewport(initiator, this.controller, flags);\n  }\n\n  public dispose(): void {\n    this.logger.trace('dispose()');\n\n    this.ctx.unregisterViewport(this);\n    this.agent.dispose();\n    this.agent = (void 0)!;\n  }\n\n  public toString(): string {\n    const propStrings: string[] = [];\n    for (const prop of props) {\n      const value = this[prop];\n      // Only report props that don't have default values (but always report name)\n      // This is a bit naive and dirty right now, but it's mostly for debugging purposes anyway. Can clean up later. Maybe put it in a serializer\n      switch (typeof value) {\n        case 'string':\n          if (value !== '') {\n            propStrings.push(`${prop}:'${value}'`);\n          }\n          break;\n        case 'boolean':\n          if (value) {\n            propStrings.push(`${prop}:${value}`);\n          }\n          break;\n        default: {\n          propStrings.push(`${prop}:${String(value)}`);\n        }\n      }\n    }\n    return `VP(ctx:'${this.ctx.friendlyPath}',${propStrings.join(',')})`;\n  }\n}\n\nconst props = [\n  'name',\n  'usedBy',\n  'default',\n  'fallback',\n  'noScope',\n  'noLink',\n  'noHistory',\n  'stateful',\n] as const;\n","import { IDisposable, IIndexable } from '@aurelia/kernel';\nimport { customAttribute, bindable, BindingMode, ICustomAttributeViewModel, IEventDelegator, IEventTarget, INode, CustomElement } from '@aurelia/runtime-html';\n\nimport { IRouter } from '../router.js';\nimport { IRouteContext } from '../route-context.js';\nimport { NavigationInstruction, Params, ViewportInstructionTree } from '../instructions.js';\nimport { IRouterEvents } from '../router-events.js';\nimport { RouteDefinition } from '../route-definition.js';\nimport { ILocationManager } from '../location-manager.js';\n\n@customAttribute('load')\nexport class LoadCustomAttribute implements ICustomAttributeViewModel {\n  @bindable({ mode: BindingMode.toView, primary: true, callback: 'valueChanged' })\n  public route: unknown;\n\n  @bindable({ mode: BindingMode.toView, callback: 'valueChanged' })\n  public params: unknown;\n\n  @bindable({ mode: BindingMode.toView })\n  public attribute: string = 'href';\n\n  @bindable({ mode: BindingMode.fromView })\n  public active: boolean = false;\n\n  private href: string | null = null;\n  private instructions: ViewportInstructionTree | null = null;\n  private eventListener: IDisposable | null = null;\n  private navigationEndListener: IDisposable | null = null;\n  private readonly isEnabled: boolean;\n\n  public constructor(\n    @IEventTarget private readonly target: IEventTarget,\n    @INode private readonly el: INode<HTMLElement>,\n    @IRouter private readonly router: IRouter,\n    @IRouterEvents private readonly events: IRouterEvents,\n    @IEventDelegator private readonly delegator: IEventDelegator,\n    @IRouteContext private readonly ctx: IRouteContext,\n    @ILocationManager private readonly locationMgr: ILocationManager,\n  ) {\n    // Ensure the element is not explicitly marked as external.\n    this.isEnabled = !el.hasAttribute('external') && !el.hasAttribute('data-external');\n  }\n\n  public binding(): void {\n    if (this.isEnabled) {\n      this.eventListener = this.delegator.addEventListener(this.target, this.el, 'click', this.onClick as EventListener);\n    }\n    this.valueChanged();\n    this.navigationEndListener = this.events.subscribe('au:router:navigation-end', _e => {\n      this.valueChanged();\n      this.active = this.instructions !== null && this.router.isActive(this.instructions, this.ctx);\n    });\n  }\n\n  public attaching(): void | Promise<void> {\n    if (this.ctx.allResolved !== null) {\n      return this.ctx.allResolved.then(() => {\n        this.valueChanged();\n      });\n    }\n  }\n\n  public unbinding(): void {\n    if (this.isEnabled) {\n      this.eventListener!.dispose();\n    }\n    this.navigationEndListener!.dispose();\n  }\n\n  public valueChanged(): void {\n    const useHash = this.router.options.useUrlFragmentHash;\n    if (this.route !== null && this.route !== void 0 && this.ctx.allResolved === null) {\n      const def = (this.ctx.childRoutes as RouteDefinition[]).find(x => x.id === this.route);\n      if (def !== void 0) {\n        // TODO(fkleuver): massive temporary hack. Will not work for siblings etc. Need to fix.\n        const parentPath = this.ctx.node.computeAbsolutePath();\n        // Note: This is very much preliminary just to fill the feature gap of v1's `generate`. It probably misses a few edge cases.\n        // TODO(fkleuver): move this logic to RouteExpression and expose via public api, add tests etc\n        let path = def.path[0];\n        if (typeof this.params === 'object' && this.params !== null) {\n          const keys = Object.keys(this.params);\n          for (const key of keys) {\n            const value = (this.params as Params)[key];\n            if (value != null && String(value).length > 0) {\n              path = path.replace(new RegExp(`[*:]${key}[?]?`), value);\n            }\n          }\n        }\n        // Remove leading and trailing optional param parts\n        path = path.replace(/\\/[*:][^/]+[?]/g, '').replace(/[*:][^/]+[?]\\//g, '');\n        if (parentPath) {\n          if (path) {\n            this.href = `${useHash ? '#' : ''}${[parentPath, path].join('/')}`;\n          } else {\n            this.href = `${useHash ? '#' : ''}${parentPath}`;\n          }\n        } else {\n          this.href = `${useHash ? '#' : ''}${path}`;\n        }\n        this.instructions = this.router.createViewportInstructions(`${useHash ? '#' : ''}${path}`, { context: this.ctx });\n      } else {\n        if (typeof this.params === 'object' && this.params !== null) {\n          this.instructions = this.router.createViewportInstructions({ component: this.route as NavigationInstruction, params: this.params as Params }, { context: this.ctx });\n        } else {\n          this.instructions = this.router.createViewportInstructions(this.route as NavigationInstruction, { context: this.ctx });\n        }\n        this.href = this.instructions.toUrl(this.router.options.useUrlFragmentHash);\n      }\n    } else {\n      this.instructions = null;\n      this.href = null;\n    }\n\n    const controller = CustomElement.for(this.el, { optional: true });\n    if (controller !== null) {\n      (controller.viewModel as IIndexable)[this.attribute] = this.instructions;\n    } else {\n      if (this.href === null) {\n        this.el.removeAttribute(this.attribute);\n      } else {\n        const value = useHash ? this.href : this.locationMgr.addBaseHref(this.href);\n        this.el.setAttribute(this.attribute, value);\n      }\n    }\n  }\n\n  private readonly onClick = (e: MouseEvent): void => {\n    if (this.instructions === null) {\n      return;\n    }\n\n    // Ensure this is an ordinary left-button click.\n    if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey || e.button !== 0) {\n      return;\n    }\n\n    e.preventDefault();\n    // Floating promises from `Router#load` are ok because the router keeps track of state and handles the errors, etc.\n    void this.router.load(this.instructions, { context: this.ctx });\n  };\n}\n","import { IDisposable } from '@aurelia/kernel';\nimport { customAttribute, bindable, BindingMode, ICustomAttributeViewModel, ICustomAttributeController, IEventDelegator, IEventTarget, INode, IWindow, getRef, CustomAttribute } from '@aurelia/runtime-html';\n\nimport { IRouter } from '../router.js';\nimport { LoadCustomAttribute } from '../configuration.js';\nimport { IRouteContext } from '../route-context.js';\n\n@customAttribute({ name: 'href', noMultiBindings: true })\nexport class HrefCustomAttribute implements ICustomAttributeViewModel {\n  @bindable({ mode: BindingMode.toView })\n  public value: unknown;\n\n  private eventListener!: IDisposable;\n  private isInitialized: boolean = false;\n  private isEnabled: boolean;\n\n  private get isExternal(): boolean {\n    return this.el.hasAttribute('external') || this.el.hasAttribute('data-external');\n  }\n\n  public readonly $controller!: ICustomAttributeController<this>;\n\n  public constructor(\n    @IEventTarget private readonly target: IEventTarget,\n    @INode private readonly el: INode<HTMLElement>,\n    @IRouter private readonly router: IRouter,\n    @IEventDelegator private readonly delegator: IEventDelegator,\n    @IRouteContext private readonly ctx: IRouteContext,\n    @IWindow w: IWindow,\n  ) {\n    if (\n      router.options.useHref &&\n      // Ensure the element is an anchor\n      el.nodeName === 'A'\n    ) {\n      // Ensure the anchor targets the current window.\n      switch (el.getAttribute('target')) {\n        case null:\n        case w.name:\n        case '_self':\n          this.isEnabled = true;\n          break;\n        default:\n          this.isEnabled = false;\n          break;\n      }\n    } else {\n      this.isEnabled = false;\n    }\n  }\n\n  public binding(): void {\n    if (!this.isInitialized) {\n      this.isInitialized = true;\n      this.isEnabled = this.isEnabled && getRef(this.el, CustomAttribute.getDefinition(LoadCustomAttribute).key) === null;\n    }\n    if (this.isEnabled) {\n      this.el.setAttribute('href', this.value as string);\n    }\n    this.eventListener = this.delegator.addEventListener(this.target, this.el, 'click', this.onClick as EventListener);\n  }\n  public unbinding(): void {\n    this.eventListener.dispose();\n  }\n\n  public valueChanged(newValue: unknown): void {\n    this.el.setAttribute('href', newValue as string);\n  }\n\n  private readonly onClick = (e: MouseEvent): void => {\n    // Ensure this is an ordinary left-button click\n    if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey || e.button !== 0\n      // on an internally managed link\n      || this.isExternal\n      || !this.isEnabled\n    ) {\n      return;\n    }\n\n    // Use the normalized attribute instead of this.value to ensure consistency.\n    const href = this.el.getAttribute('href');\n    if (href !== null) {\n      e.preventDefault();\n      // Floating promises from `Router#load` are ok because the router keeps track of state and handles the errors, etc.\n      void this.router.load(href, { context: this.ctx });\n    }\n  };\n}\n","import { IContainer, IRegistry, isObject } from '@aurelia/kernel';\nimport { AppTask } from '@aurelia/runtime-html';\n\nimport { RouteContext } from './route-context.js';\nimport { IRouterOptions, IRouter } from './router.js';\n\nimport { ViewportCustomElement } from './resources/viewport.js';\nimport { LoadCustomAttribute } from './resources/load.js';\nimport { HrefCustomAttribute } from './resources/href.js';\n\nexport const RouterRegistration = IRouter as unknown as IRegistry;\n\n/**\n * Default runtime/environment-agnostic implementations for the following interfaces:\n * - `IRouter`\n */\nexport const DefaultComponents = [\n  RouterRegistration,\n];\n\nexport {\n  ViewportCustomElement,\n  LoadCustomAttribute,\n  HrefCustomAttribute,\n};\n\nexport const ViewportCustomElementRegistration = ViewportCustomElement as unknown as IRegistry;\nexport const LoadCustomAttributeRegistration = LoadCustomAttribute as unknown as IRegistry;\nexport const HrefCustomAttributeRegistration = HrefCustomAttribute as unknown as IRegistry;\n\n/**\n * Default router resources:\n * - Custom Elements: `au-viewport`\n * - Custom Attributes: `load`, `href`\n */\nexport const DefaultResources: IRegistry[] = [\n  ViewportCustomElement as unknown as IRegistry,\n  LoadCustomAttribute as unknown as IRegistry,\n  HrefCustomAttribute as unknown as IRegistry,\n];\n\nexport type RouterConfig = IRouterOptions | ((router: IRouter) => ReturnType<IRouter['start']>);\nfunction configure(container: IContainer, config?: RouterConfig): IContainer {\n  return container.register(\n    AppTask.hydrated(IContainer, RouteContext.setRoot),\n    AppTask.afterActivate(IRouter, router => {\n      if (isObject(config)) {\n        if (typeof config === 'function') {\n          return config(router) as void | Promise<void>;\n        } else {\n          return router.start(config, true) as void | Promise<void>;\n        }\n      }\n      return router.start({}, true) as void | Promise<void>;\n    }),\n    AppTask.afterDeactivate(IRouter, router => {\n      router.stop();\n    }),\n    ...DefaultComponents,\n    ...DefaultResources,\n  );\n}\n\nexport const RouterConfiguration = {\n  register(container: IContainer): IContainer {\n    return configure(container);\n  },\n  /**\n   * Make it possible to specify options to Router activation.\n   * Parameter is either a config object that's passed to Router's activate\n   * or a config function that's called instead of Router's activate.\n   */\n  customize(config?: RouterConfig): IRegistry {\n    return {\n      register(container: IContainer): IContainer {\n        return configure(container, config);\n      },\n    };\n  },\n};\n","import { ICustomElementController } from '@aurelia/runtime-html';\nimport { DI } from '@aurelia/kernel';\n\nclass ScrollState {\n  private readonly top: number;\n  private readonly left: number;\n\n  public constructor(private el: Element) {\n    this.top = el.scrollTop;\n    this.left = el.scrollLeft;\n  }\n\n  public static has(el: Element): boolean {\n    return el.scrollTop > 0 || el.scrollLeft > 0;\n  }\n\n  public restore(): void {\n    this.el.scrollTo(this.left, this.top);\n    this.el = null!;\n  }\n}\n\nfunction restoreState(state: ScrollState): void {\n  state.restore();\n}\n\nclass HostElementState {\n  private scrollStates: ScrollState[] = [];\n\n  public constructor(host: Element) {\n    this.save(host.children);\n  }\n\n  private save(elements: HTMLCollection): void {\n    let el: Element;\n    for (let i = 0, ii = elements.length; i < ii; ++i) {\n      el = elements[i];\n      if (ScrollState.has(el)) {\n        this.scrollStates.push(new ScrollState(el));\n      }\n\n      this.save(el.children);\n    }\n  }\n\n  public restore(): void {\n    this.scrollStates.forEach(restoreState);\n    this.scrollStates = null!;\n  }\n}\n\nexport const IStateManager = DI.createInterface<IStateManager>('IStateManager', x => x.singleton(ScrollStateManager));\nexport interface IStateManager {\n  saveState(controller: ICustomElementController): void;\n  restoreState(controller: ICustomElementController): void;\n}\n\nexport class ScrollStateManager implements IStateManager {\n  private readonly cache: WeakMap<HTMLElement, HostElementState> = new WeakMap();\n\n  public saveState(controller: ICustomElementController): void {\n    this.cache.set(controller.host, new HostElementState(controller.host));\n  }\n\n  public restoreState(controller: ICustomElementController): void {\n    const state = this.cache.get(controller.host);\n    if (state !== void 0) {\n      state.restore();\n      this.cache.delete(controller.host);\n    }\n  }\n}\n"],"names":[],"mappings":"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"}