import{DI as t,IEventAggregator as e,toArray as s,camelCase as r,Registration as i}from"@aurelia/kernel";import{ValueConverterExpression as n,bindingBehavior as o,CustomExpression as a,Interpolation as c,CustomElement as l,connectable as h,AttrSyntax as u,attributePattern as p,BindingMode as d,IAttrMapper as f,bindingCommand as m,renderer as b,IExpressionParser as g,IObserverLocator as v,IPlatform as x,valueConverter as y,AppTask as w,AttributePattern as L,BindingCommand as T}from"@aurelia/runtime-html";import{ValueConverterExpression as C,bindingBehavior as M,ISignaler as k,valueConverter as E}from"@aurelia/runtime";import A from"i18next";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function N(t,e,s,r){var i,n=arguments.length,o=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,s,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(n<3?i(o):n>3?i(e,s,o):i(e,s))||o);return n>3&&o&&Object.defineProperty(e,s,o),o}function I(t,e){return function(s,r){e(s,r,t)}}var S,V;function B(t,e){const s=e.sourceExpression.expression;if(!(s instanceof C)){const r=new C(s,t,e.sourceExpression.args);e.sourceExpression.expression=r}}!function(t){t.I18N_EA_CHANNEL="i18n:locale:changed",t.I18N_SIGNAL="aurelia-translation-signal",t.RT_SIGNAL="aurelia-relativetime-signal"}(S||(S={})),function(t){t.translationValueConverterName="t",t.dateFormatValueConverterName="df",t.numberFormatValueConverterName="nf",t.relativeTimeValueConverterName="rt"}(V||(V={}));let F=class{bind(t,e,s,r){B("df",r)}};F=N([M("df")],F);const O=t.createInterface("I18nInitOptions"),$=t.createInterface("I18nextWrapper");class R{constructor(){this.i18next=A}}var j;!function(t){t[t.Second=1e3]="Second",t[t.Minute=6e4]="Minute",t[t.Hour=36e5]="Hour",t[t.Day=864e5]="Day",t[t.Week=6048e5]="Week",t[t.Month=2592e6]="Month",t[t.Year=31536e6]="Year"}(j||(j={}));class D{constructor(t){this.value=void 0;this.attributes=[];const e=/\[([a-z\-, ]*)\]/gi.exec(t);e&&(t=t.replace(e[0],""),this.attributes=e[1].split(",")),this.key=t}}const P=t.createInterface("I18N");let H=class{constructor(t,e,s,r){this.ea=s,this.signaler=r,this.localeSubscribers=new Set,this.i18next=t.i18next,this.initPromise=this.initializeI18next(e)}evaluate(t,e){const s=t.split(";"),r=[];for(const t of s){const s=new D(t),i=s.key,n=this.tr(i,e);this.options.skipTranslationOnMissingKey&&n===i?console.warn(`Couldn't find translation for key: ${i}`):(s.value=n,r.push(s))}return r}tr(t,e){return this.i18next.t(t,e)}getLocale(){return this.i18next.language}async setLocale(t){const e={oldLocale:this.getLocale(),newLocale:t};await this.i18next.changeLanguage(t),this.ea.publish("i18n:locale:changed",e),this.localeSubscribers.forEach((t=>t.handleLocaleChange(e))),this.signaler.dispatchSignal("aurelia-translation-signal")}createNumberFormat(t,e){return Intl.NumberFormat(e||this.getLocale(),t)}nf(t,e,s){return this.createNumberFormat(e,s).format(t)}createDateTimeFormat(t,e){return Intl.DateTimeFormat(e||this.getLocale(),t)}df(t,e,s){return this.createDateTimeFormat(e,s).format(t)}uf(t,e){const s=this.nf(1e4/3,void 0,e);let r=s[1];const i=s[5];"."===r&&(r="\\.");const n=t.replace(new RegExp(r,"g"),"").replace(/[^\d.,-]/g,"").replace(i,".");return Number(n)}createRelativeTimeFormat(t,e){return new Intl.RelativeTimeFormat(e||this.getLocale(),t)}rt(t,e,s){let r=t.getTime()-this.now();const i=this.options.rtEpsilon*(r>0?1:0),n=this.createRelativeTimeFormat(e,s);let o=r/31536e6;return Math.abs(o+i)>=1?n.format(Math.round(o),"year"):(o=r/2592e6,Math.abs(o+i)>=1?n.format(Math.round(o),"month"):(o=r/6048e5,Math.abs(o+i)>=1?n.format(Math.round(o),"week"):(o=r/864e5,Math.abs(o+i)>=1?n.format(Math.round(o),"day"):(o=r/36e5,Math.abs(o+i)>=1?n.format(Math.round(o),"hour"):(o=r/6e4,Math.abs(o+i)>=1?n.format(Math.round(o),"minute"):(r=Math.abs(r)<1e3?1e3:r,o=r/1e3,n.format(Math.round(o),"second")))))))}subscribeLocaleChange(t){this.localeSubscribers.add(t)}now(){return(new Date).getTime()}async initializeI18next(t){this.options={lng:"en",fallbackLng:["en"],debug:!1,plugins:[],rtEpsilon:.01,skipTranslationOnMissingKey:!1,...t};for(const t of this.options.plugins)this.i18next.use(t);await this.i18next.init(this.options)}};H=N([I(0,$),I(1,O),I(2,e),I(3,k)],H);let K=class{constructor(t){this.i18n=t,this.signals=["aurelia-translation-signal"]}toView(t,e,s){if(!t&&0!==t||"string"==typeof t&&""===t.trim())return t;if("string"==typeof t){const e=Number(t),s=new Date(Number.isInteger(e)?e:t);if(isNaN(s.getTime()))return t;t=s}return this.i18n.df(t,e,s)}};K=N([E("df"),I(0,P)],K);let z=class{bind(t,e,s,r){B("nf",r)}};z=N([M("nf")],z);let W=class{constructor(t){this.i18n=t,this.signals=["aurelia-translation-signal"]}toView(t,e,s){return"number"!=typeof t?t:this.i18n.nf(t,e,s)}};W=N([E("nf"),I(0,P)],W);let _=class{bind(t,e,s,r){B("rt",r)}};_=N([M("rt")],_);let G=class{constructor(t){this.i18n=t,this.signals=["aurelia-translation-signal","aurelia-relativetime-signal"]}toView(t,e,s){return t instanceof Date?this.i18n.rt(t,e,s):t}};G=N([E("rt"),I(0,P)],G);let U=class{bind(t,e,s,r){const i=r.sourceExpression.expression;if(!(i instanceof n)){const t=new n(i,"t",r.sourceExpression.args);r.sourceExpression.expression=t}}};var Y;U=N([o("t")],U);const q=["textContent","innerHTML","prepend","append"],Q=new Map([["text","textContent"],["html","innerHTML"]]),J={optional:!0},X={reusable:!1,preempt:!0};let Z=Y=class{constructor(t,e,s,r){this.observerLocator=e,this.locator=s,this.interceptor=this,this.isBound=!1,this.contentAttributes=q,this.hostScope=null,this.task=null,this.parameter=null,this.target=t,this.i18n=this.locator.get(P),this.platform=r,this.targetAccessors=new Set,this.i18n.subscribeLocaleChange(this)}static create({parser:t,observerLocator:e,context:s,controller:r,target:i,instruction:n,platform:o,isParameterContext:c}){const l=this.getBinding({observerLocator:e,context:s,controller:r,target:i,platform:o}),h="string"==typeof n.from?t.parse(n.from,53):n.from;if(c)l.useParameter(h);else{const e=h instanceof a?t.parse(h.value,2048):void 0;l.expr=e||h}}static getBinding({observerLocator:t,context:e,controller:s,target:r,platform:i}){let n=s.bindings&&s.bindings.find((t=>t instanceof Y&&t.target===r));return n||(n=new Y(r,t,e,i),s.addBinding(n)),n}$bind(t,e,s){var r;if(!this.expr)throw new Error("key expression is missing");this.scope=e,this.hostScope=s,this.isInterpolation=this.expr instanceof c,this.keyExpression=this.expr.evaluate(t,e,s,this.locator,this),this.ensureKeyExpression(),null===(r=this.parameter)||void 0===r||r.$bind(t,e,s),this.updateTranslations(t),this.isBound=!0}$unbind(t){var e;this.isBound&&(this.expr.hasUnbind&&this.expr.unbind(t,this.scope,this.hostScope,this),null===(e=this.parameter)||void 0===e||e.$unbind(t),this.targetAccessors.clear(),null!==this.task&&(this.task.cancel(),this.task=null),this.scope=void 0,this.obs.clear(!0))}handleChange(t,e,s){this.obs.version++,this.keyExpression=this.isInterpolation?this.expr.evaluate(s,this.scope,this.hostScope,this.locator,this):t,this.obs.clear(!1),this.ensureKeyExpression(),this.updateTranslations(s)}handleLocaleChange(){this.updateTranslations(0)}useParameter(t){if(null!=this.parameter)throw new Error("This translation parameter has already been specified.");this.parameter=new et(this,t,(t=>this.updateTranslations(t)))}updateTranslations(t){var e;const s=this.i18n.evaluate(this.keyExpression,null===(e=this.parameter)||void 0===e?void 0:e.value),r=Object.create(null),i=[],n=this.task;this.targetAccessors.clear();for(const e of s){const s=e.value,n=this.preprocessAttributes(e.attributes);for(const e of n)if(this.isContentAttribute(e))r[e]=s;else{const r=l.for(this.target,J),n=this.observerLocator.getAccessor(r&&r.viewModel?r.viewModel:this.target,e);0==(2&t)&&(4&n.type)>0?i.push(new tt(n,s,t,this.target,e)):n.setValue(s,t,this.target,e),this.targetAccessors.add(n)}}let o=!1;Object.keys(r).length>0&&(o=0==(2&t),o||this.updateContent(r,t)),(i.length>0||o)&&(this.task=this.platform.domWriteQueue.queueTask((()=>{this.task=null;for(const t of i)t.run();o&&this.updateContent(r,t)}),X)),null==n||n.cancel()}preprocessAttributes(t){0===t.length&&(t="IMG"===this.target.tagName?["src"]:["textContent"]);for(const[e,s]of Q){const r=t.findIndex((t=>t===e));r>-1&&t.splice(r,1,s)}return t}isContentAttribute(t){return this.contentAttributes.includes(t)}updateContent(t,e){const r=s(this.target.childNodes),i=[],n="au-i18n";for(const t of r)Reflect.get(t,n)||i.push(t);const o=this.prepareTemplate(t,n,i);this.target.innerHTML="";for(const t of s(o.content.childNodes))this.target.appendChild(t)}prepareTemplate(t,e,s){var r;const i=this.platform.document.createElement("template");if(this.addContentToTemplate(i,t.prepend,e),!this.addContentToTemplate(i,null!==(r=t.innerHTML)&&void 0!==r?r:t.textContent,e))for(const t of s)i.content.append(t);return this.addContentToTemplate(i,t.append,e),i}addContentToTemplate(t,e,r){if(null!=e){const i=this.platform.document.createElement("div");i.innerHTML=e;for(const e of s(i.childNodes))Reflect.set(e,r,!0),t.content.append(e);return!0}return!1}ensureKeyExpression(){var t;const e=null!==(t=this.keyExpression)&&void 0!==t?t:this.keyExpression="",s=typeof e;if("string"!==s)throw new Error(`Expected the i18n key to be a string, but got ${e} of type ${s}`)}};Z=Y=N([h()],Z);class tt{constructor(t,e,s,r,i){this.accessor=t,this.v=e,this.f=s,this.el=r,this.attr=i}run(){this.accessor.setValue(this.v,this.f,this.el,this.attr)}}let et=class{constructor(t,e,s){this.owner=t,this.expr=e,this.updater=s,this.interceptor=this,this.isBound=!1,this.hostScope=null,this.observerLocator=t.observerLocator,this.locator=t.locator}handleChange(t,e,s){this.obs.version++,this.value=this.expr.evaluate(s,this.scope,this.hostScope,this.locator,this),this.obs.clear(!1),this.updater(s)}$bind(t,e,s){this.isBound||(this.scope=e,this.hostScope=s,this.expr.hasBind&&this.expr.bind(t,e,s,this),this.value=this.expr.evaluate(t,e,s,this.locator,this),this.isBound=!0)}$unbind(t){this.isBound&&(this.expr.hasUnbind&&this.expr.unbind(t,this.scope,this.hostScope,this),this.scope=void 0,this.obs.clear(!0))}};et=N([h()],et);const st="tpt";let rt=class{"t-params.bind"(t,e,s){return new u(t,e,"","t-params.bind")}};rt=N([p({pattern:"t-params.bind",symbols:""})],rt);class it{constructor(t,e){this.from=t,this.to=e,this.type="tpt",this.mode=d.toView}}let nt=class{constructor(t){this.m=t,this.bindingType=53}static get inject(){return[f]}build(t){var e;let s;return s=null==t.bindable?null!==(e=this.m.map(t.node,t.attr.target))&&void 0!==e?e:r(t.attr.target):t.bindable.property,new it(t.expr,s)}};nt=N([m("t-params.bind")],nt);let ot=class{constructor(t,e,s){this.parser=t,this.observerLocator=e,this.platform=s}render(t,e,s,r,i){Z.create({parser:this.parser,observerLocator:this.observerLocator,context:s.container,controller:s,target:r,instruction:i,isParameterContext:!0,platform:this.platform})}};ot=N([b("tpt"),I(0,g),I(1,v),I(2,x)],ot);const at="tt";class ct{static registerAlias(t){this.prototype[t]=function(e,s,r){return new u(e,s,"",t)}}}class lt{constructor(t,e){this.from=t,this.to=e,this.type="tt",this.mode=d.toView}}class ht{constructor(t){this.m=t,this.bindingType=284}static get inject(){return[f]}build(t){var e;let s;return s=null==t.bindable?null!==(e=this.m.map(t.node,t.attr.target))&&void 0!==e?e:r(t.attr.target):t.bindable.property,new lt(t.expr,s)}}let ut=class{constructor(t,e,s){this.parser=t,this.observerLocator=e,this.platform=s}render(t,e,s,r,i){Z.create({parser:this.parser,observerLocator:this.observerLocator,context:s.container,controller:s,target:r,instruction:i,platform:this.platform})}};ut=N([b("tt"),I(0,g),I(1,v),I(2,x)],ut);const pt="tbt";class dt{static registerAlias(t){const e=`${t}.bind`;this.prototype[e]=function(t,s,r){return new u(t,s,r[1],e)}}}class ft{constructor(t,e){this.from=t,this.to=e,this.type="tbt",this.mode=d.toView}}class mt{constructor(t){this.m=t,this.bindingType=53}static get inject(){return[f]}build(t){var e;let s;return s=null==t.bindable?null!==(e=this.m.map(t.node,t.attr.target))&&void 0!==e?e:r(t.attr.target):t.bindable.property,new ft(t.expr,s)}}let bt=class{constructor(t,e,s){this.parser=t,this.observerLocator=e,this.platform=s}render(t,e,s,r,i){Z.create({parser:this.parser,observerLocator:this.observerLocator,context:s.container,controller:s,target:r,instruction:i,platform:this.platform})}};bt=N([b("tbt"),I(0,g),I(1,v),I(2,x)],bt);let gt=class{constructor(t){this.i18n=t,this.signals=["aurelia-translation-signal"]}toView(t,e){return this.i18n.tr(t,e)}};gt=N([y("t"),I(0,P)],gt);const vt=[gt,U];const xt=[K,F],yt=[W,z],wt=[G,_];const Lt=function t(e){return{optionsProvider:e,register(t){const s={initOptions:Object.create(null)};return e(s),t.register(function(t){const e=t.translationAttributeAliases,s=Array.isArray(e)?e:["t"],r=[],n=[],o=[],a=[];for(const t of s){const e=`${t}.bind`;r.push({pattern:t,symbols:""}),ct.registerAlias(t),n.push({pattern:e,symbols:"."}),dt.registerAlias(t),"t"!==t&&(o.push(t),a.push(e))}const c=[L.define(r,ct),T.define({name:"t",aliases:o},ht),ut,L.define(n,dt),T.define({name:"t.bind",aliases:a},mt),bt,rt,nt,ot];return{register:e=>e.register(i.callback(O,(()=>t.initOptions)),w.beforeActivate(P,(t=>t.initPromise)),i.singleton($,R),i.singleton(P,H),...c,...vt)}}(s),...xt,...yt,...wt)},customize:s=>t(s||e)}}((()=>{}));export{F as DateFormatBindingBehavior,K as DateFormatValueConverter,P as I18N,Lt as I18nConfiguration,O as I18nInitOptions,D as I18nKeyEvaluationResult,H as I18nService,z as NumberFormatBindingBehavior,W as NumberFormatValueConverter,_ as RelativeTimeBindingBehavior,G as RelativeTimeValueConverter,S as Signals,ct as TranslationAttributePattern,dt as TranslationBindAttributePattern,mt as TranslationBindBindingCommand,ft as TranslationBindBindingInstruction,bt as TranslationBindBindingRenderer,pt as TranslationBindInstructionType,Z as TranslationBinding,U as TranslationBindingBehavior,ht as TranslationBindingCommand,lt as TranslationBindingInstruction,ut as TranslationBindingRenderer,at as TranslationInstructionType,rt as TranslationParametersAttributePattern,nt as TranslationParametersBindingCommand,it as TranslationParametersBindingInstruction,ot as TranslationParametersBindingRenderer,st as TranslationParametersInstructionType,gt as TranslationValueConverter};
