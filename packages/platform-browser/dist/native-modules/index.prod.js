import{Platform as e,TaskQueue as t}from"../../../platform/dist/native-modules/index.js";const i=new Map;function o(e){return function(){throw new Error(`The PLATFORM did not receive a valid reference to the global function '${e}'.`)}}class s extends e{constructor(e,i={}){var s,n,d,a,m,h;super(e,i),this.domReadRequested=!1,this.domReadHandle=-1,this.domWriteRequested=!1,this.domWriteHandle=-1,this.Node="Node"in i?i.Node:e.Node,this.Element="Element"in i?i.Element:e.Element,this.HTMLElement="HTMLElement"in i?i.HTMLElement:e.HTMLElement,this.CustomEvent="CustomEvent"in i?i.CustomEvent:e.CustomEvent,this.CSSStyleSheet="CSSStyleSheet"in i?i.CSSStyleSheet:e.CSSStyleSheet,this.ShadowRoot="ShadowRoot"in i?i.ShadowRoot:e.ShadowRoot,this.MutationObserver="MutationObserver"in i?i.MutationObserver:e.MutationObserver,this.window="window"in i?i.window:e.window,this.document="document"in i?i.document:e.document,this.location="location"in i?i.location:e.location,this.history="history"in i?i.history:e.history,this.navigator="navigator"in i?i.navigator:e.navigator,this.fetch="fetch"in i?i.fetch:null!==(n=null===(s=e.fetch)||void 0===s?void 0:s.bind(e))&&void 0!==n?n:o("fetch"),this.requestAnimationFrame="requestAnimationFrame"in i?i.requestAnimationFrame:null!==(a=null===(d=e.requestAnimationFrame)||void 0===d?void 0:d.bind(e))&&void 0!==a?a:o("requestAnimationFrame"),this.cancelAnimationFrame="cancelAnimationFrame"in i?i.cancelAnimationFrame:null!==(h=null===(m=e.cancelAnimationFrame)||void 0===m?void 0:m.bind(e))&&void 0!==h?h:o("cancelAnimationFrame"),this.customElements="customElements"in i?i.customElements:e.customElements,this.flushDomRead=this.flushDomRead.bind(this),this.flushDomWrite=this.flushDomWrite.bind(this),this.domReadQueue=new t(this,this.requestDomRead.bind(this),this.cancelDomRead.bind(this)),this.domWriteQueue=new t(this,this.requestDomWrite.bind(this),this.cancelDomWrite.bind(this))}static getOrCreate(e,t={}){let o=i.get(e);return void 0===o&&i.set(e,o=new s(e,t)),o}static set(e,t){i.set(e,t)}requestDomRead(){this.domReadRequested=!0,-1===this.domWriteHandle&&(this.domWriteHandle=this.requestAnimationFrame(this.flushDomWrite))}cancelDomRead(){this.domReadRequested=!1,this.domReadHandle>-1&&(this.clearTimeout(this.domReadHandle),this.domReadHandle=-1),!1===this.domWriteRequested&&this.domWriteHandle>-1&&(this.cancelAnimationFrame(this.domWriteHandle),this.domWriteHandle=-1)}flushDomRead(){this.domReadHandle=-1,!0===this.domReadRequested&&(this.domReadRequested=!1,this.domReadQueue.flush())}requestDomWrite(){this.domWriteRequested=!0,-1===this.domWriteHandle&&(this.domWriteHandle=this.requestAnimationFrame(this.flushDomWrite))}cancelDomWrite(){this.domWriteRequested=!1,this.domWriteHandle>-1&&(!1===this.domReadRequested||this.domReadHandle>-1)&&(this.cancelAnimationFrame(this.domWriteHandle),this.domWriteHandle=-1)}flushDomWrite(){this.domWriteHandle=-1,!0===this.domWriteRequested&&(this.domWriteRequested=!1,this.domWriteQueue.flush()),!0===this.domReadRequested&&-1===this.domReadHandle&&(this.domReadHandle=this.setTimeout(this.flushDomRead,0))}}export{s as BrowserPlatform};
