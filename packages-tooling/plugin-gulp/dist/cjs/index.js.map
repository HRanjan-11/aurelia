{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import { Transform } from 'stream';\nimport { IOptionalPreprocessOptions, preprocess, preprocessOptions } from '@aurelia/plugin-conventions';\nimport * as Vinyl from 'vinyl';\n\nexport default function (options: IOptionalPreprocessOptions = {}) {\n  return plugin({\n    ...options,\n    useProcessedFilePairFilename: true,\n    stringModuleWrap\n  });\n}\n\nexport function plugin(\n  options: IOptionalPreprocessOptions,\n  _preprocess = preprocess // for testing\n) {\n  const allOptions = preprocessOptions(options);\n  return new Transform({\n    objectMode: true,\n    transform: function (file: Vinyl, enc, cb) {\n      if (file.isStream()) {\n        this.emit('error', new Error('@aurelia/plugin-gulp: Streaming is not supported'));\n      } else if (file.isBuffer()) {\n        // Rewrite foo.html to foo.html.js\n        const result = _preprocess(\n          {\n            path: file.relative,\n            contents: file.contents.toString(),\n            base: file.base\n          },\n          allOptions\n        );\n\n        if (result) {\n          if (allOptions.templateExtensions.includes(file.extname)) {\n            // Rewrite foo.html to foo.html.js, or foo.md to foo.md.js\n            file.basename += '.js';\n          }\n\n          file.contents = Buffer.from(result.code);\n          if (file.sourceMap) {\n            // ignore existing source map for now\n            file.sourceMap = result.map;\n          }\n        }\n      }\n      cb(undefined, file);\n    }\n  });\n}\n\nfunction stringModuleWrap(id: string) {\n  return `text!${id}`;\n}\n"],"names":["preprocess","preprocessOptions","Transform"],"mappings":";;;;;;;AAIyB,cAAA,EAAA,OAAA,GAAsC,EAAE,EAAA;AAC/D,IAAA,OAAO,MAAM,CAAC;AACZ,QAAA,GAAG,OAAO;AACV,QAAA,4BAA4B,EAAE,IAAI;QAClC,gBAAgB;AACjB,KAAA,CAAC,CAAC;AACL,CAAC;AAEK,SAAU,MAAM,CACpB,OAAmC,EACnC,WAAW,GAAGA,4BAAU;;AAExB,IAAA,MAAM,UAAU,GAAGC,mCAAiB,CAAC,OAAO,CAAC,CAAC;IAC9C,OAAO,IAAIC,gBAAS,CAAC;AACnB,QAAA,UAAU,EAAE,IAAI;AAChB,QAAA,SAAS,EAAE,UAAU,IAAW,EAAE,GAAG,EAAE,EAAE,EAAA;AACvC,YAAA,IAAI,IAAI,CAAC,QAAQ,EAAE,EAAE;gBACnB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC,CAAC;AACnF,aAAA;AAAM,iBAAA,IAAI,IAAI,CAAC,QAAQ,EAAE,EAAE;;gBAE1B,MAAM,MAAM,GAAG,WAAW,CACxB;oBACE,IAAI,EAAE,IAAI,CAAC,QAAQ;AACnB,oBAAA,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;oBAClC,IAAI,EAAE,IAAI,CAAC,IAAI;iBAChB,EACD,UAAU,CACX,CAAC;AAEF,gBAAA,IAAI,MAAM,EAAE;oBACV,IAAI,UAAU,CAAC,kBAAkB,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;;AAExD,wBAAA,IAAI,CAAC,QAAQ,IAAI,KAAK,CAAC;AACxB,qBAAA;oBAED,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;oBACzC,IAAI,IAAI,CAAC,SAAS,EAAE;;AAElB,wBAAA,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,GAAG,CAAC;AAC7B,qBAAA;AACF,iBAAA;AACF,aAAA;AACD,YAAA,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;SACrB;AACF,KAAA,CAAC,CAAC;AACL,CAAC;AAED,SAAS,gBAAgB,CAAC,EAAU,EAAA;IAClC,OAAO,CAAA,KAAA,EAAQ,EAAE,CAAA,CAAE,CAAC;AACtB;;;;;"}