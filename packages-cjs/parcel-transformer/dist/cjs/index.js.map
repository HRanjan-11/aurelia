{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import { Transformer } from '@parcel/plugin';\nimport SourceMap from '@parcel/source-map';\nimport { IOptionalPreprocessOptions, preprocess } from '@aurelia/plugin-conventions';\n// eslint-disable-next-line import/no-nodejs-modules\nimport { relative } from 'path';\n\nexport default new Transformer({\n  async loadConfig({config}) {\n    try {\n      const conf = await config.getConfig([], {packageKey: 'aurelia'});\n      return conf ? conf.contents : {};\n    } catch (e) {\n      return {};\n    }\n  },\n  async transform({asset, config, options}) {\n    // parcel conventions puts app's index.html inside src/ folder.\n    if (asset.filePath.endsWith('src/index.html')) return [asset];\n\n    const source = await asset.getCode();\n    const result = preprocess(\n      {\n        path: relative(options.projectRoot, asset.filePath.slice()),\n        contents: source\n      },\n      config as IOptionalPreprocessOptions\n    );\n\n    if (!result) {\n      return [asset];\n    }\n\n    asset.setCode(result.code);\n    const map = new SourceMap();\n    map.addVLQMap(result.map);\n    asset.setMap(map);\n\n    if (asset.type === 'html') {\n      asset.type = 'js';\n    }\n\n    // Return the asset\n    return [asset];\n  }\n});\n"],"names":["Transformer","preprocess","relative","SourceMap"],"mappings":";;;;;;;;;;;;;AAMA,YAAe,IAAIA,kBAAW,CAAC;IAC7B,MAAM,UAAU,CAAC,EAAC,MAAM,EAAC;QACvB,IAAI;YACF,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,EAAC,UAAU,EAAE,SAAS,EAAC,CAAC,CAAC;YACjE,OAAO,IAAI,GAAG,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;SAClC;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,EAAE,CAAC;SACX;KACF;IACD,MAAM,SAAS,CAAC,EAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAC;;QAEtC,IAAI,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,gBAAgB,CAAC;YAAE,OAAO,CAAC,KAAK,CAAC,CAAC;QAE9D,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,OAAO,EAAE,CAAC;QACrC,MAAM,MAAM,GAAGC,4BAAU,CACvB;YACE,IAAI,EAAEC,aAAQ,CAAC,OAAO,CAAC,WAAW,EAAE,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;YAC3D,QAAQ,EAAE,MAAM;SACjB,EACD,MAAoC,CACrC,CAAC;QAEF,IAAI,CAAC,MAAM,EAAE;YACX,OAAO,CAAC,KAAK,CAAC,CAAC;SAChB;QAED,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC3B,MAAM,GAAG,GAAG,IAAIC,6BAAS,EAAE,CAAC;QAC5B,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAC1B,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAElB,IAAI,KAAK,CAAC,IAAI,KAAK,MAAM,EAAE;YACzB,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC;SACnB;;QAGD,OAAO,CAAC,KAAK,CAAC,CAAC;KAChB;CACF,CAAC;;;;"}