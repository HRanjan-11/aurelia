{"version":3,"file":"index.cjs.js","sources":["../../src/index.ts"],"sourcesContent":["import { Transform } from 'stream';\nimport { IOptionalPreprocessOptions, preprocess, preprocessOptions } from '@aurelia/plugin-conventions';\nimport * as Vinyl from 'vinyl';\n\nexport default function (options: IOptionalPreprocessOptions = {}) {\n  return plugin({\n    ...options,\n    useProcessedFilePairFilename: true,\n    stringModuleWrap\n  });\n}\n\nexport function plugin(\n  options: IOptionalPreprocessOptions,\n  _preprocess = preprocess // for testing\n) {\n  const allOptions = preprocessOptions(options);\n  return new Transform({\n    objectMode: true,\n    transform: function (file: Vinyl, enc, cb) {\n      if (file.isStream()) {\n        this.emit('error', new Error('@aurelia/plugin-gulp: Streaming is not supported'));\n      } else if (file.isBuffer()) {\n        // Rewrite foo.html to foo.html.js\n        const result = _preprocess(\n          {\n            path: file.relative,\n            contents: file.contents.toString(),\n            base: file.base\n          },\n          allOptions\n        );\n\n        if (result) {\n          if (allOptions.templateExtensions.includes(file.extname)) {\n            // Rewrite foo.html to foo.html.js, or foo.md to foo.md.js\n            file.basename += '.js';\n          }\n\n          file.contents = Buffer.from(result.code);\n          if (file.sourceMap) {\n            // ignore existing source map for now\n            file.sourceMap = result.map;\n          }\n        }\n      }\n      cb(undefined, file);\n    }\n  });\n}\n\nfunction stringModuleWrap(id: string) {\n  return `text!${id}`;\n}\n"],"names":["preprocess","preprocessOptions","Transform"],"mappings":";;;;;;;gBAIyB,UAAsC,EAAE;IAC/D,OAAO,MAAM,CAAC;QACZ,GAAG,OAAO;QACV,4BAA4B,EAAE,IAAI;QAClC,gBAAgB;KACjB,CAAC,CAAC;AACL,CAAC;SAEe,MAAM,CACpB,OAAmC,EACnC,WAAW,GAAGA,4BAAU;;IAExB,MAAM,UAAU,GAAGC,mCAAiB,CAAC,OAAO,CAAC,CAAC;IAC9C,OAAO,IAAIC,gBAAS,CAAC;QACnB,UAAU,EAAE,IAAI;QAChB,SAAS,EAAE,UAAU,IAAW,EAAE,GAAG,EAAE,EAAE;YACvC,IAAI,IAAI,CAAC,QAAQ,EAAE,EAAE;gBACnB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC,CAAC;aACnF;iBAAM,IAAI,IAAI,CAAC,QAAQ,EAAE,EAAE;;gBAE1B,MAAM,MAAM,GAAG,WAAW,CACxB;oBACE,IAAI,EAAE,IAAI,CAAC,QAAQ;oBACnB,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;oBAClC,IAAI,EAAE,IAAI,CAAC,IAAI;iBAChB,EACD,UAAU,CACX,CAAC;gBAEF,IAAI,MAAM,EAAE;oBACV,IAAI,UAAU,CAAC,kBAAkB,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;;wBAExD,IAAI,CAAC,QAAQ,IAAI,KAAK,CAAC;qBACxB;oBAED,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;oBACzC,IAAI,IAAI,CAAC,SAAS,EAAE;;wBAElB,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,GAAG,CAAC;qBAC7B;iBACF;aACF;YACD,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;SACrB;KACF,CAAC,CAAC;AACL,CAAC;AAED,SAAS,gBAAgB,CAAC,EAAU;IAClC,OAAO,QAAQ,EAAE,EAAE,CAAC;AACtB;;;;;"}