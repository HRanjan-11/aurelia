{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import { IOptionalPreprocessOptions, preprocess, preprocessOptions } from '@aurelia/plugin-conventions';\nimport { getOptions } from 'loader-utils';\nimport type * as webpack from 'webpack';\n\nexport default function (\n  // @ts-ignore TODO: fix types\n  this: webpack.loader.LoaderContext,\n  contents: string,\n  sourceMap?: object, // ignore existing source map for now\n) {\n  return loader.call(this, contents);\n}\n\nexport function loader(\n  // @ts-ignore TODO: fix types\n  this: webpack.loader.LoaderContext,\n  contents: string,\n  _preprocess = preprocess // for testing\n) {\n  // eslint-disable-next-line @typescript-eslint/no-unused-expressions, @typescript-eslint/strict-boolean-expressions\n  this.cacheable && this.cacheable();\n  // @ts-ignore TODO: fix types\n  const cb = this.async() as webpack.loader.loaderCallback;\n  const options = getOptions(this) as IOptionalPreprocessOptions;\n\n  const filePath = this.resourcePath;\n\n  try {\n    const result = _preprocess(\n      { path: filePath, contents },\n      preprocessOptions(options || {})\n    );\n    // webpack uses source-map 0.6.1 typings for RawSourceMap which\n    // contains typing error version: string (should be number).\n    // use result.map as any to bypass the typing issue.\n    if (result) {\n      cb(null, result.code, result.map as any);\n      return;\n    }\n\n    // bypassed\n    cb(null, contents);\n  } catch (e) {\n    cb(e);\n  }\n}\n"],"names":[],"mappings":";;;gBAOE,QAAgB,EAChB,SAAkB;IAElB,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;AACrC,CAAC;SAEe,MAAM,CAGpB,QAAgB,EAChB,WAAW,GAAG,UAAU;;;IAGxB,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;;IAEnC,MAAM,EAAE,GAAG,IAAI,CAAC,KAAK,EAAmC,CAAC;IACzD,MAAM,OAAO,GAAG,UAAU,CAAC,IAAI,CAA+B,CAAC;IAE/D,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC;IAEnC,IAAI;QACF,MAAM,MAAM,GAAG,WAAW,CACxB,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,EAC5B,iBAAiB,CAAC,OAAO,IAAI,EAAE,CAAC,CACjC,CAAC;;;;QAIF,IAAI,MAAM,EAAE;YACV,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,GAAU,CAAC,CAAC;YACzC,OAAO;SACR;;QAGD,EAAE,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;KACpB;IAAC,OAAO,CAAC,EAAE;QACV,EAAE,CAAC,CAAC,CAAC,CAAC;KACP;AACH;;;;"}